<!DOCTYPE HTML>
<html lang="en"> 
<head>
	<title>Table Editor</title>

	<link href='/WebPath/css/fonts.css?family=Inconsolata:400' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="/WebPath/css/ConfigurationGUI.css">
	<link rel="stylesheet" type="text/css" href="/WebPath/css/ConfigurationAPI.css">
	
	<style type="text/css">		
	
		.fixedChoiceAdd,
		.fixedChoiceAdd:hover {
			text-decoration: none;
			font-size: 30px;
			font-weight: bold;
			color: rgb(15, 152, 76);
		}

		.treeNode-deleteIcon {			
			background-image: 	url(/WebPath/images/windowContentImages/ConfigurationGUI-trashCan.png);
			width: 				16px;
			height: 			20px;
			border: 			0;
			margin: 			-9px 0 -10px 0px;
		}
		.treeNode-deleteIcon:hover {
			background-image: 	url(/WebPath/images/windowContentImages/ConfigurationGUI-trashCanHover.png);
			cursor: 			pointer;
		}
		
		preloadImage {			
			width: 				24px;
			height: 			20px;
			position:			absolute;
			left: 				-100px;
			top: 				0;
		}
		#preloadImage-treeEditTrashIcon {
			background-image: 	url(/WebPath/images/windowContentImages/ConfigurationGUI-trashCan.png);
		}
		#preloadImage-treeEditTrashIconHover {
			background-image: 	url(/WebPath/images/windowContentImages/ConfigurationGUI-trashCanHover.png);
		}
		
		#popUpDialog {
			position: absolute;
			z-index: 1000;    
			border: 1px solid #770000;
			background-color: #efeaea;
			text-align: center;
			padding: 10px;
			overflow: hidden;
		}
		
	</style>
	
	
	<script type="text/JavaScript" src="/WebPath/js/Globals.js"></script>	
	<script type="text/JavaScript" src="/WebPath/js/Debug.js"></script>	
	<script type="text/JavaScript" src="/WebPath/js/DesktopContent.js"></script>
	<script type="text/JavaScript" src="/WebPath/js/js_lib/SimpleContextMenu.js"></script>
	<script type="text/JavaScript" src="/WebPath/js/js_lib/ConfigurationAPI.js"></script>

	<script>		
		
	
		var _CONFIG_TYPE_ROW_OFFSET = 1;
		var _CONFIG_DATA_COL_OFFSET = 0;
		var _CONFIG_FIXED_CELLS = 3;
		

		var _typeArray = []; //filled by request to getColumnTypes, e.g.: ["Data", "UniqueData", "FixedChoiceData", "MultilineData", "BitMap", "OnOff", "TrueFalse", "YesNo", "ChildLinkUID", "ChildLinkGroupID", "ChildLink", "GroupID"]
		// Defined in ConfigurationAPI.js, for example: ConfigurationAPI._BITMAP_DATA_TYPE		
		
		var _dataTypeArray = [ConfigurationAPI._STRING_TYPE, ConfigurationAPI._NUMBER_TYPE, ConfigurationAPI._DATE_TYPE];
		var _defaultArray = {};
		var _minArray = {};
		var _maxArray = {};
				
		var _editingCell = false;
		var _editingCellEl, _editingCellElOldValue;
		var _editingCellPos = [-1,-1];	
		var _srcName;
		var _colHdrArr, _colTypeArr, _colDataTypeArr, _colDefaultValueArr, 
		_colMinValueArr, _colMaxValueArr, 
		_colChoicesArr;
		//variables for min and max
		//_colChoicesArr is CSV where first entry is always arbitraryBool=0/1 for fixed choice columns
		
		var _tableDescription;
		var _tableIsTransposed = false;
		
		var _mouseIsSelecting = false;	//to block switching cells when selecting text
	
		var _bitMapFieldsArr = ["Number of Rows",
								"Number of Columns",
								"Cell Bit-field Size",
								"Min-value Allowed",
								"Max-value Allowed",
								"Value step-size Allowed",
								"Display Aspect H:W",
								"Min-value Cell Color",
								"Mid-value Cell Color",
								"Max-value Cell Color",
								"Absolute Min-value Cell Color",
								"Absolute Max-value Cell Color",
								"Display Rows in Ascending Order",
								"Display Columns in Ascending Order",
								"Snake Double Rows",
								"Snake Double Columns"];
		var _bitMapFieldTypesArr = [ //types => 0:string, 1:bool (default no), 
									 	 //2:bool (default yes), 3:color 
									 0,//"Number of Rows",
									 0,//"Number of Columns",
									 0,//"Cell Bit-field Size",
									 0,//"Min-value Allowed",
									 0,//"Max-value Allowed",
									 0,//"Value step-size Allowed",
									 0,//"Display Aspect H:W",
									 3,//"Min-value Cell Color",
									 3,//"Mid-value Cell Color",
									 3,//"Max-value Cell Color",
									 3,//"Absolute Min-value Cell Color",
									 3,//"Absolute Max-value Cell Color",
									 1,//"Display Rows in Ascending Order",
									 2,//"Display Columns in Ascending Order",
									 1,//"Snake Double Rows",
									 1];//"Snake Double Columns"];

		var _tableName; //an array
		var _lastTableNameUsed;
		
		/////////////////////////////////////////////////////////////////////////////////////////
		/////////////////////////////////////////////////////////////////////////////////////////
	
		//functions:			
			//init()			
			//setupTableEditor(req)
			//saveTable()
			//loadTable()
			//verifyDeleteTable()
			//deleteTable()
			//setupSpecificTable(tableName, version)		//setup editor for specific configuration table
			//specificTableRequestHandler(req)
			//setupEmptyTable();
			//setupTable(srcName,colHdrs,colTypes,colDefaultValues,colDataTypes,colDefaultValues,colChoices,tableDescription)
			//selectThisCell(r,c,el)
			//setCaretPosition(el,start,stop)
			//editCellCancel()
			//editCellOK()
			//addColumn(c)
			//deleteColumn(c)
			//transposeTable()
			//createEditTableMenu(event)
			//setupFindAndReplace()
			//setupCopyAndMoveFields()
			//copyOrMoveField(deleteSrc)
			//tableReplace()
		
			//keyHandler(e)
			//descriptionKeyHandler(e,tel)
			//fixedChoiceKeyHandler(e,c) 
		
			//handlefixedChoiceArbitraryCheckbox(c,inverted)
			//addFixedChoice(c)
			//deleteSelectedFixedChoice(c)
			//downloadFixedChoices(c)
			//popUpUploadFixedChoicesForm(c)
			//uploadFixedChoices(c)
		
			
	
		/////////////////////////////////////////////////////////////////////////////////////////
		/////////////////////////////////////////////////////////////////////////////////////////
						

		//==============================================================================
		//init ~
		//	init called once body has loaded
		function init() 
		{			
			Debug.log("CfgTableEditor init");

			
			var windowTooltip = 
				"Welcome to the <i>otsdaq</i> Table Editor. " +
				"You will find different tables that can be modified or deleted according to your needs \n\n" +

				"\n\t- <b>Main Functions:</b> " +
				"<INDENT>" +
				"You can check all table names by clicking on Table name list. " +
				" If you want to load a particular table just press " +
				"LOAD icon, or if you want to delete it then you can use " +
				"DELETE button. It will ask for confirmation for deletion " +
				"You can also save a table by changing an empty template or " +
				"load a different one, then giving it a name on table name blank space " +
				"and then pressing SAVE icon. " +
				"</INDENT>" +

				"\n\t- <b>Operations on Empty Table:</b> " +
				"<INDENT>" +
				"You will find an empty table template with four columns that can't be changed " +
				"If you want to include a new column just press the add button ( + ) " +
				"You can also delete one column by using the minus button ( - ) " +
				"You can also change names and values of each new column, because the preexisting ones " +
				"can't be modified. " +
				"</INDENT>" +

				"\n\t- <b>Changing values on Fields</b> " +
				"<INDENT>" +
				"By clicking on any desired field you will be given the option to change its value " +
				"If you change the type of data to NUMBER then two more blocks will appear: Minimum and Maximum " +
				"You can use them to limit the number that can be assigned on that field to a specific range " +
				"Their default value is empty, so if you don't put anything on them they will not be saved " +
				"You can also use environmental variables and, if needed, you can do basic operations between " +
				"an environmental value expressed within braces '{}' and any number " +
				"</INDENT>" +

				"\n\t- <b>Table Description:</b> " +
				"<INDENT>" +
				"You can set a description for the table contents on the white block at the bottom of the page" +
				"for information about the columns meaning, or limits or whatever you need. " +
				"</INDENT>" +

				"\n\nRemember, if you would like to take a look at the available online documentation, " +
				"click the question mark at the top-right of the Desktop." ;
			
			DesktopContent.tooltip("Table Editor Introduction", windowTooltip);
			DesktopContent.setWindowTooltip(windowTooltip);



			//attempt to get last table name used.. to load after refresh
			_lastTableNameUsed = "";
			try
			{
				_lastTableNameUsed = document.getElementById("loadFromConfigName").value;
				Debug.log("_lastTableNameUsed=" + _lastTableNameUsed);
			}
			catch(e) {} //ignore any errors
			
			
			DesktopContent.XMLHttpRequest("Request?RequestType=getColumnTypes", "",
					function(req) {

				var colTypes = req.responseXML.getElementsByTagName("columnTypeForGUI");
				var colDataTypes = req.responseXML.getElementsByTagName("columnDataTypeForGUI");								
				var defDataType = req.responseXML.getElementsByTagName("columnDefaultDataType");
				var defTypeFilter = req.responseXML.getElementsByTagName("columnDefaultTypeFilter");
				var defValue = req.responseXML.getElementsByTagName("columnDefaultValue");
				// added min and max value here to get elements by tag name as well
				var minValue= req.responseXML.getElementsByTagName("columnMinValue");
				var maxValue= req.responseXML.getElementsByTagName("columnMaxValue");
				
				if(colTypes.length)
					_typeArray = []; //clear and take from data
				for(var i=0;i<colTypes.length;++i)
					_typeArray.push(colTypes[i].getAttribute("value"));
				
				Debug.log("colTypes.length = " + colTypes.length);

				if(colDataTypes.length)
					_dataTypeArray = []; //clear and take from data
				for(var i=0;i<colDataTypes.length;++i)
					_dataTypeArray.push(colDataTypes[i].getAttribute("value"));				
				
				_defaultArray = {};
						// fill min and max array
				_minArray = {};
				_maxArray = {};

				var dVal;
				var minVal;
				var maxVal;
				for(var i=0;i<_dataTypeArray.length;++i)
				{
					_defaultArray[_dataTypeArray[i]] = {};

					_minArray[_dataTypeArray[i]] = {};
					_maxArray[_dataTypeArray[i]] = {};

					for(var j=0;j<_typeArray.length;++j)
					{
						//search through default dataTypes and type filter pairs
						var found = false;
						for(var a=0;a<defDataType.length;++a)
						{
							if(_dataTypeArray[i] == 
									defDataType[a].getAttribute("value"))
							{
								if("*" == 
										defTypeFilter[a].getAttribute("value"))
								{
									found = true;
									dVal = defValue[a].getAttribute("value");
									// minVal = minValue[a].getAttribute("value");
									// maxVal = maxValue[a].getAttribute("value");
									break;
								}
								else if(_typeArray[j] == 
										defTypeFilter[a].getAttribute("value"))
								{
									found = true;
									dVal = defValue[a].getAttribute("value");
									// minVal = minValue[a].getAttribute("value");
									// maxVal = maxValue[a].getAttribute("value");
									break;
								}
							}
						}

						//shall min and max be included here?
						
						if(!found)
						{
							Debug.log("Impossible error occured!... Looking for " +
									_dataTypeArray[i] + " and " + _typeArray[j] + ".",
									Debug.HIGH_PRIORITY);
							return;
						}
						
						_defaultArray[_dataTypeArray[i]]
									  [_typeArray[j]]
									  = dVal;
						
						_minArray[_dataTypeArray[i]]
									  [_typeArray[j]]
									  = [];

						_maxArray[_dataTypeArray[i]]
									  [_typeArray[j]]
									  = [];
						
					}
				}
				
				//set UID and specials to that of Data
				_defaultArray[ConfigurationAPI._STRING_TYPE]["UID"] = _defaultArray[ConfigurationAPI._STRING_TYPE]["Data"];
				_defaultArray[ConfigurationAPI._NUMBER_TYPE]["UID"] = _defaultArray[ConfigurationAPI._NUMBER_TYPE]["Data"];
				_defaultArray[ConfigurationAPI._STRING_TYPE]["Comment"] = _defaultArray[ConfigurationAPI._STRING_TYPE]["Data"];
				_defaultArray[ConfigurationAPI._STRING_TYPE]["Author"] = _defaultArray[ConfigurationAPI._STRING_TYPE]["Data"];
				_defaultArray[ConfigurationAPI._DATE_TYPE]["Timestamp"] = _defaultArray[ConfigurationAPI._DATE_TYPE]["Data"];
				
				Debug.log("default array = ",_defaultArray);
				Debug.log("min array = ",_minArray);
				Debug.log("max array = ",_maxArray);


				DesktopContent.XMLHttpRequest("Request?RequestType=getTables&refresh=1", "",
						setupTableEditor,
						0 /*handler param*/,
						0 /*progressHandler*/,
						true /*callHandlerOnErr*/);
			});
						
			window.onmouseup = function(event) {	
				editCellOK();//editCellCancel();  
				_mouseIsSelecting = false; 
				//Debug.log(_mouseIsSelecting);
			};		
		}

		//==============================================================================
		//setupTableEditor(req) ~
		function setupTableEditor(req)
		{
			var err = DesktopContent.getXMLValue(req,"Error");
			if(err) 
			{
				Debug.log(err,Debug.HIGH_PRIORITY);
				//attempt to power through
			}

			var configNames = req.responseXML.getElementsByTagName("TableName");
			var tableVersionHdr = req.responseXML.getElementsByTagName("TableVersions");

			//Save Column Info as...
			//	Configuration Name:
			//	
			//Load Column Info from...
			//	Configuration Name: ____^

			var str = "";

			str += "Load Column Info from... "; 
			str += " <input type='button' onmouseup='loadTable()' value='Load'/>";
			str += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Delete Table... "; 			
			str += " <input type='button' onmouseup='verifyDeleteTable()' value='Delete'/>";
			str += " <input id='reallyDeleteButton' type='button' style='display:none' onmouseup='deleteTable()' value='Really Delete!'/>";
			
			str += "<br>&nbsp;&nbsp;Table Name:";

			str += "<select id='loadFromConfigName' " +
					"onchange='document.getElementById(\"reallyDeleteButton\").style.display = \"none\";' " +
					">";

			var tableName;

			_tableName = [];
			
			Debug.log("CfgTableEditor requestHandler configNames.length " + configNames.length);
			Debug.log("_lastTableNameUsed=" + _lastTableNameUsed);
			for(var i=0;i<configNames.length;++i)
			{			
				tableName = configNames[i].getAttribute("value");

				str += "<option value='" + tableName + "' " +
						(tableName == _lastTableNameUsed?"selected":"") +
						">";
				str += tableName;	//can display however
				str += "</option>";
				
				_tableName.push(tableName); //keep list of table names for forcing link names
			}				
			str += "</select>";

			str += "<br><br>";
			str += "Save Column Info as...";
			str += " <input id='overwriteButton' style='display:none' type='button' onmouseup='saveTable(1)' value='Overwrite'/>";
			str += "<br>&nbsp;&nbsp;Table Name:";							
			str += "<input type='text' id='SaveAsConfigName' " + 
					"onchange='document.getElementById(\"overwriteButton\").style.display = \"none\";' " +
					"style='margin:-4px -2px -4px -1px; width:310px' value=''>";
			str += " <input type='button' onmouseup='saveTable(0)' value='Save'/>";
			
			var el = document.getElementById("controls");
			el.innerHTML = str;
			

			if(_lastTableNameUsed && _lastTableNameUsed != "")
				loadTable();
			else
				setupEmptyTable();
			
		} //end setupTableEditor

		//==============================================================================
		
		function handleTypeSelect()
		{
			var sel = document.getElementById("selectCellTypeSelect");
			if(sel.selectedIndex < 0) sel.selectedIndex = 0; //default to default, is there a way to include default in the min and max fields?
			var selVal = sel.options[sel.selectedIndex].value;
			Debug.log("CfgTableEditor handleTypeSelect = " + selVal);

			var cellSelect = document.getElementById("selectCellDataTypeSelect");
			if(cellSelect.selectedIndex < 0) cellSelect.selectedIndex = 0;
			var cellSelectVal = cellSelect.options[cellSelect.selectedIndex].value;
			Debug.log("CfgTableEditor handleTypeSelect: cellSelect = "+ cellSelectVal);
			
			//show Link ID or not
			{
				var specTypeArray = ["GroupID","ChildLink","ChildLinkUID","ChildLinkGroupID"];

				var found = false;
				for(var i=0;i<specTypeArray.length;++i)
					if(selVal == specTypeArray[i]) { found = true; break; }

				var el = document.getElementById("selectCellSpecTypeID");

				el.style.display = found?"block":"none";	
			}
			
			//show defaultValue or not
			{
				specTypeArray = ["Data","UniqueData","UniqueGroupData",
								 "FixedChoiceData","MultilineData"];

				var found = false;
				for(var i=0;i<specTypeArray.length;++i)
					if(selVal == specTypeArray[i]) { found = true; break; }

				var el = document.getElementById("selectCellSpecTypeDefaultDiv");
				var elMinMax = document.getElementById("selectCellSpecTypeMinMaxDiv");

				el.style.display = found?"block":"none";
				if(cellSelectVal == "NUMBER")
					elMinMax.style.display = found?"block":"none";
			}
			//show max and min if number is selected
			// {
			// 	// show min and max
			// 	var elMinMax = document.getElementById("selectCellSpecTypeMinMaxDiv")
			// 	if(cellSelectVal == "NUMBER"){
			// 		elMinMax.style.display = "block";
			// 	}
			// 	else{
			// 		elMinMax.style.display = "none";
			// 	}
			// }
			
			//show defaultValue BOOL or not
			{
				specTypeArray = ["OnOff","TrueFalse","YesNo"];
	
				var found = false;
				for(var i=0;i<specTypeArray.length;++i)
					if(selVal == specTypeArray[i]) { found = true; break; }
	
				var el = document.getElementById("selectCellSpecTypeDefaultBoolDiv");
	
				el.style.display = found?"block":"none";
			}


		} //end handleTypeSelect

		//==============================================================================
		//loadTable ~
		function loadTable()
		{
			var sel = document.getElementById("loadFromConfigName");
			if(sel.selectedIndex < 0) sel.selectedIndex = 0; //default to default
			var tableName = sel.options[sel.selectedIndex].value;
			// do min and max need to be included here?
			Debug.log("CfgTableEditor loadTable from " + tableName);

			//load mockup for chosen table
			setupSpecificTable(tableName, -1);
		} //end loadTable()

		//==============================================================================
		//saveTable ~
		function saveTable(allowOverwrite)
		{
			var tableName = document.getElementById("SaveAsConfigName").value;
			
			Debug.log("CfgTableEditor saveTable=" + tableName);
			
			//values: _colHdrArr, _colTypeArr, _colDataTypeArr,_colDefaultValueArr;

			//	write new info file for tableName based CSV column info
			//			data="type,name,dataType;type,name,dataType;..."
			
			// create a string with all the values that will get converted in the server to a table, than then will return to this script to show it.			
			var data = "";
			for(var i=0;i<_colHdrArr.length;++i)
			{
				if (_colDataTypeArr[i] == ConfigurationAPI._NUMBER_TYPE) 
				{
					data += _colTypeArr[i] + "," + 
						encodeURIComponent(_colHdrArr[i].trim()) + "," +
						_colDataTypeArr[i] + "," +
						encodeURIComponent(_colDefaultValueArr[i].trim()) + "," +
						encodeURIComponent(_colMinValueArr[i]?_colMinValueArr[i].trim():"") + "," +
						encodeURIComponent(_colMaxValueArr[i]?_colMaxValueArr[i].trim():"") + ";";
				}
				else 
				{
					data += _colTypeArr[i] + "," + encodeURIComponent(_colHdrArr[i].trim()) + "," +
						_colDataTypeArr[i] + "," +
						encodeURIComponent(_colDefaultValueArr[i].trim()) + ";";
				}
			}
			//handle table description
			var tableDescription = document.getElementById("table-description").value.trim();			
			if(tableDescription.length)
				tableDescription = encodeURIComponent(tableDescription);
			else
				tableDescription = "No description.";
			
			//col choices are CSV for each column and ; separated columns
			//	if col type is BitMap extract the input values
			var colChoicesData = "";
			for(var i=0;i<_colChoicesArr.length;++i)
			{
				if(_colTypeArr[i] == "BitMap")
				{
					Debug.log("BitMap saving " + i);					
					//extract fields into col choice array
					for(var j=0;j<_bitMapFieldsArr.length;++j) 
					{
						var el = document.getElementById("bitmapFieldInput-" + i + "-" + j);
						if(j) colChoicesData += ",";
						colChoicesData += encodeURIComponent(el.value);
					}
					colChoicesData += ";";	
				}
				else
				{					
					colChoicesData += _colChoicesArr[i] + ";";
				}
			}
			
			DesktopContent.XMLHttpRequest("Request?RequestType=saveTableInfo" +
				"&tableName=" + tableName + 
				"&allowOverwrite="+allowOverwrite, 
				"columnCSV=" + data + 
				"&tableDescription=" + tableDescription +
				"&columnChoicesCSV=" + colChoicesData, 
				specificTableRequestHandler, 
				1 /*handler param*/,
				0 /*progressHandler*/,
				true /*callHandlerOnErr*/);	
		} //end saveTable()
		
		//==============================================================================
		//verifyDeleteTable ~
		function verifyDeleteTable()
		{
			var sel = document.getElementById("loadFromConfigName");
			if(sel.selectedIndex < 0) sel.selectedIndex = 0; //default to default
			var tableName = sel.options[sel.selectedIndex].value;
			
			Debug.log("CfgTableEditor verifyDeleteTable from " + tableName);
			
			Debug.log("Are you sure you want to delete the " +
					"configuration '" +  tableName + 
					"'? If so, click the 'Really Delete!' button.",
					Debug.WARN_PRIORITY);
			document.getElementById("reallyDeleteButton").style.display = "inline";			
		}

		//==============================================================================
		//deleteTable ~
		function deleteTable()
		{
			var sel = document.getElementById("loadFromConfigName");
			if(sel.selectedIndex < 0) sel.selectedIndex = 0; //default to default
			var tableName = sel.options[sel.selectedIndex].value;			
			Debug.log("CfgTableEditor deleteTable from " + tableName);

			_lastTableNameUsed = "";
			
			document.getElementById("reallyDeleteButton").style.display = "none";
			DesktopContent.XMLHttpRequest("Request?RequestType=deleteTableInfo" +
				"&tableName=" + tableName, "",
				function(req)
				{
					//on success reload all configurations
					DesktopContent.XMLHttpRequest("Request?RequestType=getTables" +
							"&refresh=1", "",
							setupTableEditor,
							0 /*handler param*/,
							0 /*progressHandler*/,
							true /*callHandlerOnErr*/);					
				} //end of delete handler		
			);
		} //end deleteTable()

		//==============================================================================
		//setupSpecificTable ~
		//	undefined version gives latest
		function setupSpecificTable(tableName,version) 
		{
			var v = "";
			if(version) v = "&version="+version;
			document.getElementById("SaveAsConfigName").value = tableName;
			DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificTable&allowIllegalColumns=1" + 
					"&dataOffset=0&chunkSize=0" +  
					"&tableName=" + tableName + 
					v, 
					"", 
					specificTableRequestHandler, 
					0 /*handler param*/,
					0 /*progressHandler*/,
					true /*callHandlerOnErr*/);		
		} //end setupSpecificTable()	

		//==============================================================================
		//setupEmptyTable
		function setupEmptyTable()
		{
			var colHdrs = ["UID","CommentDescription","Author","RecordInsertionTime"];
			var colTypes = ["UID","Comment","Author","Timestamp"];
			var colDataTypes = [ConfigurationAPI._STRING_TYPE, ConfigurationAPI._STRING_TYPE, ConfigurationAPI._STRING_TYPE, ConfigurationAPI._DATE_TYPE];
			var colDefaultValues = [
				_defaultArray[ConfigurationAPI._STRING_TYPE][colTypes[0]],
				_defaultArray[ConfigurationAPI._STRING_TYPE][colTypes[1]],
				_defaultArray[ConfigurationAPI._STRING_TYPE][colTypes[2]],
				_defaultArray[ConfigurationAPI._DATE_TYPE][colTypes[3]]];
				// included min and max values starting points, same as default. Originally they were empty
			var colMinValues =
				[ //colDefaultValues;
					//	_defaultArray[ConfigurationAPI._STRING_TYPE][colTypes[0]],
					//_defaultArray[ConfigurationAPI._STRING_TYPE][colTypes[1]],
					//	_defaultArray[ConfigurationAPI._STRING_TYPE][colTypes[2]],
					//	_defaultArray[ConfigurationAPI._DATE_TYPE][colTypes[3]]
				]
				;
			var colMaxValues =
				[ //colDefaultValues;
					//	_defaultArray[ConfigurationAPI._STRING_TYPE][colTypes[0]],
					//_defaultArray[ConfigurationAPI._STRING_TYPE][colTypes[1]],
					//	_defaultArray[ConfigurationAPI._STRING_TYPE][colTypes[2]],
					//	_defaultArray[ConfigurationAPI._DATE_TYPE][colTypes[3]]
				]
				;
			var colHdrs = ["UID","CommentDescription","Author","RecordInsertionTime"];
			var colChoices = ["","","",""];

			// this one does not show values of min and max yet, it always default them to some letters from no description, fix defaultarray. 

			setupTable("Empty Table Template",colHdrs,colTypes,colDataTypes, colDefaultValues, 
					colChoices, colMinValues, colMaxValues, "No description.");
		} //end setupEmptyTable()

		//==============================================================================
		//specificTableRequestHandler
		function specificTableRequestHandler(req, isFromSaveReq) 
		{

			var tableName = DesktopContent.getXMLValue(req,"TableName");
			var err = DesktopContent.getXMLValue(req,"Error");
			if(err) 
			{				
				var writeErr = DesktopContent.getXMLValue(req,"OverwriteError");
				if(writeErr) //overwrite rejection
				{
					Debug.log(err,Debug.WARN_PRIORITY);
					Debug.log("Are you sure you want to overwrite the " +
							"configuration '" +  tableName + 
							"'? If so, click the 'Overwrite' button.",
							Debug.WARN_PRIORITY);
					document.getElementById("overwriteButton").style.display = "inline";
					return;
				}
				else
				{
					Debug.log(err,Debug.HIGH_PRIORITY);
					//try to power through
				}
			}
//			else if(tableName != "")
//				Debug.log("Column info for table '" + tableName + "' was successfully loaded!",
//						Debug.INFO_PRIORITY);
				
			document.getElementById("overwriteButton").style.display = "none";						
			
			if(isFromSaveReq && !err)
				Debug.log("Successful response to save request of Info for '" + tableName + "'",Debug.INFO_PRIORITY);
			
			if(!req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0])
				return;
			
			var colHdrs = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnHeader");
			var colTypes = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnType");
			var colDataTypes = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnDataType");
			var colDefaultValues = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnDefaultValue");
			var colMinValues = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnMinValue");
			var colMaxValues = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnMaxValue");
			//	 min and max default values here as well? they are included already.

			var colChoices = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnChoices");

			var tableDescription = DesktopContent.getXMLValue(req,"TableDescription");
			
			var colHdrsArr = [];
			for(var i=0;i<colHdrs.length;++i)
				colHdrsArr.push(colHdrs[i].getAttribute("value"));
			var colTypesArr = [];
			for(var i=0;i<colTypes.length;++i)
				colTypesArr.push(colTypes[i].getAttribute("value"));
			var colDataTypesArr = [];
			for(var i=0;i<colDataTypes.length;++i)
				colDataTypesArr.push(colDataTypes[i].getAttribute("value"));
			var colDefaultValuesArr = [];
			for(var i=0;i<colDefaultValues.length;++i)
				colDefaultValuesArr.push(
						colDefaultValues[i].getAttribute("value"));

			// added minvaluesarr and maxvaluesarr
			var colMinValuesArr = [];
			for(var i=0;i<colMinValues.length;++i)
				colMinValuesArr.push(
						colMinValues[i].getAttribute("value"));

			var colMaxValuesArr = [];
			for(var i=0;i<colMaxValues.length;++i)
				colMaxValuesArr.push(
						colMaxValues[i].getAttribute("value"));						

			var colChoicesArr = [];
			for(var i=0;i<colChoices.length;++i)
			{
				var colChoiceArr = colChoices[i].getElementsByTagName("ColumnChoice");
				var csvStr = "";
				for(var j=0;j<colChoiceArr.length;++j)
				{
					if(csvStr.length) csvStr += ",";
					
					if(colTypesArr[i] != ConfigurationAPI._BITMAP_DATA_TYPE && //for fields with choices, except BitMap (BitMap does not use arbitraryBool)...
							!j)//force first to be arbitraryBool flag 							
					{
						if(colChoiceArr[j].getAttribute("value").indexOf("arbitraryBool=") != 0)
							csvStr += "arbitraryBool=0";
						else
							csvStr += colChoiceArr[j].getAttribute("value");
					}
					else						
						csvStr += encodeURIComponent(colChoiceArr[j].getAttribute("value"));
				}
				Debug.log("csvStr col=" + i + " csvChoices=" + csvStr);
				colChoicesArr.push(csvStr);
			}
			
			if(!isFromSaveReq)
				document.getElementById('SaveAsConfigName').value = tableName;
			
			Debug.log("tableDescription = " + tableDescription);
			setupTable(tableName,colHdrsArr,colTypesArr,colDataTypesArr,colDefaultValuesArr,
					colChoicesArr, colMinValuesArr, colMaxValuesArr, tableDescription);
		} //end specificTableRequestHandler()

		//==============================================================================
		//setupTable ~
		function setupTable(srcName,colHdrs,colTypes,colDataTypes,colDefaultValues,
				colChoices, colMinValues, colMaxValues, tableDescription)
		{
			Debug.log("colChoices ",colChoices);
			
			//handle use of cached _srcName
			if(!srcName)
				srcName = _srcName;
			else
				_srcName = srcName;
					 
			//cache data for add/delete ease
			if(!colHdrs)
				colHdrs = _colHdrArr;
			else
				_colHdrArr = colHdrs;
			if(!colTypes)
				colTypes = _colTypeArr;
			else
				_colTypeArr = colTypes;
			if(!colDataTypes)
				colDataTypes = _colDataTypeArr;
			else
				_colDataTypeArr = colDataTypes;	
			if(!colDefaultValues)
				colDefaultValues = _colDefaultValueArr;
			else
				_colDefaultValueArr = colDefaultValues;
			
			// added colminvalues and colmaxvalues	
			if(!colMinValues)
				colMinValues = _colMinValueArr;
			else
				_colMinValueArr = colMinValues; 
			if(!colMaxValues)
				colMaxValues = _colMaxValueArr;
			else
				_colMaxValueArr = colMaxValues;

			if(!colChoices)
				colChoices = _colChoicesArr;
			else
				_colChoicesArr = colChoices;	
			
			if(tableDescription === undefined)
			{
				try
				{
					//If possible, save and recover table description edits
					_tableDescription = document.getElementById("table-description").value;
				}
				catch(e)
				{}
				tableDescription = _tableDescription;
			}
			else
				_tableDescription = tableDescription;			

			//force proper comment name
			colHdrs[colHdrs.length-3] = "CommentDescription";
			_colHdrArr[colHdrs.length-3] = "CommentDescription";
			
			var str = "";
			
			str += "Starting point was loaded at " +
					(new Date()) + 
					"...<br>";

			//display edit menu
			str +=
					"<div class='tableView-Menu' onmousedown='createEditTableMenu(event);' title='Edit Menu'>" +
					"<div class='gotoNavDiv'></div>" +
					"</div>"; //end context menu link div

			str += "<div style='float:left;'>";
			str += "<b>" + srcName + "</b> (Mockup-View)";
			str += "</div>";
			

			str += "<div id='clearDiv'></div>";						
			str += "<div id='findAndReplace'></div>";				
			str += "<div id='copyAndMoveFields'></div>";
			
			//display table
			str += "<table id='SubSystemTable' border='1' cellspacing='5' cellpadding='1'>";
			
			//==============================
			function localDisplayPixelMaskInputs() 
			{

				Debug.log("BitMap col=" + c + " colTypes[c]=" + colTypes[c]);

				str += "<td>";				

				var colChoicesArr = colChoices[c].split(',');
				var bitMapFieldValues = [];
				for(var f=0;f<colChoicesArr.length;++f)
					if(colChoicesArr[f] == "") continue; //skip empty values
					else
						bitMapFieldValues.push(decodeURIComponent(colChoicesArr[f]));	

				function localAddBitmapFieldInput(i) {
					str += "<tr>";
					str += "<td style='white-space:nowrap; text-align:right; margin-right:5px;'>";
					str += _bitMapFieldsArr[i] + ":";
					str += "</td>";
					str += "<td>";
					
					if(_bitMapFieldTypesArr[i] == 0) //string
					{
						str += "<input type='text' id='bitmapFieldInput-" + c + "-" + i + 
								"' value='" + 
								(i<bitMapFieldValues.length?bitMapFieldValues[i]:"DEFAULT") +
								"' " +
								"onmouseup='event.stopPropagation();' " +
								"onclick='event.stopPropagation();" +
								"setCaretPosition(this,0,this.value.length);' " +
								"style='width:150px' />";
					}
					else if(_bitMapFieldTypesArr[i] == 1 || 
							_bitMapFieldTypesArr[i] == 2) //bool yes/no
					{
						var boolVals = ["No","Yes"];
						str += "<select " +
								"style='margin:0;' id='bitmapFieldInput-" + c + "-" + i + 
								"'>";
						for(var b=0;b<boolVals.length;++b)
						{			
							str += "<option value='" + boolVals[b] + "' ";
							
							if(boolVals[b] == 
									(i<bitMapFieldValues.length?
											bitMapFieldValues[i]:
											(_bitMapFieldTypesArr[i]==2?"Yes":"No")))
								str += "selected";									
							str += " >";
							str += boolVals[b];	//can display however
							str += "</option>";					
						}			
						str += "</select>";
					}
					else if(_bitMapFieldTypesArr[i] == 3) //color, (FIXME make color selector) string for now
					{
						str += "<input type='text' id='bitmapFieldInput-" + c + "-" + i + 
								"' value='" + 
								(i<bitMapFieldValues.length?bitMapFieldValues[i]:"DEFAULT") +
								"' " +
								"onmouseup='event.stopPropagation();' " +
								"onclick='event.stopPropagation();" +
								"setCaretPosition(this,0,this.value.length);' " +
								"style='width:150px' />";
					}
					str += "</td>";							
					str += "</tr>";
				}
				
				str += "<table style='float:right;'>";
				for(var i=0;i<3;++i)
					localAddBitmapFieldInput(i);
				
				str += "</table>";
				
				str += "<div id='clearDiv'></div>";
				
				//create hidden optional fields
				str += "<a href='#' onclick='javascript:" +
						"if(this.textContent.indexOf(\"Show\") == 0) " +
						"{ document.getElementById(\"bitmapFieldInput-optional\").style.display = \"block\";" +
						"this.innerHTML = \"Hide Optional Fields\";}" +
						"else " + 
						"{ document.getElementById(\"bitmapFieldInput-optional\").style.display = \"none\";" +
						"this.innerHTML = \"Show Optional Fields\";}" +
						"' style='float:right;'>" +
						"Show Optional Fields</a>";
				
				str += "<div id='clearDiv'></div>";
				
				str += "<table id='bitmapFieldInput-optional' style='display:none' style='float:right;'>";
				for(var i=3;i<_bitMapFieldsArr.length;++i)
					localAddBitmapFieldInput(i);
				str += "</table>";

				str += "</td>";

			} //end localDisplayPixelMaskInputs()
			
			//==============================
			function localDisplayChildLinkInputs() 
			{
				Debug.log("ChildLink col=" + c + " colTypes[c]=" + colTypes[c]);
				str += "<td>"; //start primary cell

				var colChoicesArr = colChoices[c].split(',');

				//add checkbox
				Debug.log("colChoicesArr[0] = " + colChoicesArr[0]);
				str += "<input type='checkbox' id='fixedChoiceArbitraryCheckbox-" + c +
						"' onclick='handlefixedChoiceArbitraryCheckbox(" + c + ",true)' " +
						(colChoicesArr[0] == "arbitraryBool=0"?"checked":"") + //note arbitrary check is inverted compared to fixedChoice field
						">";
				str += "Force table link to one or many table(s)<br>(Include '" + ConfigurationAPI._DATATYPE_LINK_DEFAULT + "' to allow disconnected links):";
				str += "</input>";

				str += "<br>";

				str += "<br>Choose from these tables...<br>";

				str += "<table cellpadding='2px' cellspacing='2px' border='0' >"; //open table
				str += "<tr><td>";
				
				str += "<select id='newChoiceInput-" + c + "' " +							
						">";
				
				//always include default first in selection list
				//shall be max and min included in these options??				
				str += "<option>" +
						ConfigurationAPI._DATATYPE_LINK_DEFAULT +
						"</option>";		
				for(var i=0;i<_tableName.length;++i)
				{
					str += "<option>" +
							_tableName[i] +
							"</option>";						
				}					
				str += "</select>";
				
			
				str += "</td><td style='white-space:nowrap' >";
				str += "<a class='fixedChoiceAdd' onclick='addFixedChoice(" + c + "); return false;' " +
						"title='Add table as a new fixed choice option for this column.\"'" +
						">";
				str += "+";
				str += "</a>";
				str += "</td></tr>";
				str += "</table>";



				str += "<br>...to build the list of allowed tables:<br>";
				
				str += "<table cellpadding='2px' cellspacing='2px' border='0' >"; //open table
				str += "<tr><td>";
				
				str += "<select id='fixedChoicesSelect-" + c + "' " +
						"onchange='document.getElementById(\"newChoiceInput-" + c + 
						"\").value = this.value;'" +
						">";
				
				//show fixed choices first		
				for(var f=1;f<colChoicesArr.length;++f)	
					str += "<option>" +
					decodeURIComponent(colChoicesArr[f]) +
					"</option>";		

				str += "</select>";

				str += "</td><td>";
				str += 
						"<div class='treeNode-deleteIcon' " + 
						"onmouseup='event.stopPropagation();' " +
						"onclick='event.stopPropagation();" +
						"deleteSelectedFixedChoice(" + c + ");' " +
						"title='Remove the currently selected choice for this column.' " +
						"></div>";



				str += "</td></tr>";
				str += "</table>";
				
				

				str += "</td>"; //end primary cell
				
			} //end localDisplayChildLinkInputs()

			//:::::
			function localInsertAddDeleteCell(c)
			{
				str += "<td>";					
				//show +/- columns where possible to add/delete
				if(c <= colTypes.length - _CONFIG_FIXED_CELLS)					
				{
					str += c + ". ";
					str += " <a class='tableAddRowButton' " +
							"title='Add a field before this field.' " +
							"onclick='addColumn(" + c + ");'>";
					str += "+";
					str += "</a>";

					if(c < colTypes.length - _CONFIG_FIXED_CELLS && colTypes[c] != "UID")
					{
						str += "/<a class='tableDeleteRowButton' " +
								"title='Delete this field.' " +
								"onclick='deleteColumn(" + c + ");'>";
						str += "-";
						str += "</a>";
					}
				}
				str += "</td>";
			} //end localInsertAddDeleteCell()

			//:::::
			function localInsertTypeCell(c)
			{
				str += "<td onmouseup='selectThisCell(" + _CONFIG_TYPE_ROW_OFFSET + "," +
						c + ",this,event);' style='width:100px'>";
				str += ConfigurationAPI.createTableColumnHeaderHTML(
					colTypes[c], colDataTypes[c], colChoices[c],
					colDefaultValues[c], colMinValues[c], colMaxValues[c]
				);
				// str += "<div style='font-size:12px' title='";		
				// str += colTypes[c];
				// str += " &#60;" + colDataTypes[c] + "&#62;";
				// str += " [Default: " + colDefaultValues[c];
		

				// // added min and max in the same way as default values, making it only visible if it is a number type				
				// if (colDataTypes[c] == ConfigurationAPI._NUMBER_TYPE)
				// {
				// 	if (colMinValues[c] != "" && colMinValues[c] != "null")
				// 		str += "<br>Minimum: " + colMinValues[c];
				// 	if (colMaxValues[c] != "" && colMinValues[c] != "null")
				// 		str += "<br>Maximum: " + colMaxValues[c];

				// }
				// str += "]";
				// str += "'><label style='font-weight:bold;color:black;font-size:12px;'>";
				// str += colTypes[c];
				// str += "</label><br>&#60;" + colDataTypes[c] + "&#62;";
				// str += "<br>[Default: " + colDefaultValues[c];
				
				// //if fixed choice, then show that Default= the first choice
				// if(colTypes[c] == ConfigurationAPI._FIXED_CHOICE_DATA_TYPE) 
				// {
				// 	var colChoicesArr = colChoices[c]?colChoices[c].split(','):[];

				// 	//colChoices is an array (not a map).. 
				// 	if(colChoicesArr.length > 1)
				// 		str += " = " + decodeURIComponent(colChoicesArr[1]); //skip arbitrary bool entry [0]
				// }

				// if (colDataTypes[c] == ConfigurationAPI._NUMBER_TYPE) 
				// {
				// 	if (colMinValues[c] != "")
				// 		str += "<br>Minimum: " + colMinValues[c];
				// 	if (colMaxValues[c] != "")
				// 		str += "<br>Maximum: " + colMaxValues[c];
				// }
				// str += "]";
				// str += "</div>";
				str += "</td>";	
			} //end localInsertTypeCell()
			
			//:::::
			function localInsertColumnNameCell(c)
			{
				str += "<th onmouseup='selectThisCell(" + (_CONFIG_TYPE_ROW_OFFSET+1) + "," +
						c + ",this,event);'>";
				str += colHdrs[c];
				str += "</th>";
			}
			
			//:::::
			function localInsertTypeParameters(c)
			{
				//add data choices if type = FixedChoiceData
				//add bitmap info fields if type = BitMap
				//add link table options if type = ChildLink
				
				if(colTypes[c] == ConfigurationAPI._BITMAP_DATA_TYPE)
				{
					localDisplayPixelMaskInputs();
				}
				else if(colTypes[c].indexOf("ChildLink-") == 0)
				{
					localDisplayChildLinkInputs();		
				}
				else if(colTypes[c] == "FixedChoiceData")
				{
					Debug.log("FixedChoiceData col=" + c + " colTypes[c]=" + colTypes[c]);
					str += "<td>";

					str += "<table cellpadding='2px' cellspacing='2px' border='0' >"; //open table
					str += "<tr><td>";
					str += "<input type='text' id='newChoiceInput-" + c + "' value='My New Choice' " +
							"onkeydown='fixedChoiceKeyHandler(event," + c + ")' " +
							"onmouseup='event.stopPropagation();' " +
							"onclick='event.stopPropagation();" +
							"if(this.value == \"My New Choice\") setCaretPosition(this,0,this.value.length);' " +
							"style='width:220px' />";
					str += "</td><td style='white-space:nowrap' >";
					str += "<a class='fixedChoiceAdd' onclick='addFixedChoice(" + c + "); return false;' " +
							"title='Add text as a new fixed choice option for this column.\"'" +
							">";
					str += "+";
					str += "</a>";
					str += "</td></tr>";


					str += "<tr><td>";

					str += "<select style='width:220px' id='fixedChoicesSelect-" + c + "' " +
							"onchange='document.getElementById(\"newChoiceInput-" + c + 
							"\").value = this.value;'" +
							">";
					var colChoicesArr = colChoices[c].split(',');

					//always show default first
					str += "<option>" +
							ConfigurationAPI.encodeHTML(colDefaultValues[c]) + 
							"</option>";					

					for(var f=1;f<colChoicesArr.length;++f)	
						str += "<option>" +
							ConfigurationAPI.encodeHTML(decodeURIComponent(colChoicesArr[f])) +
							"</option>";		

					str += "</select>";

					str += "</td><td>";
					str += 
							"<div class='treeNode-deleteIcon' " + 
							"onmouseup='event.stopPropagation();' " +
							"onclick='event.stopPropagation();" +
							"deleteSelectedFixedChoice(" + c + ");' " +
							"title='Remove the currently selected choice for this column.' " +
							"></div>";

					

					str += "</td></tr>";
					str += "</table>";
					
					str += "<br>";
					str += "<center>";
					str += "<a onclick='downloadFixedChoices(" + c + "); return false;' " +
							"title='Dowload choices as CSV data file.\"'" +
							">";
					str += "Download";
					str += "</a>";
					str += "&nbsp;&nbsp;&nbsp;";

					str += "<a onclick='popUpUploadFixedChoicesForm(" + c + "); return false;' " +
							"title='Upload choices as CSV data file.\"'" +
							">";
					str += "Upload";
					str += "</a>";
					str += "</center>";
										
					str += "<br><br>";
					
					//add checkbox
					Debug.log("colChoicesArr[0] = " + colChoicesArr[0]);
					str += "<input type='checkbox' id='fixedChoiceArbitraryCheckbox-" + c +
							"' onclick='handlefixedChoiceArbitraryCheckbox(" + c + ")' " +
							(colChoicesArr[0] == "arbitraryBool=1"?"checked":"") +
							">";
					//add link so text toggles checkbox
					str += "<a style='text-decoration:none;color:black;' href='#' onclick='javascript:" +
							"var el = document.getElementById(\"fixedChoiceArbitraryCheckbox-" + c + "\");" +
							"var forFirefox = (el.checked = !el.checked);" +
							"handlefixedChoiceArbitraryCheckbox(" + c + ");" +
							" return false;'>";
					str += "Also allow arbitrary user entry"; //can display however
					str += "</a>";
					str += "</input>";
					
					
					str += "</td>";			

				} //end fixed choice case
				else //all other fields: transparent/empty parameter cell
				{
					str += "<td style='border:0; background-color:transparent;'></td>";
				}
			}
			
			if(_tableIsTransposed)
			{
				//for each column, make a row		
				for(var c=0;c<colTypes.length;++c)
				{
					///// open row
					str += "<tr class='SubSystemTableRow'>";
					
					/////////////////////////////////
					//+/- column links
					localInsertAddDeleteCell(c);
					
					/////////////////////////////////
					//type and data type row
					localInsertTypeCell(c);
					
					/////////////////////////////////
					//col name type row
					localInsertColumnNameCell(c);

					/////////////////////////////////
					//col parameters
					localInsertTypeParameters(c);
					
					///// close row
					str += "</tr>";
				}
			}
			else
			{
				//+/- column row
				str += "<tr class='SubSystemTableRow'>";					
				for(var c=0;c<colTypes.length;++c)
				{
					/////////////////////////////////
					//+/- column links
					localInsertAddDeleteCell(c);
				}
				str += "</tr>";
				
				//type and data type row
				str += "<tr class='SubSystemTableRow'>";	
				for(var c=0;c<colTypes.length;++c)
				{
					/////////////////////////////////
					//type and data type row
					localInsertTypeCell(c)		
				}
				
				str += "</tr>";
				str += "<tr class='SubSystemTableRow'>";
				for(var c=0;c<colHdrs.length;++c)
				{
					/////////////////////////////////
					//col name type row
					localInsertColumnNameCell(c);	
				}
				str += "</tr>";							

				//add data choices if type = FixedChoiceData
				str += "<tr class='SubSystemTableRow'>";	
				for(var c=0;c<colTypes.length;++c)
				{
					/////////////////////////////////
					//col parameters
					localInsertTypeParameters(c);
				}
				str += "</tr>";
			}

			str += "</table>";		

			
			//add table description editing
			if(!tableDescription || tableDescription == "")
				tableDescription = "No description.";
			str += "<br><br>";
			str += "Table Description (Changes will be saved with the column info.";
			
			str += " <a style='text-decoration:underline;' " +
					"id='table-description-preview-link',Debug.INFO_PRIORITY);'>" +
					"Preview</a>):";
			
			str += "<br>";
			str += "<textarea id='table-description' onkeydown='descriptionKeyHandler(event,this)' rows='6' cols='60'>";			 
			str += tableDescription;
			str += "</textarea>";
			
			var el = document.getElementById("display");
			el.innerHTML = str;	
			el = document.getElementById("table-description-preview-link");
			el.onclick = function(){
				var tip = document.getElementById("table-description").value;
				DesktopContent.tooltip("ALWAYS",
						"<center>Preview of " + srcName + " Tooltip</center><br>" +
						tip);
			}
		} //end setupTable()
		

		//=====================================================================================
		//selectThisCell ~~
		function selectThisCell(r,c,el,event) 
		{		
			if(event) //stop the body from also calling onmouseup and cancelling select
			{
				event.stopPropagation();

				Debug.logv({_mouseIsSelecting});
				if(_mouseIsSelecting) //block select if mouse is selecting text currently 
				{
					_mouseIsSelecting = false;
					Debug.logv({_mouseIsSelecting});
					return; 							
				}
			}

			if(_editingCell) //already have the edit box open, cancel it
			{
				if(_editingCellEl == el) //if same cell do nothing
					return false;
				editCellOK(); //editCellCancel(); //if new cell cancel
			}			
			
			//NOTE!!!! 
			// editCellOK() may redraw table, by calling setupTable().. 
			//	this means el can not be trusted to still exist!!
			// so use r,c to recover element
			
			//if column is Comment, Author, or Timestamp, don't allow select
			var tableEl = document.getElementById("SubSystemTable");
			var rows = tableEl.getElementsByClassName("SubSystemTableRow");//getElementsByTagName("tr");
			var typeCell; //cols = []; //just need target column info, not all columns			
			var colType;
			
			//get col type cell and tartget cell (transposed or not)
			if(_tableIsTransposed)
			{
				//transpose all
				//var tcols;
				//for(var i=0;i<rows.length;++i)
				//{ i = c
					//tcols = rows[i].getElementsByTagName("td");					
					//cols[i] = tcols[_CONFIG_TYPE_ROW_OFFSET];
						
				//}
				typeCell = rows[_CONFIG_DATA_COL_OFFSET+c].getElementsByTagName("td")[_CONFIG_TYPE_ROW_OFFSET];
				if(r == 2) //use header cells
					el = rows[_CONFIG_DATA_COL_OFFSET+c].getElementsByTagName("th")[0];
				else if(r > 2) //special row
					el = rows[_CONFIG_DATA_COL_OFFSET+c].getElementsByTagName("td")[2];
				else //r < 2
					el = rows[_CONFIG_DATA_COL_OFFSET+c].getElementsByTagName("td")[r];
			}
			else
			{
				//cols = rows[_CONFIG_TYPE_ROW_OFFSET].getElementsByTagName("td");
				typeCell = rows[_CONFIG_TYPE_ROW_OFFSET].getElementsByTagName("td")[_CONFIG_DATA_COL_OFFSET+c];
				el = rows[r].getElementsByTagName("td")[_CONFIG_DATA_COL_OFFSET+c];
				if(!el) //if failed try header cells
					el = rows[r].getElementsByTagName("th")[_CONFIG_DATA_COL_OFFSET+c];
			}
			
			//colType = cols[_CONFIG_DATA_COL_OFFSET+c].childNodes[0].innerHTML.split('<')[0]; //type text is in a div for smaller font
			colType = typeCell.childNodes[0].innerText.split('\n')[0]; //type text is in a div for smaller font
			if(colType == "Author" || 
					colType == "Timestamp"|| 
					colType == "Comment" )//|| 
					//(r == _CONFIG_TYPE_ROW_OFFSET && colType == "UID"))
			{
				Debug.log("This cell is fixed. Users can not edit cells of type '" +
						colType + ".'",Debug.WARN_PRIORITY)
				return false;
			}
			
			
			_editingCell = true;
			_editingCellEl = el;
			_editingCellPos = [r,c];			

			
			var colDataType = typeCell.childNodes[0].innerText.split('<')[1].split('>')[0];
			
			_editingCellElOldValue = el.innerHTML;
			
			var startingLinkId = "0";
			var colTypeIndexOfDash = colType.indexOf('-');
			if(colTypeIndexOfDash != -1)
			{
				startingLinkId = colType.substr(colTypeIndexOfDash+1);
				colType = colType.substr(0,colTypeIndexOfDash);
				Debug.logv({colType});
				Debug.logv({startingLinkId});
			}
			
			var str = "";			
			var typeOptionIndex = -1;
			var dataTypeOptionIndex = -1;
			
			if(r == _CONFIG_TYPE_ROW_OFFSET) //column type and data types
			{
				//do not allow type change if UID type
				if(colType != "UID")
				{
					str += "<select  onkeydown='keyHandler(event)' onchange='handleTypeSelect()' id='selectCellTypeSelect' style='float:left'>";
					for(var i=0;i<_typeArray.length;++i)
					{			
						str += "<option value='" + _typeArray[i] + "'>";
						str += _typeArray[i];	//can display however
						str += "</option>";
						
						if(typeOptionIndex == -1 && //only take first match
							colType == _typeArray[i]) 
							typeOptionIndex = i; //get starting sel index for type
					}				
					str += "</select>";
				}
				else
				{
					str += "UID ";
					str += "<input id='selectCellTypeSelect' value='UID' style='display:none'></input>";
				}
				str += "<input type='text' id='selectCellSpecTypeID' onkeydown='keyHandler(event)' " +
						"style='display:none; width:" + 
						(40 > (el.offsetWidth-8-160 /*160=width of type-dropdown*/)?40: //min of 40
								(el.offsetWidth-8-160 /*160=width of type-dropdown*/)) +
						"px; float:left; height: 13px; font-size: 14px;' value='" + 
						startingLinkId;
				str += "' onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
						"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting);' " +
						">";

				str += "<div id='clearDiv'></div>";				
				str += "<select onkeydown='keyHandler(event)'  id='selectCellDataTypeSelect' onchange='handleTypeSelect()'>";
				for(var i=0;i<_dataTypeArray.length;++i)
				{			
					str += "<option value='" + _dataTypeArray[i] + "'>";
					str += "&lt;" + _dataTypeArray[i] + "&gt;";	//can display however
					str += "</option>";
					if(dataTypeOptionIndex == -1 && //only take first match
							_editingCellElOldValue.indexOf("&lt;" + _dataTypeArray[i] + "&gt;") >= 0)
						dataTypeOptionIndex = i; //get starting sel index for data type
				}				
				str += "</select>";

				//show defaultValue but not by default
				str += "<div id='clearDiv'></div>";	
				str += "<div id='selectCellSpecTypeDefaultDiv' style='display:none; float:left;'>";
				str += "Default: ";
				var encodedDefaultValue;
				if(_colDefaultValueArr[c] !== undefined)
					encodedDefaultValue = ConfigurationAPI.encodeHTML(_colDefaultValueArr[c]);

				// new additions min and max, check if they work, no error founds yet

				else if(_colDefaultMinArr[c]!== undefined)
					encodedMinValue = ConfigurationAPI.encodeHTML(_colDefaultValueArr[c]);
				else if(_colDefaultMaxArr[c]!== undefined)
					encodedMaxValue = ConfigurationAPI.encodeHTML(_colDefaultValueArr[c]);

				else if(dataTypeOptionIndex != -1) //ConfigurationAPI.encodeHTML(decodeURIComponent(
					encodedDefaultValue = ConfigurationAPI.encodeHTML(_defaultArray[_dataTypeArray[dataTypeOptionIndex]][colType]);
								
				str += "<input type='text' id='selectCellSpecTypeDefaultInput' onkeydown='keyHandler(event)' " +
					"style='width:" + 
					(100 > (el.offsetWidth-8-160 /*160=width of type-dropdown*/)?100: //min of 100
							(el.offsetWidth-8-160 /*160=width of type-dropdown*/)) +
						"px; height: 13px; font-size: 14px;' value='" + 
						encodedDefaultValue;
				str += "' onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
						"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting);' " +
						">";
				str += "</div>";
				
				str += "<div id='clearDiv'></div>";	
				str += "<div id='selectCellSpecTypeMinMaxDiv' style='display:none; float:left;'>";
				str += "Minimum: ";
				
				// render min value
				var encodedMinValue = "";
				if(_colMinValueArr[c] !== undefined)
					encodedMinValue = ConfigurationAPI.encodeHTML(_colMinValueArr[c]);
				str += "<input type='text' id='selectCellSpecTypeMinInput' onkeydown='keyHandler(event)' " +
					"style='width:" + 
					(100 > (el.offsetWidth-8-160 /*160=width of type-dropdown*/)?100: //min of 100
							(el.offsetWidth-8-160 /*160=width of type-dropdown*/)) +
						"px; height: 13px; font-size: 14px;' value='" + 
						encodedMinValue;
				str += "' onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
						"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting);' " +
						">";

				str += "Maximum: ";
				var encodedMaxValue = "";
				if(_colMaxValueArr[c] !== undefined)
					encodedMaxValue = ConfigurationAPI.encodeHTML(_colMaxValueArr[c]);

				//  render max value
				str += "<input type='text' id='selectCellSpecTypeMaxInput' onkeydown='keyHandler(event)' " +
					"style='width:" + 
					(100 > (el.offsetWidth-8-160 /*160=width of type-dropdown*/)?100: //min of 100
							(el.offsetWidth-8-160 /*160=width of type-dropdown*/)) +
						"px; height: 13px; font-size: 14px;' value='" + 
						encodedMaxValue;
				str += "' onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
						"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting);' " +
						">";
				str += "</div>";

				//show defaultValue BOOL but not by default
				str += "<div id='selectCellSpecTypeDefaultBoolDiv' style='display:none; float:left;'>";
				str += "Default: ";
				str += "<select  onkeydown='keyHandler(event)' id='selectCellSpecTypeDefaultSelect' style=''>";						
					str += "<option value='" + 0 + "' " + 
							((_colDefaultValueArr[c]|0) == 1?"":"selected") + 
							">";
					str += "0/Off/False/No";	//can display however
					str += "</option>";
					str += "<option value='" + 1 + "' " + 
							((_colDefaultValueArr[c]|0) == 1?"selected":"") + 
							">";
					str += "1/On/True/Yes";	//can display however
					str += "</option>";	
				str += "</select>";
				str += "</div>";

			}
			else // column header names
			{
				str += "<input type='text' onkeydown='keyHandler(event)' " + 
						"style='margin:-4px -2px -4px -1px;width:" + (el.offsetWidth-6) + 
						"px; height:" + (el.offsetHeight-8) + "px' value='";
				str += _editingCellElOldValue;
				str += "' onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
						"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting);' " +
						">";
			}

			str += "<div style='padding:5px;background-color:#eeeeee;border:1px solid #555555;position:relative;" + 
					"width:105px;height:20px;margin:22px -122px -32px 10px;text-size: 16px;'>";
			str += "<a href='javascript:editCellOK("+r+","+c+");' style='color:green'>" +
					"<b style='color:green'>OK</b></a> | " +
					"<a href='javascript:editCellCancel();' style='color:red'>" + 
					"<b style='color:red'>Cancel</b></a>";
			str += "</div>";
			
			el.innerHTML = str;
			
			if(r == _CONFIG_TYPE_ROW_OFFSET) //select dropdown menu
			{
				//Debug.log("typeOptionIndex=" + typeOptionIndex +
				//		" dataTypeOptionIndex=" + dataTypeOptionIndex);
				
				if(colType != "UID")
				{
					el.getElementsByTagName("select")[0].selectedIndex = typeOptionIndex;
					el.getElementsByTagName("select")[1].selectedIndex = dataTypeOptionIndex;
					el.getElementsByTagName("select")[0].focus();
					handleTypeSelect();
				}
				else
				{
					el.getElementsByTagName("select")[0].selectedIndex = dataTypeOptionIndex;
					el.getElementsByTagName("select")[0].focus();
				}
					
			}
			else //select text box
				setCaretPosition(el.getElementsByTagName("input")[0],0,_editingCellElOldValue.length);
			
			return true;
		} //end selectThisCell()
		
		//==============================================================================
		//setCaretPosition
		function setCaretPosition(elem, caretPos, endPos) {
            elem.focus();
            if(elem.setSelectionRange)
            	elem.setSelectionRange(caretPos, endPos);
		} //end setCaretPosition()

		//==============================================================================
		//fixedChoiceKeyHandler
		//	enter and tab key adds to list without popup success message
		function fixedChoiceKeyHandler(e,c) 
		{
			// var TABKEY = 9;
			// var ENTERKEY = 13;
			
			//handle special keys for text area
			if(e.key == "Tab" || 
					e.key == "Enter")
			{
				Debug.log("tab/enter for column " + c);
				if(e.preventDefault) 
					e.preventDefault();

				addFixedChoice(c,true /*quiet*/);
			}
			return false; //done
		} //end fixedChoiceKeyHandler()

		//==============================================================================
		//descriptionKeyHandler
		//	add tab character to textareal element value
		function descriptionKeyHandler(e,tel) 
		{
			// var TABKEY = 9;
			//handle special keys for text area
			if(e.key == "Tab")
			{
				Debug.log("tab.");
				if(e.preventDefault) 
					e.preventDefault();

				var i = tel.selectionStart;
				var j = tel.selectionEnd;
				tel.value =  tel.value.substr(0,i) + 
						'\t' + tel.value.substr(j);
				tel.selectionStart = tel.selectionEnd = j+1;
			}
			return false; //done if text area was identified
		} //end descriptionKeyHandler()

		//==============================================================================
		//keyHandler
		function keyHandler(e) 
		{
			// var TABKEY = 9;
			// var ENTERKEY = 13;
			// var UPKEY = 38;
			// var DNKEY = 40;
			// var ESCKEY = 27;
			//Debug.log("key " + e.keyCode);
			//keyCode is deprecated, switching to key
			
			var shiftIsDown;
			// var key;
			if (window.event) 
			{
				// key = window.event.keyCode;
				shiftIsDown = !!window.event.shiftKey; // typecast to boolean
			} 
			else
			{
				// key = e.which;
				shiftIsDown = !!e.shiftKey;	// typecast to boolean
			}
			//Debug.log("shift=" + shiftIsDown);
			
			//tab key jumps to next cell with a CANCEL
			//	(enter key does same except saves/OKs value)
			//	shift is reverse jump
			if(e.key == "Tab" || e.key == "Enter" || 
					e.key == "ArrowUp" || e.key == "ArrowDown") 				
			{
				//this.value += "    ";
				if(e.preventDefault) 
					e.preventDefault();

				editCellOK();

				if(e.key == "Enter") //dont move to new cell
					return false;
							
				//jump forward (tab/enter) or backward (tab/enter+shift)
				//	or up or down.
				//get number of rows and cols
				//	to determine next row and col to jump to
				
				
				var newRow = _editingCellPos[0];
				var newCol = _editingCellPos[1];
				var el = document.getElementById("SubSystemTable");
				var rows = el.getElementsByTagName("tr");
				var numOfRows = _CONFIG_TYPE_ROW_OFFSET + 2;
				var numOfCols = _colHdrArr.length; //rows[_CONFIG_TYPE_ROW_OFFSET+1].getElementsByTagName("th").length - 
						//_CONFIG_DATA_COL_OFFSET;
				var cols;
				do
				{					
					if(e.key == "Tab" || e.key == "Enteer")
						newCol += (shiftIsDown?-1:1);
					else if(e.key == "ArrowUp")
						--newRow;
					else if(e.key == "ArrowDown")
						++newRow;
					
					//new position is chosen! now make it happen (in a clean way)	
									
					if(newCol == numOfCols)	{ ++newRow; newCol = 0;	}
					if(newRow == numOfRows) newRow = _CONFIG_TYPE_ROW_OFFSET;
					if(newCol < 0) {--newRow; newCol = numOfCols-1; }
					if(newRow < _CONFIG_TYPE_ROW_OFFSET) newRow = numOfRows-1;					

					cols = [];
					if(_tableIsTransposed)
					{
						//transpose all
						var tcols;
						for(var i=0;i<rows.length;++i)
						{	
							if(newRow == _CONFIG_TYPE_ROW_OFFSET)
							{
								tcols = rows[i].getElementsByTagName("td");	
								cols[i] = tcols[newRow];
							}
							else	//th is always the last newRow, so above works
							{
								tcols = rows[i].getElementsByTagName("th");
								cols[i] = tcols[0];
							}
						}
					}
					else
					{
						if(newRow == _CONFIG_TYPE_ROW_OFFSET)
							cols = rows[newRow].getElementsByTagName("td");
						else
							cols = rows[newRow].getElementsByTagName("th")
					}

					el = cols[_CONFIG_DATA_COL_OFFSET+newCol];
					
				} while(!selectThisCell(newRow,newCol,el));

				//Debug.log("newRow=" + newRow + " newCol=" + newCol);
				
				return false;
			}
			else if(e.key == "Escape") 
			{				
				if(e.preventDefault) 
					e.preventDefault();
				editCellCancel();
				return false;
			}
		} //end keyHandler

		//==============================================================================
		//editCellOK
		function editCellOK() 
		{				
			if(!_editingCellEl) return;
			
			var r = _editingCellPos[0];
			var c = _editingCellPos[1];
			
			var str;
			
			try
			{
				if(r == _CONFIG_TYPE_ROW_OFFSET) //type and dataType
				{
					Debug.log("CfgTBL editCellOK editing r,c:" + r + "," + c);
					//get type and data type from select boxes (and input field for link ID)
					var sel = document.getElementById("selectCellTypeSelect");		
					if(sel.selectedIndex < 0) sel.selectedIndex = 0; //default to default
					var colType = sel.selectedIndex?sel.options[sel.selectedIndex].value:
							sel.value; //the else is case should be UID
					sel = document.getElementById("selectCellDataTypeSelect");
					if(sel.selectedIndex < 0) sel.selectedIndex = 0; //default to default
					var colDataType = sel.options[sel.selectedIndex].value;
					
					if(colType != "UID")
					{
						var specTypeArray = ["GroupID","ChildLink","ChildLinkUID","ChildLinkGroupID"];
								
						//if child link special type, append special type ID
						for(var i=0;i<specTypeArray.length;++i)
							if(colType == specTypeArray[i])
								colType += "-" + document.getElementById("selectCellSpecTypeID").value;
						
						
						//get Default value if there
						var del = document.getElementById("selectCellSpecTypeDefaultDiv");
						if(del.style.display != "none")
						{
							del = document.getElementById("selectCellSpecTypeDefaultInput");
							Debug.log("Getting default value",del.value);
							_colDefaultValueArr[c] = del.value;
							// should min and max be included here???
						}
						del = document.getElementById("selectCellSpecTypeDefaultBoolDiv");
						if(del.style.display != "none")
						{
							del = document.getElementById("selectCellSpecTypeDefaultSelect");
							Debug.log("Getting default bool value",del.value);
							_colDefaultValueArr[c] = del.value;
						}

						//min and max set on log and definition of values for arrays colmaxvalue and colminvalue
						del = document.getElementById("selectCellSpecTypeMinMaxDiv");
						if(del.style.display != "none")
						{
							del = document.getElementById("selectCellSpecTypeMinInput");
							Debug.log("Getting min value",del.value);
							_colMinValueArr[c] = del.value;
							del = document.getElementById("selectCellSpecTypeMaxInput");
							Debug.log("Getting max value",del.value);
							_colMaxValueArr[c] = del.value;
						}
					}
										
					Debug.log("CfgTBL editCellOK editing colType,colDataType:" + 
							colType + "," + colDataType);
					
					_colTypeArr[c] = colType;
					_colDataTypeArr[c] = colDataType;
					setupTable();
					
					//show tooltips
					if(colType == ConfigurationAPI._BITMAP_DATA_TYPE)
						DesktopContent.tooltip("BitMap Field Type",
								"The BitMap type represents a 2-dimensional array of cells, " +
								"where each cell has a bit-field. The aspect ratio is optional. " +
								"The color fields are optional. " +
								"Optional fields you can leave as DEFAULT. \n\n" +
								
								"The aspect ratio should be entered as &lt;Height&gt;:&lt;Width&gt;; for example, " +
								"if you have a pixel chip with pixel size 100 microns by 150 microns you " +
								"may want your display to reflect that - you should enter &quot;100:150&quot (without the quotes)."
								);
					else if(colType == "FixedChoiceData")
						DesktopContent.tooltip("FixedChoiceData Field Type",
								"The FixedChoiceData type represents a list of choices that constrain " +
								"the allowed values for a field. " +
								"The DEFAULT value must always be one of the choices. \n\n" +
								
								"You can download and upload CSV lists of the fixed choices. \n\n" +								
								
								"If you check the box to allow arbitrary user entry, users will " +
								"have the option to enter values that do not necessarily match choices in the list."
								);
					else if(colType.indexOf("ChildLink-") == 0)
						DesktopContent.tooltip("ChildLink Field Type",
								"The ChildLink type represents one field of a table link (a pair of two fields are required to complete a table link). " +
								"The other field completing the pair must be of type ChildLinkUID or ChildLinkGroupID. " +
								"The two fields are defined as being in the same pair by having the same Link ID. " +
								"The Link ID is specified by entering a value in the input box next to the field type dropdown - " +
								"the Link ID can be a number or a string. If you put a space in a Group Link ID, the characters after the first " +
								"space will be considered for the target GroupID column in the child table (this allows for multiple Group Link fields " + 
								"in the parent table to point to the same child table GroupID column, for example).\n\n" +
								
								"If the other field in the pair is of type ChildLinkUID, then you have created a unique-record table link (i.e. a link to one particular record in the target table).\n\n" +
								"If the other field in the pair is of type ChildLinkGroupID, then you have created a group-of-records table link (i.e. a link to one or many child table records, which share the same Group ID).\n\n" +
								
								"Note that you can force users to link to fixed list of tables by checking the box in the field parameters. " +
								"Users will then be forced to choose from the tables in list of choices.\n\n " +
								"It is important to remember to include '" + ConfigurationAPI._DATATYPE_LINK_DEFAULT + "' as a choice if you want users to be able to leave your link disconnected."
								);
					else if(colType.indexOf("ChildLinkUID-") == 0)
						DesktopContent.tooltip("ChildLinkUID Field Type",
								"The ChildLinkUID type represents one field of a unique-record table link (a pair of two fields are required to complete a table link). " +
								"The other field completing the pair in this table must be of type ChildLink. " +
								"The two fields are defined as being in the same pair by having the same Link ID. " +
								"The Link ID is specified by entering a value in the input box next to the field type dropdown - " +
								"the Link ID can be a number or a string. \n\n" +
								
								"A unique-record table link is a link to one particular record in the target table. " +
								"Note that no special fields are required in the target table for a valid unique-record table link."
								);
					else if(colType.indexOf("ChildLinkGroupID-") == 0)
						DesktopContent.tooltip("ChildLinkGroupID Field Type",
								"The ChildLinkGroupID type represents one field of a group-of-records table link (a pair of two fields are required to complete a table link). " +
								"The other field completing the pair in this table must be of type ChildLink. " +
								"The two fields are defined as being in the same pair by having the same Link ID. " +
								"The Link ID is specified by entering a value in the input box next to the field type dropdown - " +
								"the Link ID can be a number or a string. If you put a space in a Group Link ID, the characters after the first " +
								"space will be considered for the target GroupID column in the child table (this allows for multiple Group Link fields " + 
								"in the parent table to point to the same child table GroupID column, for example).\n\n" +
								
								"A group-of-records table link is a link to one or many child table records, which share the same Group ID. " +
								"Note that a field of type GroupID is required in the target table for a valid group-of-records table link. " +
								"The GroupID field in the child table must have a Link ID which matches the Link ID of the pair of fields in the parent table."								
								);
					else if(colType.indexOf("GroupID-") == 0)
						DesktopContent.tooltip("GroupID Field Type",
								"The GroupID type represents a target field in the child table for a group-of-records table link in a parent table. " +
								"A group-of-records table link is a link to one or many child table records, which share the same Group ID. " +
								"The GroupID field has no special functionality unless there is a parent table targeting this child table with a link that has a corresponding Link ID. " +
								"The Link ID is specified by entering a value in the input box next to the field type dropdown - " +
								"the Link ID can be a number or a string. If you put a space in the parent Group Link ID, the characters after the first " +
								"space will be considered for the target GroupID column in the child table (this allows for multiple Group Link fields " + 
								"in the parent table to point to the same child table GroupID column, for example).\n\n" +
								
								"Note that a field of type GroupID is required in the target table for a valid group-of-records table link. " +
								"The GroupID field in the child table must have a Link ID which matches the Link ID of the pair of fields in the parent table."								
								);
				}			
				else //colHdr row
				{
					Debug.log("CfgTBL editCellOK editing r,c:" + r + "," + c + 
							" = " + _editingCellEl.getElementsByTagName("input")[0].value);
					str = _editingCellEl.getElementsByTagName("input")[0].value;
					_colHdrArr[c] = str;
					_editingCellEl.innerHTML = "";
					_editingCellEl.appendChild(document.createTextNode(str));				
				}
			}
			catch(err)
			{
				Debug.log("Error was caught! Error: " + err, Debug.HIGH_PRIORITY);
			}
			

			_editingCell = false;
			_editingCellEl = 0;
		} //end editCellOK()

		//==============================================================================
		//editCellCancel
		function editCellCancel() 
		{	
			if(_editingCellEl)
				_editingCellEl.innerHTML = _editingCellElOldValue;
			
			_editingCell = false;
			_editingCellEl = 0;
		} //end editCellCancel()

		//==============================================================================
		//addColumn ~~
		// adds col to position c (relative to view on page)
		// absolute col is _dataOffset + c
		function addColumn(c) 
		{
			Debug.log("CfgTBL addColumn " + c);
			
			_colHdrArr.splice(c,0,"DefaultColumnName");
			_colTypeArr.splice(c,0,"Data");
			_colDataTypeArr.splice(c,0, ConfigurationAPI._STRING_TYPE);
			_colDefaultValueArr.splice(c,0, ConfigurationAPI.encodeHTML(decodeURIComponent(
					_defaultArray[_colDataTypeArr[c]][_colTypeArr[c]])));
					
			_colMinValueArr.splice(c,0, ConfigurationAPI.encodeHTML(decodeURIComponent(
					_minArray[_colDataTypeArr[c]][_colTypeArr[c]])));

			_colMaxValueArr.splice(c,0, ConfigurationAPI.encodeHTML(decodeURIComponent(
					_maxArray[_colDataTypeArr[c]][_colTypeArr[c]])));

			_colChoicesArr.splice(c,0,"");
			
			setupTable(0,_colHdrArr,_colTypeArr,_colDataTypeArr,_colDefaultValueArr, 
				_colChoicesArr, _colMinValueArr, _colMaxValueArr, undefined /* to restore tableDescription */);
		} //end addColumn()

		//==============================================================================
		//deleteColumn ~~
		// deletes col to position c (relative to view on page)
		// absolute col is _dataOffset + c
		function deleteColumn(c) 
		{
			Debug.log("CfgTBL deleteColumn " + c);
			
			_colHdrArr.splice(c,1);
			_colTypeArr.splice(c,1);
			_colDataTypeArr.splice(c,1);
			_colDefaultValueArr.splice(c,1);
			
			_colMinValueArr.splice(c,1);
			_colMaxValueArr.splice(c,1);
			
			_colChoicesArr.splice(c,1);
			
			setupTable(0,_colHdrArr,_colTypeArr,_colDataTypeArr,_colDefaultValueArr, 
				_colChoicesArr, _colMinValueArr, _colMaxValueArr, undefined /* to restore tableDescription */);
		} //end deleteColumn()

		//==============================================================================
		//transposeTable ~~
		function transposeTable()
		{
			_tableIsTransposed = !_tableIsTransposed;
			Debug.log("CfgTBL transposeTable " + _tableIsTransposed);
			
			setupTable();
		} //end transposeTable()

		//==============================================================================
		//createEditTableMenu ~~
		function createEditTableMenu(event)
		{
			var menuItems = [
							 "Find and Replace",	
							 "Copy and Move",
							 "Transpose Table View"
									 ];
			var menuItemHandlers = [
							"setupFindAndReplace()",
							"setupCopyAndMoveFields()",
							"transposeTable()"							 							 
									 ];
			Debug.log("createEditTableMenu()");
			SimpleContextMenu.createMenu(
					menuItems,
					menuItemHandlers,
					"editTableMenu",					//element ID
					event.pageX-1,event.pageY-1, 	//top left position
					"rgb(220, 187, 165)", 			//primary color
					"rgb(130, 51, 51)"				//secondary color
			);
		} //end createEditTableMenu()

		//==============================================================================
		//setupFindAndReplace
		function setupFindAndReplace()
		{			
			
			//if there were any other types of controls, clear them 
			//	here {}

			var el = document.getElementById('copyAndMoveRows');
			el.innerHTML = ""; //clear the other type of controls
			
			el = document.getElementById('findAndReplace'); 
			if(el.innerHTML != "") { el.innerHTML = ""; return; } //hide if already shown
			
			_lastFindRow = _lastFindCol = -1; //initialize find location
			var str = "";
			str += "Search in all column names for text... <br>";			
			str += "<input type='text' id='findAndReplaceNeedle' style='margin:-4px -2px -4px -1px;width:" + (el.offsetWidth-6) + "px; height:" + (el.offsetHeight-8) + "px' value=''>";
			str += "<br>";
			str += "Replace with... <br>";
			str += "<input type='text' id='findAndReplaceWith' style='margin:-4px -2px -4px -1px;width:" + (el.offsetWidth-6) + "px; height:" + (el.offsetHeight-8) + "px' value=''>";
			
			//make div for translating innerHTML and value
			str += "<div id='findAndReplaceHTML' style='display:none'></div>";
			
			str += "<br><br>";
			//			str += "<input type='button' onmouseup='configFind()' value='Find' title='" +
			//					"Find every occurance of \'For text...\" in the Column(s) specified by \'Search in column.\'" +
			//					"'/>";
			//			str += " ";
			str += "<input type='button' onmouseup='tableReplace()' value='Replace' title='" +
					"Replace every occurance of \'For text...\" in the Column(s) specified by \'Search in column\' with the string specified in \'Replace with...\'" +
					"'/>";			
			str += "<br><br>";
			el.innerHTML = str;		
		} //end setupFindAndReplace()

		//==============================================================================
		//setupCopyAndMoveFields
		function setupCopyAndMoveFields()
		{		
			Debug.log("setupCopyAndMoveFields()");

			var el = document.getElementById('findAndReplace');
			el.innerHTML = ""; //clear the other type of controls
			el = document.getElementById('copyAndMoveFields');
			if (el.innerHTML != "") { el.innerHTML = ""; return; } //hide if already shown

			var str = "";
			str += "Source starting Field... ";
			str += "<input type='text' id='copyAndMoveFieldsSrc' style='margin:0;width:" +
					(el.offsetWidth - 6) + "px; height:" + (17) + "px' value='0'>";
			str += "<br>";
			str += "Number of Fields to Copy or Move... ";
			str += "<input type='text' id='copyAndMoveFieldsSrcCount' style='margin:0;width:" +
					(el.offsetWidth - 6) + "px; height:" + (17) + "px' value='1'>";
			str += "<br>";
			str += "Destination Field location (-1 for new last field)... ";
			str += "<input type='text' id='copyAndMoveFieldsDest' style='margin:0;width:" +
					(el.offsetWidth - 6) + "px; height:" + (17) + "px' value='-1'>";

			//make div for translating innerHTML and value
			str += "<div id='copyAndMoveFieldsHTML' style='display:none'></div>";

			str += "<br><br>";
			str += "<input type='button' onmouseup='copyOrMoveField(0)' value='Copy Field' title='" +
					"Copy Source Field and paste at Destination Field, pushing previously existing Fields down." +
					"'/>";
			str += " ";
			str += "<input type='button' onmouseup='copyOrMoveField(1)' value='Move Field' title='" +
					"Cut Source Field and paste at Destination Field, pushing previously existing Fields down." +
					"'/>";

			str += "<br><br>";
			el.innerHTML = str;
		} //end setupCopyAndMoveFields()

		//==============================================================================
		//copyOrMoveField
		function copyOrMoveField(deleteSrc)
		{		
			var src = document.getElementById("copyAndMoveFieldsSrc").value | 0;
			var dest = document.getElementById("copyAndMoveFieldsDest").value | 0;
			var srcCount = document.getElementById("copyAndMoveFieldsSrcCount").value | 0;

			Debug.log("tableCopyOrMoveField src=" + src + " srcCount=" + 
					srcCount + " dest=" + dest);

			if (srcCount < 1) {
				Debug.log("Error: Illegal Number of Fields '" + (srcCount) +
						"' given. Number of Fields must be greater than or equal to 1.",
						Debug.HIGH_PRIORITY);
				return;
			}
			
			if(dest < 0) //change to end
				dest = _colHdrArr.length - 3; //do not change last 3
			
			//steps:
			//	add field(s) in right place
			//	delete source field(s) if necessary
			var deleteField = src;
			for(var i=srcCount-1;i>=0;--i) //go backwards, so inserted in order
			{
				
				_colHdrArr.splice(dest,0,_colHdrArr[src + i]);
				_colTypeArr.splice(dest,0,_colTypeArr[src + i]);
				_colDataTypeArr.splice(dest,0,_colDataTypeArr[src + i]);
				_colDefaultValueArr.splice(dest,0,_colDefaultValueArr[src + i]);
				
				_colMinValueArr.splice(dest,0,_colMinValueArr[src + i]);
				_colMaxValueArr.splice(dest,0,_colMaxValueArr[src + i]);
				
				
				_colChoicesArr.splice(dest,0,_colChoicesArr[src + i]);
				
				if(dest < src)
					++src; //compensate for new add 
				if(dest < deleteField)
					++deleteField;  //compensate for new add
			} //end add field loop

			if(deleteSrc)
				for(var i=0;i<srcCount;++i)
				{
					_colHdrArr.splice(deleteField,1);
					_colTypeArr.splice(deleteField,1);
					_colDataTypeArr.splice(deleteField,1);
					_colDefaultValueArr.splice(deleteField,1);

					_colMinValueArr.splice(deleteField,1);
					_colMaxValueArr.splice(deleteField,1);


					_colChoicesArr.splice(deleteField,1);
				}	// end delete field loop
				
			setupTable(0, _colHdrArr,_colTypeArr,_colDataTypeArr,_colDefaultValueArr,
				_colChoicesArr, _colMinValueArr, _colMaxValueArr, 
				undefined /* to restore tableDescription */);
						
		} //end tableCopyOrMoveRow()

		//==============================================================================
		//tableReplace ~~
		function tableReplace()
		{			
			editCellCancel();			
			var needle = document.getElementById("findAndReplaceNeedle").value;
			var convertEl = document.getElementById("findAndReplaceHTML");
			
			//convert needle to HTML for search
			convertEl.innerHTML = "";
			convertEl.appendChild(document.createTextNode(needle));
			needle = convertEl.innerHTML; //converted text
			
			var replaceStr = document.getElementById("findAndReplaceWith").value;
			
			//convert replaceStr to HTML for search
			convertEl.innerHTML = "";
			convertEl.appendChild(document.createTextNode(replaceStr));
			replaceStr = convertEl.innerHTML; //converted text
			
			Debug.log("tableReplace '" + needle + "' with '" + replaceStr + "'");
			
			//change hdrs and types 
			var cellStr;
			
			for(var c=0;c<_colHdrArr.length-3;++c) //skip last 3 fixed columns
			{
				cellStr = _colHdrArr[c];
				tmpStr = cellStr;
				Debug.log("[" + c + "]=" + cellStr);
				needleStartIndex = 0;
				while(cellStr.indexOf(needle,needleStartIndex) >= 0)
				{
					cellStr = cellStr.replace(needle,replaceStr);
					if(cellStr == tmpStr) break; //in case replace is same as needle
					Debug.log("REPLACED=" + cellStr);		
					needleStartIndex += replaceStr.length;
				}
				_colHdrArr[c] = cellStr;
			}

			var linkIdIndex, linkType;
			for(var c=0;c<_colTypeArr.length-3;++c) //skip last 3 fixed columns
			{
				cellStr = _colTypeArr[c];
				linkIdIndex = cellStr.indexOf('-');
				if(linkIdIndex < 0) continue; //skip all non-link cells
				
				linkType = cellStr.substr(0,++linkIdIndex);
				cellStr = cellStr.substr(linkIdIndex);
				
				tmpStr = cellStr;
				Debug.log("[" + c + "]=" + cellStr);
				needleStartIndex = 0;
				while(cellStr.indexOf(needle,needleStartIndex) >= 0)
				{
					cellStr = cellStr.replace(needle,replaceStr);
					if(cellStr == tmpStr) break; //in case replace is same as needle
					Debug.log("REPLACED=" + cellStr);		
					needleStartIndex += replaceStr.length;
				}
				_colTypeArr[c] = linkType + cellStr;
			}
			
			setupTable();
						
		}

		//==============================================================================
		//addFixedChoice ~~
		//	for column c
		function addFixedChoice(c,quiet)
		{
			//if not already in choices, add it		
			
			var val = document.getElementById("newChoiceInput-" + c).value.trim();			
			Debug.log("addFixedChoice Value = " + val);
			var defaultVal = _defaultArray[_colDataTypeArr[c]][_colTypeArr[c]];
			Debug.log("deleteSelectedFixedChoice defaultVal = " + defaultVal);
					

			if(encodeURIComponent(val) == defaultVal)
			{
				Debug.log("Value '" + val + "' is the default value for column '" + 
					_colHdrArr[c] + "' and so it is always a fixed choice option. " +
							"No need to add it to the list.",
						Debug.HIGH_PRIORITY);
				return;
			}
			
			if(c >= _colChoicesArr.length)
			{
				Debug.log("Invalid column '" + c + "' given.",
						Debug.HIGH_PRIORITY);
				return;
			}
				
			var colChoicesArr = [];

			var colChoicesArr = [];
			if(_colChoicesArr[c] != "") 
				colChoicesArr = _colChoicesArr[c].split(',');
						
			var found = false;
			var encodedVal = encodeURIComponent(val);
			for(var i=1 ;i<colChoicesArr.length;++i) //start at 1 because of arbitraryBool
				if(colChoicesArr[i] == encodedVal)
				{	found = true; break; }
			
			if(found)
			{
				Debug.log("Value '" + val + "' is already a fixed choice option for column '" + 
					_colHdrArr[c] + "'",
						Debug.HIGH_PRIORITY);
				return;
			}

			if(_colChoicesArr[c].length) //other values exist
				_colChoicesArr[c] += "," + encodedVal;
			else						//first value
				_colChoicesArr[c] = "arbitraryBool=0," + encodedVal;
			
			setupTable();			
			
			if(!quiet)
				Debug.log("Value '" + val + 
					"' was successfully added as a fixed choice option for column '" + 
					_colHdrArr[c] + "'",
					Debug.INFO_PRIORITY);
			
			//select text again
			
			var el = document.getElementById("newChoiceInput-" + c);
			setCaretPosition(el,0,el.value.length);
			
		} //end addFixedChoice()

		//==============================================================================
		//handlefixedChoiceArbitraryCheckbox ~~
		//	set the value in fixed choice array
		//	if setSelectValue, then take the select box value as entry 1 in the array
		function handlefixedChoiceArbitraryCheckbox(c,inverted)
		{
			var val;
			if(inverted)
				val = document.getElementById("fixedChoiceArbitraryCheckbox-" + c).checked?"0":"1";
			else
				val = document.getElementById("fixedChoiceArbitraryCheckbox-" + c).checked?"1":"0";
			Debug.log("fixedChoiceArbitraryCheckbox Value = " + val);
			
			var colChoicesArr = [];
			if(_colChoicesArr[c] != "") 
				colChoicesArr = _colChoicesArr[c].split(',');
			
			_colChoicesArr[c] = "";
			if(!colChoicesArr.length || 
					colChoicesArr[0].indexOf("arbitraryBool=") != 0)
				_colChoicesArr[c] += "arbitraryBool=" + val; //insert missing value
			else
				colChoicesArr[0] = "arbitraryBool=" + val; //set value
			
				
			for(var i=0;i<colChoicesArr.length;++i)
			{
				if(_colChoicesArr[c].length) //already something, so add comma
					_colChoicesArr[c] += ",";
				_colChoicesArr[c] += colChoicesArr[i];
			}
			Debug.log("_colChoicesArr[c] " + _colChoicesArr[c]);
		}

		//==============================================================================
		//deleteSelectedFixedChoice ~~
		//	for column c
		function deleteSelectedFixedChoice(c)
		{
			//find the value in choices, and remove it

			if(c >= _colChoicesArr.length)
			{
				Debug.log("Invalid column '" + c + "' given.",
						Debug.HIGH_PRIORITY);
				return;
			}

			var val = document.getElementById("fixedChoicesSelect-" + c).value;
			Debug.log("deleteSelectedFixedChoice Value = " + val);
			val = encodeURIComponent(val);
			var colChoicesArr = _colChoicesArr[c].split(',');
			var defaultVal = _defaultArray[_colDataTypeArr[c]][_colTypeArr[c]];
			Debug.log("deleteSelectedFixedChoice defaultVal = " + defaultVal);
			
			
			var found = -1;
			var deletedDefault = false;
			for(var i=0;i<colChoicesArr.length;++i)
				if(colChoicesArr[i] == defaultVal) //do not allow defaultVal to be in the list	
				{
					colChoicesArr[i] = ""; //clear value, default value is implied as first in list always
					deletedDefault = true;
				}
				else if(colChoicesArr[i] == val)
				{	found = i; break; }

			
			//rebuild choices string
			if(found != -1 || deletedDefault)
			{
				_colChoicesArr[c] = "";
				var cnt = 0;
				for(var i=0;i<colChoicesArr.length;++i)
				{
					if(i == found) continue; //skip one to be removed
					if(colChoicesArr[i] == "") continue; //skip empty values
					
					if(cnt)
						_colChoicesArr[c] += "," + colChoicesArr[i];
					else	//first choice added
						_colChoicesArr[c] = colChoicesArr[i];
					
					++cnt;					
				}
				setupTable();
			}

			//finish up with message to user

			if(deletedDefault)
			{
				Debug.log("Deafult Value '" + decodeURIComponent(defaultVal) + 
						"' was found multiple times in the list of choices. " +
						"The fixed choice options were cleaned up for column '" + 
					_colHdrArr[c] + "'",
						Debug.INFO_PRIORITY);
			}
			
			if(found == -1)
			{
				if(val == defaultVal)
				{
					Debug.log("Value '" + decodeURIComponent(val) + 
							"' is the default value for column '" + 
						_colHdrArr[c] + "' and can not be removed from the fixed choice options.",
							Debug.HIGH_PRIORITY);
				}
				
				Debug.log("Value '" + decodeURIComponent(val) + 
						"' was not found in existing fixed choice options for column '" + 
					_colHdrArr[c] + "'",
						Debug.HIGH_PRIORITY);
				return;
			}
			
			Debug.log("Value '" + decodeURIComponent(val) + 
					"' was successfully removed from the fixed choice options for column '" + 
					_colHdrArr[c] + "'",
					Debug.INFO_PRIORITY);
		}
		
		//==============================================================================
		//downloadFixedChoices ~~
		//	for column c
		//
		// online people complain that this doesn't work for big files.
		// Note: if files are too big, could have server create csv file
		//	then link to <a href='/WebPath/download.csv' download></a>
		//	Note: href must be  encodeURI(dataStr) if data not already encoded
		function downloadFixedChoices(c)
		{
			editCellOK(); //editCellCancel();
			Debug.log("TableEditor downloadFixedChoices ");
			
			var tableName = document.getElementById("SaveAsConfigName").value;

			var colChoicesArr = _colChoicesArr[c].split(',');
			
			//create CSV data string from html table
			var dataStr = "data:text/csv;charset=utf-8,";
			var cnt = 0;
			for(var i=0;i<colChoicesArr.length;++i)
			{
				if(colChoicesArr[i].indexOf("arbitraryBool=") == 0)
					continue; //skip the checkbox value
				if(cnt) //after the first time
					dataStr += encodeURI("\n"); //encoded \n //each choice is a column
				dataStr += colChoicesArr[i];
				++cnt;
			}
			
			Debug.log("CfgGUI downloadTableAsCSV dataStr=" + dataStr);

			
			var link = document.createElement("a");
			link.setAttribute("href", dataStr); //double encode, so encoding remains in CSV
			link.setAttribute("style", "display:none");
			link.setAttribute("download", tableName + "_" + 
					_colHdrArr[c] + "_fixedChoices_download.csv");
			document.body.appendChild(link); // Required for FF

			link.click(); // This will download the data file named "my_data.csv"

			link.parentNode.removeChild(link);
		}

		//==============================================================================
		//popUpUploadFixedChoicesForm ~~
		//	for column c
		var _dataUploadStr;
		function popUpUploadFixedChoicesForm(c)
		{			
			Debug.log("ConfigurationAPI.bitMapDialog.locaPopupUploadCSV");	
			_dataUploadStr = ""; //clear previous upload

			var str = "";

			var pel = document.getElementById("popUpDialog");
			if(!pel)
			{
				pel = document.createElement("div");			
				pel.setAttribute("id", "popUpDialog");
			}
			pel.style.display = "none";

			//set position and size
			var w = 380;
			var h = 195;
			ConfigurationAPI.setPopUpPosition(pel,w /*w*/,h /*h*/);
			
			var str = "<a id='" + 
					"popUpDialog" + //clear upload string on cancel!
					"-header' onclick='javascript:_dataUploadStr = \"\"; var pel = document.getElementById(" +
					"\"popUpDialog\"); if(pel) pel.parentNode.removeChild(pel); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";	

			str += "Please choose a properly formatted CSV data file (i.e. fixed choices, in one column, separated by new lines) " +
					"to upload:<br><br>";

			str += "<center>";

			str += "<input type='file' id='popUpDialog-fileUpload' " + 
					"accept='.csv' enctype='multipart/form-data' />";			
		
			// done with special handling
			// continue with pop-up prompt
			str += "</center></div><br><br>"; //close main popup div

			var onmouseupJS = "";
			onmouseupJS += "document.getElementById(\"popUpDialog-submitButton\").disabled = true;";
			onmouseupJS += "uploadFixedChoices(" + c + ");";			

			str += "<input id='popUpDialog-submitButton' disabled type='button' onmouseup='" + 
					onmouseupJS + "' " +
					"value='Upload File' title='" +
					"Upload the chosen file to replace the row,col data in the current bitmap." +					
					"'/>";

			pel.innerHTML = str;
			document.body.appendChild(pel); //add element to body
			pel.style.display = "block";

			document.getElementById('popUpDialog-fileUpload').addEventListener(
					'change', function(evt) {
				var files = evt.target.files;
				var file = files[0];           
				var reader = new FileReader();
				reader.onload = function() {
					//store uploaded file and enable button
					_dataUploadStr = this.result;
					Debug.log("_dataUploadStr = " + _dataUploadStr);							
					document.getElementById('popUpDialog-submitButton').disabled = false;
				}
				reader.readAsText(file);
			}, false);
		
		}

		//==============================================================================
		//uploadFixedChoices ~~
		//	for column c
		function uploadFixedChoices(c)
		{
			Debug.log("uploadFixedChoices _dataUploadStr = " + _dataUploadStr);
			var src = _dataUploadStr.split('\n');
			//console.log(src);
			
			//save and recover arbitrary checkbox choice
			var val = document.getElementById("fixedChoiceArbitraryCheckbox-" + c).checked?"1":"0";			
			Debug.log("fixedChoiceArbitraryCheckbox Value = " + val);
						
			_colChoicesArr[c] = ""; //clear

			for(var i=0;i<src.length;++i)
			{				
				if(i) _colChoicesArr[c]	+= ",";
				else _colChoicesArr[c]	+= "arbitraryBool=" + val + ",";
				_colChoicesArr[c] += encodeURIComponent(src[i].trim()); //trim is important for weird formats of white-space (like a mac)
			}
			setupTable();

			//on succes remove popup
			el = document.getElementById("popUpDialog"); 
			if(el) el.parentNode.removeChild(el);
			
			Debug.log("Fixed choices were successfully uploaded!",
					Debug.INFO_PRIORITY);
		} //end uploadFixedChoices()
		
		
	</script>
		
</head>
	

<body onload='//init() called by DesktopContent.js'>	
		
	<h1>Configuration Table Editor</h1>

	<div style='width:550px'>	
	<a href='javascript:init()'>Refresh Window</a> 	&nbsp;&nbsp;
	<a href='javascript:setupEmptyTable()'>Clear Table</a> 	&nbsp;&nbsp;

	<!--<a style='margin-left:300px' target="_blank" 
			href="https://cdcvs.fnal.gov/redmine/projects/otsdaq/search?utf8=%E2%9C%93&wiki_pages=1&q=table+editor&all_words=1&issues=1&documents=1" 
					title="Click to open ots documentation">
	<img src="/WebPath/images/dashboardImages/icon-Help.png"></a> -->
	</div>
	
	<hr>
	
	<div id='controls'></div>
	<div id='display'></div>

	<div class='preloadImage' id='preloadImage-treeEditTrashIcon'></div>
	<div class='preloadImage' id='preloadImage-treeEditTrashIconHover'></div>
</body>
	
</html>
