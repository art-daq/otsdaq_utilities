<!DOCTYPE HTML>
<html lang="en"> 
<head>
	<title>ConfigurationGUI</title>

	<link href='/WebPath/css/fonts.css?family=Inconsolata:400' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="/WebPath/css/ConfigurationGUI.css">
	
	<style type="text/css">		
	
	</style>
	
	
	<script type="text/JavaScript" src="/WebPath/js/Globals.js"></script>	
	<script type="text/JavaScript" src="/WebPath/js/Debug.js"></script>	
	<script type="text/JavaScript" src="/WebPath/js/DesktopWindowContentCode.js"></script>
	
	<script>		
		
	
		var _CONFIG_TYPE_ROW_OFFSET = 1;
		var _CONFIG_DATA_COL_OFFSET = 0;
		var _CONFIG_FIXED_CELLS = 3;
	

		var _typeArray = ["Data","OnOff","TrueFalse","YesNo","ChildLinkUID","ChildLinkGroupID","ChildLink","GroupID"];
		var _dataTypeArray = ["VARCHAR2","NUMBER","TIMESTAMP WITH TIMEZONE"];
				
		var _editingCell = false;
		var _editingCellEl, _editingCellElOldValue;
		var _editingCellPos = [-1,-1];	
		var _srcName;
		var _colHdrArr, _colTypeArr, _colDataTypeArr;
		var _tableIsTransposed = false;
	
		/////////////////////////////////////////////////////////////////////////////////////////
		/////////////////////////////////////////////////////////////////////////////////////////
	
		//functions:			
			//init()			
			//setupTableEditor(req)
			//saveTable()
			//loadTable()
			//verifyDeleteTable()
			//deleteTable()
			//setupSpecificConfig(configName, version)		//setup editor for specific configuration table
			//specificConfigRequestHandler(req)
			//setupEmptyTable();
			//setupTable(srcName,colHdrs,colTypes,colDataTypes)
			//selectThisCell(r,c,el)
			//setCaretPosition(el,start,stop)
			//editCellCancel()
			//keyHandler(e)
			//editCellOK(r,c)
			//addColumn(c)
			//deleteColumn(c)
			//transposeTable()
	
		/////////////////////////////////////////////////////////////////////////////////////////
		/////////////////////////////////////////////////////////////////////////////////////////
						
		
		//init ~
		//	init called once body has loaded
		function init() {			
			Debug.log("CfgTableEditor init");
			
			DesktopContent.XMLHttpRequest("Request?RequestType=getConfigurations&refresh=1&allowIllegalColumns=1", "",
					setupTableEditor);
			
			setupEmptyTable();
		}
		
		//setupTableEditor(req) ~
		function setupTableEditor(req)
		{
			var err = DesktopContent.getXMLValue(req,"Error");
			if(err) 
			{
				Debug.log(err,Debug.HIGH_PRIORITY);
				//attemp to power through
			}

			var configNames = req.responseXML.getElementsByTagName("ConfigurationName");
			var configVersionHdr = req.responseXML.getElementsByTagName("ConfigurationVersions");

			//Save Column Info as...
			//	Configuration Name:
			//	
			//Load Column Info from...
			//	Configuration Name: ____^

			var str = "";

			str += "Load Column Info from... "; 
			str += " <input type='button' onmouseup='loadTable()' value='Load'/>";
			str += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Delete Table... "; 			
			str += " <input type='button' onmouseup='verifyDeleteTable()' value='Delete'/>";
			str += " <input id='reallyDeleteButton' type='button' style='display:none' onmouseup='deleteTable()' value='Really Delete!'/>";
			
			str += "<br>&nbsp;&nbsp;Configuration Name:";

			str += "<select id='loadFromConfigName' " +
					"onchange='document.getElementById(\"reallyDeleteButton\").style.display = \"none\";' " +
					">";

			var configName;

			Debug.log("CfgTableEditor requestHandler configNames.length " + configNames.length);
			for(var i=0;i<configNames.length;++i)
			{			
				configName = configNames[i].getAttribute("value");

				str += "<option value='" + configName + "'>";
				str += configName;	//can display however
				str += "</option>";
			}				
			str += "</select>";

			str += "<br><br>";
			str += "Save Column Info as...";
			str += " <input id='overwriteButton' style='display:none' type='button' onmouseup='saveTable(1)' value='Overwrite'/>";
			str += "<br>&nbsp;&nbsp;Configuration Name:";							
			str += "<input type='text' id='SaveAsConfigName' " + 
					"onchange='document.getElementById(\"overwriteButton\").style.display = \"none\";' " +
					"style='margin:-4px -2px -4px -1px; width:310px' value=''>";
			str += " <input type='button' onmouseup='saveTable(0)' value='Save'/>";
			
			
			
			var el = document.getElementById("controls");
			el.innerHTML = str;
			
		}

		//handleTypeSelect ~
		function handleTypeSelect()
		{
			var sel = document.getElementById("selectCellTypeSelect");
			var selVal = sel.options[sel.selectedIndex].value;
			Debug.log("CfgTableEditor handleTypeSelect = " + selVal);

			var specTypeArray = ["GroupID","ChildLink","ChildLinkUID","ChildLinkGroupID"];
					
			var found = false;
			for(var i=0;i<specTypeArray.length;++i)
				if(selVal == specTypeArray[i]) { found = true; break; }

			var el = document.getElementById("selectCellSpecTypeID");
			
			el.style.display = found?"block":"none";	
			
		}
		
		//loadTable ~
		function loadTable()
		{
			var sel = document.getElementById("loadFromConfigName");
			var configName = sel.options[sel.selectedIndex].value;
			
			Debug.log("CfgTableEditor loadTable from " + configName);

			//load mockup for chosen table
			setupSpecificConfig(configName, -1);
		}
		
		//saveTable ~
		function saveTable(allowOverwrite)
		{
			var configName = document.getElementById("SaveAsConfigName").value;
			
			Debug.log("CfgTableEditor saveTable=" + configName);
			_colHdrArr, _colTypeArr, _colDataTypeArr;

			//	write new info file for configName based CSV column info
			//			data="type,name,dataType;type,name,dataType;..."
			
			var data = "";
			for(var i=0;i<_colHdrArr.length;++i)
				data += _colTypeArr[i] + "," + _colHdrArr[i].trim() + "," + _colDataTypeArr[i] + ";";
			
			DesktopContent.XMLHttpRequest("Request?RequestType=saveConfigurationInfo" +
				"&configName=" + configName + 
				"&allowOverwrite="+allowOverwrite, 
				"columnCSV=" + data, specificConfigRequestHandler, 1);	
		}
		

		//verifyDeleteTable ~
		function verifyDeleteTable()
		{
			var sel = document.getElementById("loadFromConfigName");
			var configName = sel.options[sel.selectedIndex].value;
			
			Debug.log("CfgTableEditor verifyDeleteTable from " + configName);
			
			Debug.log("Are you sure you want to delete the " +
					"configuration '" +  configName + 
					"'? If so, click the 'Really Delete!' button.",
					Debug.WARN_PRIORITY);
			document.getElementById("reallyDeleteButton").style.display = "inline";			
		}
		
		//deleteTable ~
		function deleteTable()
		{
			var sel = document.getElementById("loadFromConfigName");
			var configName = sel.options[sel.selectedIndex].value;			
			Debug.log("CfgTableEditor deleteTable from " + configName);

			document.getElementById("reallyDeleteButton").style.display = "none";
			DesktopContent.XMLHttpRequest("Request?RequestType=deleteConfigurationInfo" +
				"&configName=" + configName, "",
				function(req)
				{
					var err = DesktopContent.getXMLValue(req,"Error");
					if(err) 
					{	
						Debug.log(err,Debug.HIGH_PRIORITY);
						return;
					}

					//on success reload all configurations
					DesktopContent.XMLHttpRequest("Request?RequestType=getConfigurations" +
							"&refresh=1&allowIllegalColumns=1", "",
							setupTableEditor);					
				} //end of delete handler		
			);
		}

		//setupSpecificConfig ~
		//	undefined version gives latest
		function setupSpecificConfig(configName,version) {
			var v = "";
			if(version) v = "&version="+version;
			document.getElementById("SaveAsConfigName").value = configName;
			DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificConfiguration&allowIllegalColumns=1" + "&dataOffset=0&chunkSize=0" +  
				"&configName=" + configName + v, "", specificConfigRequestHandler);		
		}		
		
		//setupEmptyTable
		function setupEmptyTable() {
			
			var colTypes = ["UID","Comment","Author","Timestamp"];
			var colDataTypes = ["VARCHAR2","VARCHAR2","VARCHAR2","TIMESTAMP WITH TIMEZONE"];
			var colHdrs = ["UID","CommentDescription","Author","RecordInsertionTime"];
			
			setupTable("Empty Table Template",colHdrs,colTypes,colDataTypes);
		}

		//specificConfigRequestHandler
		function specificConfigRequestHandler(req, isFromSaveReq) {

			var configName = DesktopContent.getXMLValue(req,"ConfigurationName");
			var err = DesktopContent.getXMLValue(req,"Error");
			if(err) 
			{				
				var writeErr = DesktopContent.getXMLValue(req,"OverwriteError");
				if(writeErr) //overwrite rejection
				{
					Debug.log(err,Debug.WARN_PRIORITY);
					Debug.log("Are you sure you want to overwrite the " +
							"configuration '" +  configName + 
							"'? If so, click the 'Overwrite' button.",
							Debug.WARN_PRIORITY);
					document.getElementById("overwriteButton").style.display = "inline";
					return;
				}
				else
				{
					Debug.log(err,Debug.HIGH_PRIORITY);
					//try to power through
				}
			}
			else if(configName != "")
				Debug.log("Column info for table '" + configName + "' was successfully loaded!",
						Debug.INFO_PRIORITY);
				
			document.getElementById("overwriteButton").style.display = "none";						
			
			if(isFromSaveReq && !err)
				Debug.log("Successful response to save request of Info for '" + configName + "'",Debug.INFO_PRIORITY);
			
			var colHdrs = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnHeader");
			var colTypes = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnType");
			var colDataTypes = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnDataType");

			var colHdrsArr = [];
			for(var i=0;i<colHdrs.length;++i)
				colHdrsArr.push(colHdrs[i].getAttribute("value"));
			var colTypesArr = [];
			for(var i=0;i<colTypes.length;++i)
				colTypesArr.push(colTypes[i].getAttribute("value"));
			var colDataTypesArr = [];
			for(var i=0;i<colDataTypes.length;++i)
				colDataTypesArr.push(colDataTypes[i].getAttribute("value"));
			
			if(!isFromSaveReq)
				document.getElementById('SaveAsConfigName').value = configName;
			setupTable(configName,colHdrsArr,colTypesArr,colDataTypesArr);
		}
		
		//setupTable ~
		function setupTable(srcName,colHdrs,colTypes,colDataTypes)
		{
			//handle use of cached _srcName
			if(!srcName)
				srcName = _srcName;
			else
				_srcName = srcName;
					 
			//cache data for add/delete ease
			if(!colHdrs)
				colHdrs = _colHdrArr;
			else
				_colHdrArr = colHdrs;
			if(!colTypes)
				colTypes = _colTypeArr;
			else
				_colTypeArr = colTypes;
			if(!colDataTypes)
				colDataTypes = _colDataTypeArr;
			else
				_colDataTypeArr = colDataTypes;			

			//force proper comment name
			colHdrs[colHdrs.length-3] = "CommentDescription";
			_colHdrArr[colHdrs.length-3] = "CommentDescription";
			
						
			var str = "";

			str += "<a href='javascript:transposeTable()'>Transpose Table View</a><br><br>";
			
			str += "Starting point was...<br><b>" + srcName + "</b> (version: Mockup-View)<br>";
							
			//display table
			str += "<table id='SubSystemTable' border='1' cellspacing='5' cellpadding='1'>";
			
			if(_tableIsTransposed)
			{
				//for each column, make a row		
				for(var c=0;c<colTypes.length;++c)
				{
					///// open row
					str += "<tr>";
					
					/////////////////////////////////
					//+/- column row
					str += "<td>";					
					//show +/- columns where possible to add/delete
					if(c <= colTypes.length - _CONFIG_FIXED_CELLS)					
					{
						str += " <a href='javascript:addColumn(" + c + ");'>";
						str += "+";
						str += "</a>";

						if(c < colTypes.length - _CONFIG_FIXED_CELLS && colTypes[c] != "UID")
						{
							str += "/<a href='javascript:deleteColumn(" + c + ");'>";
							str += "-";
							str += "</a>";
						}
					}
					str += "</td>";	
					
					/////////////////////////////////
					//type and data type row
					str += "<td onmouseup='selectThisCell(" + _CONFIG_TYPE_ROW_OFFSET + "," +
							c + ",this);' style='width:100px'>";
					str += "<div style='font-size:12px' title='";		
					str += colTypes[c];
					str += " &#60;" + colDataTypes[c] + "&#62;";
					str += "'>";
					str += colTypes[c];
					str += "<br>&#60;" + colDataTypes[c] + "&#62;";
					str += "</div>";
					str += "</td>";	

					/////////////////////////////////
					//col name type row
					str += "<th onmouseup='selectThisCell(" + (_CONFIG_TYPE_ROW_OFFSET+1) + "," +
							c + ",this);'>";
					str += colHdrs[c];
					str += "</th>";
					
					
					///// close row
					str += "</tr>";
				}
			}
			else
			{
				//+/- column row
				str += "<tr>";					
				for(var c=0;c<colTypes.length;++c)
				{
					str += "<td>"
							
					//show +/- columns where possible to add/delete
					if(c <= colTypes.length - _CONFIG_FIXED_CELLS)					
					{
						str += " <a href='javascript:addColumn(" + c + ");'>";
						str += "+";
						str += "</a>";
	
						if(c < colTypes.length - _CONFIG_FIXED_CELLS && colTypes[c] != "UID")
						{
							str += "/<a href='javascript:deleteColumn(" + c + ");'>";
							str += "-";
							str += "</a>";
						}
					}
	
					str += "</td>";					
	
				}
				str += "</tr>";
				
				//type and data type row
				str += "<tr>";	
				for(var c=0;c<colTypes.length;++c)
				{
					str += "<td onmouseup='selectThisCell(" + _CONFIG_TYPE_ROW_OFFSET + "," +
							c + ",this);'>";
					str += "<div style='font-size:12px' title='";		
					str += colTypes[c];
					str += " &#60;" + colDataTypes[c] + "&#62;";
					str += "'>";
					str += colTypes[c];
					str += "<br>&#60;" + colDataTypes[c] + "&#62;";
					str += "</div>";
					str += "</td>";			
	
				}
				str += "</tr>";
				str += "<tr>";
				for(var c=0;c<colHdrs.length;++c)
				{
					str += "<th onmouseup='selectThisCell(" + (_CONFIG_TYPE_ROW_OFFSET+1) + "," +
							c + ",this);'>";
					str += colHdrs[c];
					str += "</th>";					
	
				}
				str += "</tr>";
			}

			str += "</table>";		

			var el = document.getElementById("display");
			el.innerHTML = str;		
		}
		


		//selectThisCell ~~
		function selectThisCell(r,c,el) 
		{				
			if(_editingCell) //already have the edit box open, cancel it
			{
				if(_editingCellEl == el) //if same cell do nothing
					return false;
				editCellCancel(); //if new cell cancel
			}			
			
			//if column is Author or Timestamp, don't allow select
			var tableEl = document.getElementById("SubSystemTable");
			var rows = tableEl.getElementsByTagName("tr");
			var cols = [];
			//get col type cols (transposed or not)
			if(_tableIsTransposed)
			{
				//transpose all
				var tcols;
				for(var i=0;i<rows.length;++i)
				{
					tcols = rows[i].getElementsByTagName("td");					
					cols[i] = tcols[_CONFIG_TYPE_ROW_OFFSET];
				}
			}
			else
			{
				cols = rows[_CONFIG_TYPE_ROW_OFFSET].getElementsByTagName("td");
			}
			
			var colType = cols[_CONFIG_DATA_COL_OFFSET+c].childNodes[0].innerHTML.split('<')[0]; //type text is in a div for smaller font			
			if(colType == "Author" || 
					colType == "Timestamp"|| 
					colType == "Comment" || 
					(r == _CONFIG_TYPE_ROW_OFFSET && colType == "UID"))
				return false;
			
			
			_editingCell = true;
			_editingCellEl = el;
			_editingCellPos = [r,c];			

			var colDataType = cols[_CONFIG_DATA_COL_OFFSET+c].childNodes[0].innerHTML.split('>')[1]; //type text is in a div for smaller font
			
			_editingCellElOldValue = el.innerHTML;
			
			
			var str = "";			
			var typeOptionIndex = -1;
			var dataTypeOptionIndex = -1;
			
			if(r == _CONFIG_TYPE_ROW_OFFSET) //column type and data types
			{
				str += "<select  onkeydown='keyHandler(event)' onchange='handleTypeSelect()' id='selectCellTypeSelect' style='float:left'>";
				for(var i=0;i<_typeArray.length;++i)
				{			
					str += "<option value='" + _typeArray[i] + "'>";
					str += _typeArray[i];	//can display however
					str += "</option>";
					
					if(typeOptionIndex == -1 && //only take first match
							el.getElementsByTagName("div")[0].innerHTML.indexOf(_typeArray[i]) == 0) 
						typeOptionIndex = i; //get starting sel index for type
				}				
				str += "</select>";
				str += "<input type='text' id='selectCellSpecTypeID' onkeydown='keyHandler(event)' " +
						"style='display:none; width:40px; float:left; height: 13px' value='0'>";				
				str += "<select onkeydown='keyHandler(event)'  id='selectCellDataTypeSelect'>";
				for(var i=0;i<_dataTypeArray.length;++i)
				{			
					str += "<option value='" + _dataTypeArray[i] + "'>";
					str += "&lt;" + _dataTypeArray[i] + "&gt;";	//can display however
					str += "</option>";
					if(dataTypeOptionIndex == -1 && //only take first match
							_editingCellElOldValue.indexOf("&lt;" + _dataTypeArray[i] + "&gt;") >= 0)
						dataTypeOptionIndex = i; //get starting sel index for data type
				}				
				str += "</select>";
			}
			else // column header names
			{
				str += "<input type='text' onkeydown='keyHandler(event)' " + 
						"style='margin:-4px -2px -4px -1px;width:" + (el.offsetWidth-6) + 
						"px; height:" + (el.offsetHeight-8) + "px' value='";
				str += _editingCellElOldValue;
				str += "'>";
			}

			str += "<div style='padding:5px;background-color:#eeeeee;border:1px solid #555555;position:relative;" + 
					"width:105px;height:20px;margin:0 -122px -32px 10px;text-size: 16px;'>";
			str += "<a href='javascript:editCellOK("+r+","+c+");' style='color:green'>" +
					"<b style='color:green'>OK</b></a> | " +
					"<a href='javascript:editCellCancel();' style='color:red'>" + 
					"<b style='color:red'>Cancel</b></a>";
			str += "</div>";
			
			el.innerHTML = str;
			
			if(r == _CONFIG_TYPE_ROW_OFFSET) //select dropdown menu
			{
				Debug.log("typeOptionIndex=" + typeOptionIndex +
						" dataTypeOptionIndex=" + dataTypeOptionIndex);
				el.getElementsByTagName("select")[0].selectedIndex = typeOptionIndex;
				el.getElementsByTagName("select")[1].selectedIndex = dataTypeOptionIndex;
				el.getElementsByTagName("select")[0].focus();
				handleTypeSelect();
			}
			else //select text box
				setCaretPosition(el.getElementsByTagName("input")[0],0,_editingCellElOldValue.length);
			
			return true;
		}
		
		//setCaretPosition
		function setCaretPosition(elem, caretPos, endPos) {
            elem.focus();
            elem.setSelectionRange(caretPos, endPos);
		}
		
		//keyHandler
		function keyHandler(e) 
		{
			var TABKEY = 9;
			var ENTERKEY = 13;
			var UPKEY = 38;
			var DNKEY = 40;
			var ESCKEY = 27;
			//Debug.log("key " + e.keyCode);
			
			var shiftIsDown;
			if (window.event) 
			{
				key = window.event.keyCode;
				shiftIsDown = !!window.event.shiftKey; // typecast to boolean
			} 
			else
			{
				key = e.which;
				shiftIsDown = !!e.shiftKey;	// typecast to boolean
			}
			//Debug.log("shift=" + shiftIsDown);
			
			//tab key jumps to next cell with a CANCEL
			//	(enter key does same except saves/OKs value)
			//	shift is reverse jump
			if(e.keyCode == TABKEY || e.keyCode == ENTERKEY || 
					e.keyCode == UPKEY || e.keyCode == DNKEY) 				
			{
				//this.value += "    ";
				if(e.preventDefault) 
					e.preventDefault();

				if(e.keyCode == ENTERKEY) 
					editCellOK(_editingCellPos[0],_editingCellPos[1]);
				
				//jump forward (tab/enter) or backward (tab/enter+shift)
				//	or up or down.
				//get number of rows and cols
				//	to determine next row and col to jump to
				
				
				var newRow = _editingCellPos[0];
				var newCol = _editingCellPos[1];
				var el = document.getElementById("SubSystemTable");
				var rows = el.getElementsByTagName("tr");
				var numOfRows = _CONFIG_TYPE_ROW_OFFSET + 2;
				var numOfCols = _colHdrArr.length; //rows[_CONFIG_TYPE_ROW_OFFSET+1].getElementsByTagName("th").length - 
						//_CONFIG_DATA_COL_OFFSET;
				var cols;
				do
				{					
					if(e.keyCode == TABKEY || e.keyCode == ENTERKEY)
						newCol += (shiftIsDown?-1:1);
					else if(e.keyCode == UPKEY)
						--newRow;
					else if(e.keyCode == DNKEY)
						++newRow;
					
					//new position is chosen! now make it happen (in a clean way)	
									
					if(newCol == numOfCols)	{ ++newRow; newCol = 0;	}
					if(newRow == numOfRows) newRow = _CONFIG_TYPE_ROW_OFFSET;
					if(newCol < 0) {--newRow; newCol = numOfCols-1; }
					if(newRow < _CONFIG_TYPE_ROW_OFFSET) newRow = numOfRows-1;					

					cols = [];
					if(_tableIsTransposed)
					{
						//transpose all
						var tcols;
						for(var i=0;i<rows.length;++i)
						{	
							if(newRow == _CONFIG_TYPE_ROW_OFFSET)
							{
								tcols = rows[i].getElementsByTagName("td");	
								cols[i] = tcols[newRow];
							}
							else	//th is always the last newRow, so above works
							{
								tcols = rows[i].getElementsByTagName("th");
								cols[i] = tcols[0];
							}
						}
					}
					else
					{
						if(newRow == _CONFIG_TYPE_ROW_OFFSET)
							cols = rows[newRow].getElementsByTagName("td");
						else
							cols = rows[newRow].getElementsByTagName("th")
					}

					el = cols[_CONFIG_DATA_COL_OFFSET+newCol];
					
				} while(!selectThisCell(newRow,newCol,el));

				//Debug.log("newRow=" + newRow + " newCol=" + newCol);
				
				return false;
			}
			else if(e.keyCode == ESCKEY) 
			{				
				if(e.preventDefault) 
					e.preventDefault();
				editCellCancel();
				return false;
			}
		}
		
		//editCellOK
		function editCellOK(r,c) 
		{				
			
			var str;
			
			if(r == _CONFIG_TYPE_ROW_OFFSET) //type and dataType
			{
				Debug.log("CfgTBL editCellOK editing r,c:" + r + "," + c);
				//get type and data type from select boxes (and input field for link ID)
				var sel = document.getElementById("selectCellTypeSelect");				
				var colType = sel.options[sel.selectedIndex].value;
				sel = document.getElementById("selectCellDataTypeSelect");
				var colDataType = sel.options[sel.selectedIndex].value;
				
				var specTypeArray = ["GroupID","ChildLink","ChildLinkUID","ChildLinkGroupID"];
						
				//if child link special type, append special type ID
				for(var i=0;i<specTypeArray.length;++i)
					if(colType == specTypeArray[i])
						colType += "-" + document.getElementById("selectCellSpecTypeID").value;
				
				Debug.log("CfgTBL editCellOK editing colType,colDataType:" + 
						colType + "," + colDataType);
				
				_colTypeArr[c] = colType;
				_colDataTypeArr[c] = colDataType;
				
				str = "";
				str += "<div style='font-size:12px' title='";		
				str += colType;
				str += " &#60;" + colDataType + "&#62;";
				str += "'>";
				str += colType;
				str += "<br>&#60;" + colDataType + "&#62;";
				str += "</div>";
				_editingCellEl.innerHTML = str;
			}			
			else //colHdr row
			{
				Debug.log("CfgTBL editCellOK editing r,c:" + r + "," + c + 
						" = " + _editingCellEl.getElementsByTagName("input")[0].value);
				str = _editingCellEl.getElementsByTagName("input")[0].value;
				_colHdrArr[c] = str;
				_editingCellEl.innerHTML = "";
				_editingCellEl.appendChild(document.createTextNode(str));				
			}

			_editingCell = false;
			_editingCellEl = 0;
		}
		
		//editCellCancel
		function editCellCancel() 
		{	
			_editingCellEl.innerHTML = _editingCellElOldValue;
			
			_editingCell = false;
			_editingCellEl = 0;
		}
		

		//addColumn ~~
		// adds col to position c (relative to view on page)
		// absolute col is _dataOffset + c
		function addColumn(c) 
		{
			Debug.log("CfgTBL addColumn " + c);
			
			_colHdrArr.splice(c,0,"DefaultColumnName");
			_colTypeArr.splice(c,0,"Data");
			_colDataTypeArr.splice(c,0,"VARCHAR2");
			
			setupTable(0,_colHdrArr,_colTypeArr,_colDataTypeArr);
		}
		
		//deleteColumn ~~
		// deletes col to position c (relative to view on page)
		// absolute col is _dataOffset + c
		function deleteColumn(c) 
		{
			Debug.log("CfgTBL deleteColumn " + c);
			
			_colHdrArr.splice(c,1);
			_colTypeArr.splice(c,1);
			_colDataTypeArr.splice(c,1);
			
			setupTable(0,_colHdrArr,_colTypeArr,_colDataTypeArr);
		}

		//transposeTable ~~
		function transposeTable()
		{
			_tableIsTransposed = !_tableIsTransposed;
			Debug.log("CfgTBL transposeTable " + _tableIsTransposed);
			
			setupTable();
		}
		
	</script>
		
</head>
	

<body onload='Javascript:init();'>	
		
	<h1>Configuration Table Editor</h1>

	<a href='javascript:init()'>Refresh</a> 	&nbsp;&nbsp;
	<a href='javascript:setupEmptyTable()'>Clear Table</a> 	&nbsp;&nbsp;

	<a style='margin-left:300px' target="_blank" 
			href="https://cdcvs.fnal.gov/redmine/projects/otsdaq/search?utf8=%E2%9C%93&wiki_pages=1&q=table+editor&all_words=1&issues=1&documents=1" 
					title="Click to open ots documentation">
	<img src="/WebPath/images/dashboardImages/icon-Help.png"></a>
	<hr>
	
	<div id='controls'></div>
	<div id='display'></div>
	
</body>
	
</html>
