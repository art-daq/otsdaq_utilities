<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title>Text</title>
		<style type="text/css">	
			body {
				font: 10px arial;
				background-color: rgb(250, 250, 250);
				//margin: 0px !important;
			}

			button {
			    display: inline-block;
			    width: auto;
			    height: auto;
			    padding: 0;
			    margin: 0;
			    vertical-align: top;
			    font-size: 10px;
			    font-weight:bold;
			}

		</style>

		<script>

			var _chatSound;
			var _SOUND_PATH = "/WebPath/sounds/siren-noise.wav";
			var _soundsEnabled = true;

			//functions:
			//init()

			var pv_settings_ = [];

			/////////////////////////////////////////////////////////////////////////////////////////
			/////////////////////////////////////////////////////////////////////////////////////////

			//init called once body has loaded
			function init()
			{
				console.log("init()");
				console.log(window.frameElement.id);
				_chatSound = new Audio(_SOUND_PATH);
				window.parent.setupWidget(window.frameElement.id, getParameters());
			}

			function setupPVs(settings)
			{
				console.log("setupPVs() : " , settings);
				pv_settings_ = settings;
			}

			function newWidget(widget, parameters)
			{
				drawSirenAlarm();
				console.log(document.body);
			}

			function getParameters()
			{
				parameters = {

				};
				return parameters;
			}

			function setParameters(attributes)
			{
				
			}

			function newValue(pvName, pvValue, pvTime, pvStatus, pvSeverity)
			{
				console.log("SireneAlarm newValue() reached", pvName, pvValue);
				if(pvSeverity == "MAJOR" )
				{
					document.getElementById("alarm-text").innerHTML = "<center style = 'color: red'>" + pvName + "<br>Status: " + pvStatus + "<br>Severity: " + pvSeverity + "</center>";
					document.getElementById("alarm-image").src = "./red_siren.png";
				}
				else if(pvSeverity == "MINOR")
				{
					if(_soundsEnabled) _chatSound.play();
					document.getElementById("alarm-text").innerHTML = "<center style = 'color: orange'>" + pvName + "<br>Status: " + pvStatus + "<br>Severity: " + pvSeverity + "</center>";
					document.getElementById("alarm-image").src = "./yellow_siren.png";
				}
				else if(pvSeverity == "INVALID")
				{
					document.getElementById("alarm-text").innerHTML = "<center style = 'color: blue'>" + pvName + "<br>Status: " + pvStatus + "<br>Severity: " + pvSeverity + "</center>";
					document.getElementById("alarm-image").src = "./blue_siren.png";
				}
				else
				{
					document.getElementById("alarm-text").innerHTML ="";
					document.getElementById("alarm-image").src = "./green_siren.png";
				}
				document.getElementById("alarm-image").title =
											pvName
											+ "\nlast value "
											+ pvValue
											+ " "
											+ pv_settings_[pvName].Units
											+ " time "
											+ pvTime
											+ "\nLower Warning Limit:\t" + Number.parseFloat(pv_settings_[pvName].Lower_Warning_Limit).toExponential(2) + "\n"
										  	+ "Upper Warning Limit:\t"   + Number.parseFloat(pv_settings_[pvName].Upper_Warning_Limit).toExponential(2) + "\n"
										  	+ "Lower Alarm Limit:\t\t"   + Number.parseFloat(pv_settings_[pvName].Lower_Alarm_Limit).toExponential(2)   + "\n"
										  	+ "Upper Alarm Limit:\t\t"   + Number.parseFloat(pv_settings_[pvName].Upper_Alarm_Limit).toExponential(2)   + "\n"
										  	+ "Lower Control Limit:\t"   + Number.parseFloat(pv_settings_[pvName].Lower_Control_Limit).toExponential(2) + "\n"
										  	+ "Upper Control Limit:\t"   + Number.parseFloat(pv_settings_[pvName].Upper_Control_Limit).toExponential(2) + "\n"
										  	+ "Lower Display Limit:\t"   + Number.parseFloat(pv_settings_[pvName].Lower_Display_Limit).toExponential(2) + "\n"
										  	+ "Upper Display Limit:\t"   + Number.parseFloat(pv_settings_[pvName].Upper_Display_Limit).toExponential(2) + "\n";
			}

			function drawSirenAlarm()
			{
				var image = document.getElementById("alarm-image");
				image.src 	 = "./green_siren.png";
				image.height = window.innerHeight - 60;
				image.width  = window.innerWidth - 60;

				var button = document.getElementById("alarm-button");
				button.innerHTML = "SOUND ENABLED";
				button.style.color = "green";
			}

			window.onresize = function() {
				document.getElementById("alarm-image").height = window.innerHeight - 60;
				document.getElementById("alarm-image").width  = window.innerWidth - 60;

				console.log("SireneAlarm: window.onresize()");
			};

			function alarmSounds()
			{
				console.log("silenceAlarmSounds()");
				var button = document.getElementById("alarm-button");
				if (_soundsEnabled){
					_soundsEnabled = false;
					button.innerHTML = "SOUND DISABLED";
					button.style.color = "red";
				}
				else
				{
					_soundsEnabled = true;
					button.innerHTML = "SOUND ENABLED";
					button.style.color = "green";
				}
				//setTimeout(enableAlarmSounds,300000);
				
			}

		</script>

</head>

	<body onload='Javascript:init();'>

	<div id="display">
		<center>
			<span id="alarm-text"></span>
			<img id="alarm-image" style = "background-color: white"></img>
			<button id="alarm-button" onclick="alarmSounds()">SOUND ALARM</button>
		</center>
	</div>

	</body>

</html>
