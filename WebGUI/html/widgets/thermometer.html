<!DOCTYPE HTML>
<html lang="en"> 
	<head>
		<title>Text</title>
		<style type="text/css">			
			body {
				background-color: rgb(41,46,55);
				margin: 0px !important;
			}
			a{
				color: green;Quick Views
				height: auto;
		    	text-align: center;
			}
			div{
			}
			table{
				border-spacing:0px !important;
			}
			}
			tr {
				margin: auto;
				padding: auto;
			}
			#td{
				writing-mode: vertical-lr;
				transform: rotate(90deg);
				text-align: left;
				vertical-align: bottom;
				font-size: 100%;
				color: white;
				height: 1px;
				width: 1px;
				//float: left;

			}
		</style>

			<script src="https://d3js.org/d3.v5.min.js"></script>
			<script type="text/javascript" src="libraries/thermometer.js"></script>

		<script>		

			//functions:
				//init()

			/////////////////////////////////////////////////////////////////////////////////////////
			/////////////////////////////////////////////////////////////////////////////////////////
			var rows = 1;
			var columns = 1;

			//init called once body has loaded
			function init()
			{
				console.log("init()");
				console.log(window.frameElement.id)
				window.parent.setupWidget(window.frameElement.id, getParameters());
			}

			function setupPVs(settings)
			{
				console.log("setupPVs() : " , settings);
			}

			function newWidget(widget, parameters) 
			{
				var table = document.createElement('table');
				table.id = "display-table";
				table.style.height = "100%";//(parseInt(window.innerHeight) - 26) + "px";
				table.style.width = "100%";//window.innerWidth + "px";

				var counter = 0;
				for(var pv in widget.PVList)
				{
					counter++;
				}

				if(counter<1)
					++counter;

				var rows = Math.round(Math.sqrt(counter)); 
				var columns = Math.ceil(counter / rows);

				var hght = (parseInt(window.innerHeight) - 16) / rows;//((parseInt(window.innerHeight) - 26) * 0.9) / rows;
				var wdth = (parseInt(window.innerWidth) - 16) / columns;

				for(var col = 1; col <= columns; col++)
				{
					var tr = document.createElement('tr');
					tr.id = "tr" + col;
					//tr.style.width = tr.parentElement.innerWidth / columns;
					for(var cell = 1; cell <= rows; cell++)
					{
						var td = document.createElement('td');
						td.id = "td" + col + "-" + cell;
						var tr1 = document.createElement('tr');
						tr1.id = "tr-1" + td.id;
						var tr2 = document.createElement('tr');
						tr2.id = "tr-2" + td.id;
						td.appendChild(tr1);
						td.appendChild(tr2);

						//td.style.height = td.parentElement.innerHeight / rows;
						//console.log(td.id);
						tr.appendChild(td);
					}
					table.appendChild(tr);
				}
				var display = document.getElementById("display");
				console.log(window.innerWidth + " : " + window.innerHeight);
				console.log(wdth + " : " + hght);
				display.innerHTML = "";
				display.style.width = (parseInt(window.innerWidth) - 16)+ "px";;
				display.style.height = (parseInt(window.innerHeight) - 16) + "px";//window.innerHeight;
				display.appendChild(table);

				//console.log("newWidget() called *************************************");
				if(counter > 1){counter = 2;}
				console.log("counter" + counter);
				for(var pv in widget.PVList)
				{
					var first = Math.floor(counter/columns);
					if(first < 1) {first = 1;}	

					var pvDiv = document.createElement('div');
					pvDiv.id = "td" + first + "-" + (counter%rows +1);
					pvDiv.title = pv;
					pvDiv.style.color = "white";
					pvDiv.style.marginRight = "15px";

					pvDiv.innerHTML = pv;
					var pvCenter = document.createElement("center");
					pvCenter.appendChild(pvDiv);
					document.getElementById("tr-1td" + first + "-" + (counter%rows +1)).appendChild(pvCenter);

					var a = document.createElement('div');
					a.id = pv;
					a.title = pv;
					a.innerHTML = "N/A";
					a.style.width = wdth + "px";
					a.style.height = hght + "px";
//					document.getElementById("display").appendChild(a);	
//					a = document.getElementById(pv);
//					console.log("td" + Math.floor(counter/columns) + "-" + (counter%rows +1));
					//Create Span for pv name Container

					var center = document.createElement("center");
					center.appendChild(a);
					console.log("td" + first + "-" + (counter%rows +1));
					document.getElementById("tr-2td" + first + "-" + (counter%rows +1)).appendChild(center);

					drawThermometer(pv, 50, 0, 100);
					console.log(document.body);			

					counter++;
//					console.log(counter);
//					console.log(columns);
//					console.log(rows);
				}
			}

			function getParameters()
			{
				parameters = {
//							"param1": "",
//							"param2": "",
//							"param3": "",
//							"param4": "",
//							"param5": "",
//							"param6": "",
//							"param7": ""
							};
				return parameters;
			}

			function newValue(pvName, pvValue, pvTime, pvStatus, pvSeverity)
			{

				console.log("Termometer newValue() reached", pvName, pvValue);
				drawThermometer(pvName, pvValue, (pvValue * 0.5), (pvValue * 1.5));

			}

			function drawThermometer(container_id, val, min, max)
			{
				var hght = (parseInt(window.innerHeight) - 16);//window.innerHeight / rows;
				var wdth = (parseInt(window.innerWidth) - 16);//hght / 2;

				var thermometer = new Thermometer();
				var thermometer = new Thermometer({

					// SVG width
					width: wdth , //80,
				    // SVG height
				    height: hght, // 160,
				    // Color of the mercury
				    mercuryColor: "rgb(230, 0, 0)",
				    // Color of the shine effect on the bulb
				    bulbShineColor: "rgb(230, 200, 200)",
				    // Color of the tube border
				    borderColor: "rgb(136, 136, 136)",
				    // Width of the tube border (pixels)
				    borderWidth: 1,
				    // Color of the empty space between tube border and mercury
				    backgroundColor: "rgb(255, 255, 255)",
				    // Radius of the thermometer bulb (pixes)
				    bulbRadius: 18,
				    // Horizontal width of the tube (pixels)
				    tubeWidth: 18.5
 
				});
				var container = document.getElementById(container_id);
				container.innerHTML = "";
				thermometer.render(container, val, min, max);
			}

		</script>

</head>

	<body onload='Javascript:init();'>	

	<div id="display"></div>

	</body>

</html>
