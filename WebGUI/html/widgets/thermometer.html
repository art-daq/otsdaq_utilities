<!DOCTYPE HTML>
<html lang="en"> 
	<head>
		<title>Text</title>
		<style type="text/css">			
			body {
				font: 10px arial;
				//background-color: rgb(41,46,55);
				//margin: 0px !important;
			}

			.wrapper {
			  display: grid;
			  grid-template-columns: repeat(2, 1fr);
			  //grid-template-columns: repeat(auto-fill,minmax(120px, 1fr));
			  grid-gap: 10px;
			  grid-auto-rows: minmax(100px, auto);
			  //grid-auto-columns: 200px 200px;
			}

			div{
				//display: flex;
	    		//white-space: nowrap;
    			//text-overflow: ellipsis;
			    //display: block;
    			//overflow: hidden
    			//resize: both;
				//overflow: auto;
			}

			table{
				//table-layout: auto
				//border-spacing: 0px !important;
			}

			tr {
				//margin: auto;
				//padding: auto;
			}
			#td{
				//writing-mode: vertical-lr;
				//transform: rotate(90deg);
				//text-align: left;
				//vertical-align: bottom;
				//font-size: 100%;
				//color: white;
				//height: 1px;
				//width: 1px;
				//float: left;
			}
		</style>

		<script src="https://d3js.org/d3.v5.min.js"></script>
		<script type="text/javascript" src="libraries/thermometer.js"></script>

		<script>		

			//functions:
			//init()

			/////////////////////////////////////////////////////////////////////////////////////////
			/////////////////////////////////////////////////////////////////////////////////////////
			var rows = 1;
			var columns = 1;
			var thermometers = [];
			var containers = [];

			//init called once body has loaded
			function init()
			{
				console.log("init()");
				console.log(window.frameElement.id)
				window.parent.setupWidget(window.frameElement.id, getParameters());
			}

			function setupPVs(settings)
			{
				console.log("setupPVs() : " , settings);
			}

			var counter;
			function newWidget(widget, parameters)
			{
				counter = 0;
				for(var pv in widget.PVList)
				{
					counter++;
				}

				var olddiv = document.getElementById("dispaly-div");
				if (olddiv != null)
					document.getElementById("display").removeChild(olddiv);

				var div = document.createElement('div');
				div.className="wrapper";
				div.id = "dispaly-div";
				document.getElementById("display").appendChild(div);

				for(var pv in widget.PVList)
				{
					var divtemp = document.createElement('div');
					divtemp.style.color = "white";
					divtemp.style.fontSize = "2vw";
					divtemp.innerHTML = pv;
					//divtemp.style.width = "100%";
					//divtemp.style.height = "100%";
					div.appendChild(divtemp);
					containers[pv] = divtemp;
					drawThermometer(pv, divtemp, 50, 0, 100);
				}
				console.log(document.body);	
			}

			function getParameters()
			{
				parameters = {
//							"param1": "",
//							"param2": "",
//							"param3": "",
//							"param4": "",
//							"param5": "",
//							"param6": "",
//							"param7": ""
							};
				return parameters;
			}

			function newValue(pvName, pvValue, pvTime, pvStatus, pvSeverity)
			{
				console.log("Termometer newValue() reached", pvName, pvValue);
				//updateThermometer(pvName, containers[pvName], pvValue, (pvValue * 0.5), (pvValue * 1.5));
				thermometers[pvName].setCurrentValue(pvValue);
				thermometers[pvName].setMinValue((pvValue * 0.5));
				thermometers[pvName].setMaxValue((pvValue * 1.5));			
			}

			function drawThermometer(name, container, val, min, max)
			{
				var hght = (parseInt(window.innerHeight) - 16);//window.innerHeight / rows;
				var wdth = (parseInt(window.innerWidth) - 16);//hght / 2;

				if(hght < 100) hght = 100;
				if(wdth < 100) wdth = 100;

				var thermometer = new Thermometer({

					// SVG width
					width: wdth , //80,
				    // SVG height
				    height: hght, // 160,
				    // Color of the mercury
				    mercuryColor: "rgb(230, 0, 0)",
				    // Color of the shine effect on the bulb
				    bulbShineColor: "rgb(230, 200, 200)",
				    // Color of the tube border
				    borderColor: "rgb(136, 136, 136)",
				    // Width of the tube border (pixels)
				    borderWidth: 1,
				    // Color of the empty space between tube border and mercury
				    backgroundColor: "rgb(255, 255, 255)",
				    // Radius of the thermometer bulb (pixes)
				    bulbRadius: 18,
				    // Horizontal width of the tube (pixels)
				    tubeWidth: 18.5
 
				});

				thermometers[name] = thermometer;
				thermometers[name].render(container, val, min, max);
				var svg = container.lastChild;
				svg.setAttribute("preserveAspectRatio", "none");
				//svg.setAttribute("preserveAspectRatio", "xMidYMid slice");

				if (counter == 1)
				{
					svg.setAttribute("viewBox", "0 0 100 300");
					svg.style.width = "200%";
					svg.style.height = "100%";					
				}
				else if (counter > 1)
				{
					svg.setAttribute("viewBox", "0 0 270 400");
					svg.style.width = "150%";
					svg.style.height = "100%";
				}
			}

			function resizeWidget()
			{
				console.log("Thermometer() resize");
			}

			function updateThermometer(name, container, val, min, max)
			{
				thermometers[name].render(container, val, min, max);
			}

		</script>

</head>

	<body onload='Javascript:init();'>	

	<div id="display"></div>

	</body>

</html>
