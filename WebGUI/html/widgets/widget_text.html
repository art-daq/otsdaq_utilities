<!DOCTYPE HTML>
<html lang="en"> 
	<head>
		<title>Text</title>
		<style type="text/css">			

			body {
				background-color: rgb(255,255,255);
			}
			.wrapper {
			  display: grid;
			  //grid-template-columns: repeat(2, 1fr);
			  grid-template-columns: repeat(auto-fill,minmax(120px, 1fr));
			  grid-gap: 10px;
			  grid-auto-rows: minmax(100px, auto);
			}
			a{
				color: blue;
				height: auto;
		    	text-align: center;
				fontSize : 12vw;
			}
			div{
				padding: 2.5px;
			}
			table{
				height:100%;
			}
			tr {
				margin: auto;
				padding: auto;
			}

		</style>

		<script>		

			//functions:
			//init()

			var pv_settings_ = [];
			var labelContainers = [];
			var values = [];
			var parameters_ = {class: "", "show_labels": "true", "old_value_foreground_color": "grey", "old_value_background_color": "lightgrey"};

			/////////////////////////////////////////////////////////////////////////////////////////
			/////////////////////////////////////////////////////////////////////////////////////////

			//init called once body has loaded
			function init()
			{
				console.log("init()");
				console.log(window.frameElement.id)
				window.parent.setupWidget(window.frameElement.id, getAttributes());
			}

			function setupPVs(settings)
			{
				console.log("Text setupPVs() : " , settings);
				pv_settings_ = settings;
			}

			function drawWidget(widget, parameters) 
			{			
				var table = document.createElement('table');
				table.id = "display-table";
				table.style.height = "100%";
				table.style.width = "100%";

				var counter = 0;
				for(var pv in widget.pvList)
				{
					counter++;
				}

				var rows = Math.round(Math.sqrt(counter));
				var columns = Math.ceil(counter / rows);

				for(var col = 1; col <= columns; col++)
				{
					var tr = document.createElement('tr');
					tr.id = "tr" + col;
					for(var cell = 1; cell <= rows; cell++)
					{
						var td = document.createElement('td');
						td.id = "td" + col + "-" + cell;
						tr.appendChild(td);
					}
					table.appendChild(tr);
				}

				var display = document.getElementById("display");
				display.innerHTML = "";
				if (!Object.getOwnPropertyNames(widget.pvList).length)
					display.innerHTML = "<center>TEXT: No associated PVs to display.</center>";

				display.appendChild(table);

				if(counter > 1){counter = 2;}
				console.log("counter" + counter);
				for(var pv in widget.pvList)
				{
					var label = document.createElement('p');

					if (parameters_["show_labels"] == "true")
						label.innerHTML = pv.replace(/[&\/\\#,+()$~%.:*?<>{}]/g, "<br />") + "<br />WAITING FOR A NEW PV VALUE...";
					else
						label.innerHTML = "";

					var labelCenter = document.createElement("center");
					labelCenter.appendChild(label);
					labelContainers[pv] = label;

					var value = document.createElement('a');
					value.id = pv;
					value.title = pv;
					value.innerHTML = "N/A";
					value.style.width = "100%";
					value.style.height = "100%";
					values[pv] = value;

					var unit = document.createElement('a');
					unit.innerHTML = " " + pv_settings_[pv].Units;

					var center = document.createElement("center");
					center.appendChild(value);
					center.appendChild(unit);

					console.log(document.body);

					var first = Math.floor(counter/columns);
					if(first < 1) {first = 1;}				
					console.log("td" + first + "-" + (counter%rows +1));
					document.getElementById("td" + first + "-" + (counter%rows +1)).appendChild(labelCenter);
					document.getElementById("td" + first + "-" + (counter%rows +1)).appendChild(center);
					counter++;
				}
			}

			function getAttributes()
			{
				return parameters_;
			}

			function setAttributes(attributes)
			{
				parameters_ = attributes;
				console.log("text widget: set parameters()");
				console.log(parameters_);
			}

			function drawNewValue(pvName, pvValue, pvTime, pvStatus, pvSeverity)
			{
				console.log("Text newValue() reached", pvName, pvValue);

				document.getElementById(pvName).innerHTML = (pvValue);
				document.getElementById(pvName).parentElement.style["background-color"] = "transparent";

				window.parent.setWidgetPVinfo(
									  window.frameElement.id
									, pvName
									, pvValue
									, pvTime
									, pvStatus
									, pvSeverity
									, parameters_["show_labels"]
									, labelContainers
									, parameters_["old_value_foreground_color"]
									, parameters_["old_value_background_color"]
									, values[pvName].parentElement.parentElement
									);

				document.getElementById(pvName).title =  window.parent.setWidgetToolTip(pvName, pvValue, pvTime, pv_settings_);
				if (parameters_["show_labels"] == "true")
					labelContainers[pvName].title =  window.parent.setWidgetToolTip(pvName, pvValue, pvTime, pv_settings_);

//				if(pvSeverity == "NO_ALARM")
//				{
//					document.getElementById(pvName).parentElement.style.color = "green"
//				}
//				else if(pvSeverity == "MINOR")
//				{
//					document.getElementById(pvName).parentElement.style.color = "yellow"
//				}else if(pvSeverity == "MAJOR")
//				{
//					document.getElementById(pvName).parentElement.style.color = "red"
//				}else if(pvSeverity == "INVALID")
//				{
//					document.getElementById(pvName).parentElement.style.color = "DimGray";
//				}
//				else if(pvSeverity == "DC")
//				{
//					document.getElementById(pvName).parentElement.style.color = "Light Grey";
//				}
//
//				if(pvStatus == "NO_ALARM")
//				{
//					document.getElementById(pvName).parentElement.style.border = "thin dotted green";
//				}
//				else if(pvStatus == "HIHI")
//				{
//					document.getElementById(pvName).parentElement.style.border = "thick solid red"
//				}else if(pvStatus == "LOLO")
//				{
//					document.getElementById(pvName).parentElement.style.border = "thick solid MediumSlateBlue";
//				}else if(pvStatus == "HIGH")
//				{
//					document.getElementById(pvName).parentElement.style.border = "thin dotted red";
//				}else if(pvStatus == "LOW")
//				{
//					document.getElementById(pvName).parentElement.style.border = "thin dotted blue";
//				}else if(pvStatus == "DC")
//				{
//					document.getElementById(pvName).parentElement.style["background-color"] = "Gainsboro";
//				}else if(pvStatus == "UDF")
//				{
//					document.getElementById(pvName).parentElement.style["background-color"] = "yellow";
//				}
			}

	</script>

	</head>

	<body onload='Javascript:init();'>

	<div class="wrapper" id="display" width="100%" height="100%">
	</div>

	</body>

</html>
