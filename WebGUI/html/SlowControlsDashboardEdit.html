<!DOCTYPE HTML>
<html lang="en"> 
	<head>
		<title>Controls Dashboard Editor</title>

		<link rel="stylesheet" type="text/css" href="/WebPath/css/SlowControlsDashboard.css">
	
		<style type="text/css">			
			body {
				background-color: 		#838383;
				overflow:				auto;
			}

			#clearDiv {
				clear: 					both;
			}

			a {
				color: 					blue;
			}

			h2 {
				margin: 				0px;
			}

			input {
				cursor: 				pointer;
			}

			::color {			 
			}

			#fileBlock {
				background-color: 		rgb(26,148,49);
			}			

			#mainBlock {
				background-color: 		rgb(240,234,214);
			}

			#editBlock {
				background-color: 		rgb(0,50,0);
			}

			# searchButton {
				position:				absolute;
			}

			.mainBlock {
				position:				absolute;
				overflow: 				hidden;
			}

			#widgetTilesContainer {
				position: 				absolute;
				overflow-x:				hidden;
				overflow-y:				auto;
			}

			.tile {
				background-color: 		#b2b2b2;
				border: 				2px solid rgba(0,0,0,0);
				border-radius: 			8px;
				float:					left;
				margin:					2px;
			}

			.tile:hover {
				cursor: 				pointer;
				border: 				2px dotted gold;
			}

			.rotate270 {
			    -webkit-transform: 		rotate(270deg);
			    -moz-transform: 		rotate(90deg);
			    -o-transform: 			rotate(90deg);
			    -ms-transform: 			rotate(90deg);
			    transform: 				rotate(90deg);
			}

			#widgetFilter {
				position: 				absolute;
				top: 					20px;
				left: 					50%;
				width: 					45%;
				height: 				(100% - 6px);
				color: 					#d3d3d3;
				padding: 				0px;
				border: 				none;
				border-bottom: 			solid 2px #c9c9c9;
				transition: 			border 0.3s;
		    	font-family: 			"Lucida Sans Unicode", "Lucida Grande", Verdana, Arial, Helvetica, sans-serif; letter-spacing:-0.5px; font-size:13px;   
				background-color: 		rgba(105, 105, 105, 0.4);
				!position:				absolute;
				appearance: 			none;
				-webkit-appearance: 	none;
				-moz-appearance: 		none;
			}

			#widgetFilter:focus,
			#widgetFilter.focus {
				outline: 				none;
				border: 				none;
				border-bottom: 			solid 2px #969696;
			}

			#widgetFilter:hover {
				cursor: 				pointer;
			}

			option {
			    font-family: 			"Lucida Sans Unicode", "Lucida Grande", Verdana, Arial, Helvetica, sans-serif; letter-spacing:-0.5px; font-size:13px;   
				background-color: 		rgba(87,87,87,0.75);//#575757;
			}

			option:hover,
			option.hover {
				background-color:  		rgba(178,178,178,0.75);
				color: 					#b3b3b3;
			}

			select:active, select:hover {
				outline-color: 			red;
				background-color:  		rgba(178,178,178,0.75);
				color: 					#b3b3b3;
			}

			input[type="text"] {
				display: 				block;
				margin:					0;
				width: 					45%;
				font-family: 			"Lucida Sans Unicode", "Lucida Grande", Verdana, Arial, Helvetica, sans-serif; letter-spacing:-0.5px; font-size:13px;   
				appearance: 			none;
				-webkit-appearance: 	none;
				-moz-appearance: 		none;
				box-shadow: 			none;
				border-radius: 			5px;
				-webkit-border-radius: 5px;
				background-color: 		transparent;
				color: 					#d3d3d3;
			}

			input[type="text"]:focus {
				outline: 				none;
				color: 					black;
			}

			.titleDiv {     
                background-color: 		white;
            }

			#editorPanelTitle {
				color: 					#d3d3d3;
                font-family: 			"Lucida Sans Unicode", "Lucida Grande", Verdana, Arial, Helvetica, sans-serif; 
                letter-spacing:			-0.5px; 
                font-size:				22px;
                appearance: 			none;
                -webkit-appearance: 	none;
                -moz-appearance: 		none;                
                text-shadow: 			0 -1px 3px #202020;
    			font-weight: 			normal;
    			padding-left: 			2px;
        	}

        	.mainBlock div {
				color: 					#d3d3d3;
        		font-family: 			"Lucida Sans Unicode", "Lucida Grande", Verdana, Arial, Helvetica, sans-serif;
        		letter-spacing:			-0.5px; 
        		font-size:				16px;                         
                text-shadow: 			0 -1px 3px #202020;
    			font-weight: 			normal;
        	}

			#widgetSearch {	
				padding: 				0px;
				border: 				none;
				border-radius: 			2px;
				-webkit-border-radius: 	5px;
				border-bottom: 			solid 5px #c8c8c8;
				transition: border 		0.3s;
				background-color: 		rgba(105, 105, 105, 0.4);
			}
			#widgetSearch:focus,
			#widgetSearch.focus {
				border-bottom: 			2px solid #969696;
			}

			#divider {
				border-left: 			2px solid #575757;
			}

			#userSettingsContainer {
				position:				absolute;
				/*top: 					0px;
				left: 					60%;
				height: 				90%;
				width: 					20%;
				margin: 				10%;*/
			    font-family: 			"Lucida Sans Unicode", "Lucida Grande", Verdana, Arial, Helvetica, sans-serif; letter-spacing:-0.5px;    
				color: 					#d3d3d3;
			}

			input[type="color"] {
				//border-radius: 50px;
				margin-left: 			7.5%;
				border:  				none;
				background-color: 		transparent;
				width: 					10%;
				color: 					#b3b3b3;

			}
			input[type="checkbox"] {
				width: 					5%;
				margin-left: 			10%;
				color: 					#d3d3d3;
			}

			input[type="button"] {
				width: 					auto;
				margin-left: 			7.5%;
			}

			#switchesContainer {
				padding: 				4%;
				margin: 				4%;
				border: 				1px solid transparent;
				width: 					84% - 2px;
				background-color: 		rgba(105, 105, 105, 0.4);
				overflow-X: 			auto;
			}

			#settingsContainer {
				padding: 				4%;
				margin: 				4%;
				border: 				1px solid transparent;
				width: 					84% - 2px;
				background-color: 		rgba(105, 105, 105, 0.4);
				overflow: 				auto;
			}

			#colorPickersDiv {
			   float: 					left;
			}

			.toggle {
				position:				relative;
			  	display:				inline-block;
			 	width:					40px;
				height:					60px;
				float:					left;
				background-color:		#bbb;
			 	-webkit-border-radius:	4px;
			  	-moz-border-radius:		4px;
			 	border-radius:			4px;
			  	text-align:				center;
			}

			.toggle_settings {
			 
			}

			.toggle-margin {
				margin-right: 			15px;
			}

			.toggle input {
				width:					100%;
				height:					100%;
				margin:					0 0;
				padding:				0 0;
				position:				absolute;
				top:					0;
				right:					0;
				bottom:					0;
				left:					0;
				z-index:				2;
				cursor:					pointer;
				opacity:				0;
				filter:					alpha(opacity=0);
			}

			.toggle label {
				display:				block;
				position:				absolute;
				top:					1px;
				right:					1px;
				bottom:					1px;
				left:					1px;
				background-image:		-webkit-linear-gradient(top,#fff 0%,#ddd 50%,#fff 50%,#eee 100%);
				background-image:		-moz-linear-gradient(top,#fff 0%,#ddd 50%,#fff 50%,#eee 100%);
				background-image:		-ms-linear-gradient(top,#fff 0%,#ddd 50%,#fff 50%,#eee 100%);
				background-image:		-o-linear-gradient(top,#fff 0%,#ddd 50%,#fff 50%,#eee 100%);
				background-image:		linear-gradient(top,#fff 0%,#ddd 50%,#fff 50%,#eee 100%);
				-webkit-box-shadow:		0 2px 3px rgba(0,0,0,0.4),
										inset 0 -1px 1px #888,
										inset 0 -5px 1px #bbb,
										inset 0 -6px 0 white;
				-moz-box-shadow:		0 2px 3px rgba(0,0,0,0.4),
										inset 0 -1px 1px #888,
										inset 0 -5px 1px #bbb,
										inset 0 -6px 0 white;
				box-shadow:				0 2px 3px rgba(0,0,0,0.4),
										inset 0 -1px 1px #888,
										inset 0 -5px 1px #bbb,
										inset 0 -6px 0 white;
				-webkit-border-radius:	3px;
				-moz-border-radius:		3px;
				border-radius:			3px;
				font:					normal 11px Arial,Sans-Serif;
				color:					#666;
				text-shadow:			0 1px 0 white;
				cursor:					text;
			}

			.toggle label:before {
				content:				attr(data-off);
				position:				absolute;
				top:					6px;
				right:					0;
				left:					0;
				z-index:				4;
			}

			.toggle label:after {
				content:				attr(data-on);
				position:				absolute;
				right:					0;
				bottom:					11px;
				left:					0;
				color:					#666;
				text-shadow:			=0 -1px 0 #eee;
			}

			.toggle input:checked + label {
				background-image:		-webkit-linear-gradient(top,#eee 0%,#ccc 50%,#fff 50%,#eee 100%);
				background-image:		-moz-linear-gradient(top,#eee 0%,#ccc 50%,#fff 50%,#eee 100%);
				background-image:		-ms-linear-gradient(top,#eee 0%,#ccc 50%,#fff 50%,#eee 100%);
				background-image:		-o-linear-gradient(top,#eee 0%,#ccc 50%,#fff 50%,#eee 100%);
				background-image:		linear-gradient(top,#eee 0%,#ccc 50%,#fff 50%,#eee 100%);
				-webkit-box-shadow:		0 0 1px rgba(0,0,0,0.4),
										inset 0 1px 7px -1px #ccc,
										inset 0 5px 1px #fafafa,
										inset 0 6px 0 white;
				-moz-box-shadow:		0 0 1px rgba(0,0,0,0.4),
										inset 0 1px 7px -1px #ccc,
										inset 0 5px 1px #fafafa,
										inset 0 6px 0 white;
				box-shadow:				0 0 1px rgba(0,0,0,0.4),
										inset 0 1px 7px -1px #ccc,
										inset 0 5px 1px #fafafa,
										inset 0 6px 0 white;
			}

			.toggle input:checked:hover + label {
				-webkit-box-shadow:		0 1px 3px rgba(0,0,0,0.4),
										inset 0 1px 7px -1px #ccc,
										inset 0 5px 1px #fafafa,
										inset 0 6px 0 white;
				-moz-box-shadow:		0 1px 3px rgba(0,0,0,0.4),
										inset 0 1px 7px -1px #ccc,
										inset 0 5px 1px #fafafa,
										inset 0 6px 0 white;
				box-shadow:				0 1px 3px rgba(0,0,0,0.4),
										inset 0 1px 7px -1px #ccc,
										inset 0 5px 1px #fafafa,
										inset 0 6px 0 white;
			}

			.toggle input:checked + label:before {
				z-index:				1;
				top:					11px;
			}

			.toggle input:checked + label:after {
				bottom:					9px;
				color:					#aaa;
				text-shadow:			none;
				z-index:				4;
			}

		</style>

		<script type="text/JavaScript" src="/WebPath/js/Globals.js"></script>	
		<script type="text/JavaScript" src="/WebPath/js/Debug.js"></script>	
		<script type="text/JavaScript" src="/WebPath/js/DesktopContent.js"></script>
		<script type="text/JavaScript" src="/WebPath/js/widgetLibrary.js"></script>

		<script>	

			//functions:
			//	init()
			//	redrawWindow()
			//	drawIcons(indexReferenceArray)
			//	setupForDrawSelectionRectangle(tileNumber)
			//	selectWidgetTile(tileNumber)
			// 	searchWidgets(searchField)
			//	filterWidgets(filterField)
			//	toggleGrid(checkbox)
			//	setBackgroundColor(color)
			//	setGridColor(color)
			//	setGridSnap(color)
			//	resetToDefault()
			//	rgbToHex(rgb)

			var _codeEditorAppId = 0; //to open code editor

			//widget tile container parameters:
			var draw_ = {
					"titleText_H"			: 40,
					"widgetTileContainer_W"	: 0,
					"widgetTileContainer_H"	: 0,
					"TILE_SIZE"				: 64, //widget tile square size in pixels
					"SETTINGS_W"			: 220, //color, grid etc settings on right
					"MARGIN"				: 5,
			};

			var widgetKeys_; //keys of existing widgets (from parent dashboard at init time)

			//main html elements:
			var widgetTilesEl_;
			var dividerEl_;
			var userSettingsEl_;
			var widgetFilterContainerEl_;

			//configurable settings
			var defaultGridColor_;
			var defaultBackgroundColor_;
			var lastTileNumber_;


			/////////////////////////////////////////////////////////////////////////////////////////
			/////////////////////////////////////////////////////////////////////////////////////////

			//=====================================================================================						
			//init called once body has loaded
			function init() 
			{
				var w = window.innerWidth;
				var h = window.innerHeight;

				Debug.log("EditPane init() was called w,h: " + 
						w + " - " + h);

				//fill in CodeEditor appId
				DesktopContent.XMLHttpRequest("Request?RequestType=getAppId" + 
						"&classNeedle=ots::CodeEditorSupervisor",
						"", //end post data, 
						function(req) 
						{			
							_codeEditorAppId = DesktopContent.getXMLValue(req,"id") | 0;
							Debug.log("_codeEditorAppId " + _codeEditorAppId);
						}, //end handler
						0, 0, true,//reqParam, progressHandler, callHandlerOnErr, 
						false,//doNotShowLoadingOverlay,
						true //targetGatewaySupervisor
						);

				widgetTilesEl_ 				= document.getElementById("widgetTilesContainer");
				dividerEl_ 					= document.getElementById("divider");
				userSettingsEl_ 			= document.getElementById("userSettingsContainer");
				widgetFilterContainerEl_ 	= document.getElementById("widgetFilterContainer");

				//determine row and col draw_.TILE_SIZE of widget library
				widgetKeys_ = Object.keys(widgetLibrary.typeToSrc);


				console.log("draw_", draw_);
				console.log("widgetLibrary", widgetLibrary);

				var backgroundColorPicker = document.getElementById("backgroundColorPicker");
				defaultBackgroundColor_ = parent.mainBlock_.el.style["background-color"];
				backgroundColorPicker.value = rgbToHex(defaultBackgroundColor_);
				backgroundColorPicker.innerHTML = "Background";

				var gridColorPicker = document.getElementById("gridColorPicker");
				defaultGridColor_ = parent.gridColor_;
				gridColorPicker.value = rgbToHex(defaultGridColor_);
				backgroundColorPicker.innerHTML = "<p>Grid Color</p>";				
				gridColorPicker.title = "Set the color of the grid lines.";
				backgroundColorPicker.title = "Set the background color.";
				document.getElementById("gridCheckbox").title = "Toggle the grid lines on/off.";				
				document.getElementById("resetGrid").title = "Reset the grid to default values.";
				document.getElementById("gridSnap").checked = true;

				window.onresize = redrawWindow;
				redrawWindow();

				//commented is equivalent to undefined (but keep for search example)
//				var allIcons = [];			
//				for(var i = 0; i < widgetKeys_.length; i++)
//					allIcons.push(widgetKeys_[i]);
//
//				drawIcons(allIcons);				
				//FIXME!!!!
				drawIcons();

//				var filter = document.getElementById("widgetFilter");
//				var option = document.createElement("option");
//				option.value = "All";
//				option.innerHTML = "";
//				filter.appendChild(option);
//				var filterOptions = [];
//				for(purpose in parent.widgetLibrary.typeToPurpose)
//				{
//					if(filterOptions.indexOf(parent.widgetLibrary.typeToPurpose[purpose]) == -1)
//					{
//						var option = document.createElement("option");
//						option.value = parent.widgetLibrary.typeToPurpose[purpose];
//						option.innerHTML = parent.widgetLibrary.typeToPurpose[purpose];
//						filterOptions.push(option.value);
//						filter.appendChild(option);
//					}
//				}
			} //end initEdit()

			//=====================================================================================
			function redrawWindow() 
			{
				var w = window.innerWidth;
				var h = window.innerHeight;

				Debug.log("EditPane redrawWindow() to " + 
						w + " - " + h);

				draw_.widgetTileContainer_W = (w - draw_.SETTINGS_W - 
						4*draw_.MARGIN) |0;
				draw_.widgetTileContainer_H = (h * 0.75) |0;

				console.log("draw_", draw_);

				//--------------
				//position widget tile container
				widgetTilesEl_.style.left = "0px";
				widgetTilesEl_.style.top = (h - draw_.widgetTileContainer_H) + "px";
				widgetTilesEl_.style.height = draw_.widgetTileContainer_H + "px";
				widgetTilesEl_.style.width = draw_.widgetTileContainer_W + "px";

				//--------------
				//position divider
				dividerEl_.style.left = draw_.widgetTileContainer_W + "px";
				dividerEl_.style.top = (((h - draw_.widgetTileContainer_H)/2)|0) + "px";
				dividerEl_.style.height = draw_.widgetTileContainer_H + "px";

				//--------------
				//position settings container
				userSettingsEl_.style.left = draw_.widgetTileContainer_W + "px";
				userSettingsEl_.style.top = (draw_.titleText_H) + "px";
				userSettingsEl_.style.width = (w - draw_.widgetTileContainer_W) + "px";

				//--------------
				//position widget filter container
				//				widgetFilterContainer.style.width = window.innerWidth + "px";
				//				widgetFilterContainer.style.height = (window.innerHeight * 0.1) + "px";
				widgetFilterContainerEl_.style.top = draw_.titleText_H + "px"; 
				widgetFilterContainerEl_.left = "0px";

				//				var searchFields = document.getElementById("searchFields");
				//				searchFields.style.width  = ((w * 0.6)|0) + "px";
				//				searchFields.style.height =  ((h * 0.15)|0) + "px";
				//				searchFields.style.top  = ((h * 0.1)|0) + "px"; //"0px";
				//				searchFields.style.left = "0px";
				//
				//				var widgetSearch = document.getElementById("widgetSearch");
				//				widgetSearch.title = "Search the widget library by name of widget! \nCheck out the widgetLibrary.js in the Code Editor to set widgets' name and other properties."
				//				widgetSearch.placeholder = "Search";
				//				var widgetFilter = document.getElementById("widgetFilter");
				//				widgetFilter.title = "Filter the widget library by type of widget! \nCheck out the widgetLibrary.js in the Code Editor to set widgets' type and other properties."
				//				widgetFilter.placeholder = "Filter";
				//				var searchButtonDiv = document.getElementById("searchButtonDiv");
				//				searchButtonDiv.style.width  =  draw_.TILE_SIZE + "px";
				//				searchButtonDiv.style.height =  draw_.TILE_SIZE + "px";
				//				searchButtonDiv.style.top  = "0px";
				//				searchButtonDiv.style.left = (window.innerWidth * 0.05 + ((draw_.TILE_SIZE + 5) * (draw_.columns - 1)) - 10) + "px";
				//				searchButtonDiv.style.position = "absolute";
				//				
				//				var searchButton = document.getElementById("searchButton");
				//				searchButton.style.width  = "100%";
				//				searchButton.style.height = "100%";
				//				
				//				var img = document.createElement("img");
				//				img.src = "/WebPath/images/windowContentImages/SlowControlsDashboardFileTree-magnifyingGlass.png";
				//				img.style.height = "50%";
				//				img.style.width = "auto";
				//				img.style.top = "0px";
				//				img.style.left = "0px";
				//				searchButton.appendChild(img);
			} //end redrawWindow()

			//=====================================================================================
			//draw widget icons in widget container
			//	input parameter is result of filtering or searching
			function drawIcons(indexReferenceArray)
			{
				console.log("drawIcons()",indexReferenceArray);

				widgetTilesEl_.innerHTML = ""; //clear all existing widget icons

				var positionIndex = 0;

				if(indexReferenceArray === undefined) //do all widgets
				{
					for(var i=0;i<widgetKeys_.length;++i)
						 localDrawIcon(widgetKeys_[i],positionIndex++);
					localDrawIcon(-1,positionIndex++); //always add code editor widget at end
				}
				else //target index reference array
				{
					for(var i=0;i<indexReferenceArray.length;++i)
						localDrawIcon(indexReferenceArray[i],positionIndex++);
				}

				return;

				//==============
				//	draw icon for widget index i in keys of widgetLibrary.typeToSrc
				function localDrawIcon(i,positionIndex)
				{
					var tile = document.createElement('div');

					var name = "";
					var type = "";

					if(parent.widgetLibrary.typeToName[i] !== undefined)
						name = parent.widgetLibrary.typeToName[i];
					else
						name = parent.widgetLibrary.typeToSrc[i];

					if(parent.widgetLibrary.typeToName[i] !== undefined)
						type = parent.widgetLibrary.typeToPurpose[i];
					else
						type = "Undefined";

					//console.log("localDrawIcon() i,positionIndex,name,type:",
					//		i,positionIndex,name,type);

					tile.title = "Name: " + name + "\nType: " + type;

					tile.id = "tiles-" + i;
					tile.className = "tile";
					tile.style.width = draw_.TILE_SIZE + "px";
					tile.style.height = draw_.TILE_SIZE + "px";
					tile.setAttribute("widgetID", positionIndex);

					var tileIMG = document.createElement("img");
					if(parent.widgetLibrary.typeToImgSrc[i] !== undefined)
						tileIMG.src = "widgets/" + parent.widgetLibrary.typeToImgSrc[i];
					else
						tileIMG.src = "widgets/default-icon.png";

					tileIMG.style.width = tile.style.width;
					tileIMG.style.height = "100%";

					if(i == -1) //handle code editor icon
					{	
						tile.title = "Not finding what you're looking for? \nLaunch the Code Editor to make changes to the Widget Library, including making your own widget!";
						tileIMG.src = "widgets/code-editor.png";
						tile.onclick = 
								function()
								{
							DesktopContent.openNewWindow(
									"Code Editor", 
									"" /*subname*/,
									"/WebPath/html/CodeEditor.html?" +
									"urn=" + _codeEditorAppId + 
									"&startFilePrimary=/otsdaq_utilities/WebGUI/js/widgetLibrary.js",
									0 /*unique*/);									 
								};
					}
					else
						tileIMG.onclick = setupForDrawSelectionRectangle(i); 

					tile.appendChild(tileIMG);
					widgetTilesEl_.appendChild(tile);				

				} //end localDrawIcon

			} //end drawIcons()

			//=====================================================================================
			function setupForDrawSelectionRectangle(tileNumber)
			{							
				return function(){
					Debug.log("setupForDrawSelectionRectangle() handler " + tileNumber);

					selectWidgetTile(tileNumber);					

					parent.setupForDrawSelectionRectangle(lastTileNumber_);
				};
			} //end setupForDrawSelectionRectangle()

			//=====================================================================================
			function selectWidgetTile(tileNumber)
			{							
				Debug.log("selectWidgetTile() " + tileNumber);

				var el;
				if(lastTileNumber_ !== undefined) //revert border
				{
					el = document.getElementById("tiles-" + lastTileNumber_ );
					el.style.border = "2px solid rgba(0,0,0,0)";
					el.style.backgroundColor = "#b2b2b2";
				}

				if(lastTileNumber_ == tileNumber || 
						tileNumber === undefined) 
					lastTileNumber_ = undefined; //treat as unselecting
				else
					lastTileNumber_ = tileNumber|0;

				if(lastTileNumber_ !== undefined)
				{
					el = document.getElementById("tiles-" + lastTileNumber_);
					el.style.border = "2px dotted orange";
					el.style.backgroundColor = "white";
				}
			} //end selectWidgetTile()

			//=====================================================================================
			function searchWidgets(searchField)
			{
				Debug.log("searchWidgets() " + searchField);

				var keyword = searchField.value;
				var foundResult = [];

				for(var i = 0; i < widgetKeys_.length; i++)
				{
					console.log(i + " : " + parent.widgetLibrary.typeToName + " : " + keyword);
					
					if(parent.widgetLibrary.typeToName[i] != undefined)
						parent.widgetLibrary.typeToName[i].indexOf(keyword) != -1 ? foundResult.push(i) : console.log();
					else if(parent.widgetLibrary.typeToSrc[i] != undefined)
						parent.widgetLibrary.typeToSrc[i].indexOf(keyword) != -1 ? foundResult.push(i) : console.log();
				}

				console.log(foundResult);

				drawIcons(foundResult);
			} //end searchWidgets()

			//=====================================================================================
			function filterWidgets(filterField)
			{
				Debug.log("filterWidgets() " + filterField);

				var keyword = filterField.value;
				var foundResult = [];
				console.log(keyword);
				if(keyword === 'All')
				{
					for(var i = 0; i < widgetKeys_.length; i++)
						foundResult.push(i);
				}
				else
				{
					for(var i = 0; i < widgetKeys_.length; i++)
						if(typeof parent.widgetLibrary.typeToPurpose[i] != 'undefined')
							parent.widgetLibrary.typeToPurpose[i].indexOf(keyword) != -1 ? foundResult.push(i) : console.log();
				}

				console.log(foundResult);

				drawIcons(foundResult);
			} //end filterWidgets()		

			//=====================================================================================
			function toggleGrid(checkbox)
			{
				Debug.log("toggleGrid() " + checkbox.checked);

				parent.toggleGrid(checkbox.checked);
			} //end toggleGrid()

			//=====================================================================================
			function setBackgroundColor(color)
			{
				Debug.log("setBackgroundColor() " + color.value);
		
				parent.setBackgroundColor(color.value);
			} //end setBackgroundColor()

			//=====================================================================================
			function setGridColor(color)
			{
				Debug.log("setGridColor() " + color.value);

				parent.setGridColor(color.value, 
						document.getElementById("gridCheckbox").checked);
			} //end setGridColor()

			//=====================================================================================
			function setGridSnap(snap)
			{
				Debug.log("setGridSnap() " + snap.checked);
				parent.setGridSnap(snap.checked);
			} //end setGridSnap()

			//=====================================================================================
			function resetToDefault()
			{
				Debug.log("resetToDefault()");
								
				parent.toggleGrid(true);
				document.getElementById("gridCheckbox").checked = true;
				parent.setGridColor(defaultGridColor_, true);
				parent.setBackgroundColor(defaultBackgroundColor_);

				var backgroundColorPicker = document.getElementById("backgroundColorPicker");
				backgroundColorPicker.value = rgbToHex(defaultBackgroundColor_);

				var gridColorPicker = document.getElementById("gridColorPicker");
				gridColorPicker.value = rgbToHex(defaultGridColor_);
			} //end resetToDefault()

			//=====================================================================================
			function rgbToHex(rgb)
			{
				Debug.log("rgbToHex() " + rgb);
				
				 rgb = rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
				 return (rgb && rgb.length === 4) ? "#" +
						 ("0" + parseInt(rgb[1],10).toString(16)).slice(-2) +
						 ("0" + parseInt(rgb[2],10).toString(16)).slice(-2) +
						 ("0" + parseInt(rgb[3],10).toString(16)).slice(-2) : '';
			} //end rgbToHex()

		</script>

	</head>

	<body > <!--onload='DesktopContent.init()'-->

		<div id="titleDiv" class="mainBlock">
			<h2 id="editorPanelTitle">Editor Panel</h2>
		</div>

		<div class='mainBlock' id='widgetFilterContainer'>
			<div>Choose your widgets:</div>
			<div id="searchFields" class="absolute" style='display:none'>
				<input id="widgetSearch" type="text" class="focus" onchange="searchWidgets(this)"></input>
				<select id="widgetFilter" class="absolute" onchange="filterWidgets(this)"></select>
			</div>
		</div>
		<div id='widgetTilesContainer'></div>
		<div class='mainBlock' id='divider'></div>
		<div class='mainBlock' id='userSettingsContainer'>

			<!-- TODO for new functionalities
			<div id="switchesContainer">

				<span class="toggle toggle-margin">
					<input type="checkbox" id="checkbox" onclick="" checked>
						<label data-off="Off" data-on="On"></label>
					</input>
				</span>
				<span class="toggle toggle-margin">
					<input type="checkbox" id="checkbox" onclick="" checked>
						<label data-off="Off" data-on="On"></label>
					</input>
				</span>
				<span class="toggle toggle-margin">
					<input type="checkbox" id="checkbox" onclick="" checked>
						<label data-off="Off" data-on="On"></label>
					</input>
				</span>

			</div>
			-->
			<div id="settingsContainer">
				Grid Settings:<br>
				<span class="toggle" style="margin-top:10px">					
					<input type="checkbox" id="gridCheckbox" onclick="toggleGrid(this)" checked>
						<label data-off="Off" data-on="On"></label>
					</input>
				</span>
				<div class="colorPickersDiv" style="margin-top:-10px">
					<br><input type="color"  id="gridColorPicker"       onchange="setGridColor(this)">Grid Color</input>
					<br><input type="color"  id="backgroundColorPicker" onchange="setBackgroundColor(this)">Background</input>
					<br><input type="checkbox"  id="gridSnap" onchange="setGridSnap(this)"> Snap</input>
					<br><button id="resetGrid" 
							style="margin-bottom:1px; margin-left:20px; width:100px;"
							onclick="resetToDefault()">Default Values</button>
				</div>
			</div>
		</div>

	</body>

</html>

