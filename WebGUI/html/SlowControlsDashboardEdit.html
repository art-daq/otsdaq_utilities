<!DOCTYPE HTML>
<html lang="en"> 
	<head>
		<title>Controls Dashboard Editor</title>
		<style type="text/css">			
			body {
				background-color: 		#838383;
				overflow:				auto;
			}

			#clearDiv {
				clear: 					both;
			}

			a {
				color: 					blue;
			}

			h2 {
				margin: 				0px;
			}
			
			input {
				cursor: 				pointer;
			}

			::color {			 
			}

			#fileBlock {
				background-color: 		rgb(26,148,49);
			}			

			#mainBlock {
				background-color: 		rgb(240,234,214);
			}

			#editBlock {
				background-color: 		rgb(0,50,0);
			}

			# searchButton {
				position:				absolute;
			}

			.mainBlock {
				position:				absolute;
				overflow: 				hidden;
			}

			.tile {
				position: 				absolute;
				background-color: 		#b2b2b2;
				border: 				thin solid rgba(0,0,0,0.1);
				border-radius: 			8px;
			}

			.tile:hover {
				cursor: 				pointer;
				border-style: 			dotted;
  				border-width: 			2px;
  				border-color: 			gold;
			}

			.rotate270 {
			    -webkit-transform: 		rotate(270deg);
			    -moz-transform: 		rotate(90deg);
			    -o-transform: 			rotate(90deg);
			    -ms-transform: 			rotate(90deg);
			    transform: 				rotate(90deg);
			}

			#widgetFilter {
				position: 				absolute;
				top: 					20px;
				left: 					50%;
				width: 					45%;
				height: 				(100% - 6px);
				color: 					#d3d3d3;
				padding: 				0px;
				border: 				none;
				border-bottom: 			solid 2px #c9c9c9;
				transition: 			border 0.3s;
		    	font-family: 			"Lucida Sans Unicode", "Lucida Grande", Verdana, Arial, Helvetica, sans-serif; letter-spacing:-0.5px; font-size:13px;   
				background-color: 		rgba(105, 105, 105, 0.4);
				!position:				absolute;
				appearance: 			none;
				-webkit-appearance: 	none;
				-moz-appearance: 		none;
			}

			#widgetFilter:focus,
			#widgetFilter.focus {
				outline: 				none;
				border: 				none;
				border-bottom: 			solid 2px #969696;
			}

			#widgetFilter:hover {
				cursor: 				pointer;
			}

			option {
			    font-family: 			"Lucida Sans Unicode", "Lucida Grande", Verdana, Arial, Helvetica, sans-serif; letter-spacing:-0.5px; font-size:13px;   
				background-color: 		rgba(87,87,87,0.75);//#575757;
			}

			option:hover,
			option.hover {
				background-color:  		rgba(178,178,178,0.75);
				color: 					#b3b3b3;
			}

			select:active, select:hover {
				outline-color: 			red;
				background-color:  		rgba(178,178,178,0.75);
				color: 					#b3b3b3;
			}

			input[type="text"] {
				display: 				block;
				margin:					0;
				width: 					45%;
				font-family: 			"Lucida Sans Unicode", "Lucida Grande", Verdana, Arial, Helvetica, sans-serif; letter-spacing:-0.5px; font-size:13px;   
				appearance: 			none;
				-webkit-appearance: 	none;
				-moz-appearance: 		none;
				box-shadow: 			none;
				border-radius: 			5px;
				-webkit-border-radius: 5px;
				background-color: 		transparent;
				color: 					#d3d3d3;
			}

			input[type="text"]:focus {
				outline: 				none;
				color: 					black;
			}
		
			.titleDiv {
                                
                background-color: 		white;
            }
            
			#editorPanelTitle {
				color: 					#d3d3d3;
                font-family: 			"Lucida Sans Unicode", "Lucida Grande", Verdana, Arial, Helvetica, sans-serif; 
                letter-spacing:			-0.5px; 
                font-size:				22px;
                appearance: 			none;
                -webkit-appearance: 	none;
                -moz-appearance: 		none;                
                text-shadow: 			0 -1px 3px #202020;
    			font-weight: 			normal;
    			padding-left: 			2px;
        	}
        	
        	.mainBlock div {
				color: 					#d3d3d3;
        		font-family: 			"Lucida Sans Unicode", "Lucida Grande", Verdana, Arial, Helvetica, sans-serif;
        		letter-spacing:			-0.5px; 
        		font-size:				16px;                         
                text-shadow: 			0 -1px 3px #202020;
    			font-weight: 			normal;
        	}

			#widgetSearch {	
				padding: 				0px;
				border: 				none;
				border-radius: 			2px;
				-webkit-border-radius: 	5px;
				border-bottom: 			solid 5px #c8c8c8;
				transition: border 		0.3s;
				background-color: 		rgba(105, 105, 105, 0.4);
			}
			#widgetSearch:focus,
			#widgetSearch.focus {
				border-bottom: 			2px solid #969696;
			}
			
			#divider {
				border-left: 			2px solid #575757;
			}

			#userSettingsContainer {
				position:				absolute;
				/*top: 					0px;
				left: 					60%;
				height: 				90%;
				width: 					20%;
				margin: 				10%;*/
			    font-family: 			"Lucida Sans Unicode", "Lucida Grande", Verdana, Arial, Helvetica, sans-serif; letter-spacing:-0.5px;    
				color: 					#d3d3d3;
			}

			input[type="color"] {
				//border-radius: 50px;
				margin-left: 			7.5%;
				border:  				none;
				background-color: 		transparent;
				width: 					10%;
				color: 					#b3b3b3;

			}
			input[type="checkbox"] {
				width: 					5%;
				margin-left: 			10%;
				color: 					#d3d3d3;
			}

			input[type="button"] {
				width: 					auto;
				margin-left: 			7.5%;
			}

			#switchesContainer {
				padding: 				4%;
				margin: 				4%;
				border: 				1px solid transparent;
				width: 					84% - 2px;
				background-color: 		rgba(105, 105, 105, 0.4);
				overflow-X: 			auto;
			}

			#settingsContainer {
				padding: 				4%;
				margin: 				4%;
				border: 				1px solid transparent;
				width: 					84% - 2px;
				background-color: 		rgba(105, 105, 105, 0.4);
				overflow: 				auto;
			}

			#colorPickersDiv {
			   float: 					left;
			}

			.toggle {
				position:				relative;
			  	display:				inline-block;
			 	width:					40px;
				height:					60px;
				float:					left;
				background-color:		#bbb;
			 	-webkit-border-radius:	4px;
			  	-moz-border-radius:		4px;
			 	border-radius:			4px;
			  	text-align:				center;
			}

			.toggle_settings {
			 
			}

			.toggle-margin {
				margin-right: 			15px;
			}

			.toggle input {
				width:					100%;
				height:					100%;
				margin:					0 0;
				padding:				0 0;
				position:				absolute;
				top:					0;
				right:					0;
				bottom:					0;
				left:					0;
				z-index:				2;
				cursor:					pointer;
				opacity:				0;
				filter:					alpha(opacity=0);
			}

			.toggle label {
				display:				block;
				position:				absolute;
				top:					1px;
				right:					1px;
				bottom:					1px;
				left:					1px;
				background-image:		-webkit-linear-gradient(top,#fff 0%,#ddd 50%,#fff 50%,#eee 100%);
				background-image:		-moz-linear-gradient(top,#fff 0%,#ddd 50%,#fff 50%,#eee 100%);
				background-image:		-ms-linear-gradient(top,#fff 0%,#ddd 50%,#fff 50%,#eee 100%);
				background-image:		-o-linear-gradient(top,#fff 0%,#ddd 50%,#fff 50%,#eee 100%);
				background-image:		linear-gradient(top,#fff 0%,#ddd 50%,#fff 50%,#eee 100%);
				-webkit-box-shadow:		0 2px 3px rgba(0,0,0,0.4),
										inset 0 -1px 1px #888,
										inset 0 -5px 1px #bbb,
										inset 0 -6px 0 white;
				-moz-box-shadow:		0 2px 3px rgba(0,0,0,0.4),
										inset 0 -1px 1px #888,
										inset 0 -5px 1px #bbb,
										inset 0 -6px 0 white;
				box-shadow:				0 2px 3px rgba(0,0,0,0.4),
										inset 0 -1px 1px #888,
										inset 0 -5px 1px #bbb,
										inset 0 -6px 0 white;
				-webkit-border-radius:	3px;
				-moz-border-radius:		3px;
				border-radius:			3px;
				font:					normal 11px Arial,Sans-Serif;
				color:					#666;
				text-shadow:			0 1px 0 white;
				cursor:					text;
			}

			.toggle label:before {
				content:				attr(data-off);
				position:				absolute;
				top:					6px;
				right:					0;
				left:					0;
				z-index:				4;
			}

			.toggle label:after {
				content:				attr(data-on);
				position:				absolute;
				right:					0;
				bottom:					11px;
				left:					0;
				color:					#666;
				text-shadow:			=0 -1px 0 #eee;
			}

			.toggle input:checked + label {
				background-image:		-webkit-linear-gradient(top,#eee 0%,#ccc 50%,#fff 50%,#eee 100%);
				background-image:		-moz-linear-gradient(top,#eee 0%,#ccc 50%,#fff 50%,#eee 100%);
				background-image:		-ms-linear-gradient(top,#eee 0%,#ccc 50%,#fff 50%,#eee 100%);
				background-image:		-o-linear-gradient(top,#eee 0%,#ccc 50%,#fff 50%,#eee 100%);
				background-image:		linear-gradient(top,#eee 0%,#ccc 50%,#fff 50%,#eee 100%);
				-webkit-box-shadow:		0 0 1px rgba(0,0,0,0.4),
										inset 0 1px 7px -1px #ccc,
										inset 0 5px 1px #fafafa,
										inset 0 6px 0 white;
				-moz-box-shadow:		0 0 1px rgba(0,0,0,0.4),
										inset 0 1px 7px -1px #ccc,
										inset 0 5px 1px #fafafa,
										inset 0 6px 0 white;
				box-shadow:				0 0 1px rgba(0,0,0,0.4),
										inset 0 1px 7px -1px #ccc,
										inset 0 5px 1px #fafafa,
										inset 0 6px 0 white;
			}

			.toggle input:checked:hover + label {
				-webkit-box-shadow:		0 1px 3px rgba(0,0,0,0.4),
										inset 0 1px 7px -1px #ccc,
										inset 0 5px 1px #fafafa,
										inset 0 6px 0 white;
				-moz-box-shadow:		0 1px 3px rgba(0,0,0,0.4),
										inset 0 1px 7px -1px #ccc,
										inset 0 5px 1px #fafafa,
										inset 0 6px 0 white;
				box-shadow:				0 1px 3px rgba(0,0,0,0.4),
										inset 0 1px 7px -1px #ccc,
										inset 0 5px 1px #fafafa,
										inset 0 6px 0 white;
			}

			.toggle input:checked + label:before {
				z-index:				1;
				top:					11px;
			}

			.toggle input:checked + label:after {
				bottom:					9px;
				color:					#aaa;
				text-shadow:			none;
				z-index:				4;
			}

		</style>

		<script type="text/JavaScript" src="/WebPath/js/Globals.js"></script>	
		<script type="text/JavaScript" src="/WebPath/js/Debug.js"></script>	
		<script type="text/JavaScript" src="/WebPath/js/DesktopWindowContentCode.js"></script>
		<script type="text/JavaScript" src="/WebPath/js/widgetLibrary.js"></script>

		<script>	

			//functions:
			//	initEdit()
			//	drawicons(indexReferenceArray)
			//	setupForDrawSelectionRectangle(tileNumber)
			// 	searchWidgets(searchField)
			//	filterWidgets(filterField)
			//	toggleGrid(checkbox)
			//	setBackgroundColor(color)
			//	setGridColor(color)
			//	resetToDefault()
			//	rgbToHex(rgb)
			//	redrawWindow(clicked, hover)
			
			var _codeEditorAppId = 0; //to open code editor
		
			//widget tile container parameters:
			var widgetTiles_ = {
					"WIDGET_TYPE_COUNT" 	: 0,
					"widgetTiles_.columns" 	: 0,
					"widgetTiles_.rows" 	: 0,
					"tileSize"				: 0
			};
			
			//main html elements:
			var widgetTilesEl_;
			var dividerEl;
			var userSettingsDiv;
			
			//configurable settings
			var defaultGridColor_;
			var defaultBackgroundColor_;
			var codeEditor_ = 12345678910;
			var lastTileNumber_;
			
			

			/////////////////////////////////////////////////////////////////////////////////////////
			/////////////////////////////////////////////////////////////////////////////////////////

			//=====================================================================================						
			//init called once body has loaded
			function initEdit() 
			{			

				var w = window.innerWidth;
				var h = window.innerHeight;
				

				Debug.log("EditPane initEdit() was called w,h: " + 
						w + " - " + h);

				//fill in CodeEditor appId
				DesktopContent.XMLHttpRequest("Request?RequestType=getAppId" + 
						"&classNeedle=ots::CodeEditorSupervisor",
						"", //end post data, 
						function(req) 
						{			
					_codeEditorAppId = DesktopContent.getXMLValue(req,"id") | 0;
					Debug.log("_codeEditorAppId " + _codeEditorAppId);
						}, //end handler
						0, 0, true,//reqParam, progressHandler, callHandlerOnErr, 
						false,//doNotShowLoadingOverlay,
						true //targetSupervisor
						);
						
				
				widgetTilesEl_ = document.getElementById("widgetTilesContainer");

				widgetTilesEl_.style.top = ((h * 0.25)|0) + "px";
				widgetTilesEl_.style.left = "0px";
				widgetTilesEl_.style.height = ((h * 0.75)|0) + "px";
				widgetTilesEl_.style.width = ((w * 0.6)|0) + "px";
				
				//determine row and col widgetTiles_.tileSize of widget library
				widgetTiles_.WIDGET_TYPE_COUNT = Object.keys(widgetLibrary.typeToSrc).length;
				widgetTiles_.rows = Math.round(Math.sqrt(widgetTiles_.WIDGET_TYPE_COUNT/3));
				console.log("row", widgetTiles_.rows);
				if(widgetTiles_.rows < 4)
					widgetTiles_.rows = 4;
				else if(widgetTiles_.rows > 6)
					widgetTiles_.rows = 6;
				console.log("row", widgetTiles_.rows);

				widgetTiles_.tileSize = ((parseFloat(widgetTilesEl_.style.height) - 
						(parseFloat(widgetTilesEl_.style.height) * 0.1) - 
						(widgetTiles_.rows * 5)) / (widgetTiles_.rows));	
				
				console.log(parseFloat(widgetTilesEl_.style.width), (parseFloat(widgetTilesEl_.style.width) * 0.1), (widgetTiles_.tileSize + 5));
				
				widgetTiles_.columns = Math.round((parseFloat(widgetTilesEl_.style.width) - (parseFloat(widgetTilesEl_.style.width) * 0.1))/ (widgetTiles_.tileSize + 5)); //Math.ceil(widgetTiles_.WIDGET_TYPE_COUNT / widgetTiles_.rows);
				if((widgetTiles_.tileSize * widgetTiles_.rows) > (parseFloat(widgetTilesEl_.style.height) - (parseFloat(widgetTilesEl_.style.height) * 0.1) - (5 * (widgetTiles_.rows - 1))))
				{
					while((widgetTiles_.tileSize * widgetTiles_.rows) > (parseFloat(widgetTilesEl_.style.height) - (parseFloat(widgetTilesEl_.style.height) * 0.1) - (5 * (widgetTiles_.rows - 1))))
					{
						--widgetTiles_.rows;
					}
				}

				if((widgetTiles_.tileSize * widgetTiles_.columns) > (parseFloat(widgetTilesEl_.style.width) - (parseFloat(widgetTilesEl_.style.width) * 0.1) - (5 * (widgetTiles_.columns - 1))))
				{
					while((widgetTiles_.tileSize * widgetTiles_.columns) > (parseFloat(widgetTilesEl_.style.width) - (parseFloat(widgetTilesEl_.style.width) * 0.1) - (5 * (widgetTiles_.columns - 1))))
					{
						--widgetTiles_.columns;
					}
				}
				var titleDiv = document.getElementById("titleDiv");
				titleDiv.style.width = w + "px";
				titleDiv.style.height = ((h * 0.1)|0) + "px";
				titleDiv.style.top  = "0px";
				titleDiv.style.left = "0px";

				var buttonsDiv = document.getElementById("buttonsDiv");
//				buttonsDiv.style.width = window.innerWidth + "px";
//				buttonsDiv.style.height = (window.innerHeight * 0.1) + "px";
				buttonsDiv.style.top  = (parseFloat(titleDiv.style.height) * 1.5) + "px"; //(window.innerHeight * 0.2) + "px"; //"0px";
				buttonsDiv.left = "0px";

				var searchFields = document.getElementById("searchFields");
				searchFields.style.width  = ((w * 0.6)|0) + "px";
				searchFields.style.height =  ((h * 0.15)|0) + "px";
				searchFields.style.top  = ((h * 0.1)|0) + "px"; //"0px";
				searchFields.style.left = "0px";

				var widgetSearch = document.getElementById("widgetSearch");
				widgetSearch.title = "Search the widget library by name of widget! \nCheck out the widgetLibrary.js in the Code Editor to set widgets' name and other properties."
				widgetSearch.placeholder = "Search";
				var widgetFilter = document.getElementById("widgetFilter");
				widgetFilter.title = "Filter the widget library by type of widget! \nCheck out the widgetLibrary.js in the Code Editor to set widgets' type and other properties."
				widgetFilter.placeholder = "Filter";
//		                          widgetSearch.style.top  = (window.innerHeight * 0.1) + "px"; //"0px";
//                                widgetFilter.style.top  = (window.innerHeight * 0.1) + "px"; //"0px";

//				var searchButtonDiv = document.getElementById("searchButtonDiv");
//				searchButtonDiv.style.width  =  widgetTiles_.tileSize + "px";
//				searchButtonDiv.style.height =  widgetTiles_.tileSize + "px";
//				searchButtonDiv.style.top  = "0px";
//				searchButtonDiv.style.left = (window.innerWidth * 0.05 + ((widgetTiles_.tileSize + 5) * (widgetTiles_.columns - 1)) - 10) + "px";
//				searchButtonDiv.style.position = "absolute";
//				
//				var searchButton = document.getElementById("searchButton");
//				searchButton.style.width  = "100%";
//				searchButton.style.height = "100%";
//				
//				var img = document.createElement("img");
//				img.src = "/WebPath/images/windowContentImages/SlowControlsDashboardFileTree-magnifyingGlass.png";
//				img.style.height = "50%";
//				img.style.width = "auto";
//				img.style.top = "0px";
//				img.style.left = "0px";
//				searchButton.appendChild(img);
//				
//				document.getElementById("widgetFilter").style.width = (window.innerWidth * 0.7) + "px";
//				
//				document.getElementById("widgetSearch").style.width = "90%";
//				document.getElementById("widgetFilter").style.width = "90%";

				dividerEl = document.getElementById("divider");
				dividerEl.style.left = widgetTilesEl_.getBoundingClientRect().right + "px";
				dividerEl.style.top = parseFloat(widgetTilesEl_.style.top) + "px";
				dividerEl.style.height = (parseFloat(widgetTilesEl_.style.height) * 0.8) + "px";

				userSettingsDiv = document.getElementById("userSettingsContainer");
				userSettingsDiv.style.left = widgetTilesEl_.getBoundingClientRect().right + "px";
				userSettingsDiv.style.width = (parseFloat(w) - parseFloat(widgetTilesEl_.getBoundingClientRect().right)) + "px";

				var backgroundColorPicker = document.getElementById("backgroundColorPicker");
				defaultBackgroundColor_ = parent.mainBlock_.el.style["background-color"];
				backgroundColorPicker.value = rgbToHex(defaultBackgroundColor_);
				backgroundColorPicker.innerHTML = "Background";

				var gridColorPicker = document.getElementById("gridColorPicker");
				defaultGridColor_ = parent.gridColor_;
				gridColorPicker.value = rgbToHex(defaultGridColor_);
				backgroundColorPicker.innerHTML = "<p>Grid Color</p>";
				gridColorPicker.title = "Set the color of the grid lines."
				backgroundColorPicker.title = "Set the background color."
				document.getElementById("gridCheckbox").title = "Toggle the grid lines on/off."				
				document.getElementById("resetGrid").title = "Reset the grid to default values."  

				var filter = document.getElementById("widgetFilter");
				var option = document.createElement("option");
				option.value = "All";
				option.innerHTML = "";
				filter.appendChild(option);
				var filterOptions = [];
				for(purpose in parent.widgetLibrary.typeToPurpose)
				{
					if(filterOptions.indexOf(parent.widgetLibrary.typeToPurpose[purpose]) == -1)
					{
						var option = document.createElement("option");
						option.value = parent.widgetLibrary.typeToPurpose[purpose];
						option.innerHTML = parent.widgetLibrary.typeToPurpose[purpose];
						filterOptions.push(option.value);
						filter.appendChild(option);
					}
				}

				var allIcons = [];			
				for(var i = 0; i < widgetTiles_.WIDGET_TYPE_COUNT; i++)
					allIcons.push(i);

				drawicons(allIcons);

				window.onresize = redrawWindow;
				redrawWindow(); //redraw window for first time
			} //end initEdit()

			//=====================================================================================
			function drawicons(indexReferenceArray)
			{
				console.log("drawicons()",indexReferenceArray);
				
				widgetTilesEl_.innerHTML = "";
				var tileNumber = -1;		
				var positionX = window.innerWidth * 0.025;
				var positionY = window.innerHeight * 0.1;
				var tileNumber = -1;
				indexReferenceArray.push(codeEditor_);

				for(var cell = 0; cell < widgetTiles_.rows; cell++)
				{
					for(var col = 0; col < widgetTiles_.columns; col++)
					{
						if(indexReferenceArray.indexOf(indexReferenceArray[tileNumber]) != indexReferenceArray.length-1)
						{
							var tile = document.createElement('div');
							tile.id = "tiles-" + (indexReferenceArray[++tileNumber]);
							tile.className = "tile";
							//tile.innerHTML = "tiles-" + (tileNumber);
	//						tile.style["background-color"] = "red";
							tile.style.width = widgetTiles_.tileSize + "px";
							tile.style.height = widgetTiles_.tileSize + "px";
							tile.style.left = positionX + "px";
							tile.style.top = positionY + "px";
							tile.setAttribute("widgetID", tileNumber);

							var tileIMG = document.createElement("img");
							var name = "";
							var type = "";

							console.log(indexReferenceArray[indexReferenceArray.length-1] + " " + tileNumber);

							if(typeof parent.widgetLibrary.typeToName[indexReferenceArray[tileNumber]] !== 'undefined')
								name = parent.widgetLibrary.typeToName[indexReferenceArray[tileNumber]];
							else
								name = parent.widgetLibrary.typeToSrc[indexReferenceArray[tileNumber]];

							if(typeof parent.widgetLibrary.typeToName[indexReferenceArray[tileNumber]] !== 'undefined')
								type = parent.widgetLibrary.typeToPurpose[indexReferenceArray[tileNumber]];
							else
								type = "Undefined";

							tile.title = "Name: " + name + "\nType: " + type;

							if(typeof parent.widgetLibrary.typeToImgSrc[indexReferenceArray[tileNumber]] !== 'undefined')
								tileIMG.src = "widgets/" + parent.widgetLibrary.typeToImgSrc[indexReferenceArray[tileNumber]];
							else
								tileIMG.src = "widgets/default-icon.png";

							tileIMG.style.width = tile.style.width;
							tileIMG.style.height = "100%";

							if(indexReferenceArray[tileNumber] == codeEditor_) //last tile -> [+] brings user to widget editor in Code Editor
							{	
								tile.title = "Not finding what you're looking for? \nLaunch the Code Editor to make changes to the Widget Library, including making your own widget!";
								tileIMG.src = "widgets/code-editor.png";
								tile.onclick = 
										function()
										{
									DesktopContent.openNewWindow(
											"Code Editor", 
											"" /*subname*/,
											"/WebPath/html/CodeEditor.html?" +
											"urn=" + _codeEditorAppId + 
											"&startFilePrimary=/otsdaq_utilities/WebGUI/js/widgetLibrary.js",
											0 /*unique*/);									 
										};
							}
							else
								tileIMG.onclick = setupForDrawSelectionRectangle(indexReferenceArray[tileNumber]); 

							console.log("name and indexReferenceArray[tileNumber]: " + name + " " +  indexReferenceArray[tileNumber]);

							//tileIMG.style.width = tile.style.width;
							//tileIMG.style.height = "100%";
							//tileIMG.onclick = setupForDrawSelectionRectangle(indexReferenceArray[tileNumber]); 

							tile.appendChild(tileIMG);
							widgetTilesEl_.appendChild(tile);				
							positionX = positionX + widgetTiles_.tileSize + 5;
						}
					}
					positionY = positionY + widgetTiles_.tileSize + 5;
					positionX = window.innerWidth * 0.025;
				}
			} //end drawicons()
			
			//=====================================================================================
			function setupForDrawSelectionRectangle(tileNumber)
			{			
				Debug.log("setupForDrawSelectionRectangle() " + tileNumber);
				
				return function(){
					var el;
					if(lastTileNumber_ !== undefined) //revert border
					{
						el = document.getElementById("tiles-" + lastTileNumber_ );
						el.style.border = "thin solid rgba(0,0,0,0.1)";
					}

					el = document.getElementById("tiles-" + tileNumber);
					el.style.border = "2px dotted orange";
					lastTileNumber_  = tileNumber;

					parent.setupForDrawSelectionRectangle(tileNumber);
				};
			} //end setupForDrawSelectionRectangle()

			//=====================================================================================
			function searchWidgets(searchField)
			{
				Debug.log("searchWidgets() " + searchField);
				
				var keyword = searchField.value;
				var foundResult = [];
				
				for(var i = 0; i < widgetTiles_.WIDGET_TYPE_COUNT; i++)
				{
					console.log(i + " : " + parent.widgetLibrary.typeToName + " : " + keyword);
					
					if(parent.widgetLibrary.typeToName[i] != undefined)
						parent.widgetLibrary.typeToName[i].indexOf(keyword) != -1 ? foundResult.push(i) : console.log();
					else if(parent.widgetLibrary.typeToSrc[i] != undefined)
						parent.widgetLibrary.typeToSrc[i].indexOf(keyword) != -1 ? foundResult.push(i) : console.log();
				}
				
				console.log(foundResult);
				
				drawicons(foundResult);
			} //end searchWidgets()

			//=====================================================================================
			function filterWidgets(filterField)
			{
				Debug.log("filterWidgets() " + filterField);
				
				var keyword = filterField.value;
				var foundResult = [];
				console.log(keyword);
				if(keyword === 'All')
				{
					for(var i = 0; i < widgetTiles_.WIDGET_TYPE_COUNT; i++)
						foundResult.push(i);
				}
				else
				{
					for(var i = 0; i < widgetTiles_.WIDGET_TYPE_COUNT; i++)
						if(typeof parent.widgetLibrary.typeToPurpose[i] != 'undefined')
							parent.widgetLibrary.typeToPurpose[i].indexOf(keyword) != -1 ? foundResult.push(i) : console.log();
				}
				
				console.log(foundResult);
				
				drawicons(foundResult);
			} //end filterWidgets()		

			//=====================================================================================
			function toggleGrid(checkbox)
			{
				Debug.log("toggleGrid() " + checkbox.checked);
								
				parent.toggleGrid(checkbox.checked);
			} //end toggleGrid()

			//=====================================================================================
			function setBackgroundColor(color)
			{
				Debug.log("setBackgroundColor() " + color.value);
								
				parent.setBackgroundColor(color.value);
			} //end setBackgroundColor()

			//=====================================================================================
			function setGridColor(color)
			{
				Debug.log("setGridColor() " + color.value);
								
				parent.setGridColor(color.value, 
						document.getElementById("gridCheckbox").checked);
			} //end setGridColor()

			//=====================================================================================
			function resetToDefault()
			{
				Debug.log("resetToDefault()");
								
				parent.toggleGrid(true);
				document.getElementById("gridCheckbox").checked = true;
				parent.setGridColor(defaultGridColor_, true);
				parent.setBackgroundColor(defaultBackgroundColor_);
				
				var backgroundColorPicker = document.getElementById("backgroundColorPicker");
				backgroundColorPicker.value = rgbToHex(defaultBackgroundColor_);
				
				var gridColorPicker = document.getElementById("gridColorPicker");
				gridColorPicker.value = rgbToHex(defaultGridColor_);
			} //end resetToDefault()

			//=====================================================================================
			function rgbToHex(rgb)
			{
				Debug.log("rgbToHex() " + rgb);
				
				 rgb = rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
				 return (rgb && rgb.length === 4) ? "#" +
						 ("0" + parseInt(rgb[1],10).toString(16)).slice(-2) +
						 ("0" + parseInt(rgb[2],10).toString(16)).slice(-2) +
						 ("0" + parseInt(rgb[3],10).toString(16)).slice(-2) : '';
			} //end rgbToHex()

			//=====================================================================================
			function redrawWindow(clicked, hover) 
			{
				var w = window.innerWidth;
				var h = window.innerHeight;
				Debug.log("EditPane redrawWindow() to " + w + " - " + 
						h + " clicked:" + clicked + " hover:" + hover);

				//position widget tile container
				widgetTilesEl_.style.top = ((h * 0.25)|0) + "px";
				widgetTilesEl_.style.left = "0px";
				widgetTilesEl_.style.height = ((h * 0.75)|0) + "px";
				widgetTilesEl_.style.width = ((w * 0.6)|0) + "px";
				
			} //end redrawWindow()

		</script>

	</head>

	<body onload='Javascript:initEdit();'>

		<div id="titleDiv" class="mainBlock">
			<h2 id="editorPanelTitle">Editor Panel</h2>
		</div>
		
		<div class='mainBlock' id='buttonsDiv'>
			<div>Choose your widgets:</div>
			<div id="searchFields" class="absolute"  style='display:none'>
				<input id="widgetSearch" type="text" class="focus" onchange="searchWidgets(this)"></input>
				<select id="widgetFilter" class="absolute" onchange="filterWidgets(this)"></select>
			</div>
		</div>
		<div class='mainBlock' id='widgetTilesContainer'></div>
		<div class='mainBlock' id='divider'></div>
		<div class='mainBlock' id='userSettingsContainer'>

			<!-- TODO for new functionalities
			<div id="switchesContainer">

				<span class="toggle toggle-margin">
					<input type="checkbox" id="checkbox" onclick="" checked>
						<label data-off="Off" data-on="On"></label>
					</input>
				</span>
				<span class="toggle toggle-margin">
					<input type="checkbox" id="checkbox" onclick="" checked>
						<label data-off="Off" data-on="On"></label>
					</input>
				</span>
				<span class="toggle toggle-margin">
					<input type="checkbox" id="checkbox" onclick="" checked>
						<label data-off="Off" data-on="On"></label>
					</input>
				</span>

			</div>
			-->
			<div id="settingsContainer">
				<span class="toggle">
					<input type="checkbox" id="gridCheckbox" onclick="toggleGrid(this)" checked>
						<label data-off="Off" data-on="On"></label>
					</input>
				</span>
				<span class="colorPickersDiv"
				<br><input type="color"  id="gridColorPicker"       onchange="setGridColor(this)">Grid Color</input>
				<br><input type="color"  id="backgroundColorPicker" onchange="setBackgroundColor(this)">Background</input>
				<br><input type="button" id="resetGrid"             onclick="resetToDefault()" value="Default Values"></input>
				</span>
			</div>
		</div>

	</body>

</html>

