<!DOCTYPE HTML>
<html lang="en"> 
<head>
	<title>ConfigurationGUI</title>

	<link href='/WebPath/css/fonts.css?family=Inconsolata:400' rel='stylesheet' type='text/css'>
		
	<link rel="stylesheet" type="text/css" href="/WebPath/css/ConfigurationGUI.css">
	<link rel="stylesheet" type="text/css" href="/WebPath/css/ConfigurationAPI.css">

	<!-- MultiSelectBox: Must include .css style sheet and .js functionality -->
	<link rel="stylesheet" type="text/css" href="/WebPath/css/MultiSelectBox.css">
	<script type="text/JavaScript" src="/WebPath/js/js_lib/MultiSelectBox.js"></script>

	<style type="text/css">			

		/*fix margin for this page in Multi-Select (must have changed because of font/font-size)*/ 
		#groupSearchDiv input, textarea { 
			margin: 			19px 5px 5px 12px;
		}

		/* make buttons have a hand cursor */
		input[type="button"], button {
			cursor: pointer;
		}

		.treeNode {
			margin-left: 		30px;
			float:				left;
			position:			relative;
		}
		
		.treeNode-Connection {
			border-left: 		1px solid rgb(44, 44, 187);
			border-bottom: 		1px solid rgb(44, 44, 187);
			width: 				24px;
			height:				17px; /* +1 for firefox */
			margin-top:  		-7px;
			position:			absolute;
		}
		
		.treeNode-Expander {
			background-image: 	url(/WebPath/images/windowContentImages/ConfigurationGUI-expandTree.png);
			width: 				11px;
			height: 			9px;
			position:			absolute;
			margin: 			5px 0 0 25px;
			z-index:			1000; /* make sure it is on top of connect lines */
		} .treeNode-Expander:hover {
		    cursor:				pointer;			
		}

		.treeNode-Value {
			margin-left: 		38px;
			float:				left;
		}
		
		/*
		.treeNode-Value:hover {
			background-color:	rgb(218, 194, 194);
		}*/
		
		.treeNode-Value-nonLeafNode:hover,
		.treeNode-Value-nonLeafNode label:hover
		{
			cursor:				pointer;
		}
		
		.treeNode-Value-editIcon {			
			background-image: 	url(/WebPath/images/windowContentImages/ConfigurationGUI-pencilEdit.png);
			width: 				24px;
			height: 			20px;
			float: 				left;
			border: 			0;
			margin: 			-2px 0 -7px 10px;
			display:			none;
		}
		.treeNode-Value-editIcon:hover {
			background-image: 	url(/WebPath/images/windowContentImages/ConfigurationGUI-pencilEditHover.png);
			cursor: 			pointer;
		}
		
		.treeNode-deleteIcon {			
			background-image: 	url(/WebPath/images/windowContentImages/ConfigurationGUI-trashCan.png);
			width: 				16px;
			height: 			20px;
			border: 			0;
			margin: 			-9px 0 -10px 10px;
		}
		.treeNode-deleteIcon:hover {
			background-image: 	url(/WebPath/images/windowContentImages/ConfigurationGUI-trashCanHover.png);
			cursor: 			pointer;
		}
		
		.preloadImage {			
			width: 				24px;
			height: 			20px;
			position:			absolute;
			left: 				-100px;
			top: 				0;
		}
		#preloadImage-treeEditIconHover {
			background-image: 	url(/WebPath/images/windowContentImages/ConfigurationGUI-pencilEditHover.png);
		}
		#preloadImage-treeEditTrashIcon {
			background-image: 	url(/WebPath/images/windowContentImages/ConfigurationGUI-trashCan.png);
		}
		#preloadImage-treeEditTrashIconHover {
			background-image: 	url(/WebPath/images/windowContentImages/ConfigurationGUI-trashCanHover.png);
		}
		
		.treeNode-Link {
			float:				left;
		    margin: 			-1px 0 -3px 10px;
		    padding: 			3px 4px 3px 4px;
		    border-radius: 		3px;
		} .treeNode-Link:hover {
			background-color:	rgb(218, 194, 194);
		    margin: 			-2px 0 -2px 10px;
		    cursor:				pointer;
		}
		
		.treeNode-Children {
			border-left: 		1px solid rgb(181, 170, 210);
		}
		
		#activateConfigWithWarnings {
			margin-top: 10px;
		    font-size: 14px;
		}
		
		#tableDetails th,
		#groupDetails th {
			font-size: 14px;
			text-align: right;
			vertical-align: top;
		}
		#tableDetails td, #tableDetails a, #tableDetails label, #tableDetails div, #tableDetails b,
		#groupDetails td, #groupDetails a, #groupDetails label, #groupDetails div, #groupDetails b {
			font-size: 14px;
			text-align: left;
			vertical-align: top;
		}
		#tableDetails .underlineRow,
		#groupDetails .underlineRow {   
			border-bottom: 1px solid #b9a3a3;
	    }
	    	
		#popUpDialog {
			position: absolute;
			z-index: 1000;    
			border: 1px solid #770000;
		    background-color: #efeaea;
		    text-align: center;
		    padding: 10px;
		}
		
		.popUpOkCancel:hover {
			text-decoration: underline;
			cursor: pointer;
		}
		
	</style>
	
	
	<script type="text/JavaScript" src="/WebPath/js/Globals.js"></script>	
	<script type="text/JavaScript" src="/WebPath/js/Debug.js"></script>	
	<script type="text/JavaScript" src="/WebPath/js/DesktopWindowContentCode.js"></script>
	<script type="text/JavaScript" src="/WebPath/js/js_lib/SimpleContextMenu.js"></script>
	<script type="text/JavaScript" src="/WebPath/js/js_lib/ConfigurationAPI.js"></script>
	
	<script>		
		
		//Start by offering two views (System Configurations) (Sub-Configurations)
		//	and default to System Configurations
		//
		//High Level Goals:
		//	- Allow to select a System Config to edit or start anew (all sub-config versions are dont cares)
		//		- Be able to edit the versions associated with the System Config while 
		//		viewing other System Configs for inspiration
		//	- Allow to select a sub-configuration to edit or start anew (from mock-up)
		//		- Be able to edit a sub-config, and view others to copy chunks from them
		//
	
	
		//In System Configuration mode:
		//	List the existing configuration aliases
		//		with possibly ability to scroll through associated sub-configs
		//
	
		//In Sub-Configuration mode:
		//	List the existing versions
		//		with possibly scrolling information about the version (# of rows, lastuseddate, etc.)
		//	Some Sub-Configurations will need special views:
		//		ability to add chips (of certain types) to system config...
		//
	
		var _MAX_CHUNK_SIZE = 100; //100 rows per page
		var _CONFIG_DATA_ROW_OFFSET = 2;
		var _CONFIG_DATA_COL_OFFSET = 1;

		var _TABLE_BOOL_TYPE_TRUE_COLOR = "rgb(201, 255, 201)";
		var _TABLE_BOOL_TYPE_FALSE_COLOR = "rgb(255, 178, 178)";
		
		var _SCRATCH_VIEW_NAME = "Scratch-View";
		var _MOCKUP_VIEW_NAME = "Mockup-View";
		
		var _OK_CANCEL_DIALOG_STR = "";

		_OK_CANCEL_DIALOG_STR += "<div title='' style='padding:5px;background-color:#eeeeee;border:1px solid #555555;position:relative;z-index:2000;" + //node the expander nodes in tree-view are z-index:1000  
				"width:95px;height:20px;margin:0 -122px -32px 10px; font-size: 16px; white-space:nowrap; text-align:center;'>";
		_OK_CANCEL_DIALOG_STR += "<a class='popUpOkCancel' onclick='javascript:editCellOK(); event.stopPropagation();' onmouseup='event.stopPropagation();' title='Accept Changes' style='color:green'>" +
				"<b style='color:green;font-size: 16px;'>OK</b></a> | " +
				"<a class='popUpOkCancel' onclick='javascript:editCellCancel(); event.stopPropagation();' onmouseup='event.stopPropagation();' title='Discard Changes' style='color:red'>" + 
				"<b style='color:red;font-size: 16px;'>Cancel</b></a>";
		_OK_CANCEL_DIALOG_STR += "</div>";	
		
		var _OTS_RELAUNCH_STR = 
				"Click here to relaunch ots in " +
				"<a href='#' onclick='javascript:" +
				"DesktopContent.popUpVerification(" + 
				"\"Are you sure you want to relaunch otsdaq in Normal Mode?\", " +
				"function() {" + 
				"DesktopContent.XMLHttpRequest(\"Request?RequestType=launchOTS\");" +
				"},0,\"#efeaea\",0,\"#770000\");" +
				"'>Normal Mode</a>" +
				" or " +
				"<a href='#' onclick='javascript:" +
				"DesktopContent.popUpVerification(" + 
				"\"Are you sure you want to relaunch otsdaq in Wiz Mode?\", " +
				"function() {" + 
				"DesktopContent.XMLHttpRequest(\"Request?RequestType=launchWiz\");" +
				"},0,\"#efeaea\",0,\"#770000\");" +
				"'>Wiz Mode</a>." +
				"<br>" +
				"Click here to " +
				"<a href='#' id='versionTrackingSystemLink' onclick='javascript:" +
				"var el = this;" +
				"if(el.textContent == \"Turn Version Tracking OFF\")" +
				"DesktopContent.popUpVerification(" + 
				"\"Are you sure you want to turn OFF your configuration version tracking?\", " +
				"function() {" + 
				"DesktopContent.XMLHttpRequest(\"Request?RequestType=versionTracking&Type=OFF\",\"\",versionTrackingHandler);" +
				"},0,\"#efeaea\",0,\"#770000\");" +
				"else " +
				"DesktopContent.popUpVerification(" + 
				"\"Are you sure you want to turn ON your configuration version tracking?\", " +
				"function() {" + 
				"DesktopContent.XMLHttpRequest(\"Request?RequestType=versionTracking&Type=ON\",\"\",versionTrackingHandler);" +
				"},0,\"#efeaea\",0,\"#770000\");" +
				"'>Turn Version Tracking OFF</a>"
				;
	
		var _currentConfigName, _associatedGroupName, _associatedGroupKey;
		var _editingCell = false;
		var _editingCellEl, _editingCellElOldValue, _editingCellElOldTitle;
		var _editingCellPos = [-1,-1];
		var _versionIsChanged = false;
		var _version;
		var _dataOffset = 0;
		var _lastFindRow, _lastFindCol;
		var _cachedTableComment, _cachedGroupComment;
		
		var _versionTrackingIsOn = true;
		var _firstTimeSilentActive = true;
		var _useTableLinkDropdown = true;		
		var _tableViewIsTransposed = false;
		var _showTableDetails = true;
		var _showGroupDetails = true;
		var _tableLinkDropdownChoices = []; 
		var _tableFixedChoiceData = {}; 
		var _tableDefaultRowValues = []; 
		var _tableViewBackLinkStr;
		var _tableUploadStr = "";
		
		var _displayTargetEl = 0;

		var _contextMemberNames = [];
		var _backboneMemberNames = [];
		

		var _contextMenuEl = 0;
		
		var _msChosenGroupName;
		var _msChosenGroupKey;
		var _groupViewFilterIndex = 2; //-1=all, 0=context, 1=backbone, 2=configuration
		
		var _mouseIsSelecting = false;	//to block switching cells when selecting text
		
		//for tree view
		var treeViewHandlerStr_; //used by recursive function to build html string
		var fancyTreeViewHandlerStr_;
		var treeNodeUID_;		//incrementing unique id for nodes
		var treeMemberNames_, treeMemberVersions_, treeMemberComments_;
		var treeViewBackLinkStr_;
		var treeGroupName_, treeGroupKey_;
		var treeViewHideStatus_ = true;
		var treeFilterApplied_ = false;
		var treeViewHideInfo_ = true;
		var treeFilter_ = "";
		var lastTreeFilter_ = "";
		
		var treeHasChanged_ = false;	
		var treeEditingNodeType_ = "";		
		var treeEditingTargetTable_ = "";
		var treeEditingTargetUID_ = "";
		var treeEditingTargetColumn_ = "";
		var treeEditingNodeParentIdString_ = "";
		var treeEditingNodeDepth_ = -1;
		var treeEditingNodeIdString_ = "";
		var treeEditingNodeInitValue_ = "";	
		var treeEditingEditIconShownEl_ = 0;
		var treeEditingEditIconShownIdString_ = "";
		var treeEditingInitGroupMembers_ = [];
		var treeEditingGroupMembersLastSelect_ = "";
	
		
	
		/////////////////////////////////////////////////////////////////////////////////////////
		/////////////////////////////////////////////////////////////////////////////////////////
	
		//functions:			
			//init()
			//niceName(str)									//removes "Configuration" from name
		
			//setupSystemViewMode(anchorTarget)							//gets configuration groups aliases
			//groupAliasesRequestHandler(req,anchorTarget)		 
			
			//setupGroupViewMode(anchorTarget)							//gets all configuration groups
			//configGroupsRequestHandler(req,anchorTarget)
			//groupSearchSelectionHandler(el)
			//makeGroupInfoDisplayString(groupName,allKeys,latestKey,latestMembersHdr,backLinkToList)
			//gotoSelectedMSGroup()
			
			//setupTableViewMode(anchorTarget)							//gets configuration tables
			//tableViewRequestHandler(req,anchorTarget)
			
			//setupSpecificConfigGroup(groupName,groupKey,backLinkStr,anchorTarget)	//setup editor for specific configuration group
			//specificGroupRequestHandler(req,param)			
		
			//setupSpecificConfig(configName,version,backLinkStr)			//setup editor for specific configuration table
			//setupSpecificConfigInRight(configName,version)
			//specificConfigRequestHandler(req,backLinkStr)			
			//toggleTableDetails(setVal)
			//toggleGroupDetails(setVal)
			//transposeTableView()
			//getTableViewColIsBoolType(rows)
			//createTableViewOutputStr(cols,colIsBoolType,transposeOutput,colsIsArray)
			//downloadTableAsCSV()
			//uploadTableFromCSV()

		//tree-view focused
			//setupConfigGroupTreeView(configGroupName,configGroupKey,backLinkStr)
			//treeViewHandler(req,parentId,errStr)
			//recursiveDrawTree(parent,depth,path,parentIdString)
			//getTreeViewTableStrings(tableLinkName)
			//refreshTreeView();
			//applyTreeFilter(filter,reapplyFilter,infoWasToggled)
			//toggleTreeChildren(depth,uid,setVal)
			//expandTreeChildrenDepth()
			//hideTreeChildrenDepth()
			//createTreeViewMenu(event)
		
			//handleTreeNodeClick(depth,uid,editClick,type)			
			//treeHasChanged(reset)
			//saveModifiedTree(ignoreWarnings)
			//editTreeAddNewRow(tableName)
			//editTreeNodeOK()
			//editTreeNodePropagateChange()
		
			//selectThisTreeNode(idString,type,event)
			//treeViewGroupMemberEditMultiSelectHandler(sel) 
			//handleEditTreeGroupIDEditFreeformToggle()
		//end tree-view focused
		
			//selectThisCell(r,c,el,event)
			//editCellCancel()
			//keyHandler(e)
			//bodyKeyHandler(e,keyEl)
			//bodyMouseHandler(e)
			//bodyMouseMoveHandler(e)

			//editCellOK()									//assumes edited cell is specified by its global variables
			//addRow(r)										//add row at destination with default values populated
			//deleteRow(r)									//delete row at destination
		
			//popUpClearVersionsPrompt(clearTemporary,backLinkStr)
			//popUpSaveNewTableForm()
			//popUpSaveNewGroupForm(groupName, sourceGroupKey, sourceTye)
			//popUpGroupAliasForm(isLatest, myAlias)
			//popUpVersionAliasForm()
			//popUpVersionAliasGroupEditorForm()
			//popUpVersionAliasSpecificGroupForm(groupName,groupKey)
			//popUpFilterTreeForm()
			//popUpGroupViewAliasForm(groupName,groupKey)
			//popUpGroupViewAliasFormSubmit(groupName,groupKey)
		
			//handleGroupCommentToggle(groupName,setHideVal)
			//handlePopUpHeightToggle(h,gh)
		
			//setupConfigCreator(preSelectStr)
			//setupConfigCreatorHandler(req,preSelectStr)
			//addMemberToConfigGroup(groupName,backLinkStr) 
		
			//activateSystemConfig(groupName, groupKey)
			//activateSystemConfigHandler(req)
			//versionTrackingHandler(req)
			//selectForCreateConfig(i)
			//versionsForCreateConfig(i, alias)		
			//createConfigGroup(ignoreWarnings)
			//createConfigGroupHandler(req)

			//setVersionAliasInActiveBackbone(versionAlias,configName,version,newBackboneNameAdd,doneHandler,doReturnParams)			
			//wizToLatestConfigGroup(groupAlias, ignoreWarnings, groupType)
			//wizToActiveConfigGroup(groupAlias, groupType)
			//saveGroupAndActivate(groupName,configMap,doneHandler,doReturnParams)
	
			
			
			//saveConfigAsNewVersion(temporary, backLinkStr, ignoreWarnings)
			//saveConfigAsNewVersionHandler(req, backLinkStr)
			//saveConfigGroupAsNewKey(groupName, sourceType, ignoreWarnings)	
			//changeMemberVersionForConfigGroup(groupName, groupKey, configName, newVersion)
		
			//isTemporary(version)
		
			//setupFindAndReplace()
			//configFind()
			//configReplace() 
			//configIncrementByReplace()
			//versionHasChanged()
		
			//setupCopyAndMoveRows()
			//configCopyView()
			//configCopyRow(deleteSrc)					//copy/move row from source to destination row			
			//jump(anchor)
			//evaluateJS(str)			
			//createEditTableMenu(event)
		

		//ConfigurationAPI functions
			//ConfigurationAPI.getDateString(date)
			//ConfigurationAPI.setCaretPosition(el,start,stop)
			//ConfigurationAPI.setGroupAliasInActiveBackbone(groupAlias,groupName,groupKey,newBackboneNameAdd,doneHandler,doReturnParams)
			//ConfigurationAPI.newWizBackboneMemberHandler(req,params)
			//ConfigurationAPI.setPopUpPosition(el,w,h,padding,border,margin)
		//end ConfigurationAPI functions

		//ConfigurationAPI constants
			//ConfigurationAPI._DEFAULT_COMMENT
		//end ConfigurationAPI constants
		
		/////////////////////////////////////////////////////////////////////////////////////////
		/////////////////////////////////////////////////////////////////////////////////////////
				
		
		//init called once body has loaded
		function init() {			
						
			Debug.log("CfgGUI init ");
			DesktopContent.tooltip("Configuration GUI Introduction",
					"Welcome to the Configuration GUI. Here you can manipulate every configuration "+
					"parameter in your entire <i>otsdaq</i> system. \n\n" +
					"The organization of the Configuration GUI is as follows:\n" +
					"There are links at the top of the page to switch between the main views" +
					" 'System View', 'Group View', and " +					
					"'Table View'; " +
					"then below those links is a display of the currently Active groups; " +
					"and then below that is the view content." +
					"\n\nIf you would like to take a look at the available online documentation, " +
					"click the question mark at the top of the Configuration GUI window.\n\n" +
					
					"Briefly, here is a description of the main views: " +
					"\n\t- 'System View' is for viewing and editing the translation from System Aliases to groups." +
					"\n\t- 'Group View' is for viewing and editing groups of tables." +
					"\n\t- 'Table View' is for viewing and editing tables." + 
					"\n\n" +
					"You will see one more type view in the Configuration GUI and that is the 'Tree-view'." +
					"Briefly, the 'Tree-view' is a way of viewing tables that are linked together - " +
					"each group can be viewed in 'Tree-view' format."
			);
			
			
			window.onkeydown = bodyKeyHandler;
			window.onmouseup = bodyMouseHandler;
			//be careful to not override the window.onmousemove DesktopContent action
			DesktopContent.mouseMoveSubscriber(bodyMouseMoveHandler); 
			
			//get context and backbone member list 
			DesktopContent.XMLHttpRequest("Request?RequestType=getContextMemberNames", "", 
					function (req) 
					{				
				var err = DesktopContent.getXMLValue(req,"Error");
				if(err) 
				{
					Debug.log(err,Debug.HIGH_PRIORITY);
					return;
				}
				var memberNames = req.responseXML.getElementsByTagName("ContextMember");
				_contextMemberNames = []; //reset
				for(var i=0;i<memberNames.length;++i)
					_contextMemberNames[i] = memberNames[i].getAttribute("value");
				Debug.log(_contextMemberNames);
				if(_contextMemberNames.length == 0) 
					Debug.log("Empty context member list found!",Debug.HIGH_PRIORITY);
					},
					0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
			);

			DesktopContent.XMLHttpRequest("Request?RequestType=getBackboneMemberNames", "", 
					function (req)
					{				
				var err = DesktopContent.getXMLValue(req,"Error");
				if(err) 
				{
					Debug.log(err,Debug.HIGH_PRIORITY);
					return;
				}
				var memberNames = req.responseXML.getElementsByTagName("BackboneMember");
				_backboneMemberNames = []; //reset
				for(var i=0;i<memberNames.length;++i)
					_backboneMemberNames[i] = memberNames[i].getAttribute("value");
				Debug.log(_backboneMemberNames);
				if(_backboneMemberNames.length == 0) 
					Debug.log("Empty backbone member list found!",Debug.HIGH_PRIORITY);
					},
					0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
			);

			//============================
			//		for debugging
			
			//setupSpecificConfig("FEConfiguration","0",""); return;
			//setupSpecificConfig("XDAQContextConfiguration","10","setupTableViewMode('anchorTag-XDAQContextConfiguration');"); return;

			//setupSpecificConfigGroup("artdaqFclTest","46","","anchorTag-RawDataSaverConsumerConfiguration"); return;			
			//setupSpecificConfigGroup("testContext","5"); return;
			
			//setupConfigCreator(); return
			
			//setupConfigGroupTreeView("testContext","5"); return; //"46"); return;
			//setupConfigGroupTreeView("artdaqFclTest","4"); return;
			
			//setupGroupViewMode(); return;
			
			//============================


			
			
			//get command string if opening a new window
			var cmdStr = DesktopContent.getParameter(1); //from  location.search
			if(cmdStr && cmdStr != "")
			{
				//do incoming commands!
				Debug.log("cmdStr=" + cmdStr);
				//replace %22 with "
				cmdStr = cmdStr.replace(/%22/g, "\"");
				
				evaluateJS(cmdStr);	
			}
			else
				setupSystemViewMode();			

		}	
		
		//return name without "Configuration" unless it is start of the name 
			//or part of the word "Configurations"
		function niceName(str) {	
			var i = str.lastIndexOf("Configuration");
			return str.substr(0,(i>1 && str[i+13] != 's')?i:str.length);
		}

		//setupSystemViewMode ~
		function setupSystemViewMode(anchorTarget) {

			var el = document.getElementById("display");
			el.innerHTML = "Loading...";
			
			DesktopContent.XMLHttpRequest("Request?RequestType=getGroupAliases", "", 
					groupAliasesRequestHandler,anchorTarget,
					0,0,true  //progressHandler, callHandlerOnErr, showLoadingOverlay
					);			

			DesktopContent.XMLHttpRequest("Request?RequestType=versionTracking&Type=Get","",
					versionTrackingHandler,
					0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
			);
		}
		
		//setupGroupViewMode ~
		function setupGroupViewMode(anchorTarget) {

			var el = document.getElementById("display");
			el.innerHTML = "Loading...";
			DesktopContent.XMLHttpRequest("Request?RequestType=getConfigurationGroups", "", 
					configGroupsRequestHandler, anchorTarget,
					0,0,true  //progressHandler, callHandlerOnErr, showLoadingOverlay
					);		
		}
		
		//setupTableViewMode ~
		function setupTableViewMode(anchorTarget) {

			var el = document.getElementById("display");
			el.innerHTML = "Loading...";
			DesktopContent.XMLHttpRequest("Request?RequestType=getConfigurations", "", 
					tableViewRequestHandler,anchorTarget,
					0,0,true  //progressHandler, callHandlerOnErr, showLoadingOverlay
					);		
		}

		//setupSpecificConfigGroup ~		
		function setupSpecificConfigGroup(groupName, groupKey, backLinkStr, anchorTarget) {

			var el = document.getElementById("display");
			el.innerHTML = "Loading...";
			var param = "";
			if(backLinkStr && backLinkStr != "")
				param += "&backLinkStr=" + backLinkStr;
			if(anchorTarget && anchorTarget != "")
				param += "&anchorTarget=" + anchorTarget;
			
			DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificConfigurationGroup" +
					"&groupName=" + groupName +
					"&groupKey=" + groupKey,
					"", specificGroupRequestHandler, param,
					0,0,true  //progressHandler, callHandlerOnErr, showLoadingOverlay
					);		
		}
		
		//setupSpecificConfig ~
		//	undefined version gives latest
		function setupSpecificConfig(configName, version, backLinkStr) {
			
			var el;
			if(_displayTargetEl && backLinkStr == "special display target")
			{
				el = _displayTargetEl;
				backLinkStr = ""; //clear the link string
			}
			else
			{
				el = document.getElementById("display");
				_displayTargetEl = 0;
			}
			
			el.innerHTML = "Loading...";
			var v = "";
			if(version !== undefined && version != "") v = "&version="+version;
			DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificConfiguration" + "&dataOffset=0&chunkSize=" + _MAX_CHUNK_SIZE +  
				"&configName=" + configName + 
				v, 
				"", specificConfigRequestHandler, backLinkStr,
				0,0,true  //progressHandler, callHandlerOnErr, showLoadingOverlay
				);		
		}
		//setupSpecificConfigInRight ~
		//	undefined version gives latest
		function setupSpecificConfigInRight(configName, version) {
			_displayTargetEl = document.getElementById("display-right");
			setupSpecificConfig(configName,version,"special display target");
		}
		
		//groupAliasesRequestHandler ~
		function groupAliasesRequestHandler(req, anchorTarget) {
			
			var err = DesktopContent.getXMLValue(req,"Error");
			if(err) 
			{
				Debug.log(err,Debug.HIGH_PRIORITY);
				
				//attempt to go on, in case error was just associtate with one group
				//return;
			}

			DesktopContent.tooltip("System View",
					"You are looking at your configuration through the 'System View' now. " +
					"From this view you can see existing System Aliases, edit them, " +
					"and create new ones." +
					"\n\n" +				
					"It is important to note that the Backbone group has a table called " +
					"'GroupAliases' and this is the table that defines your " +
					"System Aliases (Clicking <i>Edit System Aliases</i> at the top of " +
					"this view will take you to the 'GroupAliases' table)." +
					"The System Aliases defined in the Active Backbone group are what you " +
					"are seeing now!\n\n" +
					"You can edit and create System Aliases from this view. All of the links " +
					"with <i>Wiz-</i> in the name will either edit or create a System Alias for you. " +
					"The wiz process you select, under the hood, will modify the currently active " +
					"'GroupAliases' table, save it, create a new Backbone group with the new 'GroupAliases' " +
					"table as a member, and activate the new Backbone group. Handling many steps for you " +
					"like a wiz!" + 
					"\n\n" +		
					"There are two key terms you will find in the 'System View' involving 'Latest' and " +
					"'Active'; here is a brief " +
					"description of each: " +
					"<INDENT>" +
					"- 'Wiz-to-Latest':" +
					"<INDENT>" + 
					"This will setup a System Alias to refer to a group comprised " +
					"of the latest/newest versions of each table in the group. When you select this route, you will " +
					"be prompted for the group type: Context, Backbone, or Configuration. " +
					"For example, if you select the Configuration group type, then a Configuration group consisting of the " +
					"latest versions of each table, that are not members of Context or Backbone groups, will be " +
					"created, the active 'GroupAliases' table will be modified to include a System Alias to the" +
					"new Configuration group, the modified 'GroupAlias' table will saved as a new version, " +
					"and a new Backbone group (with that new 'GroupAlias' table as a member) will be created and activated. Very handy!" +
					"</INDENT>" +
					"</INDENT>" +
					"<INDENT>" +
					"- 'Wiz-to-Active':" +
					"<INDENT>" +
					"This will setup a System Alias to refer to one of the Active groups. " +
					"When you select this route, you will " +
					"be prompted for the group type: Context, Backbone, or Configuration." +
					"For example, if you select the Configuration group type, then the active 'GroupAliases' table " +
					"will be modified to include a System Alias to the" +
					"currently Active Configuration group, the modified 'GroupAlias' table will saved as a new version, " +
					"and a new Backbone group (with that new 'GroupAlias' table as a member) will be created and activated. Also very handy!" +
					"</INDENT>" +
					"</INDENT>" +
					"\n\nRemember, if you would like to take a look at the available online documentation, " +
					"click the question mark at the top of the page.\n\n"
			);
			
			activateSystemConfigHandler(req); //display active config groups			
			
			var groupAliases = req.responseXML.getElementsByTagName("GroupAlias");
			var groupNames = req.responseXML.getElementsByTagName("GroupName");
			var groupKeys = req.responseXML.getElementsByTagName("GroupKey");
			var groupComments = req.responseXML.getElementsByTagName("GroupComment");
			var aliasComments = req.responseXML.getElementsByTagName("AliasComment");

			var groupAliasesVersion = 
					DesktopContent.getXMLValue(req,"GroupAliasesConfigurationVersion");		
			var groupAliasesName = 
					DesktopContent.getXMLValue(req,"GroupAliasesConfigurationName");		

			var str = ""; //string for html content			
			
			var groupAlias, groupName, groupKey, groupComment, aliasComment;
			var backLinkStr;

			backLinkStr = "setupSystemViewMode();"; 
			
			str += _OTS_RELAUNCH_STR + "<br>";
			
			str += "<a href='#' onclick='javascript:setupSpecificConfig(\"" + 
					groupAliasesName + "\",\"" +
					groupAliasesVersion + "\",\"" + backLinkStr + "\"); return false;'>";
			str += "Edit System Aliases</a>";

			str += "<br>";
			
			str += "<a href='#' onclick='javascript:popUpGroupAliasForm(1); return false;' " +
					"title='Automatically assign a new System Alias to a Group comprised of the latest table versions.'" +
					">";
			str += "Wiz-New System Alias-to-Latest</a>";

			//str += "&nbsp;&nbsp;&nbsp;&nbsp;";
			str += "<br>";

			str += "<a href='#' onclick='javascript:popUpGroupAliasForm(0); return false;'  " +
						"title='Automatically assign a new System Alias to an Active Group.'" +
						">";
			str += "Wiz-New System Alias-to-Active</a>";
			
			str += "<br><br><br>";

			Debug.log("CfgGUI groupAliasesRequestHandler groupAliases.length " + groupAliases.length);

			
			
			str += "<table style='white-space:nowrap' cellpadding='0' cellspacing='0' border='0' >"; //open system aliases table
			
			str += "<tr>";
			str += "<th>";
			str += "<u>System Alias</u>";
			str += "</th><th style='background-color:rgb(218, 194, 194);'>";
			str += "<u>Translation</u>";
			str += "</th><th colspan='4'>";
			str += "";		
			str += "<th style='text-align:left;padding-left: 20px;'>";
			str += "<u>Alias Comment</u>";
			str += "</th>";	
			str += "<th style='text-align:left;padding-left: 20px;'>";
			str += "<u>Group Comment</u>";
			str += "</th>";
			str += "</tr>";
			
			
			if(!groupAliases.length)
				str += "No Configuration Group Aliases found.";
			for(var i=0;i<groupNames.length;++i)
			{		
				groupAlias 	= groupAliases[i].getAttribute("value");
				groupName 	= groupNames[i].getAttribute("value");
				groupKey 	= groupKeys[i].getAttribute("value");
				groupComment= decodeURIComponent(groupComments[i].getAttribute("value"));	
				aliasComment= decodeURIComponent(aliasComments[i].getAttribute("value"));

				backLinkStr = "setupSystemViewMode(\\\"anchorTag-" + 
						groupAlias + "\\\");"; 				


				str += "<tr style='height:30px;'><td style='text-align:left;padding: 0 10px 0 0px;'>";
				
				//system alias
				str += "<a name='anchorTag-" + 
						groupAlias + "'></a>";
				str += "&quot;";
				str += "<a href='#' onclick='javascript:setupSpecificConfig(\"" + 
						groupAliasesName + "\",\"" +
						groupAliasesVersion + "\",\"" + backLinkStr + "\"); return false;' " +
						"title='Alias Comment:\n\"" + aliasComment + "\"' " +
						">";
				str += groupAlias + "</a>&quot;";


				str += "</td><td style='text-align:left; padding: 0 10px 0 10px; background-color:rgb(218, 194, 194);'>";


				//add group view link				
				str += "&lt; ";
				str += " <a href='#' onclick='javascript:setupSpecificConfigGroup(\"" + groupName +
						"\",\"" + groupKey + "\",\"" + backLinkStr + "\"); return false;' " +
						"title='Group Comment:\n\"" + groupComment + "\"' " +
						">";
				str += groupName + "</a>";					
				str += "(" + groupKey +") &gt;";	

				
				str += "</td><td style='text-align:left; padding-left:10px;'>";
				
				
				//add tree view link
				str += " <a href='#' onclick='javascript:setupConfigGroupTreeView(\"" + groupName +
					"\",\"" + groupKey + "\",\"" + backLinkStr + "\"); return false;'>";
				str += "Tree-view</a>";		

				
				str += "</td><td style='text-align:left; padding: 0 0 0 10px;'>";
				
				
				//add Activate link
				str += " <a href='#' onclick='javascript:activateSystemConfig(\"" + groupName +
						"\",\"" + groupKey + "\"); return false;'>";
				str += "Activate</a>";

				
				str += "</td><td style='text-align:left; padding: 0 0 0 10px;'>";
				
				
				//Wiz to latest of all tables
				str += " <a href='#' onclick='javascript:" + 
						//"wizToLatestConfigGroup(\"" + groupAlias + "\"); return false;' "+
						"popUpGroupAliasForm(1,\"" + groupAlias + "\"); return false;' " +
						"title='Automatically assign this System Alias to a Group comprised of the latest table versions.'" +
						">";
				str += "Wiz-to-Latest</a>";

				
				str += "</td><td style='text-align:left; padding: 0 0 0 10px;'>";
				
				
				//Wiz to active config group
				str += " <a href='#' onclick='javascript:" +
						//"wizToInitializedConfigGroup(\"" + groupAlias + "\"); return false;' " +
						"popUpGroupAliasForm(0,\"" + groupAlias + "\"); return false;' " +
						"title='Automatically assign this System Alias to an Active Group.'" +
						">";
				str += "Wiz-to-Active</a>";
				

				str += "</td>";
						
				//add alias comment
				str += "<td style='text-align:left; padding: 0 10px 0 10px;' " +
						"title='For...    " + groupAlias + " <" +
						groupName + "(" + groupKey + ")>' " +
						">"
				str += "<pre style='white-space:nowrap;'>//" + aliasComment + "</pre>"; 
				str += "</td>";
				
				//add group comment
				str += "<td style='text-align:left; padding: 0 10px 0 10px;' " +
						"title='For...    " + groupName + "(" + groupKey + ")' " +
						">"
				str += "<pre style='white-space:nowrap;'>//" + groupComment + "</pre>"; 
				str += "</td>";
				
				str += "</tr>";				
			}
			str += "</table>"; //close system aliases table

			var el = document.getElementById("display");
			el.innerHTML = str;
		}
		
		//configGroupsRequestHandler ~
		function configGroupsRequestHandler(req, anchorTarget) {				
			var err = DesktopContent.getXMLValue(req,"Error");
			if(err) 
			{
				Debug.log(err,Debug.HIGH_PRIORITY);
				
				//attempt to go on, in case error was just associtate with one group
				//return;
			}
			
			activateSystemConfigHandler(req);

			var groupNames = req.responseXML.getElementsByTagName("ConfigurationGroupName");
			var keys = req.responseXML.getElementsByTagName("ConfigurationGroupKey");
			var membersHdr = req.responseXML.getElementsByTagName("ConfigurationGroupMembers");
			var types = req.responseXML.getElementsByTagName("ConfigurationGroupType");
					
			var groupName, key;
			
			var el = document.getElementById("display");

			var str = "";
			var configNames, configVersions;
			var backLinkStr;
			var configName, configVersion;									
			
			backLinkStr = "setupGroupViewMode();"; 
			
			var typeName = ["All","Contexts","Backbones","Configurations"];
			var typeFilterIndex = [-1,0,1,2];
			
			str += "Showing:";
			for(var i=0;i<typeName.length;++i)
			{
				if(_groupViewFilterIndex == typeFilterIndex[i])
					str += " <b>" + typeName[i] + "</b>";
				else
				{
					str += " <a href='#' onclick='javascript:_groupViewFilterIndex=" + 
							typeFilterIndex[i] + ";setupGroupViewMode(); return false;'>";
					str += typeName[i];
					str += "</a>";
				}
			}
			
			str += "<br>";
			str += "<label id='filteredGroupCount'></label> of " +
					groupNames.length + " groups. ";
			str += "Don't see what you need: ";
			str += "<a href='" +
					"javascript:setupConfigCreator(\"&backLinkStr=" + backLinkStr + 
					"\");' title='" +
					"Goto the group creator interface." +
					"'>" + 
					"Create a new Group</a>";
			str += "<br>";

					
			Debug.log("CfgGUI requestHandler groupNames.length " + groupNames.length);
			if(!groupNames.length)
				str += "No Configuration Groups found.";
			else
			{
				_msChosenGroupName = "";
				_msChosenGroupKey = "";
				//////////////////////////////////////
				//add search box div

				str += "<button type='button' onmouseup='javascript:gotoSelectedMSGroup()' title='" +
						"View the Latest Key for the Selected Group." +
						"'>" +
						"View Latest Key for Selected Group</button>";
				str += "<div id='groupSearchDiv' ";
				str += "style='margin-top:-20px; height:200px; width:450px;'";
				str += ">";				
				str += "</div>";

				str += "<div id='clearDiv'></div>";

				str += "<button style='margin-top:-25px' " + 
						"type='button' onmouseup='javascript:gotoSelectedMSGroup()' title='" +
						"View the Latest Key for the Selected Group." +
						"'>" +
						"View Latest Key for Selected Group</button>";
				
				str += "<div style='margin-top:10px' id='msSelectedGroupDiv'></div>";
								
				str += "<div style='margin-top:0px'>";
				str += "<hr><b >";
				str += "Exhaustive Configuration Group List:";
				str += "</b></div><br>";
				
				//end search box add div
				//////////////////////////////////////				
			}
			
			str += "<div id='exhaustiveGroupList'></div>";
			
			el.innerHTML = str;
			
			//////////// make search box
			{	
				var noMultiSelect = true; // true or false (false for multiselect functionality) 

				var msValues = []; 	//group names for multi-select
				var msKeys = []; 	//group keys for multi-select
				var msTypes = [];	//back link strings for multi-select
				var skipRepeat;
				var msAllKeys = []; //all keys separated by '-'
				var indexToLatest = []; //index to latest, used for exhaustive list
				var filteredGroupCount = 0;
				backLinkStr = "setupGroupViewMode();";
				
				for(var i=0;i<groupNames.length;++i)
				{	
					groupName = groupNames[i].getAttribute("value");
					key = keys[i].getAttribute("value");

					if(_groupViewFilterIndex == 0 && //context only
							types[i].getAttribute("value") != "Context")
					{
						Debug.log("Filtering out " + groupName + "_v" + key);
						continue;
					}
					else if(_groupViewFilterIndex == 1 && //context only
							types[i].getAttribute("value") != "Backbone")
					{
						Debug.log("Filtering out " + groupName + "_v" + key);
						continue;
					}
					else if(_groupViewFilterIndex == 2 && //context only
							types[i].getAttribute("value") != "Configuration")
					{
						Debug.log("Filtering out " + groupName + "_v" + key);
						continue;
					}

					++filteredGroupCount;
					skipRepeat = false;
					for(var j=0;j<msValues.length;++j)
						if(msValues[j] == groupName)
						{							
							//only represent single latest group/key
							if((key|0) > (msKeys[j]|0))
							{
								msKeys[j] = key; //found new latest key
								indexToLatest[j] = i; //update latest index
							}
							
							//add to all keys
							msAllKeys[j] += "-" + key;
							
							skipRepeat = true;							
							break;							
						}
					if(skipRepeat) continue; //do not add repeats to multi-select array
				
					msValues.push(groupName);
					msKeys.push(key);
					msTypes.push(backLinkStr);
					msAllKeys.push(key);
					indexToLatest.push(i);
				}
				
				
				//prepare key string (last key in key string is latest)
				// and display exhastive list
				str = "";
				for(var i=0;i<msValues.length;++i)
				{
					msAllKeys[i] += "-" + msKeys[i] + "-" + msValues[i];
					
					str += makeGroupInfoDisplayString(
							msValues[i],
							msAllKeys[i].split('-'),
							msKeys[i],
							membersHdr[indexToLatest[i]],
							true  //back link to the exhaustive list
							);					
				}
				var el = document.getElementById('exhaustiveGroupList');
				el.innerHTML = str;
				el = document.getElementById('filteredGroupCount');
				el.innerHTML = filteredGroupCount;
				
				
				//write to a particular div
				el = document.getElementById('groupSearchDiv');  
				MultiSelectBox.createSelectBox(el,
						"groupSearch",
						"Search and Select a Group:",
						msValues,msAllKeys,msTypes,groupSearchSelectionHandler,noMultiSelect);

				MultiSelectBox.initMySelectBoxes();

	            //if anything is selected from before.. handle as selected
	            var selArr = MultiSelectBox.getSelectionArray(el);
	            for(var s in selArr)
	            {
	            	if(selArr[s])
	            		groupSearchSelectionHandler(
	                			MultiSelectBox.getSelectionElementByIndex(el,s));
	            }
				
			}			
			//////////// end make search box

			//if there is a target to jump to, do it
			if(anchorTarget)
			{
				Debug.log("anchorTarget = " + anchorTarget);
				jump(anchorTarget);
			}
		}
		
		//groupSearchSelectionHandler ~~
		//	make group search selection handler
		//	el points to the div of selected element
		function groupSearchSelectionHandler(el)
		{
            var i = MultiSelectBox.getSelectedIndex(el); 
            var selArr = MultiSelectBox.getSelectionArray(el);            
            if(selArr[i])
			{
				Debug.log("Chosen element index:" + i +
						" value:" + el.innerHTML +
						" key:" + el.getAttribute("key-value") +
						" type:" + el.getAttribute("type-value"));
				var keyArr = el.getAttribute("key-value").split('-');

				_msChosenGroupName = keyArr[keyArr.length-1];
				_msChosenGroupKey = keyArr[keyArr.length-2];
				
				//copy selected div and show as selected
				var srcEl = document.getElementById("groupViewGroupDiv-" + 
						_msChosenGroupName + "-" + _msChosenGroupKey);
				var str = "";
				
				str += "<b class='bold-header'>";
				str += "Selected Group: " + _msChosenGroupName;
				str += "</b><br>";			
				str += srcEl.innerHTML;
				str += "<br>";				

				el = document.getElementById('msSelectedGroupDiv');
				el.innerHTML = str;				
			}
			else
			{
				_msChosenGroupName = "";
				_msChosenGroupKey = "";
				el = document.getElementById('msSelectedGroupDiv');
				el.innerHTML = "";				
			}
		}
		

		//getGroupInfoDisplayString ~~
		function makeGroupInfoDisplayString(groupName,allKeys,latestKey,latestMembersHdr,
				backLinkToList)
		{			
			var str = "";

			str += "<b class='bold-header'>";
			str += groupName;
			str += "</b>";
			str += "<br>";
			
			str += "<div id='groupViewGroupDiv-" + groupName + "-" + latestKey + "'>";
			str += "Existing Valid Keys: ";			

			var backLinkStr;
			if(backLinkToList)
				backLinkStr = "setupGroupViewMode(\\\"anchorTag-" + 
					groupName + "-" + latestKey + "\\\");"; 
			else
				backLinkStr = "setupGroupViewMode()";
			for(var j=0;j<allKeys.length-2;++j)
			{
				str += "<a href='#' onclick='javascript:setupSpecificConfigGroup(\"" + 
						groupName + "\",\"" + 
						allKeys[j] + "\",\"" + 
						backLinkStr + "\"); return false;'>";
				str += allKeys[j] + "</a> ";

			}
			str += "<br>";
			str += "Latest Key: " + latestKey + " (shown below)";
			str += "<br>";			

			str += "<a name='anchorTag-" + 
					groupName + "-" + latestKey + "'></a>";
			str += "<a href='#' onclick='javascript:setupSpecificConfigGroup(\"" + groupName +
					"\",\"" + latestKey + "\",\"" + backLinkStr + "\"); return false;'>";
			str += groupName + "</a> (" + latestKey +")";

			//add tree view link
			str += " <a href='#' onclick='javascript:setupConfigGroupTreeView(\"" + groupName +
					"\",\"" + latestKey + "\",\"" + backLinkStr + "\"); return false;'>";
			str += "Tree-view</a>";										

			//add Activate link
			str += " <a href='#' onclick='javascript:activateSystemConfig(\"" + groupName +
					"\",\"" + latestKey + "\"); return false;'>";
			str += "Activate</a>";

			//show  members for latest version
			str += "<br><table><tr>";

			//members are only returned for the latest
			configNames = latestMembersHdr.getElementsByTagName("MemberName");
			configVersions = latestMembersHdr.getElementsByTagName("MemberVersion");
				
			Debug.log("CfgGUI requestHandler configNames.length " + configNames.length);

			for(var j=0;j<configNames.length;++j)
			{
				configName = configNames[j].getAttribute("value");
				configVersion = configVersions[j].getAttribute("value");
				backLinkStr = "setupGroupViewMode(\\\"anchorTag-" + 
						groupName + "-" + configName + "\\\");"; 

				str += "<td align='center'>";

				str += "<a name='anchorTag-" + 
						groupName + "-" + configName + "'></a>";
				str += "<a href='#' onclick='javascript:setupSpecificConfig(\"" + configName +
						"\",\"" + configVersion + "\",\"" + backLinkStr + "\"); return false;'>";
				str += niceName(configName) + "</a><br>" + 
						((configVersion|0) == ConfigurationAPI._SCRATCH_VERSION?_SCRATCH_VIEW_NAME:configVersion);
				str += "</td>";
			}
			str += "</tr></table>";	
			str += "</div>"; //close groupViewGroupDiv-*
			
			str += "<hr>";

			return str;
		}
		
		//gotoSelectedMSGroup ~~
		function gotoSelectedMSGroup()
		{
			if(_msChosenGroupName == "" || _msChosenGroupKey == "")
			{
				Debug.log("Must first select a Group name from the select box.", 
						Debug.HIGH_PRIORITY);
				return;
			}
			setupSpecificConfigGroup(_msChosenGroupName,_msChosenGroupKey,
					"setupGroupViewMode()");
		}
		

		//tableViewRequestHandler ~~
		function tableViewRequestHandler(req, anchorTarget)
		{					
			var err = DesktopContent.getXMLValue(req,"Error");
			if(err) 
			{
				Debug.log(err,Debug.HIGH_PRIORITY);
				return;
			}
			
			var configNames = req.responseXML.getElementsByTagName("ConfigurationName");
			var configVersionHdr = req.responseXML.getElementsByTagName("ConfigurationVersions");
			
			var el = document.getElementById("display");

			var str = "";
			var configVersions;
			var configName, version;
			var backLinkStr;

			Debug.log("CfgGUI requestHandler configNames.length " + configNames.length);
			for(var i=0;i<configNames.length;++i)
			{			
				configName = configNames[i].getAttribute("value");
				
				backLinkStr = "setupTableViewMode(\\\"anchorTag-" + configName + "\\\");"; 

				str += "<a name='anchorTag-" + configName + "'></a>";
				str += "<a href='#' onclick='javascript:setupSpecificConfig(\"" + configName +
					"\",\"\",\"" + backLinkStr + "\"); return false;'>";
				str += niceName(configName);
				str += "</a><br><table style='margin-left:40px'><tr>";

				configVersions = configVersionHdr[i].getElementsByTagName("Version");
				
				//Debug.log("CfgGUI requestHandler config= " + configName +
				//				+ " configNames.length " + configVersions.length);
				
				for(var j=0;j<configVersions.length;++j)
				{
					version = configVersions[j].getAttribute("value");
					str += "<td align='center'>";
					str += "version" + "<br>";
					str += "<a href='#' onclick='javascript:setupSpecificConfig(\"" + configName +
							"\",\"" + version + "\",\"" + backLinkStr + "\"); return false;'>";
					str += ((version|0) == ConfigurationAPI._SCRATCH_VERSION?_SCRATCH_VIEW_NAME:version);					
					str += "</td>";
				}
				str += "</tr></table><br>";
			}				
			//Debug.log("CfgGUI requestHandler str " + str);
			el.innerHTML = str;
			
			//if there is a target to jump to, do it
			if(anchorTarget)
			{
				Debug.log("anchorTarget = " + anchorTarget);
				jump(anchorTarget);
			}
		}


		//specificGroupRequestHandler ~~
		//	backLinkStr is defined to call functions one after the other
		function specificGroupRequestHandler(req, param) {

			//remove all previous buttons
			var el;
			do
			{
				el = document.getElementById("saveGroupWithWarningsIgnored");
				if(el) el.parentNode.removeChild(el);
			} while(el);	
			
			var attemptedNewGroupName = DesktopContent.getXMLValue(req,"AttemptedNewGroupName");
			
			var treeErr = DesktopContent.getXMLValue(req,"TreeErrors");
			if(treeErr) 
			{	
				//As of 4/20/2017 tree errors are handled by the pop-up group save box
				Debug.log(treeErr);
				return;
			}			
			
			var err = DesktopContent.getXMLValue(req,"Error");
			if(err) 
			{	
				Debug.log(err,Debug.HIGH_PRIORITY);

				var el = document.getElementById("display");
				var str = "";
				str += "Failed.<br><br>" + err; 
				

				var groupName = DesktopContent.getXMLValue(req,"ConfigurationGroupName");
				var groupKey = DesktopContent.getXMLValue(req,"ConfigurationGroupKey");
				
				if(groupName && groupKey)
				{
					str += "<br><br>&nbsp;&nbsp;&nbsp;&nbsp;";
					str += "<a href='#' onclick='javascript:setupSpecificConfigGroup(\"" + groupName +
						"\",\"" + groupKey + "\"); return false;'>";
					str += "Go-to group &quot;" + groupName + "&quot;</a>";	
				}
				
				var errSplit = err.split('"');
				if(errSplit.length > 1)
				{
					str += "<br><br>It seems like there was trouble with a specific table, " +
							 "&quot;" + errSplit[1] + "&quot;. Try using the Table Editor " +
							 "in ots wiz to verify the column info is valid; or you can try " +
							 "goint to to the table view:";
					str += "<br>&nbsp;&nbsp;&nbsp;&nbsp;";
					str += "<a href='#' onclick='javascript:setupSpecificConfig(\"" + errSplit[1] +
						"\"); return false;'>";
					str += "Go-to table &quot;" + errSplit[1] + "&quot;</a>";						
				}
					
				Debug.log(str,Debug.WARN_PRIORITY);
				//el.innerHTML = str;
				//return;
				
				//don't power through if a new group was attempted
				if(attemptedNewGroupName && attemptedNewGroupName != "")
					return;
			}
			else if(attemptedNewGroupName && attemptedNewGroupName != "") //if attempted and no errors, shout success
				Debug.log("New group '" + attemptedNewGroupName + "' successfully created!",
						Debug.INFO_PRIORITY);
				
			
			var backLinkStr = "";
			var anchorTarget = "";
			
			var DEFAULT_groupNavContextMenuItems = [
												   "Go-to Table View",
												   "Open in new Desktop Window",
												   "Open in new Browser Tab"];
			
			if(param)
			{
				Debug.log("param= " + param);
				param = param.split("&");			
				for(var i=1;i<param.length;i+=2)
				{
					var pi;
					if((pi=param[i].indexOf("backLinkStr=")) >= 0)			
						backLinkStr = param[i].substr(param[i].indexOf("=")+1);
					if((pi=param[i].indexOf("anchorTarget=")) >= 0)			
						anchorTarget = param[i].substr(param[i].indexOf("=")+1);
				}			
			}
			
			var groupName = DesktopContent.getXMLValue(req,"ConfigurationGroupName");
			var groupKey = DesktopContent.getXMLValue(req,"ConfigurationGroupKey");
			var historicalKeys = req.responseXML.getElementsByTagName("HistoricalConfigurationGroupKey");

			var configNames = req.responseXML.getElementsByTagName("MemberName");
			var configVersions = req.responseXML.getElementsByTagName("MemberVersion");
			var configComments = req.responseXML.getElementsByTagName("MemberComment");
			
			var key,version,configName,configComment;
			var el = document.getElementById("display");

			var str = "";
			
			var configExistingVersions;			
			
			if(backLinkStr != "")
			{
				//Note: be careful with the source of backLinkStr.. don't use both quote styles!
				if(backLinkStr.indexOf("'") >= 0)
					backLinkStr = backLinkStr.replace(/'/g, "\\\"");
				else
					backLinkStr = backLinkStr.replace(/"/g, "\\\"");
				Debug.log("Back-link = " + backLinkStr);

				str += "<a href='#' onclick='javascript:evaluateJS(\"" + backLinkStr + "\");  return false;'>Back</a>";
				str += "&nbsp;&nbsp;&nbsp;&nbsp;";
			}	
			else backLinkStr = "";		

			var refreshLinkStr = "setupSpecificConfigGroup(\"" + 
					groupName + "\",\"" +
					groupKey + "\",\"" + backLinkStr + "\");"; 
			str += "<a href='#' onclick='javascript:" + refreshLinkStr + 
					"; return false;'>Refresh</a>";
			str += "<br>";

			str += "<h3><u>Specific Configuration Group View</u></h3>";
			str += "<label id='configGroupModified'></label><b>" + 
					groupName + "</b> (group key: " + groupKey + ") ";

			//add tree view link
			var returnToHereLink = "setupSpecificConfigGroup(\\\"" + groupName + "\\\",\\\"" +
					groupKey + "\\\");"; 	
			str += " <a href='#' onclick='javascript:setupConfigGroupTreeView(\"" + groupName +
				"\",\"" + groupKey + "\",\"" + returnToHereLink + "\"); return false;' title='" +
					"Display the tree-view for the current group '" + groupName + 
					" (" + groupKey + ").'" +
					">";
			str += "Tree-view</a>";	
			
			//add Activate link
			str += " <a href='#' onclick='javascript:activateSystemConfig(\"" + groupName +
					"\",\"" + groupKey + "\"); return false;' title='" +
					"Activate the current group '" + groupName + 
					" (" + groupKey + ").'" +
					">";
			str += "Activate</a>";
			
			//add Alias link
			str += " <a href='#' onclick='javascript:popUpGroupViewAliasForm(\"" + groupName +
					"\",\"" + groupKey + "\"); return false;' title='" +
					"Create a System to Alias that refers to the current group '" + groupName + 
					" (" + groupKey + ").'" +
					">";
			str += "Alias</a>";
			
			//create group details
			{
				str += "<div id='clearDiv'></div>";
				str += "<div id='groupDetails' style='display:block'>Group Details:";
				var groupComment = DesktopContent.getXMLValue(req,"ConfigurationGroupComment");
				groupComment = decodeURIComponent(groupComment);
				_cachedGroupComment = groupComment;
				var groupAuthor = DesktopContent.getXMLValue(req,"ConfigurationGroupAuthor");
				var groupCreationTime = DesktopContent.getXMLValue(req,"ConfigurationGroupCreationTime");
				groupCreationTime = ConfigurationAPI.getDateString(new Date((groupCreationTime|0)*1000));
				
				str += "<table border='0' style='" +
						"border: 1px solid #9c5e5e;" +
						"margin: 5px 0 5px 30px;" +
						"background-color: #d2c1c1;" +
						"'>";
				str += "<tr><th>Author:</th><td class='underlineRow'>" + groupAuthor + "</td></tr>";
				str += "<tr><th>Created:</th><td class='underlineRow'>" + groupCreationTime + "</td></tr>";				
				str += "<tr><th>Comment:</th><td>" + 
						groupComment.replace(/\n/g , "<br>") + "</td></tr>";
				str += "</table>";
				str += "</div>";

				str += "<div id='clearDiv'></div>";
			}
			
			if(historicalKeys.length)
			{
				str += "Existing &quot;" + groupName + "&quot; group keys: ";
				//str += " " + groupKey;
				
				for(var i=0;i<historicalKeys.length;++i)
				{
					key = historicalKeys[i].getAttribute("value");
					if(groupKey == key)
					{ str += " " + key; continue; }
					
					str += " <a href='#' onclick='javascript:setupSpecificConfigGroup(\"" +
								groupName + "\",\"" + key + "\",\"" + backLinkStr + "\"); return false;'>";
					str += key;
					str += "</a>";
				}
			}
			else 
				str += "No Historical keys exist for " + groupName + ".<br>";
			
			
			str += "<br><a href='#' onclick='javascript:addMemberToConfigGroup(\"" + 
					groupName + "\",\"" + returnToHereLink + "\"); return false;'>";
			str += "Add/Remove/Modify Configuration Members</a> for "  + groupName + "(" + groupKey + ")";
			
			str += "<br>";
			var setMembersToDefaultReq = 
					"DesktopContent.XMLHttpRequest(\"Request?RequestType=setAliasOfGroupMembers" +
							"&versionAlias=Default" + 
							"&groupName=" + groupName +
							"&groupKey=" + groupKey + "\", \"\"," +
							"ConfigurationAPI.newWizBackboneMemberHandler," +
							"[\"MemberVersionAliasWizBackbone\",undefined]," +
							"0,0,true" +  //progressHandler, callHandlerOnErr, showLoadingOverlay
							");";
					
			str += "<a href='#' onclick='javascript:" + setMembersToDefaultReq + "; return false;' title='Make all member versions" + 
					" the &apos;Default&apos; version for that member " + 
					" by automatically setting up the &apos;Default&apos; alias " + 
					"in the active Backbone group.'" +
					">";
			str += "Set all Members' chosen Version to the 'Default' table-Alias";
			str += "</a>";
			str += "<br>";

			str += "<a href='#' onclick='javascript:popUpVersionAliasSpecificGroupForm(" + 
					"\"" + groupName + "\",\"" + groupKey + "\"); return false;' title='Set an Alias for all member versions" +
					" by automatically setting up the specified Alias " + 
					"in the active Backbone group.'" +
					">";
			str += "Set all Members' chosen Versions to a table-Alias";
			str += "</a>";
			str += "<br><br>";
			

			str += "<div style='margin-left:30px'>";
			
			var cfgVersionStr;
			var cfgNameStr = "";
			var replaceScreenJS,newWindowStr,newwindowJS,newtabJS;
			var groupMemberNavContextMenuItemHandlers = [];
			
			str += "<table cellpadding='0' cellspacing='0' border='0' style='float:left;'>";
			
			//Debug.log("CfgGUI specificConfigRequestHandler Member length " + configNames.length + " - " + configVersions.length);
			for(var i=0;i<configNames.length && i<configVersions.length;++i)
			{
				configName = configNames[i].getAttribute("value");
				version = configVersions[i].getAttribute("value");
				configComment = configComments[i].getAttribute("value");
				
				backLinkStr = "setupSpecificConfigGroup(\\\"" + groupName + "\\\",\\\"" +
						groupKey + "\\\",undefined,\\\"anchorTag-" + 
						configName + "\\\");"; 
				//make replace screen js
				replaceScreenJS = "setupSpecificConfig(\"" + 
						configName + "\",\"" +
						version + "\",\"" + backLinkStr + "\");";

				str += "<tr>"; //open pre/comment table row
				str += "<td>";
				str += "<div style='float:left;margin-right:20px;'>";	//open name div
				str += "<a name='anchorTag-" + configName + "'></a>";
				str += "<b>" + niceName(configName) + "</b> ";
				str += "</div>"; //close member name 

				str += "</td><td style='background-color: rgb(218, 194, 194);'>"; //open "curren version" link
				
				str += "<div style='float:left;white-space:nowrap;'>";	//open name div
				str += "<a id='" + configName + "-currentVersionLink' " +
						"href='javascript:" + replaceScreenJS + "'>";
				str += "(Current version: ";
				str += "<label id='" + configName + "-currentVersion'>";					
				str += ((version|0) == ConfigurationAPI._SCRATCH_VERSION?_SCRATCH_VIEW_NAME:version);
				str += "</label>";

				str += ")";
				str += "</a>";
				str += "</div>"; //close member current version link
				
				str += "</td><td>"; //open table nav link

				//add member nav goto link
				{
					//make context menu
					groupMemberNavContextMenuItemHandlers = [];															 
					groupMemberNavContextMenuItemHandlers.push(replaceScreenJS);

					//make new window link
					newWindowStr = "setupSpecificConfig(\"" + 
							configName + "\",\"" +
							version + "\")";
					newWindowStr = newWindowStr.replace(/"/g, "\\\"");
					newWindowStr = location.pathname + 
							location.search +
							"&newWindowOps=" + newWindowStr;
					newwindowJS = "DesktopContent.openNewWindow(" +
							"\"Configure\",\"\",\"" + 
							newWindowStr + "\",false);";
					groupMemberNavContextMenuItemHandlers.push(newwindowJS);

					//make new tab link
					newtabJS = "DesktopContent.openNewBrowserTab(" +
							"\"Configure\",\"\",\"" + 
							newWindowStr + "\",false);";
					groupMemberNavContextMenuItemHandlers.push(newtabJS);

					str += //start member Link div
							"<div class='treeNode-Link' style='float:left;'  " + 
							"onmousedown='" + // start link onmousedown	
							"SimpleContextMenu.createMenu(["; //open array for items

					//output item strings
					for(j=0;j<DEFAULT_groupNavContextMenuItems.length;++j)
					{
						if(j)
							str += ",";
						str += "\"" + DEFAULT_groupNavContextMenuItems[j] + "\"";
					}
					str += //end items and open array for item handlers
							"]," +
							"[";

					for(j=0;j<groupMemberNavContextMenuItemHandlers.length;++j)
					{
						//Debug.log("treeNavContextMenuItemHandlers[j]= " + treeNavContextMenuItemHandlers[j]);
						//need to escape all quotes by one more level
						groupMemberNavContextMenuItemHandlers[j] = groupMemberNavContextMenuItemHandlers[j].replace(/\\\"/g, "AAAAA");
								groupMemberNavContextMenuItemHandlers[j] = groupMemberNavContextMenuItemHandlers[j].replace(/"/g, "\\\"");
						groupMemberNavContextMenuItemHandlers[j] = groupMemberNavContextMenuItemHandlers[j].replace(/AAAAA/g, "\\\\\\\"");										
						//Debug.log("treeNavContextMenuItemHandlers[j]= " + treeNavContextMenuItemHandlers[j]);
						//Debug.log("this works= " + "Debug.log(\\\"hi\\\");");
						//THIS WORKS: treeViewHandlerStr_ += "\"" + "Debug.log(\\\"hi\\\");" + "\"";
						str += "\"" + groupMemberNavContextMenuItemHandlers[j] + "\"";
						if(j != groupMemberNavContextMenuItemHandlers.length-1)
							str += ",";
					}
					str += "]" + //end treeNavContextMenuItemHandlers array
							",\"groupMemberNavContextMenu\",event.pageX-1,event.pageY-1, " +
							"\"rgb(220, 187, 165)\", \"rgb(130, 51, 51)\");";					
					str += 
							"' " + // end link onmousedown
							//"onmouseup='" + onmouseupJS + "' " +
							">" +	
							"<div class='gotoNavDiv'></div>" +			
							"</div>"; //end nav Link					
				}

				str += "</td><td>";

				//add comment
				//make comment html safe
				configComment = configComment.replace(/</g, "&lt");
				configComment = configComment.replace(/>/g, "&gt");

				str += "<div id='" + configName + "-comment' " +
						"style='font-size:14px; margin:2px 0 0 20px; float:left; white-space: nowrap;'>";
				if(configComment != ConfigurationAPI._DEFAULT_COMMENT) //do not show if default
					str += "//" + configComment;

				str += "</div>";
				str += "</td></tr>"; //close pre/comment table row
				
				str += "<tr><td colspan='4'>"

				//add prompt and existing versions
				str += "<div id='clearDiv'></div>";
				str += "Click below to change "  + niceName(configName) + 
						" Version for " + groupName + ":<br>";		

				str += "<div style='white-space:nowrap'>";
				str += "Existing versions: ";
				str += "<label id='" + configName + "-existingVersions'>";
				cfgVersionStr = ""; //keep CSV list of versions for use by changeMemberVersionForConfigGroup
				
				configExistingVersions = configVersions[i].getElementsByTagName("ConfigurationExistingVersion");
				var existingVersion;
				for(var j=0;j<configExistingVersions.length;++j)
				{
					existingVersion = configExistingVersions[j].getAttribute("value");
					if((existingVersion|0) < 0 || //skip temporary versions and scratch version
							(existingVersion|0) == ConfigurationAPI._SCRATCH_VERSION) //scratch version will be shown as an alias
						continue;
					
					if(existingVersion == version || //skip link for current version
							(existingVersion == 		//including if it's the scratch alias
									ConfigurationAPI._VERSION_ALIAS_PREPEND +
									ConfigurationAPI._SCRATCH_ALIAS &&
									version == ConfigurationAPI._SCRATCH_VERSION)) 
					{
						cfgVersionStr += existingVersion + ",";
						str += " " + existingVersion; continue;
					}
					str += " ";
					str += "<a href='#' onclick='javascript:changeMemberVersionForConfigGroup(\"" +
							groupName + "\",\"" + groupKey + "\",\"" + configName + "\"," + 
							"\"" + existingVersion + "\"";
					str += "); return false;' " +
							"title='Select v" + existingVersion + " of table &apos;" +
							configName + "&apos; to be a member of the &apos;" + groupName + "&apos; group.' " +
							">" + existingVersion;
					str += "</a>";
					cfgVersionStr += existingVersion + ",";
				}			
				str += "</label>";	
				str += "</div>";

				//add div holding existing versions for modifications
				str += "<div id='" + configName + "-versions' style='display:none'>";
				str += cfgVersionStr;
				str += "</div>";

				str += "<br>";
				str += "</td></tr>";
				
				cfgNameStr += configName + ",";							
			}
			
			str += "</table>";
					
			str += "</div>";
			
			str += "<div id='GroupMember-names' style='display:none'>";
			str += cfgNameStr;
			str += "</div>";
			

			el.innerHTML = str;
			
			//if there is a target to jump to, do it
			if(anchorTarget && anchorTarget != "")
			{
				Debug.log("anchorTarget = " + anchorTarget);
				jump(anchorTarget);
			}
		}
		
		//specificConfigRequestHandler
		function specificConfigRequestHandler(req, backLinkStr) {	

			_tableViewBackLinkStr = backLinkStr;
			
			var showSaveButtons = false;
			
			var err = DesktopContent.getXMLValue(req,"Error");
			if(err) 
			{
				Debug.log(err,Debug.HIGH_PRIORITY);
				
				Debug.log("There were errors loading this version.\n\n(You may want to try loading this version again " +
						"to see what was partially loaded into the cache before failure. " +
						"If you think, the failure is due to a column name change, " +
						"you can also try to Copy the failing view to the new column names using the " +
						"'Copy and Move' functionality.) " +
						"\n\nPlease see the detailed Errors below:",Debug.HIGH_PRIORITY);

				showSaveButtons = true; //allow user to try to save and have server fix
				
				//try to power through
			}
			
			var warns = DesktopContent.getXMLValue(req,"TableWarnings");
			if(warns)
			{
				Debug.log("There were warnings found when loading this table " +
						"(you can treat them as informational):\n\n" +
						warns,Debug.WARN_PRIORITY);
				
				showSaveButtons = true; //allow user to try to save and have server fix
			}
						
			activateSystemConfigHandler(req); //display active config groups
			
			var configName = DesktopContent.getXMLValue(req,"ConfigurationName");
			var version = DesktopContent.getXMLValue(req,"ConfigurationVersion");
									
			var existingNames = req.responseXML.getElementsByTagName("ExistingConfigurationNames");	
			_tableLinkDropdownChoices = [];
			for(var i=0;i<existingNames.length;++i)
				_tableLinkDropdownChoices.push(existingNames[i].getAttribute("value"));
			
			Debug.log("_tableLinkDropdownChoices " + _tableLinkDropdownChoices.length);
			
			var kocVersionHdr = req.responseXML.getElementsByTagName("ConfigurationVersions");
			if(!kocVersionHdr.length)
			{	//should never happen (tag can be empty, but must be there)
				Debug.log("Error?! No tag for versions returned for configName: " + configName, Debug.HIGH_PRIORITY);
				return;
			}
			var configVersions = kocVersionHdr[0].getElementsByTagName("Version");
			
			var xmlRows = req.responseXML.getElementsByTagName("CurrentVersionRows");
			if(!xmlRows.length)
			{
				var el;
				if(_displayTargetEl)
					el = _displayTargetEl;
				else
					el = document.getElementById("display");
				var str = el.innerHTML;
				str += "<br><br>";
				str += "The column names failed to load!<br>" +
						"Go to the 'Table Editor' to check on the validity of the table '" + configName + "'...";
				el.innerHTML = str;
				return;
			}
			var rows = req.responseXML.getElementsByTagName("CurrentVersionRows")[0].getElementsByTagName("Row");
			
			var colHdrs = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnHeader");
			var colTypes = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnType");
			var colDataTypes = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnDataType");
			var colChoices = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnChoices");
			
			//fill fixed choice structure
			_tableFixedChoiceData = {};
			var fixedChoiceArr;
			for(var i=0;i<colChoices.length;++i)
			{
				fixedChoiceArr = colChoices[i].getElementsByTagName("ColumnChoice");
				if(fixedChoiceArr.length)
				{
					_tableFixedChoiceData[i] = [];
					for(var j=0;j<fixedChoiceArr.length;++j)
						_tableFixedChoiceData[i].push(fixedChoiceArr[j].getAttribute("value"));
				}
			}
			
			_tableDefaultRowValues = [];
			var defaultRowValues = req.responseXML.getElementsByTagName("DefaultRowValue");
			for(var i=0;i<defaultRowValues.length;++i)
				_tableDefaultRowValues.push(defaultRowValues[i].getAttribute("value"));
			
			//reset globals
			
			if(_currentConfigName != configName) //clear  cached comment
				_cachedTableComment = "";
			_currentConfigName = configName;
			_version = version;
			_editingCell = false;
			_editingCellEl = 0;
			_versionIsChanged = false;
			_dataOffset = rows.length?(rows[0].getAttribute("value") | 0):0;

			var str = "";			
			
			_associatedGroupName = "";
			_associatedGroupKey = -1;

			if(backLinkStr && backLinkStr != "")
			{
				//Note: be careful with the source of backLinkStr.. don't use both quote styles!
				if(backLinkStr.indexOf("'") >= 0)
					backLinkStr = backLinkStr.replace(/'/g, "\\\"");
				else
					backLinkStr = backLinkStr.replace(/"/g, "\\\"");
				Debug.log("Back-link = " + backLinkStr);

				str += "<a href='#' onclick='javascript:evaluateJS(\"" + backLinkStr + "\"); return false;'>Back</a>";
				str += "&nbsp;&nbsp;&nbsp;&nbsp;";
				
				var backLinkStrSplit = backLinkStr.split('"');
				
				if(backLinkStr.indexOf("setupTableViewMode") < 0 && 
						backLinkStrSplit.length > 3)
				{
					_associatedGroupName = backLinkStrSplit[1].split('\\')[0];
					_associatedGroupKey = backLinkStrSplit[3].split('\\')[0];
				}
			}
			else backLinkStr = "";

			var refreshLinkStr = "setupSpecificConfig(\"" + 
					configName + "\",\"" +
					version + "\",\"" + backLinkStr + "\");"; 
			str += "<a href='#' onclick='javascript:" + refreshLinkStr + 
					"; return false;'>Refresh</a>";

			{
				//clear cached versions
				var clearLinkStr = "popUpClearVersionsPrompt(0,\"" + 
						backLinkStr + "\");"; 
				str += "&nbsp;&nbsp;&nbsp;&nbsp;";
				str += "<a href='#' onclick='javascript:" + clearLinkStr + 
						"; return false;'>Clear Cache</a>";
			}

			{
				//clear temporary versions
				var clearLinkStr = "popUpClearVersionsPrompt(1,\"" + 
						backLinkStr + "\");"; 
				str += "&nbsp;&nbsp;&nbsp;&nbsp;";
				str += "<a href='#' onclick='javascript:" + clearLinkStr + 
						"; return false;'>Clear Temporary Versions</a>";
			}

			
			
			str += "<br><br>";
			
			

			//display edit menu
			str +=
					"<div class='tableView-Menu' onmousedown='createEditTableMenu(event);' title='Edit Menu'>" +
					"<div class='gotoNavDiv'></div>" +
					"</div>"; //end context menu link div
			
			//display config name and version
			str += "<div style='float:left;'>";
			str += "<b>" + configName + "</b> (version: " + (version==-1?_MOCKUP_VIEW_NAME:
					(version == ConfigurationAPI._SCRATCH_VERSION?_SCRATCH_VIEW_NAME:version)) + ")";	
			str += "</div>";
						
			//add link for wiz to default
			if(version != -1)
			{
				str += "<div style='float:left;margin: 3px 0 0 15px;'>";
				str +=  "<a href='#' onclick='javascript:setVersionAliasInActiveBackbone(\"Default\",\"" + 
						configName + "\",\"" + 
						version + "\"); return false;' title='Make '" + configName + "' version " + version + 
						" the 'Default' table version " + 
						" by automatically setting up the 'Default' alias " + 
						"in the active Backbone group.'" +
						">";	
				str += "Wiz-to-Default";
				str += "</a>";
				str += "</div>";

				str += "<div style='float:left;margin: 3px 0 0 15px;'>";
				str +=  "<a href='#' onclick='javascript:popUpVersionAliasForm(); return false;' "+
						"title='Assign an Alias you specify to '" + configName + 
						"' version " + version +					
						" by automatically modifying the active Backbone group.'" +
						">";	
				str += "Wiz-to-Other-Alias";
				str += "</a>";
				str += "</div>";
			}

			
			str += "<div id='clearDiv'></div>";
			
			str += "All versions:";
			
			//display mockup link (mockup always present)
			str += " ";
			if(-1 != version)				
				str +=  "<a href='#' onclick='javascript:setupSpecificConfig(\"" + configName +
					"\",\"" + "-1" + "\", \"" + backLinkStr + "\"); return false;'>";
			str += _MOCKUP_VIEW_NAME;
			if(-1 != version)				
				str +=  "</a>";				
			
			//display all other version links
			{
				var configVersion;
				for(var j=0;j<configVersions.length;++j)
				{
					configVersion = configVersions[j].getAttribute("value")
					str += " ";
					if(configVersion != version)
						str +=  "<a href='#' onclick='javascript:setupSpecificConfig(\"" + configName +
							"\",\"" + configVersion + 
							"\", \"" + backLinkStr + "\"); return false;'>";
					str += ((configVersion|0) == ConfigurationAPI._SCRATCH_VERSION?_SCRATCH_VIEW_NAME:configVersion);
					if(configVersion != version)
						str += "</a>";
				}
			}
			
			str += "<div id='clearDiv'></div>";						
			str += "<div id='findAndReplace'></div>";
			str += "<div id='copyAndMoveRows'></div>";
			
			//create table details
			str += "<div id='tableDetails' style='display:none'>Table Details:";
			var tableComment = DesktopContent.getXMLValue(req,"TableComment");
			if(version[0] != '-') //only cache permanent table comments
				_cachedTableComment = tableComment;
			var tableAuthor = DesktopContent.getXMLValue(req,"TableAuthor");
			var tableCreationTime = DesktopContent.getXMLValue(req,"TableCreationTime");
			var tableLastAccessTime = DesktopContent.getXMLValue(req,"TableLastAccessTime");
			var tableDescription = DesktopContent.getXMLValue(req,"ConfigurationDescription");

			//if there is a description show tooltip
			if(tableDescription != "" && 
					tableDescription.toUpperCase().indexOf("NO DESCRIPTION") != 0)
				DesktopContent.tooltip(configName +" Table Description",
					"The table description may be useful in determining how to use this " +
					"table or the meaning of the column fields. Here is the description for " +
					"the '" + configName + "' table:<br><br>" +
					"<div style='margin-left:20px'>" +
					tableDescription + "</div>");
			
					
			//convert linux time to Date
			tableCreationTime = ConfigurationAPI.getDateString(new Date((tableCreationTime|0)*1000)); 
			tableLastAccessTime = ConfigurationAPI.getDateString(new Date((tableLastAccessTime|0)*1000)); 
			
			str += "<table border='0' style='" +
					"border: 1px solid #9c5e5e;" +
					"margin: 5px 0 5px 30px;" +
					"background-color: #d2c1c1;" +
					"'>";
			str += "<tr><th>Author:</th><td class='underlineRow'>" + tableAuthor + "</td></tr>";
			str += "<tr><th>Created:</th><td class='underlineRow'>" + tableCreationTime + "</td></tr>";
			str += "<tr><th>Last Load:</th><td class='underlineRow'>" + tableLastAccessTime + "</td></tr>";
			str += "<tr><th>Comment:</th><td class='underlineRow'>" + 
					tableComment.replace(/\n/g , "<br>") + "</td></tr>";
			str += "<tr><th>Description:</th><td>";

			str += "<label id='tableDescriptionText-Show' style='display:block'>";
			str += "<a href='#' onclick='document.getElementById(\"tableDescriptionText\").style.display = \"block\"; document.getElementById(\"tableDescriptionText-Show\").style.display = \"none\";'>" +
					"show</a>";
			str += "</label>";			
			str += "<label id='tableDescriptionText' style='display:none'>";
			str += "<a href='#' onclick='document.getElementById(\"tableDescriptionText\").style.display = \"none\"; document.getElementById(\"tableDescriptionText-Show\").style.display = \"block\";'>" +
					"hide</a><br>" +					
					Debug.errorPopConditionString(DesktopContent.tooltipConditionString(tableDescription)) + 
					"</label>";			
			str += "</td></tr>";	
			
			str += "</table>"
			str += "</div>";
			
			str += "<div id='clearDiv'></div>";
			
			//four corners for last +/- (w & w/o transpose)
			str += "<table><tr><td>";
			//display table
			str += "<table id='SubSystemTable' border='1' cellspacing='5' cellpadding='1'>";
			
			
			//create structure for call to createTableViewOutputStr
			{
				var colIsBoolArray 	= [];				
				var cols = [];
				var typeDivStr;
				
				//add types (first column is for row numbers)
				//	and fill colIsBoolArray
				{
					var boolTypes 		= ["OnOff","TrueFalse","YesNo"];
					var colType,colDataType,isStatusType;
					
					cols.push([]);
					//init pre-data columns
					for(var c=0;c<_CONFIG_DATA_COL_OFFSET;++c)
					{
						cols[cols.length-1].push("");
						colIsBoolArray.push(false);	
					}
					for(var c=0;c<colHdrs.length;++c)
					{
						colType = colTypes[c].getAttribute("value");
						colDataType = colDataTypes[c].getAttribute("value");
						
						typeDivStr = "";
						typeDivStr += "<div style='font-size:12px' title='";		
						typeDivStr += colType;
						typeDivStr += " &#60;" + colDataType + "&#62;";
						typeDivStr += "'>";
						typeDivStr += colType;
						typeDivStr += "<br>&#60;" + colDataType + "&#62;";
						typeDivStr += "</div>";		
	
						cols[cols.length-1].push(typeDivStr);	
						
						isStatusType = false;
						for(var i=0;i<boolTypes.length;++i)
							if(boolTypes[i] == 
									colType)
							{
								isStatusType = true; break;
							}
						colIsBoolArray.push(isStatusType);
					}
				}
					
				//add headers (first column is for row numbers)
				cols.push([]);
				//init pre-data columns
				for(var c=0;c<_CONFIG_DATA_COL_OFFSET;++c)
					cols[cols.length-1].push("");	
				for(var c=0;c<colHdrs.length;++c)
					cols[cols.length-1].push(colHdrs[c].getAttribute("value"));
				
				//add data
				{
					var rowEntries;
					for(var r=0;r<rows.length;++r)
					{
						rowEntries = rows[r].getElementsByTagName("Entry");	

						cols.push([]);
						for(var c=0;c<_CONFIG_DATA_COL_OFFSET;++c)
							cols[cols.length-1].push("");	
						
						for(var c=0;c<colHdrs.length;++c)
							cols[cols.length-1].push(rowEntries[c].getAttribute("value"));
					}
				}
				
				var transposeOutput = false;
				var colsIsArray = true;	
				if(_tableViewIsTransposed) //check if need to transpose view
				{
					//invert so it can be inverted again in transposeTableView()
					_tableViewIsTransposed = !_tableViewIsTransposed; 
					transposeOutput = true;			
					str += createTableViewOutputStr(cols,colIsBoolArray,transposeOutput,colsIsArray);
					_tableViewIsTransposed = !_tableViewIsTransposed; 
				}
				else
					str += createTableViewOutputStr(cols,colIsBoolArray,transposeOutput,colsIsArray);
			}
				
			str += "</table>";
			
			str += "</td><td valign='top'>"; //four corners continued

			//add + row controls for new last row
			str += " <a id='lastAddRowLink1' style='display:none' href='#' onclick='javascript:addRow(" + r + "); return false;'>";
			str += "+";
			str += "</a>";
			
			str += "</td></tr>"; //four corners continued
			str += "<tr><td valign='top'>"; //four corners continued
			
			//add + row controls for new last row
			str += " <a id='lastAddRowLink0' href='#' onclick='javascript:addRow(" + r + "); return false;'>";
			str += "+";
			str += "</a>";
			
			str += "</td><td></td></tr></table>"; //four corners ended
			

			var el;
			if(_displayTargetEl)
				el = _displayTargetEl;
			else
				el = document.getElementById("display");
			
			el.innerHTML = str;
			
			if(isTemporary(version)) //if temporary
			{
				//show save button
				var dispStr = el.innerHTML;
				str = "";
				str += "<div id='config-firstSaveButton'>";
				str += "<input type='button' onmouseup='popUpSaveNewTableForm()' value='Save Changes as New Version' title='" +
					"Save the current table view as a new persistent version." +
					"'/>";
				str += "</div><br>";
				
				var i = dispStr.indexOf("<div class=\"tableView-Menu\"");
				
				el.innerHTML = dispStr.substr(0,i) + str + 
						dispStr.substr(i) + "<br>" + str;
			}
			else if(showSaveButtons)
				versionHasChanged();
						
			toggleTableDetails(_showTableDetails);
		}
		
		//toggleTableDetails ~~
		function toggleTableDetails(setVal)
		{
			if(setVal !== undefined)
				_showTableDetails = setVal;
			else	
				_showTableDetails = !_showTableDetails; //invert

			Debug.log("toggleTableDetails " + _showTableDetails);
			var el = document.getElementById("tableDetails");
			el.style.display = _showTableDetails?"block":"none";
		}
		
		//toggleGroupDetails ~~
		function toggleGroupDetails(setVal)
		{
			if(setVal !== undefined)
				_showGroupDetails = setVal;
			else	
				_showGroupDetails = !_showGroupDetails; //invert

			Debug.log("showGroupDetails " + _showGroupDetails);
			var el = document.getElementById("groupDetails");
			el.style.display = _showGroupDetails?"block":"none";
		}
		
		//setVersionAliasInActiveBackbone ~~
		//	Used to setup a table-alias.
		//	It will activate the resuling backbone and call a done handler
		function setVersionAliasInActiveBackbone(versionAlias,configName,version,
				newBackboneNameAdd,doneHandler,doReturnParams)
		{			
			Debug.log("setVersionAliasInActiveBackbone versionAlias " + versionAlias);
			Debug.log("setVersionAliasInActiveBackbone configName " + configName);
			Debug.log("setVersionAliasInActiveBackbone version " + version);

			if(!configName || configName == "" || !version || version == "")
			{
				Debug.log("Process interrupted. Invalid group name and key given!",Debug.HIGH_PRIORITY);				
				return;
			}
			
			if(!newBackboneNameAdd || newBackboneNameAdd == "")
				newBackboneNameAdd = "Wiz";
			newBackboneNameAdd += "Backbone";
			Debug.log("setVersionAliasInActiveBackbone newBackboneNameAdd=" + newBackboneNameAdd);
			
			DesktopContent.XMLHttpRequest("Request?RequestType=setVersionAliasInActiveBackbone" +
					"&versionAlias=" + versionAlias +
					"&configName=" + configName + 
					"&version=" + version, "", 
					ConfigurationAPI.newWizBackboneMemberHandler,
					[("VersionAlias" + newBackboneNameAdd),doneHandler,doReturnParams],
					0,0,true  //progressHandler, callHandlerOnErr, showLoadingOverlay
					);
		}
		
		//isTemporary
		function isTemporary(version)
		{
			return version < -1;
		}
		
		//treeViewHandler ~		
		function treeViewHandler(req,parentId) 
		{				
			var err = DesktopContent.getXMLValue(req,"Error");
			if(err) 
			{
				Debug.log("If you do not understand the error, try refreshing the tree from the '>>' menu in the top left of the page",Debug.HIGH_PRIORITY);
				Debug.log(err,Debug.HIGH_PRIORITY);				
				return;
			}
			
			var warn = DesktopContent.getXMLValue(req,"Warning");
			if(warn) 
			{
				Debug.log("If you had made changes to this tree, they may have been lost.",Debug.WARN_PRIORITY);
				Debug.log(warn,Debug.WARN_PRIORITY);	
			}
			
			//removed this because it should be controlled by the handlers properly
			//editCellCancel();
			
			//draw tree		
			
			var configGroupName = DesktopContent.getXMLValue(req,"configGroup");
			var configGroupKey = DesktopContent.getXMLValue(req,"configGroupKey");			
			
			if(!parentId && 
					treeViewHandlerStr_ && treeViewHandlerStr_ != "" &&
					treeGroupName_ == configGroupName &&
							treeGroupKey_ == configGroupKey)
			{
				Debug.log("Re-using tree handler string that we already have!");
				var el = document.getElementById("display");
				el.innerHTML = treeViewHandlerStr_;
				
				if(treeHasChanged_) //if tree was changed before, trick into showing buttons again
				{
					treeHasChanged_ = false;
					treeHasChanged();
				}
				
				
				//setup back link string properly for menu generation
				if(treeViewBackLinkStr_ && treeViewBackLinkStr_ != "")
				{
					//Note: be careful with the source of treeViewBackLinkStr_.. don't use both quote styles!
					if(treeViewBackLinkStr_.indexOf("'") >= 0)
						treeViewBackLinkStr_ = treeViewBackLinkStr_.replace(/'/g, "\\\"");
					else
						treeViewBackLinkStr_ = treeViewBackLinkStr_.replace(/"/g, "\\\"");
					Debug.log("Back-link = " + treeViewBackLinkStr_);
				}
				
				
				//fix root group name/key links just in case
				//	(this avoids errors in manipulating treeViewHandlerStr_ and re-acquiring the tree string)
				{
					var rootGroupEl = document.getElementById("treeView-ConfigGroupLink");
					Debug.log("Modifying root group key " + treeGroupKey_);
					var str = "";
					str += "<div style='display:none'>" + treeGroupName_ + "</div>";
					str += "<div style='display:none'>" + treeGroupKey_ + "</div>";
					str += treeGroupName_ + " (" + treeGroupKey_ + ")";
					rootGroupEl.innerHTML = str;
					rootGroupEl.onclick = function() {

						var backLinkStr = "setupConfigGroupTreeView(\"" + 
								treeGroupName_ + "\",\"" +
								treeGroupKey_ + "\");";
						setupSpecificConfigGroup(treeGroupName_,treeGroupKey_,
								backLinkStr);
						return false;
					};

					//modify the activate link
					rootGroupEl = document.getElementById("treeView-ConfigGroupActivateLink");
					rootGroupEl.onclick = function() {
						activateSystemConfig(treeGroupName_,treeGroupKey_);
						return false;
					};
				}
				
				return;
			}
			else
				treeViewHandlerStr_ = "";
			
			
			var treeErr = DesktopContent.getXMLValue(req,"TreeErrors");
			if(treeErr) 
			{
				Debug.log("There were errors detected when attempting to verify the group '" +
						configGroupName + " (" + configGroupKey + ")'. " + 
						"Please see the detailed report below:\n\n" + treeErr,Debug.WARN_PRIORITY);
			}
						
			treeGroupName_ = configGroupName;
			treeGroupKey_ = configGroupKey;
			
			var activeTableNames = req.responseXML.getElementsByTagName("ActiveTableName");
			var activeTableVersions = req.responseXML.getElementsByTagName("ActiveTableVersion");
			var activeTableComments = req.responseXML.getElementsByTagName("ActiveTableComment");
			treeMemberNames_ = [];
			treeMemberVersions_ = [];
			treeMemberComments_ = [];
			
			_tableLinkDropdownChoices = [];			
			_tableLinkDropdownChoices.push(DesktopContent.getXMLValue(req,"DefaultNoLink"));
			for(var i=0;i<activeTableNames.length;++i)
			{
				treeMemberNames_.push(activeTableNames[i].getAttribute("value"));
				_tableLinkDropdownChoices.push(treeMemberNames_[i]);
				treeMemberVersions_.push(activeTableVersions[i].getAttribute("value"));		
				treeMemberComments_.push(activeTableComments[i].getAttribute("value"));				
			}
			
			var el;
			var depth;			
			
			if(parentId) //this is an expansion
			{
				depth = (parentId.split("-")[0] | 0)+1; //parent depth + 1
				
				//target is children area				
				el = document.getElementById("treeNode-ChildrenOf-" + parentId);
				el.style.display = "block"; //make sure it is shown

				//change toggle to "-"
				var toggleEl = document.getElementById("treeNode-toggle-" + parentId);
				toggleEl.style.backgroundImage = 
						"url(/WebPath/images/windowContentImages/ConfigurationGUI-hideTree.png)";
				
				//if disconnected link remove "DISCONNECTED"
				var valEl = document.getElementById("treeNode-Value-" + parentId);
				var valElText= valEl.textContent;
				var i;
				if((i = valElText.indexOf(")-DISCONNECTED")) > 0)
				{
					var testStillDisconnected = DesktopContent.getXMLValue(req,"DisconnectedStartNode");
					if(testStillDisconnected && testStillDisconnected == "1")
					{
						Debug.log("Still disconnected.");
					}
					else
					{					
						//only remove disconnected indicator if really 
						valEl.innerHTML = "";
						valEl.appendChild(document.createTextNode(valElText.substr(0,i+1)));
					}
				}				
			}
			else //this is the initial top level request
			{
				//reset globals
				_editingCell = false;
				_editingCellEl = 0;
				treeHasChanged_ = false;

				depth = 0;
				treeNodeUID_ = 0; //reset node id
				el = document.getElementById("display");
				
				//add back link				
				if(treeViewBackLinkStr_ && treeViewBackLinkStr_ != "")
				{
					//setup back link string properly
					//Note: be careful with the source of treeViewBackLinkStr_.. don't use both quote styles!
					if(treeViewBackLinkStr_.indexOf("'") >= 0)
						treeViewBackLinkStr_ = treeViewBackLinkStr_.replace(/'/g, "\\\"");
					else
						treeViewBackLinkStr_ = treeViewBackLinkStr_.replace(/"/g, "\\\"");
					Debug.log("Back-link = " + treeViewBackLinkStr_);

					treeViewHandlerStr_ += "<a href='#' onclick='javascript:evaluateJS(\"" + treeViewBackLinkStr_ + 
							"\"); return false;'>Back</a>";
					treeViewHandlerStr_ += "&nbsp;&nbsp;&nbsp;&nbsp;";
				}				

				//				var refreshLinkStr = "treeViewHandlerStr_=\"\"; setupConfigGroupTreeView(\"" + 
				//						treeGroupName_ + "\",\"" +
				//						treeGroupKey_ + "\",\"" + treeViewBackLinkStr_ + "\");"; 
				//				treeViewHandlerStr_ += "<a href='#' onclick='javascript:" + refreshLinkStr + 
				//						"; return false;'>Refresh</a>";	
				//treeViewHandlerStr_ += "&nbsp;&nbsp;&nbsp;&nbsp;";
				
				treeViewHandlerStr_ += "<a href='#' onclick='javascript:expandTreeChildrenDepth(); return false;' " + 
						"title='Expand all children at deepest depth; " +
						"if no nodes are expanded, then expand XDAQContextConfiguration preferentially.\n\n" +
						"(Hot-keys: + , &gt; , } , A , E )" +
						"\nNote: hot-keys will target the highlighted node.'" +
						">+ All Children</a>";
				
				treeViewHandlerStr_ += "&nbsp;&nbsp;&nbsp;&nbsp;";
				treeViewHandlerStr_ += "<a href='#' onclick='javascript:hideTreeChildrenDepth(); return false;'" + 
						"title='Hide all children at deepest depth.\n\n" +
						"(Hot-keys: - , &lt; , { , Z , M )" +
						"\nNote: hot keys will target the highlighted node.'" +
						">- All Children</a>";
				
				
				//				treeViewHandlerStr_ += "&nbsp;&nbsp;&nbsp;&nbsp;";
				//				treeViewHandlerStr_ += "<a href='#' onclick='" +
				//						"treeViewHideStatus_ = !treeViewHideStatus_;" +
				//						refreshLinkStr +
				//						"; return false;' title='' " +
				//						">" + (treeViewHideStatus_?"Show":"Hide") + " Status=False</a>";				
				//				

				//display edit menu
				treeViewHandlerStr_ +=
						"<div class='tableView-Menu' onmousedown='createTreeViewMenu(event);' " +
						"title='Edit Menu'>" +
						"<div class='gotoNavDiv'></div>" +
						"</div>"; //end context menu link div
				
				//create group details
				{
					var groupComment = DesktopContent.getXMLValue(req,"configGroupComment");	
					groupComment = decodeURIComponent(groupComment);		
					var groupAuthor = DesktopContent.getXMLValue(req,"configGroupAuthor");
					var groupCreationTime = DesktopContent.getXMLValue(req,"configGroupCreationTime");
					groupCreationTime = ConfigurationAPI.getDateString(new Date((groupCreationTime|0)*1000));

					treeViewHandlerStr_ += "<div id='clearDiv'></div>";
					treeViewHandlerStr_ += "<div id='groupDetails' style='display:block'>" +
							"Root-Group Details:";					
					treeViewHandlerStr_ += "<table border='0' style='" +
							"border: 1px solid #9c5e5e;" +
							"margin: 5px 0 5px 30px;" +
							"background-color: #d2c1c1;" +
							"'>";
					treeViewHandlerStr_ += "<tr><th>Author:</th><td class='underlineRow'>" + groupAuthor + "</td></tr>";
					treeViewHandlerStr_ += "<tr><th>Created:</th><td class='underlineRow'>" + groupCreationTime + "</td></tr>";				
					treeViewHandlerStr_ += "<tr><th>Comment:</th><td>" + 
							groupComment.replace(/\n/g , "<br>") + "</td></tr>";
					treeViewHandlerStr_ += "</table>";
					treeViewHandlerStr_ += "</div>";

					treeViewHandlerStr_ += "<div id='clearDiv' style='height:15px'></div>";
				}
				

				if(treeErr) 
				{
					treeViewHandlerStr_ += "<div style='color:red; cursor:pointer' title='" + 
							//treeErr.replace(/'/g , "&apos;") + "' ";
							"Click to view errors' ";
					treeViewHandlerStr_ += "onmouseup='" +
							"var el = document.getElementById(\"treeViewErrors\"); el.style.display = " +
							"el.style.display == \"none\"?\"block\":\"none\"" +
							"'>";
					treeViewHandlerStr_ += "<u>Warning: Errors were detected in this tree!</u>";
					treeViewHandlerStr_ += "</div>";
					treeViewHandlerStr_ += "<div id='treeViewErrors' style='display:none'>" + 
							treeErr.replace(/\n/g , "<br>") + "</div>";
					treeViewHandlerStr_ += "<div id='clearDiv' style='margin-bottom:10px'></div>";	
				}
				
				var backLinkStr = "setupConfigGroupTreeView(\\\"" + 
										treeGroupName_ + "\\\",\\\"" +
										treeGroupKey_ + "\\\");"; 
				
				//add config group header
				treeViewHandlerStr_ += "<a id='treeView-ConfigGroupLink' " +
					"href='#' onclick='javascript:setupSpecificConfigGroup(\"" + configGroupName +
					"\",\"" + configGroupKey + "\",\"" + backLinkStr + "\"); return false;'>";
				treeViewHandlerStr_ += "<div style='display:none'>" + configGroupName + "</div>";
				treeViewHandlerStr_ += "<div style='display:none'>" + configGroupKey + "</div>";
				treeViewHandlerStr_ += configGroupName + " (" + configGroupKey + ")";
				treeViewHandlerStr_ += "</a>";

				treeViewHandlerStr_ += "&nbsp;&nbsp;&nbsp;";
				
				//add Activate link
				treeViewHandlerStr_ += " <a id='treeView-ConfigGroupActivateLink' " +
						"href='#' onclick='javascript:activateSystemConfig(\"" + configGroupName +
						"\",\"" + configGroupKey + "\"); return false;'>";
				treeViewHandlerStr_ += "Activate</a>";
				
				treeViewHandlerStr_ += "<div id='clearDiv' style='margin-bottom:10px'></div>";	
				
				//preload hide image
				treeViewHandlerStr_ += "<img style='display:none' src='" + 
						"/WebPath/images/windowContentImages/ConfigurationGUI-hideTree.png" +"'>";
			}			
			
			//add tree
			var tree = DesktopContent.getXMLNode(req,"tree");
			var preLength = treeViewHandlerStr_.length;
			recursiveDrawTree(tree,depth,tree.getAttribute("value"),parentId);
			if(preLength == treeViewHandlerStr_.length) //no children found 	
			{
				//treat this as an empty value node!
				
				//////////=======================
				treeViewHandlerStr_ += 
						"<div class='treeNode'> " +
						"<div class='treeNode-Connection'></div>" +
						"<div class='treeNode-Value'>";

				treeViewHandlerStr_ += "<label style='color:rgb(212, 0, 0)'>";
				treeViewHandlerStr_ += "No Children Nodes Found.";
				treeViewHandlerStr_ += "</label>";

				treeViewHandlerStr_ += "</div>" + //end treeNode Value div		
						"</div>" + //end treeNode div							
						"<div id='clearDiv'></div>";  
				//////////=======================
			}
			
			el.innerHTML = treeViewHandlerStr_;
			
			//save the full string for posterity (and for back links)
			treeViewHandlerStr_ = document.getElementById("display").innerHTML;
			
			applyTreeFilter("",1); //reapplyFilter
			toggleGroupDetails(_showGroupDetails);
		}

		//recursiveDrawTree ~		
		function recursiveDrawTree(parent,depth,path,parentIdString) 
		{				
			document.getElementById("display").style.width = (30*depth + 740) + "px";
			document.getElementById("tempTree").style.width = (30*depth + 740) + "px";

			var uid;
			var nodes = parent.children;
			var nodeName;
			var value, valueType;
			var tableLinkName, childLinkIndex, linkIdType, linkId;
			var i,j;
			var childrenLength;
			var newWindowStr;
			var backLinkStr;
			var titleStr;
			var nodeEditType, nodeEditTypeDisplay;
			var isLink,isDisconnected, isGroupLink;
			
			var pathHTML = path;
			//make path html safe
			pathHTML = pathHTML.replace(/</g, "&lt");
			pathHTML = pathHTML.replace(/>/g, "&gt");				
					
			for(i=0;i<nodes.length;++i)
			{
				uid = treeNodeUID_++;
				nodeName = nodes[i].getAttribute("value");

				//make nodeName html safe
				nodeName = nodeName.replace(/</g, "&lt");
				nodeName = nodeName.replace(/>/g, "&gt");
				
				//Debug.log("nodeName= " + nodeName + " depth=" + depth + " uid=" + uid);
								
				childrenLength = nodes[i].children.length;
				//Debug.log("child's childrenLength=" + childrenLength);
									
				//handle value nodes
				if(childrenLength && (value = nodes[i].children[0]).nodeName == "value"
						)//&& (valueType = nodes[i].children[1]).nodeName != "Disconnected")
				{	
					value = value.getAttribute("value");
					valueType =  nodes[i].children[1].getAttribute("value"); //dataType
					
					//make value html safe
					value = value.replace(/</g, "&lt");
					value = value.replace(/>/g, "&gt");
					
					//this is a value node!	
					//////////=======================
					treeViewHandlerStr_ += 
							"<div class='treeNode' id='treeNode-" +
							( depth + "-" + uid ) + "' >" +
							"<div class='treeNode-Path' style='display:none' id='treeNode-path-" +
							( depth + "-" + uid ) + "'>" + // end path id
							pathHTML + //save path for future use.. and a central place to edit when changes occur
							"</div>" +
							"<div class='treeNode-ParentId' style='display:none' id='treeNode-ParentId-" +
							( depth + "-" + uid ) + "'>" + 
							parentIdString + //save parentId for future use navigating up tree
							"</div>" +
							"<div class='treeNode-Connection'></div>";																	
					
					if(valueType == "FixedChoiceData")
					{
						//add CSV choices div
						treeViewHandlerStr_ += 
								"<div class='treeNode-FixedChoice-CSV' style='display:none' " + 
								"id='treeNode-FixedChoice-CSV-" +
								( depth + "-" + uid ) + "'>";
						
						var choices = nodes[i].children[1].children; //xml elements
						for(var j=0;j<choices.length;++j)
						{
							if(j) treeViewHandlerStr_ += ",";
							treeViewHandlerStr_ += choices[j].getAttribute("value");
						}
						treeViewHandlerStr_ += "</div>";
					}
					
					//normal value node and edit icon
					{
						//start value node
						treeViewHandlerStr_ += 
								"<div class='treeNode-Value treeNode-ValueType-" + valueType +
								"' " +
								"id='treeNode-Value-" +
								(depth + "-" + uid) + "' " +

								"onclick='handleTreeNodeClick(" +							
								depth + "," + uid + "," + 	
								"0,\"value\")' " +

								"onmousemove='handleTreeNodeMouseMove(" +							
								depth + "," + uid + "," + 	
								"event)' " +

								">";	

						titleStr = "~ Leaf Value Node ~\n";
						titleStr +=	"Path: \t" + path + nodeName + "\n";
						
						//left side of value
						treeViewHandlerStr_ += 
								"<div style='float:left' title='" + titleStr + "'>" +
								"<b class='treeNode-Value-leafNode-fieldName bold-header'>" + 
								nodeName + "</b>" + 
								"</div><div style='float:left'>&nbsp;:</div>";
						
						//normal edit icon
						treeViewHandlerStr_ += 
								"<div class='treeNode-Value-editIcon' id='treeNode-Value-editIcon-" +
								(depth + "-" + uid) + "' " +
								"onclick='handleTreeNodeClick(" +							 
								depth + "," + uid + "," + 	
								"1,\"value\"); event.stopPropagation();' " +
								"title='Edit the value of this node.' " +
								"></div>";						
					}
							
					treeViewHandlerStr_ += "<div style='float:left; margin-left:9px;' id='treeNode-Value-leafNode-" +
							(depth + "-" + uid) +			
							"' class='" +
							"treeNode-Value-leafNode-ColumnName-" + nodeName +
							"' " +
							">";
										
					if(valueType == "OnOff" || 
							valueType == "YesNo" || 
							valueType == "TrueFalse")
					{
						//colorize true false														
						treeViewHandlerStr_ += "<div style='float:left'>";										
						treeViewHandlerStr_ += value;											
						treeViewHandlerStr_ += "</div>";
						
						var color = (value == "On" || value == "Yes" || value == "True")?
								"rgb(16, 204, 16)":"rgb(255, 0, 0);";
						treeViewHandlerStr_ += "<div style='width:10px;height:10px;" +
								"background-color:" + color + ";" +
							    "float: left;" +
							    "border-radius: 7px;" +
							    "border: 2px solid white;" +
							    "margin: 2px 0 0 6px;" +								
								"'></div>";								
					}
					else if(valueType == "Timestamp")				
						treeViewHandlerStr_ += ConfigurationAPI.getDateString(new Date((value|0)*1000));						
					else					
						treeViewHandlerStr_ += value;
											
							
					treeViewHandlerStr_ += 
							"</div>" + //end treeNode Value value side div
														
							"</div>" + //end treeNode Value div		
							"</div>" + //end treeNode div							
							"<div id='clearDiv'></div>";  
					//////////=======================
					
					continue; //so no need to recurse
				}
				
				//not a value node so try to recurse				

				isLink = false;
				isDisconnected = false;
				isGroupLink = false;
				tableLinkName = "";
				
				//get value and table link name for this parent
				if(childrenLength && (value = nodes[i].children[0]).nodeName != "value")
				{	
					--childrenLength; //subtract the link ID node from children length
				
					//this is a link node!	
					var offset = 0;
					if(value.getAttribute("value") == "Disconnected")
					{
						//this is a disconnected link node!
						++offset;
						value = nodes[i].children[offset]; //get link ID node
						--childrenLength;
						isGroupLink = value.nodeName == "GroupID";					
						isDisconnected = true;

					}
					
					value =  
							"<label style='color:rgb(65, 86, 146);font-weight:bold;'>" +
							nodeName.replace(/</g, "&lt").replace(/>/g, "&gt") +
							"</label>" +
							"-(" + 
							value.nodeName.replace(/</g, "&lt").replace(/>/g, "&gt") + 
							" = " + 
							value.getAttribute("value").replace(/</g, "&lt").replace(/>/g, "&gt") + 
							")";					

					if(isDisconnected)
						value += "-" + 
						"<label style='color:red;font-weight:bold;'>" +
						"DISCONNECTED" +
						"</label>";
					
					tableLinkName = nodes[i].children[offset+1].getAttribute("value"); //LinkConfigurationName node
					--childrenLength; //subtract the tableLinkName name node from children length
					childLinkIndex = nodes[i].children[offset+2].getAttribute("value"); //LinkIndex node					
					--childrenLength; //subtract the childLinkIndex node from children length
					
					isLink = true;
				}
				else
				{
					value = nodeName;
					tableLinkName = nodeName;
					
					//make value html safe
					value = value.replace(/</g, "&lt");
					value = value.replace(/>/g, "&gt");
				}

				//make tableLinkName html safe
				tableLinkName = tableLinkName.replace(/</g, "&lt");
				tableLinkName = tableLinkName.replace(/>/g, "&gt");
				

				var treeNavContextMenuItems = [];
				var treeNavContextMenuItemHandlers = [];
				var tableComment = "";
				var tableTitle = "";
				
				{
					var retVal  = getTreeViewTableStrings(tableLinkName, isLink);
					
					treeNavContextMenuItems = retVal.treeNavContextMenuItems;
					treeNavContextMenuItemHandlers = retVal.treeNavContextMenuItemHandlers;
					tableComment = retVal.tableComment;
					tableTitle = retVal.tableTitle;
				}				

				//////////=======================

				nodeEditType = ((treeNavContextMenuItemHandlers.length == 0 && !isLink)?"uid":
						(depth == 0?"table":"link"));
				nodeEditTypeDisplay = ((treeNavContextMenuItemHandlers.length == 0 && !isLink)?"UID":
						(depth == 0?"Table":"Link"));
				
				treeViewHandlerStr_ += 
						"<div class='treeNode' id='treeNode-" +
						( depth + "-" + uid ) + "' ";
								
				treeViewHandlerStr_	+= 	"onmousemove='handleTreeNodeMouseMove(" +							
					depth + "," + uid + "," + 	
					"event)' "							
					;		
				
				treeViewHandlerStr_ += ">"; //end treeNode div open
											
				treeViewHandlerStr_ += 
						"<div class='treeNode-Path' style='display:none' id='treeNode-path-" +
						( depth + "-" + uid ) + "'>" + // end path id
						pathHTML + //save path for future use.. and a central place to edit when changes occur
						"</div>" +
						"<div class='treeNode-ParentId' style='display:none' id='treeNode-ParentId-" +
						( depth + "-" + uid ) + "'>" + 
						parentIdString + //save parentId for future use navigating up tree
						"</div>" +
						"<div class='treeNode-NodeName' style='display:none' id='treeNode-nodeName-" +
						( depth + "-" + uid ) + "'>" + // end nodeName id
						nodeName + //save nodeName for future use.. and a central place to edit when changes occur
						"</div>" +
						"<div class='treeNode-Connection'></div>" +						
						"<div class='treeNode-Expander' id='treeNode-toggle-" +
						( depth + "-" + uid ) + "' " + // end expander id
						"onmouseup='toggleTreeChildren(" + 
						depth + "," +
						uid + ");' " + // end expander onmouseup
						"></div>";

				if(isLink) //if link node save table name and childLinkIndex in hidden div
				{
					treeViewHandlerStr_ += 
							"<div class='treeNode-linkTableName' style='display:none' " +
							"id='treeNode-linkTableName-" +
							( depth + "-" + uid ) + "'>" + // end path id
							tableLinkName + //save table name for future use.. and a central place to edit when changes occur
							"</div>";
					
					treeViewHandlerStr_ += 
							"<div class='treeNode-childLinkIndex' style='display:none' " +
							"id='treeNode-childLinkIndex-" +
							( depth + "-" + uid ) + "'>" + // end path id
							childLinkIndex + //save link index name for future use.. and a central place to edit when changes occur
							"</div>";	
					
					treeViewHandlerStr_ += 
							"<div class='treeNode-childLinkIdType' style='display:none' " +
							"id='treeNode-childLinkIdType-" +
							( depth + "-" + uid ) + "'>" + // end path id
							(isGroupLink?"GroupID":"UID") + //save link id type for future use.. and a central place to edit when changes occur
							"</div>";					
				}

				treeViewHandlerStr_ += "<table cellpadding='0' cellspacing='0' border='0' style='float:left;'><tr>"; //open pre/comment table row 
				if(treeNavContextMenuItemHandlers.length) //fix width if this is a config node so comments show up aligned
					treeViewHandlerStr_ += "<td><div style='width:470px'>"; //open pre-comment td and div
				else
					treeViewHandlerStr_ += "<td><div>"; //open pre-comment td and div
				
				treeViewHandlerStr_ += "<table cellpadding='0' cellspacing='0' border='0' style='float:left;'><tr><td>"; //open tree node name/link table row
				

				titleStr = 
						"~ " + nodeEditTypeDisplay + " Tree Node ~";
				if(tableTitle)
					titleStr += "\n" + tableTitle;
				if(depth > 0)
					titleStr +=	"\nPath: \t\t" + path + nodeName + "\n";
				
				treeViewHandlerStr_	+= "<div class='treeNode-Value treeNode-Value-nonLeafNode " +
						"treeNode-Value-nodeEditType-" + nodeEditType +
						"' " +
						"id='treeNode-Value-" +
						(depth + "-" + uid) + "' ";
				
				treeViewHandlerStr_	+= "onclick='handleTreeNodeClick(" +												
												depth + "," + uid + "," + 	
												"0,\"" +
												nodeEditType +
												"\")' ";
								
				treeViewHandlerStr_ += "title='" + titleStr + "' ";
				
				treeViewHandlerStr_ += ">";
				treeViewHandlerStr_ += value;
				treeViewHandlerStr_ += "</div>"; //end treeNode Value
				
				treeViewHandlerStr_ += "</td><td>";
				
				//within this TD, put editClick and link
				treeViewHandlerStr_ += "<table cellpadding='0' cellspacing='0' border='0' style='float:left;'><tr>"; //open edit/link table row
				treeViewHandlerStr_ += "<td>";
				if(nodeEditType != "table" && nodeEditType != "link") //uid edit icon
					treeViewHandlerStr_ += 
							"<div style='margin-top:-4px; float:left;'>" + //to account for not being in value node
							"<div class='treeNode-Value-editIcon' id='treeNode-Value-editIcon-" +
							(depth + "-" + uid) + "' " +
							"onclick='handleTreeNodeClick(" +							 
							depth + "," + uid + "," + 	
							"1,\"" +
							nodeEditType +
							"\"); event.stopPropagation();' " +
							"title='Edit the UID for this record (with the option to delete this record entirely).' " +
							"></div>" +
							"</div>";
				treeViewHandlerStr_ += "</td><td style='width:100px'>";

				//if there is a table link menu (or if disconnected link), add it
				if(treeNavContextMenuItemHandlers.length || isLink) 
				{
					treeViewHandlerStr_ += "<table cellpadding='0' cellspacing='0' border='0' style='float:left;'><tr>"; //open linkmenu/editicon table row
					treeViewHandlerStr_ += "<td  id='treeNode-LinkContextMenuTD-" +
							(depth + "-" + uid) + "'>";
							
					treeViewHandlerStr_ += 
						"<div class='treeNode-Link' "; //start treeNode Link div
					
					
					if(isDisconnected) //hide link if disconnected
						treeViewHandlerStr_ += "style='display:none' ";
					
					treeViewHandlerStr_ += 
						"onmousedown='" + // start link onmousedown	
						"SimpleContextMenu.createMenu(["; //open array for items
					
					//output item strings
					for(j=0;j<treeNavContextMenuItems.length;++j)
					{
						if(j)
							treeViewHandlerStr_ += ",";
						treeViewHandlerStr_ += "\"" + treeNavContextMenuItems[j] + "\"";
					}
					
					treeViewHandlerStr_ += //end items and open array for item handlers
							"]," +
							"[";
					
					for(j=0;j<treeNavContextMenuItemHandlers.length;++j)
					{
						if(j)
							treeViewHandlerStr_ += ",";
						
						//Debug.log("treeNavContextMenuItemHandlers[j]= " + treeNavContextMenuItemHandlers[j]);
						//need to escape all quotes by one more level
						treeNavContextMenuItemHandlers[j] = treeNavContextMenuItemHandlers[j].replace(/\\\"/g, "AAAAA");
						treeNavContextMenuItemHandlers[j] = treeNavContextMenuItemHandlers[j].replace(/"/g, "\\\"");
						treeNavContextMenuItemHandlers[j] = treeNavContextMenuItemHandlers[j].replace(/AAAAA/g, "\\\\\\\"");										
						//Debug.log("treeNavContextMenuItemHandlers[j]= " + treeNavContextMenuItemHandlers[j]);
						//Debug.log("this works= " + "Debug.log(\\\"hi\\\");");
						//THIS WORKS: treeViewHandlerStr_ += "\"" + "Debug.log(\\\"hi\\\");" + "\"";
						treeViewHandlerStr_ += "\"" + treeNavContextMenuItemHandlers[j] + "\"";
					}
					treeViewHandlerStr_ += "]" + //end treeNavContextMenuItemHandlers array
							",\"treeNavContextMenu\",event.pageX-1,event.pageY-1, " +
							"\"rgb(220, 187, 165)\", \"rgb(130, 51, 51)\");";					
					treeViewHandlerStr_ += 
						"' " + // end link onmousedown
						//"onmouseup='" + onmouseupJS + "' " +
						">" +	
						"<div class='gotoNavDiv'></div>" +			
						"</div>"; //end treeNode Link div
					
					treeViewHandlerStr_ += "</td><td>"; //delimit linkmenu/editicon table row
					
					if(nodeEditType == "link") //add edit icon for links
						treeViewHandlerStr_ += 
								//"<div style='margin-top:-4px; float:left;'>" + //to account for not being in value node
								"<div class='treeNode-Value-editIcon' id='treeNode-Value-editIcon-" +
								(depth + "-" + uid) + "' " +
								"onclick='handleTreeNodeClick(" +							 
								depth + "," + uid + "," + 	
								"1,\"" +
								nodeEditType +
								"\"); event.stopPropagation();' " +
								"title='Edit this link.' " + 
								"></div>";
					
					treeViewHandlerStr_ += "</td></tr></table>"; //close linkmenu/editicon table row
				}				
				
				treeViewHandlerStr_ += "</td></tr></table>"; //close edit/link table row
				treeViewHandlerStr_ += "</td></tr></table>"; //close tree node name/link table row
								
				treeViewHandlerStr_ += "</div></td>"; //close pre-comment div and td
				
				if(nodeEditType == "table")
					treeViewHandlerStr_ += 
							"<td><div style='margin-top:-4px; float:left;'>" + //to account for not being in value node
							"<div class='treeNode-Value-editIcon' id='treeNode-Value-editIcon-" +
							(depth + "-" + uid) + "' " +
							"onclick='handleTreeNodeClick(" +							 
							depth + "," + uid + "," + 	
							"1,\"" +
							nodeEditType +
							"\"); event.stopPropagation();' " +
							"title='Edit the comment for this table.' " +
							"></div>" +
							"</div></td>";
				
				
				//add comment if applicable
				treeViewHandlerStr_ += "<td style='font-size:14px; white-space: nowrap;' id='" +
						"treeNode-TableComment-" + 
						(depth + "-" + uid) + "' " +
						">";
				if(tableComment != "")
					treeViewHandlerStr_ += //"<td style='font-size:14px; white-space: nowrap;'>" +
						"//" + tableComment;
				else 
					treeViewHandlerStr_ += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"; //for mouse over area
				treeViewHandlerStr_ += "</td>";
				treeViewHandlerStr_ += "</tr></table>"; //close pre/comment table row
					
				treeViewHandlerStr_ += 
						"<div id='clearDiv'></div>" +
						"<div class='treeNode-Children' id='treeNode-ChildrenOf-" +
						( depth + "-" + uid ) + "'>";
						
				if(childrenLength)
				{					
					recursiveDrawTree(nodes[i],depth+1,path+nodeName+"/",
							( depth + "-" + uid ));					
				}
				
				treeViewHandlerStr_ += 
						"</div>" +						
						"</div>" + //end treeNode div
						"<div id='clearDiv'></div>";  
				//////////=======================
				
				
				
			}
		}

		//getTreeViewTableStrings ~
		function getTreeViewTableStrings(tableLinkName, isLink)
		{
			var backLinkStr;
			var onmouseupJS = "";
			var newwindowJS = "";
			var newtabJS = "";
			
			var DEFAULT_treeNavContextMenuItems = [
					   "Go-to Table View",
					   "Open in new Desktop Window",
					   "Open in new Browser Tab",
					   "Add new Record to Table"];
			var treeNavContextMenuItems = []
			var treeNavContextMenuItemHandlers = [];
			var menuIndex = 0;
					
			var tableComment = ""; 
			var tableTitle = ""; 
			
			//search for table link
			for(j=0;j<treeMemberNames_.length;++j)
				if(tableLinkName == treeMemberNames_[j])
					break;
			if(j != treeMemberNames_.length) //found table link
			{
				backLinkStr = "setupConfigGroupTreeView(\\\"" + 
						treeGroupName_ + "\\\",\\\"" +
						treeGroupKey_ + "\\\");"; 	
				

				//make replace screen js
				onmouseupJS = "setupSpecificConfig(\"" + 
						treeMemberNames_[j] + "\",\"" +
						treeMemberVersions_[j] + "\",\"" + backLinkStr + "\");";

				treeNavContextMenuItems.push(DEFAULT_treeNavContextMenuItems[menuIndex++]);
				treeNavContextMenuItemHandlers.push(onmouseupJS);
				

				//make new window link
				newWindowStr = "setupSpecificConfig(\"" + 
						treeMemberNames_[j] + "\",\"" +
						treeMemberVersions_[j] + "\")";
				newWindowStr = newWindowStr.replace(/"/g, "\\\"");

				newWindowStr = location.pathname + 
						location.search +
						"&newWindowOps=" + newWindowStr;

				newwindowJS += "DesktopContent.openNewWindow(" +
						"\"Configure\",\"\",\"" + 
						newWindowStr + "\",false);";

				treeNavContextMenuItems.push(DEFAULT_treeNavContextMenuItems[menuIndex++]);
				treeNavContextMenuItemHandlers.push(newwindowJS);


				//make new browser tab link
				newtabJS += "DesktopContent.openNewBrowserTab(" +
						"\"Configure\",\"\",\"" + 
						newWindowStr + "\",false);";
				
				treeNavContextMenuItems.push(DEFAULT_treeNavContextMenuItems[menuIndex++]);
				treeNavContextMenuItemHandlers.push(newtabJS);
				
				
				//make add new row js
				onmouseupJS = "editTreeAddNewRow(\"" + 
						treeMemberNames_[j] + "\");";

				if(!isLink)
				{
					treeNavContextMenuItems.push(DEFAULT_treeNavContextMenuItems[menuIndex++]);
					treeNavContextMenuItemHandlers.push(onmouseupJS);
				}
				else
					++menuIndex; //skip 1st menu item
				

				tableComment = treeMemberComments_[j];
				//make comment html safe
				tableComment = tableComment.replace(/</g, "&lt");
				tableComment = tableComment.replace(/>/g, "&gt");
				if(tableComment == ConfigurationAPI._DEFAULT_COMMENT) //do not show if default
					tableComment = "";
				tableTitle = "Table: \t\t" + treeMemberNames_[j] + "-v" + 
						treeMemberVersions_[j];
				if(tableComment != "")
					tableTitle += "\nComment: \t\"" +
						tableComment + "\"";
			}
			
			return {
				"tableTitle" : 						tableTitle,
				"tableComment" : 					tableComment,
				"treeNavContextMenuItems" :			treeNavContextMenuItems,
				"treeNavContextMenuItemHandlers" : 	treeNavContextMenuItemHandlers
			};
		}
		
		//editTreeAddNewRow ~~
		function editTreeAddNewRow(tableName)
		{
			Debug.log("editTreeAddNewRow " + tableName);
					
			//find table node element
			var els = document.getElementsByClassName("treeNode-Value-nodeEditType-table");
			{
				var i;
				for(i=0;i<els.length;++i)
					if(els[i].textContent == tableName)
					{
						_editingCellEl = els[i];
						break;
					}
				if(i==els.length)
				{
					Debug.log("Invalid tree member table targeted!",Debug.HIGH_PRIORITY);
					return;					
				}
			}

			//setup globals (acting like a node edit)
			treeEditingNodeType_ = "table-newRow";
			treeEditingNodeIdString_ = _editingCellEl.id.substr(("treeNode-Value-").length);
			treeEditingTargetTable_ = _editingCellEl.textContent;
			_editingCellElOldValue = tableName;
			treeEditingNodeDepth_ = 0;
			
			
			//other globals are unused
			treeEditingNodeParentIdString_ = "";
			treeEditingTargetUID_ = "";
			treeEditingTargetColumn_ = "";	
			treeEditingNodeInitValue_ = "1"; //just something so editTreeNodeOK proceeds
			
			editTreeNodeOK();//act on globals			
		}
				
		//handleTreeNodeClick ~~
		function handleTreeNodeClick(depth,uid,editClick,type)
		{
			var idString = depth + "-" + uid;
			treeEditingNodeDepth_ = depth;
			treeEditingNodeIdString_ = idString;
			
			//Debug.log("handleTreeNodeClick editClick " + editClick);
			
			var el = document.getElementById("treeNode-Value-" + idString);
			
			if(treeEditingEditIconShownEl_)
			{
				//Debug.log("handleTreeNodeClick editClick clearing ");
				bodyMouseMoveHandler();
			}
					
			if(_editingCell) //already have the edit box open, cancel it
			{
				if(_editingCellEl == el) //if same cell do nothing
					return true;
				editTreeNodeOK(); //if new cell, click ok on old cell before continuing
			}

			var path = document.getElementById("treeNode-path-" + idString).textContent;
			
			//			Debug.log("handleTreeNodeClick el       " + el.innerHTML);
			//Debug.log("handleTreeNodeClick idString    " + idString);
			//Debug.log("handleTreeNodeClick uid      " + uid);
			//			Debug.log("handleTreeNodeClick nodeName " + nodeName);
			Debug.log("handleTreeNodeClick path     " + path);
			//Debug.log("handleTreeNodeClick editClick " + editClick);
			//Debug.log("handleTreeNodeClick type     " + type);
			
			//determine type clicked:
			//	- table name 
			//	- uid
			//	- link ID 
			//	- value
			//
			//allow different behavior for each	depending on single or edit(2x) click	
			//	- table name 	
			//		1x = toggle Children
			//		2x = N/A
			//	- uid		 	
			//		1x = toggle Children, 
			//		2x = edit UID mode (up/down tab/shtab enter esc active)
			//	- link ID 	 	
			//		1x = toggle Children 
			//		2x = edit ID (no keys active)
			//	- value		 	
			//		1x = N/A 
			//		2x = edit record Value mode (up/down tab/shtab enter esc active)
			//
			//on tree node edit OK
			//	- table name 
			//		N/A
			//	- uid
			//		save affected table as temporary version (re-use active temporary version at server)
			//		if saved successfully
			//			scan tree nodes for all other table/uid nodes and change that uid 
			//	- link ID 
			//		save affected table as temporary version (re-use active temporary version at server)
			//		if saved successfully
			//			clear children and re-request children (just one level)
			//			scan tree nodes for all other table/uid/linkid nodes and change that linkid
			//				for each, clear children and re-request children (just one level)
			//	- value
			//		save affected table as temporary version (re-use active temporary version at server)
			//		if saved successfully
			//			scan tree nodes for all other table/uid/value nodes and change that value
			//
			//on tree node edit cancel
			//	return previous value
			
			
			//==================
			//take action based on editClick and type string:
			//	- table 
			//	- uid
			//	- link 
			//	- value
			//
			//params:
			//	(el,depth,uid,path,editClick,type,delayed)
			
			if(editClick)	//2x click
			{
				if(type == "table")
				{
					//edit table comment
					treeEditingTargetTable_ = el.textContent;
					
					//other globals are unused
					treeEditingNodeParentIdString_ = "";
					treeEditingTargetUID_ = "";
					treeEditingTargetColumn_ = "";
					
					selectThisTreeNode(idString,type);
					return;
				}

				var splitArr = path.split('/');
				treeEditingNodeParentIdString_ = 		
						document.getElementById("treeNode-ParentId-" + idString).textContent;
				
				if(type == "uid")
				{
					//edit UID mode (up/down tab/shtab enter esc active)
					if(depth == 1)
						treeEditingTargetTable_ = splitArr[splitArr.length-2]; //table should be before last slash in path
					else //accessing through link so need to get from parent
					{
						treeEditingTargetTable_ = document.getElementById("treeNode-linkTableName-" + 
								treeEditingNodeParentIdString_).textContent;	
					}
					treeEditingTargetUID_ = el.textContent;
					treeEditingTargetColumn_ = "UID";
					Debug.log("edit uid mode target=" + treeEditingTargetTable_ +
							"/" + treeEditingTargetUID_ + "/" +
							treeEditingTargetColumn_);
					
					selectThisTreeNode(idString,type);
				}
				else if(type == "link" || type == "value" ||
						type == "link-disconnected")
				{
					//edit ID (no keys active)
					Debug.log("edit link/value mode");
					
					//almost all cases, uid is correct in path (NOT when parent is uid-link)
					treeEditingTargetUID_ = splitArr[splitArr.length-2];
					
					if(depth == 2)						
						treeEditingTargetTable_ = splitArr[splitArr.length-3]; //table should be before last slash in path
					else //accessing through link so need to get table name from parent
					{
						//needs to get from parent OR parent-of-parent
						//	if parent is uid link.. then one level back
						//	if parent is groupid link.. then two levels back
						
						var pel = document.getElementById("treeNode-linkTableName-" +
								treeEditingNodeParentIdString_);
						if(!pel)
							pel = document.getElementById("treeNode-linkTableName-" +
								(document.getElementById("treeNode-ParentId-" + 
										treeEditingNodeParentIdString_).textContent));
						else //parent is uid link, so UID from path is wrong, fix it
						{
							//take uid from parent value, right side						
							treeEditingTargetUID_ = document.getElementById("treeNode-Value-" +
									treeEditingNodeParentIdString_).textContent.
											split(')')[0].split('=')[1].substr(1);
						}
						
						treeEditingTargetTable_ = pel.textContent;
					}										
					
					if(type == "value" || type == "link-disconnected")
						treeEditingTargetColumn_ = el.childNodes[0].textContent; //get from bold node
					else //link has col as start of value
						treeEditingTargetColumn_ = el.textContent.split('-')[0]; //get before dash
					
					Debug.log("edit link/value mode target=" + treeEditingTargetTable_ +
							"/" + treeEditingTargetUID_ + "/" +
							treeEditingTargetColumn_);
					selectThisTreeNode(idString,type);
				}
				else
				{
					Debug.log("This should be impossible - tell a developer how you got here!", Debug.HIGH_PRIORITY);
					return;
				}
			}
			else		//1x click
			{
				if(type == "table" || type == "uid" || type == "link")
				{
					toggleTreeChildren(depth,uid);
				}
				else if(type == "value")
				{
					//N/A
				}
				else
				{
					Debug.log("This should be impossible - tell a developer how you got here!", Debug.HIGH_PRIORITY);
					return;
				}
			}
			
			
		}
		
		//applyTreeFilter ~
		function applyTreeFilter(filter, reapplyFilter, infoWasToggled)
		{
			Debug.log("applyTreeFilter " + filter);
			Debug.log("treeViewHideInfo_ " + treeViewHideInfo_);

			var valName;			

			var allValues = document.getElementsByClassName("treeNode-Value-leafNode-fieldName");
			if(treeFilterApplied_ || treeViewHideInfo_ || infoWasToggled)
			{
				//clear Tree Filter
				for(var i=0;i<allValues.length;++i)
				{
					allValues[i].parentNode.parentNode.parentNode.style.display = "block";

					//if not hiding info (comment/author/time) then done
					if(!treeViewHideInfo_)
						continue;
					
					//else hide all info fields
					valName = allValues[i].innerHTML;
					if(valName == "CommentDescription" ||
							valName == "Author" ||
							valName == "RecordInsertionTime")
						allValues[i].parentNode.parentNode.parentNode.style.display = "none";					
				}
				
				treeFilterApplied_ = false;	
				
				lastTreeFilter_ = treeFilter_;
			}
			
			if(reapplyFilter)
				filter = treeFilter_;
			else 
				treeFilter_ = filter;
			
			if(!filter || filter == "" || filter == "*") return;			
			
			//apply new filter
			var filterArr = filter.split('*');

			//if only one element find exact
			//for each !"" component find it one after the other..
			
			var filterMatch;
			for(var i=0;i<allValues.length;++i)
			{
				filterMatch = true;
				valName = allValues[i].innerHTML;
				if(filterArr.length == 1)
				{
					if(valName != filterArr[0])
						filterMatch = false;						
				}
				else
				{
					var nextIndex = -1;
					for(var j=0;j<filterArr.length;++j)
					{
						Debug.log("j=" + j + " filterArr[j]=" + filterArr[j] + 
								" nextIndex=" + nextIndex);
						if(filterArr[j] == "") continue; //skip empty filters
						
						if(j == 0) //must start with this filter
						{
							if((nextIndex = valName.indexOf(filterArr[j])) != 0)
							{
								filterMatch = false;
								break; //done
							}
						}
						else if(j == filterArr.length-1) //must end with this filter
						{
							if(valName.lastIndexOf(filterArr[j]) !=
									valName.length - filterArr[j].length)
							{
								filterMatch = false;
								break;
							}
						}
						else if((nextIndex = valName.indexOf(filterArr[j],nextIndex+1)) < 0)
						{
							filterMatch = false;
							break; //done
						}
					}					
				}
				
				if(!filterMatch)	//get to treeNode element
					allValues[i].parentNode.parentNode.parentNode.style.display = "none";
			}
			
			treeFilterApplied_ = true;
		}		
				
		//expandTreeChildrenDepth ~
		//	expand all children at deepest depth
		//	if deepest depth is 0, expand XDAQContextConfiguration preferentially
		function expandTreeChildrenDepth()
		{
			Debug.log("expandTreeChildrenDepth " + "");

			//prevent overloading expand/hide commands
			if(DesktopContent._loadBoxRequestStack)
			{
				Debug.log("rejected command due to active load box stack " +
						DesktopContent._loadBoxRequestStack);
				return;
			}

			var params = []; //(depth,uid)
			var allNodes;
			var contextIndex = -1;			
			var deepestDepth = -1;
			var nameOfTargetNode = "";
			
			//choose which nodes are considered:
			//if a node is highlighted only expand and collapse considering its children
			if(treeEditingEditIconShownEl_)
			{
				Debug.log("treeEditingEditIconShownIdString_ " + treeEditingEditIconShownIdString_);
				
				//if this is a leaf node 
				//	consider parent the target node
				
				var telIdString = treeEditingEditIconShownIdString_;
				var tel = document.getElementById("treeNode-Value-leafNode-" +
											treeEditingEditIconShownIdString_);
				if(tel) //if leaf node, change target id string
					telIdString = document.getElementById("treeNode-ParentId-" +
							treeEditingEditIconShownIdString_).textContent;
					
				tel = document.getElementById("treeNode-" +
							telIdString);
				
				nameOfTargetNode = document.getElementById("treeNode-Value-" +
						telIdString).textContent;
				Debug.log("nameOfTargetNode " + nameOfTargetNode);
					
				//add self and all children				
				allNodes = tel.getElementsByClassName("treeNode-Expander");
			}
			else	//all nodes
				allNodes = document.getElementsByClassName("treeNode-Expander");
			
			//find deepest depth and build params array
			for(var i=0;i<allNodes.length;++i)
			{
				//skip hidden nodes in search
				if(allNodes[i].offsetParent === null) continue;
				
				params.push(
						allNodes[i].onmouseup.toString().split("(")[2].split(")")[0].split(","));
				if((params[params.length-1][0]|0) > deepestDepth)
					deepestDepth = params[params.length-1][0]|0;
				
				if(contextIndex == -1 &&
						(params[params.length-1][0]|0) == 0 && 
						document.getElementById("treeNode-nodeName-" + 
								params[params.length-1][0] + "-" + 
								params[params.length-1][1]).textContent ==
								"XDAQContextConfiguration") 
					contextIndex = params.length-1; //found XDAQContextConfiguration, save index
			}

			Debug.log("deepestDepth " + deepestDepth);	
			if(deepestDepth < 0) return;

			//if deepestDepth is 0 and XDAQContextConfiguration is present
			//	expand only XDAQContextConfiguration
			//else expand all children at deepestDepth
			
			if(deepestDepth == 0 && contextIndex != -1)
			{	//	expand only XDAQContextConfiguration
				Debug.log("Expand only XDAQContextConfiguration " + contextIndex);
				toggleTreeChildren(
						params[contextIndex][0]|0, 		//make integer
						params[contextIndex][1]|0);		//make integer					
				return;
			}

			var countExpanded = 0;
			for(var i=0;i<params.length;++i)
				if((params[i][0]|0) == deepestDepth)
				{
					if(toggleTreeChildren(
							params[i][0]|0, 		//make integer
							params[i][1]|0,			//make integer
							true))					//show
						++countExpanded;
				}
			
			if(!countExpanded)
				Debug.log("The tree has been expanded as far as possible" +
						(treeEditingEditIconShownEl_?(" with respect to the highlighted node " +
								"'" + nameOfTargetNode + "'"):"") + "!",Debug.INFO_PRIORITY);
		}
		
		//hideTreeChildrenDepth ~
		//	hide all children at deepest depth
		function hideTreeChildrenDepth()
		{
			Debug.log("hideTreeChildrenDepth " + "");

			//prevent overloading expand/hide commands
			if(DesktopContent._loadBoxRequestStack)
			{
				Debug.log("rejected command due to active load box stack " +
						DesktopContent._loadBoxRequestStack);
				return;
			}
			
			//this means toggling all children at second deepest depth
			var allNodes;
			var params = []; //(depth,uid,nodeName,path)
			var contextIndex = -1;
			var nameOfTargetNode = "";

			var deepestDepth = -1;
			var secondDeepestDepth = -1;
			
			//choose which nodes are considered:
			//if a node is highlighted only expand and collapse considering its children
			if(treeEditingEditIconShownEl_)
			{
				Debug.log("treeEditingEditIconShownIdString_ " + treeEditingEditIconShownIdString_);

				//if this is a leaf node 
				//	consider parent the target node

				var telIdString = treeEditingEditIconShownIdString_;
				var tel = document.getElementById("treeNode-Value-leafNode-" +
						treeEditingEditIconShownIdString_);
				if(tel) //if leaf node, change target id string
					telIdString = document.getElementById("treeNode-ParentId-" +
							treeEditingEditIconShownIdString_).textContent;

				tel = document.getElementById("treeNode-" +
						telIdString);

				nameOfTargetNode = document.getElementById("treeNode-Value-" +
						telIdString).textContent;
				Debug.log("nameOfTargetNode " + nameOfTargetNode);

				//add self and all children				
				allNodes = tel.getElementsByClassName("treeNode-Expander");
			}
			else	//all nodes
				allNodes = document.getElementsByClassName("treeNode-Expander");
			
			
			//find deepest depth and build params array
			for(var i=0;i<allNodes.length;++i)
			{
				//skip hidden nodes in search
				if(allNodes[i].offsetParent === null) continue;
				
				params.push(
						allNodes[i].onmouseup.toString().split("(")[2].split(")")[0].split(","));
				if((params[params.length-1][0]|0) > deepestDepth)
				{
					secondDeepestDepth = deepestDepth; //track 2nd place
					deepestDepth = params[params.length-1][0]|0;
				}
			}

			Debug.log("secondDeepestDepth " + secondDeepestDepth);
			if(secondDeepestDepth < 0) 
			{
				Debug.log("The tree has been collapsed as far as possible" +
						(treeEditingEditIconShownEl_?(" with respect to the highlighted node " +
								"'" + nameOfTargetNode + "'"):"") + "!",Debug.INFO_PRIORITY);
				return;
			}

			var countHidden = 0;
			for(var i=0;i<params.length;++i)
				if((params[i][0]|0) == secondDeepestDepth)
				{
					if(toggleTreeChildren(
							params[i][0]|0, 		//make integer
							params[i][1]|0,			//make integer							
							false)) //hide
						++countHidden;
				}
			
			if(!countHidden)
				Debug.log("The tree has been collapsed as far as possible" +
						(treeEditingEditIconShownEl_?(" with respect to the highlighted node " +
								"'" + nameOfTargetNode + "'"):"") + "!",Debug.INFO_PRIORITY);
		}
		
		//toggleTreeChildren ~ 
		//	if expanding
		//		if no children div, request new depth
		//		else display children
		//	if minimizing
		//		hide children
		//
		//	setVal can be used to avoid toggling
		//		- true = show, false = hide, undefined = toggle
		//
		// return true if action taken, else false
		function toggleTreeChildren(depth,uid,setVal) 
		{
			if(_mouseIsSelecting) return;
			
			var setValUsed = (setVal !== undefined);
					
			//			Debug.log("depth: " + depth);
			//			Debug.log("uid: " + uid);
			//			Debug.log("nodeName: " + nodeName);
			//			Debug.log("path: " + path);
			
			var idString = depth + "-" + uid;
			//Debug.log("idString: " + idString);
			
			var el = document.getElementById("treeNode-ChildrenOf-" + idString);
			var configGroupEls = document.getElementById("treeView-ConfigGroupLink").childNodes;
			var str = el.innerHTML;
			
			if(str != "") //if children already exist, then toggle display
			{
				var toggleEl = document.getElementById("treeNode-toggle-" + idString);
				var doShow = false;
				
				if(	(!setValUsed && el.style.display == "none") ||
						(setValUsed && setVal) )
					doShow = true;
				
				if(doShow) //if not shown, show and "-"
				{
					if(el.style.display == "block") return false; //already was shown
					el.style.display = "block";
					toggleEl.style.backgroundImage = 
							"url(/WebPath/images/windowContentImages/ConfigurationGUI-hideTree.png)";
					return true;
				}
				else //else shown, so hide and "+"
				{
					if(el.style.display == "none") return false; //already was hidden
					el.style.display = "none";
					toggleEl.style.backgroundImage = 
							"url(/WebPath/images/windowContentImages/ConfigurationGUI-expandTree.png)";
					return true;
				}
			}
			else if(!setValUsed || setVal)	//if no children div, then request it
			{
				var path = document.getElementById("treeNode-path-" + idString).textContent;
				var nodeName = document.getElementById("treeNode-nodeName-" + idString).textContent;
				
				var modifiedTables = ""; //csv table, temporay version,...
				for(var j=0;j<treeMemberNames_.length;++j)
					if((treeMemberVersions_[j]|0) < -1)
					{
						if(modifiedTables.length)
							modifiedTables += ",";
						modifiedTables += treeMemberNames_[j];
						modifiedTables += ",";
						modifiedTables += treeMemberVersions_[j];
					}
						
				
				DesktopContent.XMLHttpRequest("Request?RequestType=getTreeView" + 
						"&configGroup=" + configGroupEls[0].innerHTML + 
						"&configGroupKey=" + configGroupEls[1].innerHTML +
						"&hideStatusFalse=" + (treeViewHideStatus_?1:0) +
						"&depth=1", 
						"startPath=" + path + nodeName + "/"+ 
						"&modifiedTables=" + modifiedTables,treeViewHandler,idString,
						0,0,true); //progressHandler, callHandlerOnErr, showLoadingOverlay
				return true;
			}
			return false;
		}
		
		//setupConfigGroupTreeView ~
		function setupConfigGroupTreeView(configGroupName, configGroupKey, backLinkStr)
		{
			if(backLinkStr && backLinkStr != "")
				treeViewBackLinkStr_ = backLinkStr;
			else 
				treeViewBackLinkStr_ = "";
			DesktopContent.XMLHttpRequest("Request?RequestType=getTreeView" +
					"&configGroup=" + configGroupName + 
					"&configGroupKey=" + configGroupKey +
					"&hideStatusFalse=" + (treeViewHideStatus_?1:0) +
					"&depth=1", 
					"startPath=/",treeViewHandler,
					0, 0, 0, //reqIndex, progressHandler, callHandlerOnErr
					true); //showLoadingOverlay
		}
		
		//activateSystemConfig ~
		function activateSystemConfig(groupName, groupKey, ignoreWarnings)
		{
			DesktopContent.XMLHttpRequest("Request?RequestType=activateConfigGroup&groupName=" + 
					groupName + "&groupKey=" + groupKey +
					(ignoreWarnings?("&ignoreWarnings=" + ignoreWarnings):""),
					"",activateSystemConfigHandler,
					true, 0 ,0, //reqIndex, progressHandler, callHandlerOnErr
					true); //showLoadingOverlay
		}
		

		//versionTrackingHandler ~
		function versionTrackingHandler(req) 
		{
			var versionTrackingSystemLink = document.getElementById("versionTrackingSystemLink");			
			
			//set tracking is OFF set Debug prepend message
			var versionTracking = DesktopContent.getXMLValue(req,"versionTrackingStatus");
			if(versionTracking == "OFF")
			{
				Debug.prependMessage = "Version TRACKING OFF:::";
				if(versionTrackingSystemLink) versionTrackingSystemLink.innerHTML = "Turn Version Tracking ON";
				Debug.log("ALERT! ALERT! Version Tracking is OFF!!!", Debug.WARN_PRIORITY);
				_versionTrackingIsOn = false;
			}
			else if(versionTracking != "ON")
			{
				//check ever-present message
				//	and only give indication if there was a change
				versionTracking = DesktopContent.getXMLValue(req,"versionTracking");
				if(versionTracking == "OFF" &&  //identify mismatch
						_versionTrackingIsOn)
				{
					Debug.prependMessage = "Version TRACKING OFF:::";
					if(versionTrackingSystemLink) versionTrackingSystemLink.innerHTML = "Turn Version Tracking ON";
					Debug.log("ALERT! ALERT! Version Tracking is OFF!!!", Debug.WARN_PRIORITY);	
					_versionTrackingIsOn = false;
				}
				else if(versionTracking == "ON" &&  //identify mismatch
						!_versionTrackingIsOn)
				{
					Debug.prependMessage = "";
					if(versionTrackingSystemLink) versionTrackingSystemLink.innerHTML = "Turn Version Tracking OFF";
					Debug.log("Note: Version Tracking is ON!!!", Debug.WARN_PRIORITY);	
					_versionTrackingIsOn = true;
				}
				else if(versionTracking != "ON" &&
						versionTracking != "OFF")
				{				
					Debug.prependMessage = "Version TRACKING UNKOWN:::";
					if(versionTrackingSystemLink) versionTrackingSystemLink.innerHTML = "Turn Version Tracking ON";
					_versionTrackingIsOn = false;
				}
			}
			else //as normal, Turn Version Tracking is ON
			{
				Debug.prependMessage = "";
				if(versionTrackingSystemLink) versionTrackingSystemLink.innerHTML = "Turn Version Tracking OFF";
				if(!_versionTrackingIsOn)
					Debug.log("Version Tracking is ON!!!", Debug.INFO_PRIORITY);
				_versionTrackingIsOn = true;				
			}
			
			Debug.log("_versionTrackingIsOn " + _versionTrackingIsOn);
		}
		
		//activateSystemConfigHandler ~
		function activateSystemConfigHandler(req,displayErrors)
		{	
			var withWarningsStr = "";
			var name,key; //only filled in if withWarningsStr != ""
			if(displayErrors)
			{
				var err = DesktopContent.getXMLValue(req,"Error");
				if(err) 
				{
					Debug.log(err,Debug.HIGH_PRIORITY);				
					
					Debug.log(_OTS_RELAUNCH_STR,Debug.INFO_PRIORITY);

					//try to find group name and key
					//	if found, show activate with warnings button
					var i = err.indexOf("'")+1;//("activating group '") + ("activating group '").length;
					name = err.substr(i,err.indexOf("'",i)-i).split("(");
					if(name.length == 2)
					{
						key = name[1].split(")")[0] | 0; //force integer
						name = name[0];					
												
						//add ignore warnings Activate link
						withWarningsStr += " <a href='#' onclick='javascript:activateSystemConfig(\"" + 
								name +
								"\",\"" + key + "\",1); return false;'>"; //ignore warnings
						withWarningsStr += "Activate " + 
								name + "(" + key + ") w/warnings ignored</a>";
					}
				}
			}
			
			//update version tracking
			versionTrackingHandler(req);
			
			var activeConfigGroups = [
									  DesktopContent.getXMLValue(req,"Context-ActiveGroupName"),
									  DesktopContent.getXMLValue(req,"Context-ActiveGroupKey"),
									  DesktopContent.getXMLValue(req,"Backbone-ActiveGroupName"),
									  DesktopContent.getXMLValue(req,"Backbone-ActiveGroupKey"),
									  DesktopContent.getXMLValue(req,"Configuration-ActiveGroupName"),
									  DesktopContent.getXMLValue(req,"Configuration-ActiveGroupKey")];
									  
			var activeConfigHeaders = ["Context","Backbone","Configuration"];
			Debug.log("activeConfigGroups: " + activeConfigGroups);
			
			var oldStr = document.getElementById("activeConfig").innerHTML;
			var str = "";
			var thereIsAnEmpty = false;
			
			str += "<table cellpadding='0' cellspacing='0' border='0' >"; //open active groups table
			
			for(var i=0;i<activeConfigHeaders.length;++i)
			{
				str += "<tr><td style='text-align:left'>";
				if(i==2)
					str += "Active " + activeConfigHeaders[i] + ": ";//"Last Initialized " + activeConfigHeaders[i] + "... ";
				else
					str += "Active " + activeConfigHeaders[i] + ": ";
				

				str += "</td><td style='text-align:left; padding-left:20px;'>";
				
				if(!activeConfigGroups[i*2] || activeConfigGroups[i*2] == "")
				{
					str += "None";
					thereIsAnEmpty = true;
				}
				else
				{
					str += "<a href='#' onclick='javascript:setupSpecificConfigGroup(\"" + activeConfigGroups[i*2] +
					"\",\"" + activeConfigGroups[i*2+1] + "\"); return false;'>";
					str += activeConfigGroups[i*2] + " (" + activeConfigGroups[i*2+1] + ")</a>";
				}
				//str += "<br>";

				str += "</td><td style='text-align:left; padding-left:20px;'>";
				str += "<a href='#' onclick='javascript:setupConfigGroupTreeView(\"" + 
						activeConfigGroups[i*2] + 
									"\",\"" + 
									activeConfigGroups[i*2+1] + "\"); return false;'>Tree-view</a>";								
				
				str += "</td></tr>";
			}
			str += "</table>"; //close active groups table
			
			document.getElementById("activateConfigWithWarnings").innerHTML = withWarningsStr;			
			if(withWarningsStr != "")
			{
				Debug.log("Group " + name + "(" + key + ") was not activated.\n\n" +
						"Please see detailed Warnings and Errors below. " +
						"You can try to activate " + 
						"with warnings ignored " + 
						"<label style='font-weight:bold;text-decoration:underline;font-size:inherit;'>" +
						"(MAKE SURE YOU KNOW WHY!)</label> by clicking '<u>Activate " + 
						name + "(" + key + ") w/warnings ignored</u>' " +
						"at the top of the page.",Debug.HIGH_PRIORITY);
				//Debug.log(_OTS_RELAUNCH_STR,Debug.INFO_PRIORITY);
				
			}
			else 
			{
				var el = document.getElementById("activeConfig");
				el.innerHTML = str;
				str = el.innerHTML;				
				
				if(!_firstTimeSilentActive && str != oldStr) //only popup after the first time
				{						
					if(thereIsAnEmpty) //may have been a deactivationg (due to error?)
						Debug.log("Note: There was a change in the active groups (check the top of the page)!",
								Debug.INFO_PRIORITY);
					else //must have been an activation
						Debug.log("Note: There was a successful activation of a group (check the top of the page)!",
								Debug.INFO_PRIORITY);

					//Debug.log(_OTS_RELAUNCH_STR,Debug.INFO_PRIORITY);
				}
				else
					_firstTimeSilentActive = false;
			}				
		}
		
//		//setGroupAliasInActiveBackbone ~~
//		//	Used to set a group alias.
//		//	This function will activate the resulting backbone group and 
//		//		call a done handler	
//		//
//		//      if doReturnParms
//		//          then the handler is called with an object 
//		//          describing the new backbone group object:
//		//                 retParams.newBackbone //true if successfully activated
//		//                 retParams.groupName   //backbone group name 
//		//                 retParams.groupKey    //backbone group key
//		//               
//		function setGroupAliasInActiveBackbone(groupAlias,groupName,groupKey,
//				newBackboneNameAdd,doneHandler,doReturnParams)
//		{
//			Debug.log("setGroupAliasInActiveBackbone groupAlias=" + groupAlias);
//			Debug.log("setGroupAliasInActiveBackbone groupName=" + groupName);
//			Debug.log("setGroupAliasInActiveBackbone groupKey=" + groupKey);
//			
//			if(!groupName || groupName == "" || !groupKey || groupKey == "")
//			{
//				Debug.log("Process interrupted. Invalid group name and key given!",Debug.HIGH_PRIORITY);
//				doneHandler(); //error so call done handler
//				return;
//			}
//			
//			if(!newBackboneNameAdd || newBackboneNameAdd == "")
//				newBackboneNameAdd = "Wiz";
//			newBackboneNameAdd += "Backbone";
//			Debug.log("setGroupAliasInActiveBackbone newBackboneNameAdd=" + newBackboneNameAdd);
//			
//			DesktopContent.XMLHttpRequest("Request?RequestType=setGroupAliasInActiveBackbone" +
//					"&groupAlias=" + groupAlias + 
//					"&groupName=" + groupName +
//					"&groupKey=" + groupKey, "", 
//					newWizBackboneMemberHandler,
//					[("GroupAlias" + newBackboneNameAdd),doneHandler,doReturnParams],
//					0,0,true  //progressHandler, callHandlerOnErr, showLoadingOverlay
//					);					
//		}
		
		//wizToActiveConfigGroup ~~
		//	groupType := 0-context, 1-backbone, 2-configuration
		function wizToActiveConfigGroup(groupAlias,groupType)
		{			
			if(groupType !== undefined)groupType |= 0; //make integer
			else groupType = 2; //default to config group
			
			var groupTypeName = groupType==0?"Context":(groupType==1?"Backbone":"Configuration");
			
			Debug.log("CfgGUI wizToActiveConfigGroup " + groupType + ":" + groupTypeName);
			
			//set group alias to the last initialized configuration group
			
			var el = document.getElementById("display");			
			el.innerHTML = "Loading...";

			//get active configuration group
			DesktopContent.XMLHttpRequest("Request?RequestType=getActiveConfigGroups",
					"", function(req) 
					{
				activateSystemConfigHandler(req);
				
				var name = DesktopContent.getXMLValue(req,
						groupTypeName + "-ActiveGroupName");
				var key =  DesktopContent.getXMLValue(req,
						groupTypeName + "-ActiveGroupKey");
				
				if(!name || !key)
				{
					Debug.log("Process interrupted. There was no active " + 
							groupTypeName + " Group found.",
							Debug.HIGH_PRIORITY);
					setupSystemViewMode();
					return;
				}
				
				ConfigurationAPI.setGroupAliasInActiveBackbone(groupAlias,name,key,0,setupSystemViewMode);				
				
					},
					0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
			); //end of getActiveConfigGroups handler
		}
		
		//wizToLatestConfigGroup ~~
		//	groupType := 0-context, 1-backbone, 2-configuration
		function wizToLatestConfigGroup(groupAlias,ignoreWarnings,groupType)
		{	
			if(groupType !== undefined)groupType |= 0; //make integer
			else groupType = 2; //default to config group
			
			var groupTypeName = groupType==0?"Context":(groupType==1?"Backbone":"Configuration");
			
			Debug.log("CfgGUI wizToLatestConfigGroup " + groupType + ":" + groupTypeName);
			
			
			//get latest version of all tables for configuration group
			//make a new group with those versions
			//set group alias to the resulting group
			
			var el = document.getElementById("display");	
			var originalDisplayStr = el.innerHTML;
			el.innerHTML = "Loading...";

			DesktopContent.XMLHttpRequest("Request?RequestType=getConfigurations",
					"", function(req) 
					{
				var err = DesktopContent.getXMLValue(req,"Error");
				if(err) 
				{
					Debug.log(err,Debug.HIGH_PRIORITY);
					return;
				}
				
				var configNames = req.responseXML.getElementsByTagName("ConfigurationName");
				var configVersionHdr = req.responseXML.getElementsByTagName("ConfigurationVersions");
				
				var name;
				var configVersions;

				Debug.log("configNames.length " + configNames.length);

				var context = _contextMemberNames;
				var backbone = _backboneMemberNames;
				var configMap = "configList=";
				var found;
				for(var i=0;i<configNames.length;++i)
				{		
					name = configNames[i].getAttribute("value");
					configVersions = configVersionHdr[i].getElementsByTagName("Version");

					found = false;
					if(groupType == 0 || groupType == 2)
						for(var c in context)
							if(name == context[c])
							{	
								found = true;
								break;
							}
					if(!found && 
							(groupType == 1 || groupType == 2))
						for(var c in backbone)
							if(name == backbone[c])
							{	
								found = true;
								break;
							}
					
					if(groupType == 2 && found) continue; //not in config group, so skip
					if(groupType != 2 && !found) continue; //not in group type, so skip
										
					//this is an included table in target group type!
					
					//find the latest that is not temporary
					for(var v=configVersions.length-1;v>=0;--v)
						if(configVersions[v].getAttribute("value")[0] != 
								'-') //assume leading '-' means temporary
						{
							configMap += name + "," + 
									configVersions[v].getAttribute("value") + ",";
							break;							
						}
				}

				Debug.log("configMap " + configMap);
				//return;

				DesktopContent.XMLHttpRequest("Request?RequestType=saveNewConfigurationGroup" +
						"&groupName=" +	(groupTypeName + "Group" + "WizToLatest") +
						"&ignoreWarnings=" + (ignoreWarnings?1:0),
						configMap, 
						function(req)
						{
					var err = DesktopContent.getXMLValue(req,"Error");
					var name = DesktopContent.getXMLValue(req,"ConfigurationGroupName");
					var key = DesktopContent.getXMLValue(req,"ConfigurationGroupKey");
					if(err) 
					{
						if(!name || !key)
						{
							Debug.log(err,Debug.HIGH_PRIORITY);
							Debug.log("Process interrupted. Failed to create a new Configuration group!" +
								" Please see details below.",
								Debug.HIGH_PRIORITY);
							setupSystemViewMode();
							return;
						}
						Debug.log(err,Debug.WARN_PRIORITY);
						Debug.log("Going on with existing name=" + name + " & key=" + key,
								Debug.WARN_PRIORITY);
						Debug.log("Process interrupted. Failed to create a new Configuration group!" +
							" (Likely the Group Alias points to an equivalent Configuration group already)",
							Debug.WARN_PRIORITY);
					}
					
					//handle "TreeError" warnings
					{	
						var treeErr = DesktopContent.getXMLValue(req,"TreeErrors");
						if(treeErr) 
						{					
							var attemptedNewGroupName = DesktopContent.getXMLValue(req,"AttemptedNewGroupName");
							Debug.log(treeErr,Debug.WARN_PRIORITY);
							Debug.log("There were problems identified in the tree view of the " +
									"attempted new group &apos;" +
									attemptedNewGroupName +
									"&apos;.\nYou can wiz the group anyway (if you think it is a good idea) by clicking " +
									"'<u>Wiz-to-Latest with Warnings Ignored</u>'",
									Debug.WARN_PRIORITY);
							var str = "";
							str += " <input id='saveGroupWithWarningsIgnored' " + 
									"style='margin-bottom:15px;' " +
									"type='button' onmouseup='wizToLatestConfigGroup(\"" +
									groupAlias + "\",1," + groupType + 
									")' value='Wiz-to-Latest with Warnings Ignored' " +
									"title='Automatically assign System Alias &apos;" + groupAlias + 
									"&apos; to a ";
							str += groupTypeName;
							str += " Group comprised of the latest table versions.'" +									
									"'/>";
							str += "<div id='clearDiv'></div>";	
	
							var displayEl = document.getElementById("display");							
							//since "Loading..." hid the popup from being closed properly
							// relaod original html and do it here
							displayEl.innerHTML = originalDisplayStr;
							//remove all previous buttons
							var el;
							do
							{
								el = document.getElementById("saveGroupWithWarningsIgnored");
								if(el) el.parentNode.removeChild(el);
							} while(el);	
							el = document.getElementById("popUpDialog"); 
							if(el) el.parentNode.removeChild(el);							

							//add new button
							el = document.createElement("div");
							el.innerHTML = str; //create element with save with warnings ignored button							
							displayEl.insertBefore(el,displayEl.childNodes[0]); //insert new first child					
							
							return;
						}
					}
					
					//else proceeding normally
					
					ConfigurationAPI.setGroupAliasInActiveBackbone(groupAlias,name,key,0,setupSystemViewMode);


						},
						0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
				); //end of saveNewConfigurationGroup handler


					},
					0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
			);	//end of getConfigurations handler
		}

		//saveGroupAndActivate
		function saveGroupAndActivate(groupName,configMap,doneHandler,doReturnParams)
		{
			DesktopContent.XMLHttpRequest("Request?RequestType=saveNewConfigurationGroup&groupName=" +
					groupName, configMap, 
					function(req)
					{
				var err = DesktopContent.getXMLValue(req,"Error");
				var name = DesktopContent.getXMLValue(req,"ConfigurationGroupName");
				var key = DesktopContent.getXMLValue(req,"ConfigurationGroupKey");
				var newBackbone = true;
				if(err) 
				{
					if(!name || !key)
					{
						Debug.log(err,Debug.HIGH_PRIORITY);
						Debug.log("Process interrupted. Failed to create a new Backbone group!" +
								" Please see details below.",
								Debug.HIGH_PRIORITY);

						if(doneHandler)
							doneHandler(); //error so call done handler
						return;
					}
					else
					{
						Debug.log(err,Debug.WARN_PRIORITY);
						Debug.log("Process interrupted. Failed to create a new Backbone group!" +
								" (Likely the currently active Backbone already represents what is being requested)\n\n" +
								"Going on with existing backbone group, name=" + name + " & key=" + key,
								Debug.WARN_PRIORITY);
						newBackbone = false;
					}					
				}

				//now activate the new backbone group

				DesktopContent.XMLHttpRequest("Request?RequestType=activateConfigGroup" +
						"&groupName=" + name +
						"&groupKey=" + key, "", 
						function(req)
						{
					var err = DesktopContent.getXMLValue(req,"Error");
					if(err) 
					{
						Debug.log(err,Debug.HIGH_PRIORITY);
						return;
					}

					activateSystemConfigHandler(req);

					if(doneHandler)
					{
						//done so call done handler (and indicate success)
						if(!doReturnParams)
							doneHandler(); //done so call done handler
						else
						{
							var retParams = {
									"groupName" : name,
									"groupKey" : key,
									"newBackbone" : newBackbone									
							}
							doneHandler(retParams); 	 //(and indicate success)
						}
					}

						},0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
				);	//end of activate new backbone handler

					},0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
			); //end of backbone saveNewConfigurationGroup handler
		}
				
//		//newWizBackboneMemberHandler
//		//	Used to handle the response from modifying a member of the backbone.
//		//	This handler will activate the resulting backbone group and
//		//		call a done handler.
//		//
//		//	params = [newBackboneGroupName, doneHandler, doReturnParams]
//		function newWizBackboneMemberHandler(req,params)
//		{
//			var err = DesktopContent.getXMLValue(req,"Error");
//			if(err) 
//			{
//				Debug.log(err,Debug.HIGH_PRIORITY);
//				Debug.log("Process interrupted. Failed to modify the currently active Backbone!",Debug.HIGH_PRIORITY);
//
//				if(params[1])
//					params[1](); //error so call done handler
//				return;
//			}		
//
//			var groupAliasName = DesktopContent.getXMLValue(req,"savedName");
//			var groupAliasVersion = DesktopContent.getXMLValue(req,"savedVersion");
//
//			Debug.log("groupAliasName=" + groupAliasName);
//			Debug.log("groupAliasVersion=" + groupAliasVersion);
//
//			var configNames = req.responseXML.getElementsByTagName("oldBackboneName");
//			var configVersions = req.responseXML.getElementsByTagName("oldBackboneVersion");
//
//			//make a new backbone with old versions of everything except Group Alias 
//			var configMap = "configList=";
//			var name;
//			for(var i=0;i<configNames.length;++i)
//			{		
//				name = configNames[i].getAttribute("value");
//
//				if(name == groupAliasName)
//				{
//					configMap += name + "," + 
//							groupAliasVersion + ",";
//					continue;
//				}
//				//else use old member
//				configMap += name + "," + 
//						configVersions[i].getAttribute("value") + ",";							
//			}
//
//			saveGroupAndActivate(params[0],configMap,params[1],params[2]);			
//		}
		
		//setupConfigCreator ~
		function setupConfigCreator(preSelectStr)
		{
			var el = document.getElementById("display");
			el.innerHTML = "Loading...";
			DesktopContent.XMLHttpRequest("Request?RequestType=getConfigurations",
					"", setupConfigCreatorHandler, preSelectStr,
					0,0,true  //progressHandler, callHandlerOnErr, showLoadingOverlay
					);			
		}
		
		//setupConfigCreatorHandler ~
		// preSelectStr may contain "&backLinkStr=..." in it
		function setupConfigCreatorHandler(req,preSelectStr)
		{
			var err = DesktopContent.getXMLValue(req,"Error");
			if(err) 
			{
				Debug.log(err,Debug.HIGH_PRIORITY);
				var el = document.getElementById("display");
				el.innerHTML = "Failed.";
				return;
			}
			
			activateSystemConfigHandler(req);
		
			var backLinkStr = "";		
			//if backLinkStr is present parse it out
			if(preSelectStr && preSelectStr.indexOf("&") >= 0)
			{
				preSelectStr = preSelectStr.split("&");
				backLinkStr = preSelectStr[1].substr(preSelectStr[1].indexOf("=")+1);
				preSelectStr = preSelectStr[0];
			}
			Debug.log("preSelectStr=" + preSelectStr);
			Debug.log("backLinkStr=" + backLinkStr);

			var el = document.getElementById("display");
			var str = "";

			if(backLinkStr && backLinkStr != "")
			{
				//Note: be careful with the source of backLinkStr.. don't use both quote styles!
				if(backLinkStr.indexOf("'") >= 0)
					backLinkStr = backLinkStr.replace(/'/g, "\\\"");
				else
					backLinkStr = backLinkStr.replace(/"/g, "\\\"");
				Debug.log("Back-link = " + backLinkStr);

				str += "<a href='#' onclick='javascript:evaluateJS(\"" + backLinkStr + "\"); return false;'>Back</a>";
				str += "&nbsp;&nbsp;&nbsp;&nbsp;";
			}
			
			var refreshLinkStr = "setupConfigCreator(\"" + 
					preSelectStr + "&backLinkStr=" + backLinkStr + "\");"; 
			str += "<a href='#' onclick='javascript:" + refreshLinkStr + 
					"; return false;'>Refresh</a>";
			str += "<br>";

			if(preSelectStr)
				str += "<br>Choose the versions of configurations you would like to add...<br>";
			
			str += "<div id='createGroupInfo'></div><br>";
			str += "<button type='button' onmouseup='javascript:" +
					"popUpSaveNewGroupForm(document.getElementById(\"newConfigName\").value," +
					"-1,1);" + //sourceGroupKey, sourceType
					//createConfigGroup()'
					"' title='" +
					"Create the new persistent group and group key pair." +
					"'>" +
					"Create the new Group</button>";
			str += "<br><br>";
			str += "Group Name: <input id='newConfigName'/>";
			str += "<br><br>";
			
			var configNames = req.responseXML.getElementsByTagName("ConfigurationName");
			var configVersionHdr = req.responseXML.getElementsByTagName("ConfigurationVersions");
			var name;
			var configVersions, version;
		
			Debug.log("configNames.length " + configNames.length);
			
			str += "<table>";			

			str += "<tr><td>";
			
			var title = "Select/Deselect checkboxes based on this selection.";
			str += "<a href='#' onclick='javascript:selectForCreateConfig(1); return false;' title='" + title + "'>All</a> | " +
					"<a href='#' onclick='javascript:selectForCreateConfig(0); return false;' title='" + title + "'>None</a> | " + 
					"<a href='#' onclick='javascript:selectForCreateConfig(2); return false;' title='" + title + "'>Context</a> | " +
					"<a href='#' onclick='javascript:selectForCreateConfig(3); return false;' title='" + title + "'>Backbone</a> | " +
					"<a href='#' onclick='javascript:selectForCreateConfig(4); return false;' title='" + title + "'>Configuration</a>";
			str += "&nbsp;&nbsp;&nbsp;&nbsp;";
			str += "</td><td colspan='2' style='white-space: nowrap;'>";
			var title = "Select the version in the drop-downs for all tables based on this selection.";
			str += "<a href='#' onclick='javascript:versionsForCreateConfig(0); return false;' title='" + title + "'>Latest</a> | " +
					"<a href='#' onclick='javascript:versionsForCreateConfig(1); return false;' title='" + title + "'>Defaults</a> | " +
					"<a href='#' onclick='javascript:popUpVersionAliasGroupEditorForm(); return false;' title='" + title + "'>Other Alias</a>";
			str += "</td>";
			str += "</tr>";
			
			for(var i=0;i<configNames.length;++i)
			{		
				str += "<tr><td style='white-space: nowrap;'>";
				name = configNames[i].getAttribute("value");
				
				
				//add checkbox
				str += "<input type='checkbox' class='memberConfigCheckbox' value='" + 
						name + "'>";
				//add link so text toggles checkbox
				str += "<a style='text-decoration:none;color:black;' href='#' onclick='javascript:" +
						"var el = document.getElementsByClassName(\"memberConfigCheckbox\");" +
						"var forFirefox = (el[" + i + "].checked = !el[" + i + "].checked);" +
						" return false;'>";
				str += niceName(name); //can display however
				str += "</a>";
				str += "</input>";

				configVersions = configVersionHdr[i].getElementsByTagName("Version");
				//Debug.log("CfgGUI requestHandler configNames.length " + configVersions.length);

				str += "</td><td>";
				
				str += "<select id='select-" + name + "'>";
				for(var j=0;j<configVersions.length;++j)
				{
					version = configVersions[j].getAttribute("value");
					str += "<option value='" + version + "'>";
					str += version;	//can display however
					str += "</option>";
				}
				str += "</select>";
				str += "</td>";
				
				backLinkStr = "setupConfigCreator(\\\"" + preSelectStr + "\\\");";
				
				str += "<td>";
				str += "<a href='#' onclick='" +
						"var sel = document.getElementById(\"select-" + name + "\");" +
						"setupSpecificConfig(\"" + name + "\"," +
						"sel.options[sel.selectedIndex]?sel.options[sel.selectedIndex].value:-1" +
						",\"" + backLinkStr + "\"); return false;'" +
						" title='Go to " + name + "&apos;s selected version'" +
						">";
				str += "goto</a>";
						//"(configName, version)"
				str += "</td>";
				str += "</tr>";
			}	
			str += "</table>";

			str += "<button type='button' onmouseup='javascript:createConfigGroup()' title='" +
					"Create the new persistent group and group key pair." +
					"'>" +
					"Create the new Group</button>";
			el.innerHTML = str;		
			

			if(preSelectStr)
			{
				//preSelectStr is CSV with groupName followed by member name/version pairs
				//use preset string to fill in preselected config group components
				var preSelectArr = preSelectStr.split(",");
				el = document.getElementById("newConfigName");
				el.value = preSelectArr[0]; //set group name
				var els = document.getElementsByClassName("memberConfigCheckbox");
				var options;
				//set member configs and versions
				for(el=0;el<els.length;++el)
				{
					els[el].checked = false;
					for(var c=1;c<preSelectArr.length-1;c+=2)
						if(els[el].value == preSelectArr[c])
						{	
							//found so check to include
							els[el].checked = true;
							//and set version
							sel = document.getElementById("select-" + els[el].value);
							options = sel.options;
							for(var i=0;i<options.length;++i)
								if(options[i].value == preSelectArr[c+1])
								{
									options[i].selected = true;
									break;
								}
							break;
						}
				}
			}
		}
		
		//createConfigSelect ~
		//0 is none, 1 is all, 2 is context, 3 is backbone, 4 is others (configuration)			
		function selectForCreateConfig(i)
		{
			var els = document.getElementsByClassName("memberConfigCheckbox");
			
			//use list of context/backbone configuration from server
			var context = _contextMemberNames;
			var backbone = _backboneMemberNames
			switch(i)
			{
			case 1: //check all
				for(var el=0;el<els.length;++el)
					els[el].checked = true;
				break;			
			case 2: //context	
				for(var el=0;el<els.length;++el)
				{
					Debug.log(els[el].value);
					els[el].checked = false;
					for(var c=0;c<context.length;++c)
						if(els[el].value == context[c])
						{	
							els[el].checked = true;
							break;
						}
				}
				break;		
			case 3: //backbone	
				for(var el=0;el<els.length;++el)
				{
					Debug.log(els[el].value);
					els[el].checked = false;
					for(var c=0;c<backbone.length;++c)
						if(els[el].value == backbone[c])
						{	
							els[el].checked = true;
							break;
						}
				}
				break;	
			case 4: //configuration	
				for(var el=0;el<els.length;++el)
				{
					els[el].checked = true;
					for(var c in context)
						if(els[el].value == context[c])
						{	
							els[el].checked = false;
							break;
						}
					for(var c in backbone)
						if(els[el].value == backbone[c])
						{	
							els[el].checked = false;
							break;
						}
				}
				break;		
			default:
				//select none
				for(var el=0;el<els.length;++el)
					els[el].checked = false;
			}
		}
		
		//versionsForCreateConfig ~
		//0 is latest, 1 is default, 2 is otherAlias 
		function versionsForCreateConfig(i,alias)
		{						
			var els = document.getElementsByClassName("memberConfigCheckbox");
			var sel,options;
			switch(i)
			{
			case 0: //latest
				for(var el=0;el<els.length;++el)
				{
					Debug.log(els[el].value);
					sel = document.getElementById("select-" + els[el].value);
					options = sel.options;
					
					//find the latest that is not temporary
					for(var i=options.length-1;i>=0;--i)
						if(options[i].value[0] != '-') //assume leading '-' means temporary
						{
							options[i].selected = true;
							break;							
						}
				}
				break;
			case 1: //defaults
				
				var defaultToSel;
				for(var el=0;el<els.length;++el)
				{
					Debug.log(els[el].value);
					sel = document.getElementById("select-" + els[el].value);
					options = sel.options;

					//find ALIAS:Default or else first that is not temporary and not an ALIAS:
					defaultToSel = -1;
					for(var i=0;i<options.length;++i)
						if(options[i].value == "ALIAS:Default")
						{
							//done!
							defaultToSel = i;
							break;
						}
						else if(defaultToSel == -1 && 
								options[i].value[0] != '-' &&  //assume leading '-' means temporary
								options[i].value.indexOf("ALIAS:") != 0) //skip aliases 
							defaultToSel = i; //found backup default, keep looking for ALIAS:Default				

					if(defaultToSel >= 0)
						options[defaultToSel].selected = true;
				}
				
				break;
			case 2: //other alias
				
				var defaultToSel;
				for(var el=0;el<els.length;++el)
				{
					Debug.log(els[el].value);
					sel = document.getElementById("select-" + els[el].value);
					options = sel.options;

					//find ALIAS:Default or else first that is not temporary
					defaultToSel = -1;
					for(var i=0;i<options.length;++i)
						if(options[i].value == "ALIAS:" + alias)
						{
							//done!
							defaultToSel = i;
							break;
						}
						else if(defaultToSel == -1 && 
								options[i].value[0] != '-') //assume leading '-' means temporary
							defaultToSel = i; //found backup default, keep looking for ALIAS:Default				

					if(defaultToSel >= 0)
						options[defaultToSel].selected = true;
				}
				
				break;
			default: 
				Debug.log("Impossible! Should never happen!! Alert system admins.",Debug.HIGH_PRIORITY);				
			}
		}
		
//		//createConfigGroup ~
//		function createConfigGroup(ignoreWarnings)
//		{
//			var config = document.getElementById("newConfigName").value;
//			Debug.log("config " + config);
//			
//			var configMap = "configList=";
//			var els = document.getElementsByClassName("memberConfigCheckbox");
//			var sel;
//			for(var el=0;el<els.length;++el)
//				if(els[el].checked)
//				{
//					sel = document.getElementById("select-" + els[el].value);
//					if(sel.options.length)
//					{
//						Debug.log("subconfig=" + els[el].value + " version=" + 
//							sel.options[sel.selectedIndex].value);
//						configMap += els[el].value + "," + sel.options[sel.selectedIndex].value + ",";
//					}
//				}			
//			
//			DesktopContent.XMLHttpRequest("Request?RequestType=saveNewConfigurationGroup" +
//					"&groupName=" +	config +
//					"&ignoreWarnings=" + (ignoreWarnings?1:0), 
//					configMap, createConfigGroupHandler,
//					0, 0, 0, //reqIndex, progressHandler, callHandlerOnErr
//					true); //showLoadingOverlay
//		}

		//createConfigGroupHandler ~
		function createConfigGroupHandler(req)
		{
			//remove all previous buttons
			var el;
			do
			{
				el = document.getElementById("saveGroupWithWarningsIgnored");
				if(el) el.parentNode.removeChild(el);
			} while(el);	
			
			var treeErr = DesktopContent.getXMLValue(req,"TreeErrors");
			if(treeErr) 
			{	
				var attemptedNewGroupName = DesktopContent.getXMLValue(req,"AttemptedNewGroupName");
				Debug.log(treeErr,Debug.WARN_PRIORITY);
				Debug.log("There were problems identified in the tree view of the " +
						"attempted new group &apos;" +
						attemptedNewGroupName +
						"&apos;.\nYou can save the group anyway (if you think it is a good idea) by clicking " +
						"'<u>Save Group with Warnings Ignored</u>'",
						Debug.WARN_PRIORITY);
				var str = "";
				str += " <input id='saveGroupWithWarningsIgnored' " + 
						"style='margin-bottom:15px;' " +
						"type='button' onmouseup='createConfigGroup(1);' " + 
						" value='Save Group with Warnings Ignored' title='" +
						"Save the modified group as a new persistent key for this group name." +
						"'/>";	
				str += "<div id='clearDiv'></div>";

				el = document.createElement("div");
				el.innerHTML = str; //create element with save with warnings ignored button
				var displayEl = document.getElementById("display");
				displayEl.insertBefore(el,displayEl.childNodes[0]); //insert new first child
				return;
			}

			var err = DesktopContent.getXMLValue(req,"Error");
			var el = document.getElementById('createGroupInfo');
			if(err) 
			{
				Debug.log(err,Debug.HIGH_PRIORITY);
				el.innerHTML = ""; //clear any previous success stories
				return;
			}
			
			var name = DesktopContent.getXMLValue(req,"ConfigurationGroupName");
			var key = DesktopContent.getXMLValue(req,"ConfigurationGroupKey");
			var str = "";
			
			str += "<br>";
			str += "New Configuration Group Created: <b class='bold-header'>" +
					name + " (" + key + ")</b>"; 
			str += "<br>Goto its ";
			str += "<a href='#' onclick='javascript:setupSpecificConfigGroup(\"" + name + 
					"\",\"" + key + "\"); return false;'>Member-view</a> or ";
			str += "<a href='#' onclick='javascript:setupConfigGroupTreeView(\"" + name + 
					"\",\"" + key + "\"); return false;'>Tree-view</a>, or ";
			str += "<a href='#' onclick='javascript:activateSystemConfig(\"" + name + 
					"\",\"" + key + "\"); return false;'>Activate</a> it.";
			
			el.innerHTML = str;
			
			//scroll to the top
			window.scrollTo(0,0);
			Debug.log("New Configuration Group Created: " +
					name + " (" + key + ")",Debug.INFO_PRIORITY);
		}
		
		//setupCopyAndMoveRows
		function setupCopyAndMoveRows()
		{
			var el = document.getElementById('findAndReplace');
			el.innerHTML = ""; //clear the other type of controls
			el = document.getElementById('copyAndMoveRows');  
			if(el.innerHTML != "") { el.innerHTML = ""; return; } //hide if already shown
			
			var str = "";
			str += "Source starting row or Source Version... ";
			str += "<input type='text' id='copyAndMoveRowsSrc' style='margin:0;width:" + 
					(el.offsetWidth-6) + "px; height:" + (17) + "px' value='0'>";
			str += "<br>";
			str += "Number of rows to Copy or Move... ";
			str += "<input type='text' id='copyAndMoveRowsSrcCount' style='margin:0;width:" +  
					(el.offsetWidth-6) + "px; height:" + (17) + "px' value='1'>";
			str += "<br>";
			str += "Destination row (-1 for new last row)... ";
			str += "<input type='text' id='copyAndMoveRowsDest' style='margin:0;width:" +  
					(el.offsetWidth-6) + "px; height:" + (17) + "px' value='-1'>";

			//make div for translating innerHTML and value
			str += "<div id='copyAndMoveRowsHTML' style='display:none'></div>";
			
			str += "<br><br>";
			str += "<input type='button' onmouseup='configCopyRow(0)' value='Copy Row' title='" +
					"Copy Source Row and paste at Destination Row, pushing previously existing rows down." +
					"'/>";
			str += " ";
			str += "<input type='button' onmouseup='configCopyRow(1)' value='Move Row' title='" +
					"Cut Source Row and paste at Destination Row, pushing previously existing rows down." +
					"'/>";
			str += " ";
			str += "<input type='button' onmouseup='configCopyView()' value='" +
					"Copy Source Version to new Temporary Version' title='" +
					"Copy Source Version (with possibly different column names) to a new Temporary Version with current column names." +
					"'/>";			
			str += "<br><br>";
			el.innerHTML = str;	
		}	
		
		//configCopyView ~~
		function configCopyView()
		{
			var src = document.getElementById("copyAndMoveRowsSrc").value;	
			Debug.log("configCopyView src=" + src);	
			Debug.log("configCopyView _currentConfigName=" + _currentConfigName);			
			
			DesktopContent.XMLHttpRequest("Request?RequestType=copyViewToCurrentColumns" +
					"&configName=" + _currentConfigName +
					"&sourceVersion=" + src,
					"", specificConfigRequestHandler,
					0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
					);
		}
		
		//configCopyRow
		function configCopyRow(deleteSrc)
		{
			var src = document.getElementById("copyAndMoveRowsSrc").value | 0;
			var dest = document.getElementById("copyAndMoveRowsDest").value | 0;
			var srcCount = document.getElementById("copyAndMoveRowsSrcCount").value | 0;
			
			
			Debug.log("configCopyRow src=" + src + " srcCount=" + srcCount + " dest=" + dest);

			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");
			if(src < 0 || src >= rows.length - _CONFIG_DATA_ROW_OFFSET)
			{
				Debug.log("Error: Illegal source row of '" + src + 
						"' given. Row must be less than " + 
						(rows.length- _CONFIG_DATA_ROW_OFFSET), Debug.HIGH_PRIORITY);
				return;
			}
			if(src+srcCount-1 < 0 || src+srcCount-1 >= rows.length - _CONFIG_DATA_ROW_OFFSET)
			{
				Debug.log("Error: Illegal last source row of '" + (src+srcCount-1) + 
						"' given. Row must be less than " + 
						(rows.length- _CONFIG_DATA_ROW_OFFSET), Debug.HIGH_PRIORITY);
				return;
			}
			if(dest < -1 || dest >= rows.length - _CONFIG_DATA_ROW_OFFSET)
			{
				Debug.log("Error: Illegal destination row of '" + dest + 
						"' given. Use '-1' for a new row, otherwise row must be less than " + 
						(rows.length- _CONFIG_DATA_ROW_OFFSET), Debug.HIGH_PRIORITY);
				return;
			}

			//steps:
			//	- add destination row
			//	- for each src col 
			//		- dest[col] = src[col]

			//if(deleteSrc) --dest;	//when move, add before target row
			
			//get col types for bool coloring
			var colIsBoolType = getTableViewColIsBoolType(rows);
			var boolTypeTrues = ["On","True","Yes"];
			
			var inputDest = dest;
			for(var r=0;r<srcCount;++r,++src,++dest)
			{
				if(inputDest == -1) //new row, so point to last row for addRow use
					dest = rows.length - _CONFIG_DATA_ROW_OFFSET;				
	
				//get source row before adding row
				var srcCols = rows[_CONFIG_DATA_ROW_OFFSET+src].getElementsByTagName("td");
				
				addRow(dest); 	
				Debug.log("src=" + src + " dest=" + dest);
				
				//get destination row after add
				el = document.getElementById("SubSystemTable");
				rows = el.getElementsByTagName("tr");
				
				var val;
				var destCols = rows[_CONFIG_DATA_ROW_OFFSET+dest].getElementsByTagName("td");
				for(var c=1;c<srcCols.length;++c)
				{
					Debug.log("copy c=" + c + " srcHTML=" + srcCols[c].innerHTML);
					val = srcCols[c].innerHTML;
					destCols[c].innerHTML = val;
					if(colIsBoolType[c]) //colorize bool types
					{
						//determine if true value
						var isTrue = false;
						for(var i=0;i<boolTypeTrues.length;++i)
							if(boolTypeTrues[i] == val)
							{
								isTrue = true; break;
							}
						
						destCols[c].style.backgroundColor =
								(isTrue)?_TABLE_BOOL_TYPE_TRUE_COLOR:_TABLE_BOOL_TYPE_FALSE_COLOR;										
					}
				}
				
				if(dest < src) ++src; //to account for added row
				
				if(deleteSrc)
				{					
					deleteRow(src);
					--src;	//to account for deleted row
				}
			}
		}	
		
		//setupFindAndReplace
		function setupFindAndReplace()
		{			 
			var el = document.getElementById('copyAndMoveRows'); 
			el.innerHTML = ""; //clear the other type of controls
			el = document.getElementById('findAndReplace'); 
			if(el.innerHTML != "") { el.innerHTML = ""; return; } //hide if already shown
			
			_lastFindRow = _lastFindCol = -1; //initialize find location
			var str = "";
			str += "Search in column ('*' for all)... <br>";
			str += "<input type='text' id='findAndReplaceTarget' style='margin:-4px -2px -4px -1px;width:" + (el.offsetWidth-6) + "px; height:" + (el.offsetHeight-8) + "px' value='*'>";
			str += "<br>";
			str += "For text... <br>";
			str += "<input type='text' id='findAndReplaceNeedle' style='margin:-4px -2px -4px -1px;width:" + (el.offsetWidth-6) + "px; height:" + (el.offsetHeight-8) + "px' value=''>";
			str += "<br>";
			str += "Replace with... <br>";
			str += "<input type='text' id='findAndReplaceWith' style='margin:-4px -2px -4px -1px;width:" + (el.offsetWidth-6) + "px; height:" + (el.offsetHeight-8) + "px' value=''>";
			
			//make div for translating innerHTML and value
			str += "<div id='findAndReplaceHTML' style='display:none'></div>";
			
			str += "<br><br>";
			str += "<div style='white-space:nowrap;'>";
			str += "<input type='button' onmouseup='configFind()' value='Find' title='" +
					"Find every occurance of &apos;For text...&quot; in the Column(s) specified by &apos;Search in column.&apos;" +
					"'/>";
			str += " ";
			str += "<input type='button' onmouseup='configReplace()' value='Replace' title='" +
					"Replace every occurance of &apos;For text...&quot; in the Column(s) specified by &apos;Search in column&apos; with the string specified in &apos;Replace with...&apos;" +
					"'/>";
			str += "&nbsp;&nbsp; or..."
			for(var i=0;i<3;++i)
				str += "&nbsp;";
			str += "<input type='button' onmouseup='configIncrementByReplace()' " +
					"value='Increment by &quot;Replace with...&quot; Field' title='" +
					"Increment the trailing number in all fields in the Column(s) specified by &apos;Search in column&apos; by the signed integer number specified in &apos;Replace with...&apos; If there is no trailing number, a zero is inferred." +
					"'/>";
			str += " ";
			str += "<input type='button' onmouseup='configIncrementByReplace(true)' " +
					"value='Increment each row uniquely by &quot;Replace with...&quot; Field' title='" +
					"Increment the trailing number in all fields, uniquely from row to row, in the Column(s) specified by &apos;Search in column&apos; by the signed integer number specified in &apos;Replace with...&apos; The starting number comes from the first cell encountered; if there is no trailing number, a zero is inferred." +
					"'/>";
			str += "</div>";
			str += "<br><br>";
			el.innerHTML = str;						
		}
				
		//configFind
		//	use _lastFindRow, _lastFindCol as starting point
		function configFind()
		{
			editCellOK(); //editCellCancel();
			var target = document.getElementById("findAndReplaceTarget").value;
			var needle = document.getElementById("findAndReplaceNeedle").value;
			var convertEl = document.getElementById("findAndReplaceHTML");
			
			//convert needle to HTML for search
			convertEl.innerHTML = "";
			convertEl.appendChild(document.createTextNode(needle));
			needle = convertEl.innerHTML; //converted text
			Debug.log("configFind '" + needle + "' @ " + target);
						

			Debug.log("_lastFindRow=" + _lastFindRow + " _lastFindCol=" + _lastFindCol);
			
			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");	
			var cells;
			var cols = rows[_CONFIG_DATA_ROW_OFFSET-1].getElementsByTagName("th");
			var cellStr;			
			var svLast = [_lastFindRow-_CONFIG_DATA_ROW_OFFSET,
						  _lastFindCol-_CONFIG_DATA_COL_OFFSET];
			for(var r=_CONFIG_DATA_ROW_OFFSET;r<rows.length;++r) //skip header rows
			{
				if(r < _lastFindRow) continue; //skip rows already looked at 
				
				cells = rows[r].getElementsByTagName("td");
				
				if(r != _lastFindRow)
				{
					_lastFindCol = -1; //reset last col for row
					_lastFindRow = r;
				}

				for(var c=_CONFIG_DATA_COL_OFFSET;c<cells.length;++c) //skip row index column
				{
					if(target != "*" && cols[c].innerHTML != target) continue; //skip if not target column 

					if(c <= _lastFindCol) continue; //skip cols already looked at in this row

					_lastFindCol = c; 
					
					cellStr = cells[c].innerHTML;
					Debug.log("[" + r + "," + c + "]=" + cellStr);
					if(cellStr.indexOf(needle) >= 0)
					{
						Debug.log("FOUND=" + cellStr);
						
						//cancel any other cells and target the found cell
						editCellOK(); //editCellCancel();
						selectThisCell(r,c,cells[c]);
						return;
					}
					
				}
			}
			Debug.log("Info: Reached end of table and was not able to find '" +
					needle + "' in columns '" + 
					target + "' after row,col = [" + svLast[0] + "," + svLast[1] + 
					"]. Try Find again to wrap around.", 
					Debug.HIGH_PRIORITY);
			_lastFindRow = -1; //reset for next find
		}
		
		//configIncrementByReplace ~~
		function configIncrementByReplace(uniquely)
		{
			editCellOK(); //editCellCancel();
			var target = document.getElementById("findAndReplaceTarget").value;
			var incrementNum = document.getElementById("findAndReplaceWith").value | 0;			
			if(!incrementNum)
				incrementNum = 1;
			Debug.log("configIncrementByReplace +=" + incrementNum + " @ " + target);
			
			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");	
			var cells;
			var cols = rows[_CONFIG_DATA_ROW_OFFSET-1].getElementsByTagName("th");
			var cellStr,cellNumIndex,cellNum;
			
			var uniqueCellNumIndex = -1;
			var cellNumIndex;
			
			for(var r=_CONFIG_DATA_ROW_OFFSET;r<rows.length;++r) //skip header rows
			{
				cells = rows[r].getElementsByTagName("td");

				for(var c=_CONFIG_DATA_COL_OFFSET;c<cells.length;++c) //skip row index column
				{
					//skip if not target column
					if(target != "*" && cols[c].innerHTML != target) continue;  

					cellStr = cells[c].innerHTML;
					Debug.log("[" + r + "," + c + "]=" + cellStr);
					
					//find any trailing number					
					for(cellNumIndex = cellStr.length-1; 
							cellNumIndex >= 0; --cellNumIndex)
						if(cellStr[cellNumIndex] < '0' ||
								cellStr[cellNumIndex] > '9')
							break;
					++cellNumIndex;
					Debug.log("cellNumIndex=" + cellNumIndex + " - " + cellStr.substr(cellNumIndex));
					cellNum = cellStr.substr(cellNumIndex) | 0;
					Debug.log("cellNum=" + cellNum);
					
					if(uniquely)
					{
						if(uniqueCellNumIndex < 0) //take starting value from cell
							uniqueCellNumIndex = cellNum;
						else
						{
							uniqueCellNumIndex += incrementNum;
							cellNum = uniqueCellNumIndex;
						}
					}
					else
						cellNum += incrementNum;
					
					Debug.log("newNum=" + cellNum);
					
					cells[c].innerHTML = cellStr.substr(0,cellNumIndex) + cellNum;
				}
			}

			versionHasChanged();
		}
		
		//configReplace ~~
		function configReplace()
		{			
			editCellOK(); //editCellCancel();
			var target = document.getElementById("findAndReplaceTarget").value;
			var needle = document.getElementById("findAndReplaceNeedle").value;
			var convertEl = document.getElementById("findAndReplaceHTML");
			
			//convert needle to HTML for search
			convertEl.innerHTML = "";
			convertEl.appendChild(document.createTextNode(needle));
			needle = convertEl.innerHTML; //converted text
			
			var replaceStr = document.getElementById("findAndReplaceWith").value;
			
			//convert replaceStr to HTML for search
			convertEl.innerHTML = "";
			convertEl.appendChild(document.createTextNode(replaceStr));
			replaceStr = convertEl.innerHTML; //converted text
			
			Debug.log("configReplace '" + needle + "' with '" + replaceStr + "' @ " + target);
			
			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");	
			var cells;
			var cols = rows[_CONFIG_DATA_ROW_OFFSET-1].getElementsByTagName("th");
			var cellStr, tmpStr;
			var needleStartIndex;
			for(var r=_CONFIG_DATA_ROW_OFFSET;r<rows.length;++r) //skip header rows
			{
				cells = rows[r].getElementsByTagName("td");

				for(var c=_CONFIG_DATA_COL_OFFSET;c<cells.length;++c) //skip row index column
				{
					//skip if not target column
					if(target != "*" && cols[c].innerHTML != target) continue;  
					
					cellStr = cells[c].innerHTML;
					tmpStr = cellStr;
					Debug.log("[" + r + "," + c + "]=" + cellStr);
					needleStartIndex = 0;
					while(cellStr.indexOf(needle,needleStartIndex) >= 0)
					{
						cellStr = cellStr.replace(needle,replaceStr);
						if(cellStr == tmpStr) break; //in case replace is same as needle
						Debug.log("REPLACED=" + cellStr);		
						needleStartIndex += replaceStr.length;
					}
					cells[c].innerHTML = cellStr;
				}
			}
			
			versionHasChanged();
		}
		
		function versionHasChanged()
		{		
			if(!_versionIsChanged)
			{
				_versionIsChanged = true;
				
				//give button for saving changes

				//get rid of all first save buttons (for temporary views)
				var el = document.getElementById("config-firstSaveButton");
				while(el)
				{				
					el.parentNode.removeChild(el);
					el = document.getElementById("config-firstSaveButton");
				}								
				
				var newDiv = document.createElement("div");
				str = "";
				str += "<input type='button' onmouseup='popUpSaveNewTableForm()' " + 
						"value='Save Changes as New Version' title='" +
						"Save the current table view as new persitent version." +
						"'/>";
				str += " ";
				str += "<input type='button' onmouseup='saveConfigAsNewVersion(1)' " +
						"value='Save Changes as Temporary Version' title='" +
						"Save the current table view as new temporary version." +
						"'/>";
				str += "<br><br>";
				newDiv.innerHTML = str;
				
				//insert a new div before and after table
				el = document.getElementById("display");
				var targetEl = document.getElementsByClassName("tableView-Menu");
				el.insertBefore(newDiv, targetEl[0]);
				newDiv = document.createElement("div");
				newDiv.innerHTML = "<br>" + str;				
				el.appendChild(newDiv);	
			}			
		}
		
		//treeViewGroupMemberEditMultiSelectHandler ~~
		//	called when a uid is selected or deselected
		function treeViewGroupMemberEditMultiSelectHandler(sel) 
		{
			var i = MultiSelectBox.getSelectedIndex(sel); 
			var selArr = MultiSelectBox.getSelectionArray(sel);
			MultiSelectBox.dbg("ms Chosen element index:",i,
					"=", selArr[i],
					" value:",sel.innerHTML);
			for(var s in selArr)
				MultiSelectBox.dbg("ms selected [" + s + "]: ",
						selArr[s]);
			
			//show uid info box			
			var el = document.getElementById("treeView-editLink-uidInfo");
			el.style.display = "block";	
			
			if(treeEditingGroupMembersLastSelect_ == sel.textContent)
				return; //already shown uid values
			
			treeEditingGroupMembersLastSelect_ = sel.textContent;
			
			el.innerHTML = ""; //clear
			
			var modifiedTables = ""; //csv table, temporay version,...
			for(var j=0;j<treeMemberNames_.length;++j)
				if((treeMemberVersions_[j]|0) < -1)
				{
					if(modifiedTables.length)
						modifiedTables += ",";
					modifiedTables += treeMemberNames_[j];
					modifiedTables += ",";
					modifiedTables += treeMemberVersions_[j];
				}

			DesktopContent.XMLHttpRequest("Request?RequestType=getTreeView" + 
					"&configGroup=" + treeGroupName_ + 
					"&configGroupKey=" + treeGroupKey_ +
					"&hideStatusFalse=" + 1 +
					"&depth=1", 
					"startPath=" + "/" + 
						_editingCellEl.getElementsByTagName("select")[0].value + "/" + 
						treeEditingGroupMembersLastSelect_ + "/"+ 
					"&modifiedTables=" + modifiedTables,
					function(req) 
					{
				var err = DesktopContent.getXMLValue(req,"Error");
				if(err) 
				{		
					el.innerHTML = "Error occurred.";
					return;
				}

				var warn = DesktopContent.getXMLValue(req,"Warning");
				if(warn) 
				{
					el.innerHTML = "Warning occurred.";
					return;
				}
				
				var str = "";
				
				str += "<u>UID '" + sel.textContent + "' values:</u><br>";
				str += "<div id='clearDiv' style='margin-top:10px'></div>"; //little padding
				var children = req.responseXML.getElementsByTagName("node");
				for(var j=0;j<children.length;++j)
				{
					//must all be value/link nodes					
					str += "<b class='bold-header' style='color:rgb(65, 86, 146);'>" +
							DesktopContent.getXMLValue(children[j]) + "</b>";
					str += " : ";
					str += DesktopContent.getXMLValue(children[j].children[0]);
					str += "<br>";
				}				
				
				el.innerHTML = str;
					},
					0,0,0,true); //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
		}

		//selectThisTreeNode ~~
		function selectThisTreeNode(idString,type,event) 
		{	
			if(event) //stop the body from also calling onmouseup and cancelling select
			{
				event.stopPropagation();

				Debug.log(_mouseIsSelecting);
				if(_mouseIsSelecting) //block select if mouse is selecting text currently 
				{
					_mouseIsSelecting = false;
					Debug.log(_mouseIsSelecting);
					return; 							
				}
			}

			//if column type is Author or Timestamp, don't allow select
			//			el.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
			//			"treeNode-ChildrenOf-0-0-ARTDAQAggregatorConfiguration"
			
			var el = 0;
						
			if(type == "table")
			{
				treeEditingNodeType_ = type;
				
				//edit table comment
				el = document.getElementById("treeNode-TableComment-" + idString);				
				_editingCellElOldValue = el.textContent;				
				var initVal = _editingCellElOldValue.substr(2).trim();	
				treeEditingNodeInitValue_ = initVal;
				
				//add input into element
				var str = "";
				str += "<input type='text' onkeydown='keyHandler(event)' style='margin:-4px -2px -4px -1px;width:" + 
						(el.offsetWidth>150?el.offsetWidth:150) + "px; height:" + (el.offsetHeight) + "px' value='";
				str += initVal;
				str += "' onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
						"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting); event.stopPropagation();' " +
						">";

				str += _OK_CANCEL_DIALOG_STR;		

				el.innerHTML = str;
				
				//select text in new input
				ConfigurationAPI.setCaretPosition(el.getElementsByTagName("input")[0],0,initVal.length);
			}			
			else if(type == "uid")
			{
				treeEditingNodeType_ = type;
				
				//edit record uid
				el = document.getElementById("treeNode-Value-" + idString);				
				_editingCellElOldValue = el.textContent;
				treeEditingNodeInitValue_ = _editingCellElOldValue;

				var str = "";
				str += "<table cellpadding='0' cellspacing='0' border='0'><tr>";
				str += "<td>";
				str += "<input type='text' onkeydown='keyHandler(event)' style='margin:-4px -2px -4px -1px;width:" + 
						(el.offsetWidth>150?el.offsetWidth:150) + "px; height:" + (el.offsetHeight) + "px' value='";
				str += _editingCellElOldValue;
				str += "' onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
						"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting); event.stopPropagation();' " +
						">";
				str += "</td><td>";
				str += 
						"<div class='treeNode-deleteIcon' " + 
						"onmouseup='event.stopPropagation();' " +
						"onclick='event.stopPropagation();" +
						"DesktopContent.popUpVerification(" + 
						"\"Are you sure you want to delete the record associated with the UID &apos;" +
						treeEditingNodeInitValue_ + "&apos; from the table &apos;" + 
						treeEditingTargetTable_ + "&apos;?\"," +
						"function() {" + 
						"treeEditingNodeType_ = \"delete-uid\";" +
						"editTreeNodeOK();" +
						"},0,\"#efeaea\",0,\"#770000\");' " +
						"title='Delete the record associated with this UID node.' " +
						"></div>";
				str += "</td></tr></table>";

				str += _OK_CANCEL_DIALOG_STR;		

				el.innerHTML = str;
				
				//select text in new input
				ConfigurationAPI.setCaretPosition(el.getElementsByTagName("input")[0],0,_editingCellElOldValue.length);
			}
			else if(type == "value")
			{
				treeEditingNodeType_ = type;
				
				//edit column entry in record
				//	data type matters here, also don't edit author, timestamp
				el = document.getElementById("treeNode-Value-leafNode-" + idString);
				var vel = document.getElementById("treeNode-Value-" + idString);
				
				//if value node, dataType is in element class name
				var colType = vel.className.split(' ')[1].split('-');
				if(colType[1] == "ValueType")
					colType = colType[2];

				//Debug.log("el.className=" + vel.className);
				Debug.log("colType=" + colType);
				
				if(colType == "Author" || 
						colType == "Timestamp")
				{
					Debug.log("Can not edit Author or Timestamp fields.",
							Debug.WARN_PRIORITY);
					return false;
				}
				
				var str = "";		
				var optionIndex = -1;
				
				if(colType == "YesNo" || 
						colType == "TrueFalse" || 
						colType == "OnOff")  //if column type is boolean, use dropdown
				{
					treeEditingNodeType_ += "-bool";
					_editingCellElOldValue = el.innerHTML;
					
					var initVal = el.childNodes[0].textContent;
					treeEditingNodeInitValue_ = initVal;
					
					var boolVals = [];
					if(colType == "YesNo")
						boolVals = ["No","Yes"];
					else if(colType == "TrueFalse")
						boolVals = ["False","True"];
					else if(colType == "OnOff")
						boolVals = ["Off","On"];


					str += "<select  onkeydown='keyHandler(event)' " +
							"onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
							"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting); event.stopPropagation();' " +
							"onclick='event.stopPropagation();'" +
							"style='margin:-4px -2px -4px -1px; height:" + (el.offsetHeight+6) + "px'>";
					for(var i=0;i<boolVals.length;++i)
					{			
						str += "<option value='" + boolVals[i] + "'>";
						str += boolVals[i];	//can display however
						str += "</option>";
						if(boolVals[i] == initVal)
							optionIndex = i; //get starting sel index					
					}			
					str += "</select>";
					if(optionIndex == -1) optionIndex = 0; //use False option by default					
				}
				else if(colType == "FixedChoiceData")
				{
					_editingCellElOldValue = el.textContent;
					treeEditingNodeInitValue_ = _editingCellElOldValue;
					
					str += "<select  onkeydown='keyHandler(event)' " +
							"onmouseup='event.stopPropagation();' " +
							"onclick='event.stopPropagation();' " +
							"style='margin:-4px -2px -4px -1px; height:" + (el.offsetHeight+6) + "px'>";

					//default value is assumed in list

					var vel = document.getElementById("treeNode-FixedChoice-CSV-" +
							idString);
					var choices = vel.textContent.split(',');
					
					for(var i=0;i<choices.length;++i)
					{			
						str += "<option>";
						str += decodeURIComponent(choices[i]);	//can display however
						str += "</option>";
						if(decodeURIComponent(choices[i]) 
								== _editingCellElOldValue)
							optionIndex = i; //get starting sel index
					}				
					str += "</select>";	
				}
				else if(colType == "MultilineData")
				{
					_editingCellElOldValue = el.textContent;
					treeEditingNodeInitValue_ = _editingCellElOldValue;
					
					str += "<textarea rows='4' onkeydown='keyHandler(event)' cols='50' style='font-size: 14px; margin:-4px -2px -4px -1px;width:" + 
							(el.offsetWidth-6) + "px; height:" + (el.offsetHeight-8) + "px' ";
					str += " onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
							"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting);event.stopPropagation();' " +
							"onclick='event.stopPropagation();'" +
							">";
					str += _editingCellElOldValue;
					str += "</textarea>";				
				}
				else // normal cells, with text input
				{
					if(colType == "GroupID") //track type if it is groupid field
						treeEditingNodeType_ += "-groupid";
					
					_editingCellElOldValue = el.textContent;
					treeEditingNodeInitValue_ = _editingCellElOldValue;
					
					str += "<input type='text' onkeydown='keyHandler(event)' style='margin:-4px -2px -4px -1px;width:" + 
							(el.offsetWidth+6) + "px; height:" + (el.offsetHeight) + "px' value='";
					str += _editingCellElOldValue;
					str += "' onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
							"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting);event.stopPropagation();' " +
							"onclick='event.stopPropagation();'" +
							">";					
				}


				str += _OK_CANCEL_DIALOG_STR;	

				el.innerHTML = str;
				
				//handle default selection
				if(colType == "YesNo" || 
						colType == "TrueFalse" || 
						colType == "OnOff")  //if column type is boolean, use dropdown
				{					//select initial value
					el.getElementsByTagName("select")[0].selectedIndex = optionIndex;
					el.getElementsByTagName("select")[0].focus();
				}
				else if(colType == "FixedChoiceData")
				{
					el.getElementsByTagName("select")[0].selectedIndex = optionIndex;
					el.getElementsByTagName("select")[0].focus();				
				}
				else if(colType == "MultilineData")
					ConfigurationAPI.setCaretPosition(el.getElementsByTagName("textarea")[0],0,_editingCellElOldValue.length);
				else 					//select text in new input
					ConfigurationAPI.setCaretPosition(el.getElementsByTagName("input")[0],0,_editingCellElOldValue.length);
				
			}	
			else if(type == "link" || 
					type == "link-disconnected")
			{
								
				//edit link entry in record (2 columns: link table and id)							
				el = document.getElementById("treeNode-Value-" + idString);
				
				//hide nav menu
				 document.getElementById("treeNode-LinkContextMenuTD-" + 
						 idString).style.display = "none";
									
				var linkIdType;		
				var linkInitId;		
				_editingCellElOldValue = el.innerHTML;
				if(type == "link-disconnected")
				{	
					linkIdType = document.getElementById("treeNode-linkIdType-" + idString).textContent;
					linkInitId = document.getElementById("treeNode-linkId-" + idString).textContent;
				}
				else
				{
					linkIdType = el.textContent.split('(')[1].split(' ')[0];
					linkInitId = el.textContent.split(')')[0].split('=')[1].substr(1);
				}
				
				
				var linkTable = document.getElementById("treeNode-linkTableName-" + idString);
				if(linkTable)
					linkTable = linkTable.textContent; 
				else
					linkTable = "";
				var linkIndex = document.getElementById("treeNode-childLinkIndex-" + idString).textContent;										

				Debug.log("linkTable " + linkTable);
				Debug.log("linkIdType " + linkIdType); // "UID" or "GroupID"
				Debug.log("linkInitId " + linkInitId);  //the ID
				Debug.log("linkIndex " + linkIndex);  //the link index

				treeEditingNodeType_ = "link"; //get rid of "disconnected"
				treeEditingNodeType_ += "-" + linkIdType;
				treeEditingNodeInitValue_ = linkTable + "," + linkInitId;
				
				var optionIndex = -1;
				
				selectLinkTableName = linkTable;
				selectLinkId = linkInitId;
				
				var firstTimeMembers = true;
				
				//////////////////////////
				//localGetLinkToChoices
				//	used to repeatedly get link-to-choices
				//		when selections change
				//		save last successfull table index to optionIndex
				function localGetLinkToChoices()
				{					
					//////////////////////////
					//localCreateLinkEditHTML ~~
					//	creates edit link html based on linkToChoices
					//	and selectLinkTableName
					function localCreateLinkEditHTML(linkToChoices,groupMembers,groupChoices)
					{
						var str = "";	
						

						//////////////////////////
						//localSetupGroupMemberEdit ~~~~
						//	setup add/remove group members controls
						//	parameters are member uids and all possible uids
						function localSetupGroupMemberEdit()
						{
							Debug.log("localSetupGroupMemberEdit " + 
									groupMembers.length + " of " + 
									groupChoices.length);

							//new element with multi-select box of UID members
							var nel = document.getElementById('treeView-groupMemberEditDiv'); 
							nel.onclick = function(event) { event.stopPropagation();}
							nel.onmouseup = function(event) { event.stopPropagation();}
							
							
							//////////// make search box
							{	
								var noMultiSelect = false; // true or false (false for multiselect functionality) 

								var msValues = []; 	//group names for multi-select
								var msKeys = []; 	//group keys for multi-select
								var msTypes = [];	//back link strings for multi-select

								treeEditingInitGroupMembers_ = [];
								treeEditingGroupMembersLastSelect_ = "";
										
								for(var i=0;i<groupChoices.length;++i)
								{	
									msValues.push(
											DesktopContent.getXMLValue(groupChoices[i])
											);	
								}



								//write to a particular div
								MultiSelectBox.createSelectBox(nel,
										"treeViewGroupUIDs",
										"Select Group Members:",
										msValues,msValues,msValues,
										treeViewGroupMemberEditMultiSelectHandler,
										noMultiSelect,
										treeViewGroupMemberEditMultiSelectHandler);

								

								//set pre-selections for uids already in group
								MultiSelectBox.initMySelectBoxes(true); //init to clear
								var memberVal;
								for(var i=0;i<groupMembers.length;++i)
								{	
									memberVal = DesktopContent.getXMLValue(groupMembers[i])
									for(var j=0;j<msValues.length;++j)
										if(msValues[j] == memberVal)
										{			
											//found member!
											MultiSelectBox.setSelectionElementByIndex(
													nel,j,true);
											treeEditingInitGroupMembers_.push(msValues[j]);	
											
											if(firstTimeMembers) //append to init value the first time
												treeEditingNodeInitValue_ += "," + msValues[j];
											break;
										}											
								}
								MultiSelectBox.initMySelectBoxes(false); //setup selections
								
								firstTimeMembers = false;
							}			
							//////////// end make search box
						}
						
						
						optionIndex = -1;

						Debug.log("_tableLinkDropdownChoices " + _tableLinkDropdownChoices.length);

						str += "<label style='color:rgb(65, 86, 146);font-weight:bold;'>" +
								treeEditingTargetColumn_ + "</label>" +"<br>";

						str += "<table cellpadding='0' cellspacing='0' border='0' " +
								"onmouseup='event.stopPropagation();' " +
								"onclick='event.stopPropagation();' " +
								"><tr>"; 
						str += "<td style='text-align:right'>Table:</td><td>";
						str += "<select  onkeydown='keyHandler(event,this)' " +
								"onmouseup='event.stopPropagation();'" +
								"onclick='event.stopPropagation();'" +
								"style='" + 
								"height:" + (29) + "px'>";
						for(var i=0;i<_tableLinkDropdownChoices.length;++i)
						{			
							str += "<option value='" + _tableLinkDropdownChoices[i] 
																				 + "'>";
							str += _tableLinkDropdownChoices[i];	//can display however
							str += "</option>";
							if(_tableLinkDropdownChoices[i] 
														 == selectLinkTableName)
								optionIndex = i; //get starting sel index
						}				
						str += "</select>";
						str += "</td></tr><tr>";

						str += "<td style='text-align:right'>";
						str += linkIdType + ":";
						str += "</td><td>";
						
						//start new table for select and editIcon
						str += "<table cellpadding='0' cellspacing='0' border='0'><tr><td>"; 

						str += "<select  onkeydown='keyHandler(event,this)' " +
								"id='editTree-groupIdFreeform-select' " +
								"onmouseup='event.stopPropagation();'" +
								"onclick='event.stopPropagation();'" +
								"style='" + 
								"height:" + (29) + "px'>";
						var linkToChoice;
						var linkToOptionIndex = 0; //default to first
						for(var i=0;i<linkToChoices.length;++i)
						{			
							linkToChoice = DesktopContent.getXMLValue(linkToChoices[i]);
							str += "<option value='" + linkToChoice	 + "'>";
							str += linkToChoice;	//can display however
							str += "</option>";
							if(linkToChoice	 == selectLinkId)
								linkToOptionIndex = i; //get starting sel index
						}				
						str += "</select>";		

						str += "<input type='text' " +
								"id='editTree-groupIdFreeform-input' " +
								"style='display:none; margin:2px; width:150px; height:" + 
								(19) + "px'>";						
						str += "";
						str += "</input>";	
						
						str += "</td><td>";

						str += "<div style='display:block' " + 
								"class='treeNode-Value-editIcon' " +
								"id='editTree-groupIdFreeform-editIcon' " +
								"onmouseup='event.stopPropagation();'" +
								"onclick='handleEditTreeGroupIDEditFreeformToggle();event.stopPropagation();' " +
								"title='Toggle free-form GroupID editing' " +
								"></div>";		
						str += "</td></tr></table>"; //end select and editIcon table
						
						str += "</td></tr></table>";

						if(linkIdType == "GroupID")		//add extra group-link stuff	
						{
							str += "<div id='clearDiv'></div>";
							str += "<div id='treeView-groupMemberEditDiv' " +
									"style='height:200px; width:250px;" +
									//"margin-bottom: 0px;" +
									"margin: -20px 0 -5px 0;'"; //margin messes up error printing
									"'";
							str += ">";								
							str += "</div>";
							
							//link for new default record in group
							str += "<a onmouseup='event.stopPropagation();' " +
									"id='treeView-editGroupLink-uidCreate' " +
									"style='" +
									"position: absolute;" + 
									"left: 300px; top: 80px;" +
									"z-index: 10;" +
									"white-space: nowrap; text-decoration: underline;" + 
									"' " + //end style
									"onclick='event.stopPropagation(); " +
									"treeEditingNodeType_ = \"table-newGroupRow\";" +
									"editTreeNodeOK();" +									
									"'" +
									">";
							str += "Create a new Default Record in Group";
							str += "</a>";
							
							//uid info box
							str += "<div id='treeView-editLink-uidInfo' " +
									"onclick='event.stopPropagation();' onmouseup='event.stopPropagation();'" +
									"style='" +
									"height: 148px; width: 350px; position: absolute; " + 
									"display: none; background-color: rgb(193, 152, 152); " +
									"left: 300px; top: 100px; border-radius: 5px; cursor: auto;" +
									"padding: 10px; overflow: auto; white-space: nowrap;" +
									"z-index: 10;" +
									"'>";
									
						}
						else if(linkIdType == "UID")		//add extra UID-link stuff	
						{
							str += "<div id='clearDiv'></div>";
							
							//backgroun box
							str += "<div style='" +
									"position: absolute;" + 
									"left: 170px; top: 76px; " +
									"height: 199px; width:389px;" +
									"background-color: rgb(226, 216, 216);" +
									"border-radius: 5px;" + 
									"z-index: 10;" +
									"border: 1px solid rgb(153, 153, 153);" +									
									"'" +
									"></div>";
							//link for new default record in group
							str += "<a onmouseup='event.stopPropagation();' " +
									"id='treeView-editUIDLink-uidCreate' " +
									"style='" +
									"position: absolute;" + 
									"left: 180px; top: 80px;" +
									"z-index: 10;" +
									"white-space: nowrap; text-decoration: underline;" + 
									"' " + //end style
									"onclick='event.stopPropagation(); " +
									"treeEditingNodeType_ = \"table-newUIDRow\";" +
									"editTreeNodeOK();" +									
									"'" +
									">";
							str += "Create a new Default Record in Linked Table";
							str += "</a>";
							
							//uid info box
							str += "<div id='treeView-editLink-uidInfo' " +
									"onclick='event.stopPropagation();' onmouseup='event.stopPropagation();'" +
									"style='" +
									"height: 148px; width: 350px; position: absolute; " + 
									"display: none; background-color: rgb(193, 152, 152); " +
									"left: 180px; top: 100px; border-radius: 5px; cursor: auto;" +
									"padding: 10px; overflow: auto; white-space: nowrap;" +
									"z-index: 10;" +
									"'>";
							
						}
							
						str += "</div>";

						str += _OK_CANCEL_DIALOG_STR;		

						el.innerHTML = str;

						//select initial value
						var sel = el.getElementsByTagName("select")[0];
						var selId = el.getElementsByTagName("select")[1];
						sel.selectedIndex = optionIndex;	
						if(linkToChoices.length)
						{
							selId.selectedIndex = linkToOptionIndex;	
							selId.focus();
						}
						else
							selId.disabled = true;

						//////
						//localLinkEditSelectOnChangeHandler ~~
						//	handle change of dropdowns
						function localLinkEditSelectOnChangeHandler() {
							selectLinkTableName = sel.value;
							selectLinkId = selId.value;
							Debug.log("Select table changed: " + selectLinkTableName + 
									" - " + selectLinkId);
							localGetLinkToChoices(); //re-request the linkToChoices
						};			
						
						sel.onchange = localLinkEditSelectOnChangeHandler;
						selId.onchange = localLinkEditSelectOnChangeHandler;

						if(linkIdType == "GroupID")		//add extra group-link stuff					
							localSetupGroupMemberEdit();
						else if(linkIdType == "UID" &&
								!selId.disabled)		//add extra UID-link stuff
						{
							//sneak peak the chosen UID
							
							//show uid info box			
							var uel = document.getElementById("treeView-editLink-uidInfo");
							uel.style.display = "block";
							Debug.log("sneak peak UID");
							
							var modifiedTables = ""; //csv table, temporay version,...
							for(var j=0;j<treeMemberNames_.length;++j)
								if((treeMemberVersions_[j]|0) < -1)
								{
									if(modifiedTables.length)
										modifiedTables += ",";
									modifiedTables += treeMemberNames_[j];
									modifiedTables += ",";
									modifiedTables += treeMemberVersions_[j];
								}

							DesktopContent.XMLHttpRequest("Request?RequestType=getTreeView" + 
									"&configGroup=" + treeGroupName_ + 
									"&configGroupKey=" + treeGroupKey_ +
									"&hideStatusFalse=" + 1 +
									"&depth=1", 
									"startPath=" + "/" + 
									_editingCellEl.getElementsByTagName("select")[0].value + "/" + 
									selId.value + "/"+ 
									"&modifiedTables=" + modifiedTables,
									function(req) 
									{
								var err = DesktopContent.getXMLValue(req,"Error");
								if(err) 
								{		
									uel.innerHTML = "Error occurred.";
									return;
								}

								var warn = DesktopContent.getXMLValue(req,"Warning");
								if(warn) 
								{
									uel.innerHTML = "Warning occurred.";
									return;
								}

								var str = "";

								str += "<u>UID '" + selId.value + "' values:</u><br>";
								str += "<div id='clearDiv' style='margin-top:10px'></div>"; //little padding
								var children = req.responseXML.getElementsByTagName("node");
								for(var j=0;j<children.length;++j)
								{
									//must all be value/link nodes					
									str += "<b class='bold-header' style='color:rgb(65, 86, 146);'>" +
											DesktopContent.getXMLValue(children[j]) + "</b>";
									str += " : ";
									str += DesktopContent.getXMLValue(children[j].children[0]);
									str += "<br>";
								}				

								uel.innerHTML = str;
									},
									0,0,0,true); //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
						}
						
					} //end of localCreateLinkEditHTML definition
					
					
					var linkTableVersion = -1;
					for(var j=0;j<treeMemberNames_.length;++j)
						if(selectLinkTableName == treeMemberNames_[j])
						{
							linkTableVersion = treeMemberVersions_[j];
							break;
						}
					if(linkTableVersion == -1)
					{
						//if there is no valid table name, 
						//	then jump to html creation
						
						Debug.log("Invalid tree member table targeted!");//,Debug.HIGH_PRIORITY);
						localCreateLinkEditHTML([],[],[]);						
						return;					
					}

					//get possible choices for 
					//	link table, link type, and link index
					//... from server:
					DesktopContent.XMLHttpRequest("Request?RequestType=getLinkToChoices" +	
							"&linkToTableName=" + selectLinkTableName +		
							"&linkToTableVersion=" + linkTableVersion +		
							"&linkIdType=" + linkIdType +
							"&linkIndex=" + linkIndex +
							"&linkInitId=" + selectLinkId,
							"", function(req) 
							{
						var err = DesktopContent.getXMLValue(req,"Error");
						if(err) 
						{						
							Debug.log(err,Debug.HIGH_PRIORITY);
							
							//do not kill edit if worked before.. 
							//	in case user is playing with tables
							//revert to last successful table selection							
							if(optionIndex == -1)
							{
								editCellCancel();
							}
							else
							{
								Debug.log("Reverting back to previous table selection.",
										Debug.HIGH_PRIORITY);
								el.getElementsByTagName("select")[0].selectedIndex = optionIndex;
							}
														
							return;
						}

						var linkToChoices = req.responseXML.getElementsByTagName("linkToChoice");
						var groupMembers = req.responseXML.getElementsByTagName("groupMember");
						var groupChoices = req.responseXML.getElementsByTagName("groupChoice");
						
						//group links also need table version in init value
						if(treeEditingNodeType_ == "link-GroupID" &&
								firstTimeMembers)
							treeEditingNodeInitValue_ += "," + linkTableVersion;
									
						localCreateLinkEditHTML(linkToChoices,groupMembers,groupChoices);


							},0,0,0,true //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
					); //end of getLinkToChoices handler
				}; //end of localGetLinkToChoices definition
				
				localGetLinkToChoices(linkTable);

			}
						
			_editingCell = true;
			_editingCellEl = el;			

			_editingCellElOldTitle = el.title;
			el.title = "";
						
			return true;
		}
		
		//selectThisCell ~~
		function selectThisCell(r,c,el,event) 
		{	
			_editingCellElOldTitle = el.title; //originally only used by tree, but 
											//table cells have title now too
			
			if(event) //stop the body from also calling onmouseup and cancelling select
			{
				event.stopPropagation();

				Debug.log(_mouseIsSelecting);
				if(_mouseIsSelecting) //block select if mouse is selecting text currently 
				{
					_mouseIsSelecting = false;
					Debug.log(_mouseIsSelecting);
					return; 							
				}
			}
			
			if(_editingCell) //already have the edit box open, cancel it
			{
				if(_editingCellEl == el) //if same cell do nothing
					return true;
				editCellOK(); //editCellCancel(); //if new cell cancel
			}
			
			var tableEl = document.getElementById("SubSystemTable");
			var rows = tableEl.getElementsByTagName("tr");

			//if column type is Author or Timestamp, don't allow select
			var colType;
			if(_tableViewIsTransposed) 	//type is at col 0
				colType = rows[_CONFIG_DATA_COL_OFFSET+c].getElementsByTagName("td")[0].childNodes[0].innerHTML.split('<')[0];
			else						//type is at row 0
				colType = rows[0].getElementsByTagName("td")[_CONFIG_DATA_COL_OFFSET+c].childNodes[0].innerHTML.split('<')[0]; //type text is in a div for smaller font			
			
			if(colType == "Author" || 
					colType == "Timestamp")
				return false;
			
			
			_editingCell = true;
			_editingCellEl = el;
			_editingCellPos = [r,c];
			
			_editingCellElOldValue = el.textContent;//el.innerHTML;
			var str = "";		
			var optionIndex = -1;
					
			Debug.log("colType=" + colType);
			Debug.log("colType.indexOf('ChildLink')" + colType.indexOf("ChildLink"));
			Debug.log("_tableLinkDropdownChoices " + _tableLinkDropdownChoices.length);
			if(_useTableLinkDropdown && 
					colType.indexOf("ChildLink") == 0 &&
					colType.indexOf("ChildLinkGroupID") < 0 &&
					colType.indexOf("ChildLinkUID") < 0) //if column type is ChildLink, use dropdown
			{
				str += "<select  onkeydown='keyHandler(event)' " +
						"style='margin:-4px -2px -4px 1px;width:" + 
						(el.offsetWidth-6) + "px; height:" + (el.offsetHeight-8) + "px'>";
				for(var i=0;i<_tableLinkDropdownChoices.length;++i)
				{			
					str += "<option value='" + _tableLinkDropdownChoices[i]//.getAttribute("value")
							+ "'>";
					str += _tableLinkDropdownChoices[i];//.getAttribute("value");	//can display however
					str += "</option>";
					if(_tableLinkDropdownChoices[i]//getAttribute("value") 
							== _editingCellElOldValue)
						optionIndex = i; //get starting sel index
				}				
				str += "</select>";				
			}
			else if(colType == "FixedChoiceData")
			{
				str += "<select  onkeydown='keyHandler(event)' " +
						"style='margin:-4px -2px -4px 1px;width:" + 
						(el.offsetWidth-6) + "px; height:" + (el.offsetHeight-8) + "px'>";
				
				//default value is assumed in list
				str += "<option>";
				str += decodeURIComponent(_tableDefaultRowValues[c]);	//can display however
				str += "</option>";
				if(decodeURIComponent(_tableDefaultRowValues[c])
											 == _editingCellElOldValue)
					optionIndex = 0; //get starting sel index
				
				for(var i=0;i<_tableFixedChoiceData[c].length;++i)
				{			
					str += "<option>";
					str += decodeURIComponent(_tableFixedChoiceData[c][i]);	//can display however
					str += "</option>";
					if(decodeURIComponent(_tableFixedChoiceData[c][i]) 
												 == _editingCellElOldValue)
						optionIndex = i+1; //get starting sel index
				}				
				str += "</select>";	
			}
			else if(colType == "BitMap")
			{
				//let API bitmap dialog handle it
				ConfigurationAPI.bitMapDialog(
						"Bitmap", //field name
						_tableFixedChoiceData[c],
						_editingCellElOldValue,
						function()
						{
							Debug.log("yes");
						},
						function() //cancel handler
						{							
							//remove the editing cell selection
							Debug.log("no");
							_editingCell = false;
							_editingCellEl = 0;
						});
				return true;
			}
			else if(colType == "MultilineData")
			{
				//onkeydown='keyHandler(event)' 
				str += "<textarea rows='4' onkeydown='keyHandler(event)' cols='50' style='font-size: 14px; margin:-4px -2px -4px -1px;width:" + 
						(el.offsetWidth-6) + "px; height:" + (el.offsetHeight-8) + "px' ";
				str += " onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
						"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting);' " +
						">";
				str += _editingCellElOldValue;
				str += "</textarea>";				
			}
			else if(colType == "YesNo" || 
					colType == "TrueFalse" || 
					colType == "OnOff")  //if column type is boolean, use dropdown
			{
				var boolVals = [];
				if(colType == "YesNo")
					boolVals = ["No","Yes"];
				else if(colType == "TrueFalse")
					boolVals = ["False","True"];
				else if(colType == "OnOff")
					boolVals = ["Off","On"];
				

				str += "<select  onkeydown='keyHandler(event)' " +
						"style='margin:-4px -2px -4px 1px;width:" + 
						(el.offsetWidth-6) + "px; height:" + (el.offsetHeight-8) + "px'>";
				for(var i=0;i<boolVals.length;++i)
				{			
					str += "<option value='" + boolVals[i] + "'>";
					str += boolVals[i];	//can display however
					str += "</option>";
					if(boolVals[i] == _editingCellElOldValue)
						optionIndex = i; //get starting sel index					
				}			
				str += "</select>";
				if(optionIndex == -1) optionIndex = 0; //use False option by default
			}
			else // normal cells, with text input
			{
				str += "<input type='text' onkeydown='keyHandler(event)' style='margin:-4px -2px -4px -1px;width:" + 
						(el.offsetWidth-6) + "px; height:" + (el.offsetHeight-8) + "px' value='";
				str += _editingCellElOldValue.replace(/'/g, "&apos;"); //replace single quotes since within html
				str += "' onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
						"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting);' " +
						">";
			}
						
			str += _OK_CANCEL_DIALOG_STR;		
			
			el.innerHTML = str;

			if(_useTableLinkDropdown && 
					colType.indexOf("ChildLink") == 0 &&
					colType.indexOf("ChildLinkGroupID") < 0 &&
					colType.indexOf("ChildLinkUID") < 0) //if column type is ChildLink, use dropdown
			{
				el.getElementsByTagName("select")[0].selectedIndex = optionIndex;
				el.getElementsByTagName("select")[0].focus();
			}
			else if(colType == "FixedChoiceData")
			{
				el.getElementsByTagName("select")[0].selectedIndex = optionIndex;
				el.getElementsByTagName("select")[0].focus();				
			}
			else if(colType == "MultilineData")
				ConfigurationAPI.setCaretPosition(el.getElementsByTagName("textarea")[0],0,_editingCellElOldValue.length);					
			else if(colType == "YesNo" || 
					colType == "TrueFalse" || 
					colType == "OnOff")  //if column type is boolean, use dropdown
			{
				el.getElementsByTagName("select")[0].selectedIndex = optionIndex;
				el.getElementsByTagName("select")[0].focus();				
			}
			else //select text box
				ConfigurationAPI.setCaretPosition(el.getElementsByTagName("input")[0],0,_editingCellElOldValue.length);
			
			return true;
		}				
		
		//bodyMouseHandler ~~
		function bodyMouseHandler(e)
		{		
			//Debug.log("bodyMouseHandler");
			if(!_mouseIsSelecting)
			{
				//detect proper views
				var el = document.getElementById("treeView-ConfigGroupLink");
				if(el) //tree view ok handler
					editTreeNodeOK();
				else
					editCellOK();
			}
			_mouseIsSelecting = false; 
			//Debug.log(_mouseIsSelecting);
		}
		
		//bodyKeyHandler ~~
		function bodyKeyHandler(e) 
		{
			//detect proper views
			var el = document.getElementById("treeView-ConfigGroupLink");	
			var popUpEl = document.getElementById("popUpDialog");

			//tree view key handler and no popup and no editing cell
			if(el && !popUpEl && !_editingCellEl) 
			{	
				//NOTE: Firefox and Chrome have different keycodes for +/-
				var expandKeys = [65,69,190,221,187,61]; // a, e, >, }, +, FF+ (no shift needed)
				var hideKeys = [90,77,188,219,189,173]; // z, m, <, {, -, FF- (no shift needed)
				
				//Debug.log("treeView bodyKey " + e.keyCode);
								
				for(var i=0;i<expandKeys.length;++i)
					if(expandKeys[i] == e.keyCode)
					{
						//handle expand
						Debug.log("treeView bodyKey expand " + e.keyCode);
						expandTreeChildrenDepth();
						break;
					}

				for(var i=0;i<hideKeys.length;++i)
					if(hideKeys[i] == e.keyCode)
					{
						//handle hide
						Debug.log("treeView bodyKey hide " + e.keyCode);
						hideTreeChildrenDepth();
						break;
					}
			}
			//else no handler			
		}
		
		//keyHandler
		function keyHandler(e,keyEl) 
		{
			var TABKEY = 9;
			var ENTERKEY = 13;
			var UPKEY = 38;
			var DNKEY = 40;
			var ESCKEY = 27;
			//Debug.log("key " + e.keyCode);
			
			var shiftIsDown;
			if (window.event) 
			{
				key = window.event.keyCode;
				shiftIsDown = !!window.event.shiftKey; // typecast to boolean
			} 
			else
			{
				key = e.which;
				shiftIsDown = !!e.shiftKey;	// typecast to boolean
			}
			//Debug.log("shift=" + shiftIsDown);
			
			
			//handle text area specially
			if(!shiftIsDown)
			{
				var tel;
				if(_editingCellEl && 
						(tel = _editingCellEl.getElementsByTagName("textarea")).length)
				{
					tel = tel[0];
					//handle special keys for text area
					if(e.keyCode == TABKEY)
					{
						Debug.log("tab.");
						if(e.preventDefault) 
							e.preventDefault();

						var i = tel.selectionStart;
						var j = tel.selectionEnd;
						tel.value =  tel.value.substr(0,i) + 
								'\t' + tel.value.substr(j);
						tel.selectionStart = tel.selectionEnd = j+1;
					}
					return false; //done if text area was identified
				}
			}
			
			//tab key jumps to next cell with a CANCEL
			//	(enter key does same except saves/OKs value)
			//	shift is reverse jump
			if(e.keyCode == TABKEY || e.keyCode == ENTERKEY || 
					e.keyCode == UPKEY || e.keyCode == DNKEY) 				
			{
				//this.value += "    ";
				if(e.preventDefault) 
					e.preventDefault();

				 
				editCellOK();
				if(e.keyCode == ENTERKEY) //dont move to new cell
					return false;
				
				//detect tree view
				var el = document.getElementById("treeView-ConfigGroupLink");
				if(el)
				{
					Debug.log("TODO - Could move to next cell in future in tree-view.");
					return;
				}
				
				//jump forward (tab/enter) or backward (tab/enter+shift)
				//	or up or down.
				//get number of rows and cols
				//	to determine next row and col to jump to
				
				
				var newRow = _editingCellPos[0];
				var newCol = _editingCellPos[1];
				var el = document.getElementById("SubSystemTable");
				var rows = el.getElementsByTagName("tr");

				var numOfRows;
				var numOfCols;
				
				if(_tableViewIsTransposed)
				{
					numOfCols = rows.length - _CONFIG_DATA_COL_OFFSET;
					numOfRows = rows[0].getElementsByTagName("td").length + 1 - 
							_CONFIG_DATA_ROW_OFFSET; //assume one TH cell
				}
				else
				{
					numOfRows = rows.length - _CONFIG_DATA_ROW_OFFSET;
					numOfCols = rows[_CONFIG_DATA_ROW_OFFSET-1].getElementsByTagName("th").length - 
							_CONFIG_DATA_COL_OFFSET;					
				}
				
				do
				{					
					if(e.keyCode == TABKEY || e.keyCode == ENTERKEY)
						newCol += (shiftIsDown?-1:1);
					else if(e.keyCode == UPKEY)
						--newRow;
					else if(e.keyCode == DNKEY)
						++newRow;
					
					//new position is chosen! now make it happen (in a clean way)	
									
					if(newCol == numOfCols)	{ ++newRow; newCol = 0;	}
					if(newRow == numOfRows) newRow = 0;
					if(newCol < 0) {--newRow; newCol = numOfCols-1; }
					if(newRow < 0) newRow = numOfRows-1;					

					if(_tableViewIsTransposed)
						el = rows[_CONFIG_DATA_COL_OFFSET+newCol].getElementsByTagName("td")[_CONFIG_DATA_ROW_OFFSET-1+newRow];
					else
						el = rows[_CONFIG_DATA_ROW_OFFSET+newRow].getElementsByTagName("td")[_CONFIG_DATA_COL_OFFSET+newCol];
				
				} while(!selectThisCell(newRow,newCol,el));

				Debug.log("newRow=" + newRow + " newCol=" + newCol);
				
				return false;
			}
			else if(e.keyCode == ESCKEY) 
			{				
				if(e.preventDefault) 
					e.preventDefault();
				editCellCancel();
				return false;
			}
			else if((e.keyCode >= 48 && e.keyCode <= 57) || 
					(e.keyCode >= 96 && e.keyCode <= 105))// number
			{
				//if child link cell or boolean cell			
				var sel;
				if((sel = _editingCellEl.getElementsByTagName("select")).length)
				{
					if(keyEl) //if input element, use it
						sel = keyEl;
					else
						sel = sel[sel.length-1]; //assume the last select in the cell is the select
					
					//select based on number
					var selNum;
					if(e.keyCode >= 96)
						selNum = e.keyCode - 96;
					else
						selNum = e.keyCode - 48;
					
					sel.selectedIndex = selNum % (sel.options.length);
					sel.focus();	
					
					Debug.log("number select =" + sel.selectedIndex);
					if(sel.onchange) //if onchange implemented call it
						sel.onchange();
				}
			}
		}
		

		//popUpSaveTreeForm ~~
		function popUpGroupViewAliasForm(groupName,groupKey)
		{
			Debug.log("CfgGUI popUpGroupViewAliasForm");	

			var str = "";

			var el = document.getElementById("popUpDialog");
			if(!el)
			{
				el = document.createElement("div");			
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 380;
			var h = 215;
			ConfigurationAPI.setPopUpPosition(el,w /*w*/,h /*h*/);
			
//			var ww = DesktopContent.getWindowWidth();
//			var wh = DesktopContent.getWindowHeight();
//			el.style.top = (DesktopContent.getWindowScrollTop() + ((wh-h-2)/2)) + "px"; 
//			el.style.left = (DesktopContent.getWindowScrollLeft() + ((ww-w-2)/2)) + "px";
//			el.style.width = w + "px";
//			el.style.height = h + "px";

			
			//show choices of group aliases or alternatively textbox
			//	default to the system alias that is closest to groupName/groupKey
			
			
			//get existing group aliases	
			///////////////////////////////////////////////////////////
			DesktopContent.XMLHttpRequest("Request?RequestType=getGroupAliases" +	
					"",
					"",
					function(req) 
					{
				var err = DesktopContent.getXMLValue(req,"Error");
				if(err) 
				{					
					Debug.log(err,Debug.HIGH_PRIORITY);
					el.innerHTML = str;
					return;
				}

				var aliases = req.responseXML.getElementsByTagName("GroupAlias");
				var aliasGroupNames = req.responseXML.getElementsByTagName("GroupName");
				var aliasGroupKeys = req.responseXML.getElementsByTagName("GroupKey");

				//Show dropdown for alias
				//	and a pencil to change dropdown to text box to free-form alias.
				//Also, identify if already aliased and choose that as default option
				//	in dropwdown.					
				var alias, aliasGroupName, aliasGroupKey;
				var i = 0; //re-using code that had multiple groups, this requires just one group					
				var groupOptionIndex = []; //keep ABSOLUTE distance and index of option for each group, or -1 if none
				
				groupOptionIndex.push([-1,0]); //index and distance

				//find alias
				var modTblStr = ""; 
				for(var j=0;j<aliasGroupNames.length;++j)
				{
					alias = DesktopContent.getXMLValue(aliases[j]);
					aliasGroupName = DesktopContent.getXMLValue(aliasGroupNames[j]);
					aliasGroupKey = DesktopContent.getXMLValue(aliasGroupKeys[j]);	

					//Debug.log("compare " + aliasGroupName + ":" +
					//		aliasGroupKey);

					//also build drop down
					modTblStr += "<option value='" + alias + "' ";

					//consider any alias with same groupName
					if(aliasGroupName == groupName)
					{
						if(groupOptionIndex[i][0] == -1 ||	//take best match
								Math.abs(groupKey - aliasGroupKey) < groupOptionIndex[i][1])
						{
							Debug.log("found alias");
							groupOptionIndex[i][0] = j; //index
							groupOptionIndex[i][1] = Math.abs(groupKey - aliasGroupKey); //ABSOLUTE distance
						}
					}
					modTblStr += ">";
					modTblStr += alias;	//can display however
					modTblStr += "</option>";
				}

				var str = "<a id='" + 
						"popUpDialog" + 
						"-header' href='#' onclick='javascript:var el = document.getElementById(" +
						"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

				str += "<div id='popUpDialog-div'>";				

				str += "Please choose a System Alias below and then click 'Create System Alias' " +
						"to setup a System Alias referring to the current group  '" + 
						groupName + " (" + groupKey + ").'<br><br>";
				
				str += "<center>";
				str += "Set '<b style='font-size:16px'>" + groupName + " (" + 
						groupKey + ")</b>' to System Alias:";
				str += "</a><br>";
				str += "<table cellpadding='0' cellspacing='0' border='0'><tr><td>";
				str += "<select " +
						"id='popUpDialog-editAliasSelect-" + (i) + "' " +
						"style='margin:2px; height:" + (25) + "px'>";						
				str += modTblStr;
				str += "</select>";						

				str += "<input type='text' " +
						"id='popUpDialog-editAliasTextBox-" + (i) + "' " +
						"style='display:none; margin:2px; width:150px; height:" + 
						(19) + "px'>";						
				str += "";
				str += "</input>";	
				str += "</td><td>";

				str += "<div style='display:block' " + 
						"class='treeNode-Value-editIcon' id='popUpDialog-editIcon-" +
						(i) + "' " +
						"onclick='handleEditTreeAliasEditToggle(" +							 
						i + 
						");' " +
						"title='Toggle free-form system alias editing' " +
						"></div>";

				str += "</td></tr></table>";				


				// done with system alias handling
				// continue with pop-up prompt

				str += "</center></div><br>"; //close main popup div

				var onmouseupJS = "";
				onmouseupJS += "document.getElementById(\"popUpDialog-submitButton\").disabled = true;";
				onmouseupJS += "popUpGroupViewAliasFormSubmit(\"" + groupName +
				"\",\"" + groupKey + "\");";

				str += "<input id='popUpDialog-submitButton' type='button' onmouseup='" + 
						onmouseupJS + "' " +
						"value='Alias' title='" +
						"Set the System Alias to the current Group name and key" +						
						"'/>";
				el.innerHTML = str;

				//handle default dropdown selections for group alias
				if(groupOptionIndex[i][0] != -1) //have a default
					document.getElementById("popUpDialog-editAliasSelect-" + 
							i).selectedIndex = groupOptionIndex[i][0];

					},0,0,0,true //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
			); //end of getGroupAliases handler

			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";
		}
		
		//popUpGroupViewAliasFormSubmit ~~
		function popUpGroupViewAliasFormSubmit(groupName,groupKey)
		{
			//get group alias
			var groupAlias;
			{
				var setAliasCheckboxIndex = 0;
				var el = document.getElementById("popUpDialog-editAliasSelect-" +
						setAliasCheckboxIndex);
				if(el.style.display == "none")
				{
					//get value from text box
					el = document.getElementById("popUpDialog-editAliasTextBox-" + 
							setAliasCheckboxIndex);					
				}
				groupAlias = el.value;
			}
			Debug.log("Group view alias setting to " + groupAlias);
			ConfigurationAPI.setGroupAliasInActiveBackbone(groupAlias,groupName,groupKey,0,
					function(retParams) //done handler
					{
				if(retParams) 
				{
					if(retParams.newBackbone)
						Debug.log("Successfully modified the active Backbone group " +
								" to set the System Alias '" + groupAlias + "' to " +
								" refer to the current group '" + groupName + 
								" (" + groupKey + ").'" +
								"\n\n" +
								"Backbone group '" + retParams.groupName + " (" + 
								retParams.groupKey + ")' was created and activated.",
								Debug.INFO_PRIORITY);
					else
						Debug.log("Success, but no need to create a new Backbone group. " +
								"An existing Backbone group " +
								" already has the System Alias '" + groupAlias + "' " +
								" referring to the current group '" + groupName + 
								" (" + groupKey + ").'" +
								"\n\n" +
								"Backbone group '" + retParams.groupName + " (" + 
								retParams.groupKey + ")' was activated.",
								Debug.INFO_PRIORITY);
				}
				
				//kill popup dialog
				var el = document.getElementById("popUpDialog"); 
				if(el) el.parentNode.removeChild(el);
				
					}, true); //request return parameters
		}
		
		//popUpSaveTreeForm ~~
		function popUpSaveTreeForm()
		{
			Debug.log("CfgGUI popUpSaveTreeForm");	

			var str = "";

			var el = document.getElementById("popUpDialog");
			if(!el)
			{
				el = document.createElement("div");			
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var gh = 50;
			var w = 380;
			var h = 330;
			ConfigurationAPI.setPopUpPosition(el,w /*w*/,h-gh*2 /*h*/);
//			var gh = 50;
//			var ww = DesktopContent.getWindowWidth();
//			var wh = DesktopContent.getWindowHeight();
//			el.style.top = (DesktopContent.getWindowScrollTop() + ((wh-h-2)/2)- gh*2) + "px"; //allow for 2xgh growth for each affected group
//			el.style.left = (DesktopContent.getWindowScrollLeft() + ((ww-w-2)/2)) + "px";
//			el.style.width = w + "px";
//			el.style.height = h + "px";

			//always
			//	- save modified tables (show list of modified tables)
			//		(and which active group they are in)
			//
			//optionally
			//	- checkbox to bump version of modified active groups
			//	- checkbox to assign system alias to bumped active group 
				
			
			var modTblCount = 0;
			var modTblStr = "";
			var modifiedTables = ""; //csv table, temporay version,...
			for(var j=0;j<treeMemberNames_.length;++j)
				if((treeMemberVersions_[j]|0) < -1)
				{
					if(modTblCount++)
						modTblStr += ",";
					modTblStr += treeMemberNames_[j];
					
					if(modifiedTables.length)
						modifiedTables += ",";
					modifiedTables += treeMemberNames_[j];
					modifiedTables += ",";
					modifiedTables += treeMemberVersions_[j];
				}

			var str = "<a id='" + 
					"popUpDialog" + 
					"-header' href='#' onclick='javascript:var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "Saving the tree will create new persistent versions of each modified table." + 
					"<br><br>" + 
					"Here is the list of modified tables (count=" + modTblCount + 
					"):" +					
					"<br>";
			
			
			//display modified tables
			str += "<div style='white-space:nowrap; width:" + w + "px; height:40px; " + 
					"overflow:auto; font-weight: bold;'>";
			str += modTblStr;
			str += "</div>";			
			
			//get affected groups
			//	and save member map to hidden div for Save action			
			var configGroupEls = document.getElementById("treeView-ConfigGroupLink").childNodes;
			///////////////////////////////////////////////////////////
			DesktopContent.XMLHttpRequest("Request?RequestType=getAffectedActiveGroups" +	
					"&groupName=" + configGroupEls[0].innerHTML + 
					"&groupKey=" + configGroupEls[1].innerHTML,
					"&modifiedTables=" + modifiedTables,
					function(req) 
					{
				var err = DesktopContent.getXMLValue(req,"Error");
				if(err) 
				{					
					Debug.log(err,Debug.HIGH_PRIORITY);
					el.innerHTML = str;
					return;
				}

				//for each affected group
				//	 put csv: name,key,memberName,memberVersion...
				var groups = req.responseXML.getElementsByTagName("AffectedActiveGroup");				
				var memberNames, memberVersions;
				var xmlGroupName;
				modTblStr = ""; //re-use
				for(var i=0;i<groups.length;++i)
				{
					xmlGroupName = DesktopContent.getXMLValue(groups[i],"GroupName");
					str += "<div style='display:none' class='popUpDialog-affectedGroups' >";
					str += xmlGroupName;
					str += "," + DesktopContent.getXMLValue(groups[i],"GroupKey");

					memberNames = groups[i].getElementsByTagName("MemberName");
					memberVersions = groups[i].getElementsByTagName("MemberVersion");
					Debug.log("memberNames.length " + memberNames.length);
					for(var j=0;j<memberNames.length;++j)
						str += "," + DesktopContent.getXMLValue(memberNames[j]) + 
						"," + DesktopContent.getXMLValue(memberVersions[j]);
					str += "</div>"; //close div popUpDialog-affectedGroups


					if(modTblStr.length)
						modTblStr += ",";


					modTblStr += "<a style='color:black' href='#' onclick='javascript:" +								
							"var forFirefox = handleGroupCommentToggle(\"" + xmlGroupName + "\");" +								
							" handlePopUpHeightToggle(" + h + "," + gh + ");'>";
					modTblStr += xmlGroupName;
					modTblStr += "</a>";

					//store cached group comment in hidden html
					modTblStr += "<div id='popUpDialog-groupComment-" + 
							xmlGroupName + "' " +
							"class='popUpDialog-groupComment-cache' " + 
							"style='display:none'>" + 
							decodeURIComponent(DesktopContent.getXMLValue(groups[i],"GroupComment")) +
							"</div>";
				}

				str += "Please choose the options you want and click 'Save Tree':" +
						"<br>";
				
				//add checkbox to save affected groups
				str += "<input type='checkbox' id='popUpDialog-bumpGroupVersions' checked " +
						"onclick='handlePopUpHeightToggle(" + h + "," + gh + ");'>";
				//add link so text toggles checkbox
				str += "<a href='#' onclick='javascript:" +
						"var el = document.getElementById(\"popUpDialog-bumpGroupVersions\");" +
						"var forFirefox = (el.checked = !el.checked);" +
						" handlePopUpHeightToggle(" + h + "," + gh + "); return false;'>";
				str += "Save Affected Groups as New Keys";
				str += "</a>";
				str +=	"</input><br>";
				
				//add checkbox to activate saved affected groups
				str += "<input type='checkbox' id='popUpDialog-activateBumpedGroupVersions' checked " +
						">";
				//add link so text toggles checkbox
				str += "<a href='#' onclick='javascript:" +
						"var el = document.getElementById(\"popUpDialog-activateBumpedGroupVersions\");" +
						"if(el.disabled) return false; " +
						"var forFirefox = (el.checked = !el.checked);" +
						"return false;'>";
				str += "Also Activate New Groups";
				str += "</a>";
				str +=	"</input><br>";

				str += "Here is the list of affected groups (count=" + groups.length + 
						"):" +					
						"<br>";

				//display affected groups
				str += "<div style='white-space:nowrap; width:" + w + "px; margin-bottom:20px; " + 
						"overflow:auto; font-weight: bold;'>";
				str += modTblStr;
				str += "<div id='clearDiv'></div>";
				str += "<center>";			

				str += "<div id='popUpDialog-groupComment-header'></div>";

				str += "<div id='clearDiv'></div>";

				str += "<textarea id='popUpDialog-groupComment' rows='4' cols='50' style='width:417px;height:68px;display:none;margin:0;'>";					 
				str += ConfigurationAPI._DEFAULT_COMMENT;
				str += "</textarea>";
				str += "</center>";

				str += "</div>"; //end affected groups div		

				str += "<div id='popUpDialog-groupAliasArea' ><center>";

				//get existing group aliases	
				///////////////////////////////////////////////////////////
				DesktopContent.XMLHttpRequest("Request?RequestType=getGroupAliases" +	
						"",
						"",
						function(req) 
						{
					var err = DesktopContent.getXMLValue(req,"Error");
					if(err) 
					{					
						Debug.log(err,Debug.HIGH_PRIORITY);
						el.innerHTML = str;
						return;
					}

					var aliases = req.responseXML.getElementsByTagName("GroupAlias");
					var aliasGroupNames = req.responseXML.getElementsByTagName("GroupName");
					var aliasGroupKeys = req.responseXML.getElementsByTagName("GroupKey");

					//for each affected group
					//	-Show checkbox for setting alias and dropdown for alias
					//	and a pencil to change dropdown to text box to free-form alias.
					//	-Also, identify if already aliased and choose that as default option
					//	in dropwdown.					
					var alias, aliasGroupName, aliasGroupKey;
					var groupName, groupKey;					
					var groupOptionIndex = []; //keep distance and index of option for each group, or -1 if none
					for(var i=0;i<groups.length;++i)
					{				
						groupOptionIndex.push([-1,0]); //index and distance
						
						groupName = DesktopContent.getXMLValue(groups[i],"GroupName");
						groupKey = DesktopContent.getXMLValue(groups[i],"GroupKey");

						//find alias
						modTblStr = ""; //re-use
						for(var j=0;j<aliasGroupNames.length;++j)
						{
							alias = DesktopContent.getXMLValue(aliases[j]);
							aliasGroupName = DesktopContent.getXMLValue(aliasGroupNames[j]);
							aliasGroupKey = DesktopContent.getXMLValue(aliasGroupKeys[j]);	

							//Debug.log("compare " + aliasGroupName + ":" +
							//		aliasGroupKey);

							//also build drop down
							modTblStr += "<option value='" + alias + "' ";

							//consider any alias with same groupName
							if(aliasGroupName == groupName)
							{
								if(groupOptionIndex[i][0] == -1 ||	//take best match
										Math.abs(groupKey - aliasGroupKey) < groupOptionIndex[i][1])
								{
									Debug.log("found alias");
									groupOptionIndex[i][0] = j; //index
									groupOptionIndex[i][1] = Math.abs(groupKey - aliasGroupKey); //distance
								}
							}
							modTblStr += ">";
							modTblStr += alias;	//can display however
							modTblStr += "</option>";
						}

						str += "<input type='checkbox' class='popUpDialog-setGroupAlias' " +
								(groupOptionIndex[i][0] >= 0?"checked":"") + //check if has an alias already
								">";
						//add link so text toggles checkbox
						str += "<a href='#' onclick='javascript:" +
								"var el = document.getElementsByClassName(\"popUpDialog-setGroupAlias\");" +
								"var forFirefox = (el[" + i + "].checked = !el[" + i + "].checked);" +
								" return false;'>";
						str += "Set '<b style='font-size:16px'>" + groupName + "</b>' to System Alias:";
						str += "</a><br>";

						str += "<table cellpadding='0' cellspacing='0' border='0'><tr><td>";
						str += "<select " +
								"id='popUpDialog-editAliasSelect-" + (i) + "' " +
								"style='margin:2px; height:" + (25) + "px'>";						
						str += modTblStr;
						str += "</select>";						

						str += "<input type='text' " +
								"id='popUpDialog-editAliasTextBox-" + (i) + "' " +
								"style='display:none; margin:2px; width:150px; height:" + 
								(19) + "px'>";						
						str += "";
						str += "</input>";	
						str += "</td><td>";

						str += "<div style='display:block' " + 
								"class='treeNode-Value-editIcon' id='popUpDialog-editIcon-" +
								(i) + "' " +
								"onclick='handleEditTreeAliasEditToggle(" +							 
								i + 
								");' " +
								"title='Toggle free-form system alias editing' " +
								"></div>";

						str += "</td></tr></table>";

						str +=	"</input>";

						//increase height each time a group check is added
						h += gh;
						el.style.height = h + "px";						
					}

					str += "</center></div>"; //close id='popUpDialog-groupAliasArea'


					// done with system alias handling
					// continue with pop-up prompt

					str += "</div><br>"; //close main popup div

					var onmouseupJS = "";
					onmouseupJS += "document.getElementById(\"popUpDialog-submitButton\").disabled = true;";
					onmouseupJS += "handleGroupCommentToggle(0,1);"; //force cache of group comment
					onmouseupJS += "handlePopUpHeightToggle(" + h + "," + gh + ");";
					onmouseupJS += "saveModifiedTree();";					

					str += "<input id='popUpDialog-submitButton' type='button' onmouseup='" + 
							onmouseupJS + "' " +
							"value='Save Tree' title='" +
							"Save new versions of every modified table\n" +
							"(Optionally, save new active groups and assign system aliases)" +
							"'/>";
					el.innerHTML = str;
					
					//handle default dropdown selections for group alias
					for(var i=0;i<groups.length;++i)
						if(groupOptionIndex[i][0] != -1) //have a default
							document.getElementById("popUpDialog-editAliasSelect-" + 
									i).selectedIndex = groupOptionIndex[i][0];

						},0,0,0,true //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
				); //end of getGroupAliases handler

					},0,0,0,true //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
			); //end of getActiveConfigGroups handler			


			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";
		}
		
		//saveModifiedTree ~~
		//	ignoreWarnings = true will ignore warnings when saving groups
		function saveModifiedTree(ignoreWarnings)
		{			
			Debug.log("saveModifiedTree " + (ignoreWarnings?1:0));			
			
			//for each modified table
			//	save new version
			//	update tree member table version based on result
			//if saving groups
			//	for each affected group
			//		save member list but with tree table versions
			//		modify root group name if changed
			//if saving aliases
			//	for each alias
			//		set alias for new group
			
			//Note: all information comes from popup dialog
			//	any return must also kill the popup

			var numberOfRequests = 0;
			var numberOfReturns = 0;
			var allRequestsSent = false;		
			
			//localHandleAffectedGroups ~~
			function localHandleAffectedGroups()
			{
				Debug.log("Done with table saving.");

				//check if saving groups
				var savingGroups = 
						document.getElementById("popUpDialog-bumpGroupVersions").checked;
				var activatingSavedGroups = 
						document.getElementById("popUpDialog-activateBumpedGroupVersions").checked;

				if(!savingGroups) //then no need to proceed. exit!
				{
					//kill popup dialog
					var el = document.getElementById("popUpDialog"); 
					if(el) el.parentNode.removeChild(el);	
					return;
				}
				
				//identify root group name/key
				var rootGroupEl = document.getElementById("treeView-ConfigGroupLink");
				var rootGroupName = rootGroupEl.childNodes[0].textContent;
				var rootGroupKey = rootGroupEl.childNodes[1].textContent;

				Debug.log("rootGroup = " + rootGroupName + "(" + rootGroupKey + ")");
				Debug.log("On to saving groups");

				numberOfRequests = 0;		//re-use
				numberOfReturns = 0;		//re-use
				allRequestsSent = false; 	//re-use

				var affectedGroupNames = []; //to be populated for use by alias setting
				var affectedGroupKeys = []; //to be populated for use by alias setting
				var affectedGroupEls = 
						document.getElementsByClassName("popUpDialog-affectedGroups");
				var affectedGroupCommentEls = 
						document.getElementsByClassName("popUpDialog-groupComment-cache");						
				
				//	for each affected group
				for(var i=0;i<affectedGroupEls.length;++i)
				{
					//save member list but with tree table versions
					Debug.log(affectedGroupEls[i].textContent);
					Debug.log("group comment: " + affectedGroupCommentEls[i].textContent);

					var affectedArr = affectedGroupEls[i].textContent.split(','); 

					//build member config map
					var configMap = "configList=";
					//member map starts after group name/key (i.e. [2])
					for(var a=2;a<affectedArr.length;a+=2)								
						if((affectedArr[a+1]|0) < -1) //there should be a new modified version
						{
							Debug.log("affectedArr " + affectedArr[a] + "-v" + affectedArr[a+1]);
							//find version
							for(var k=0;k<treeMemberNames_.length;++k)
								if(affectedArr[a] == treeMemberNames_[k])
								{
									Debug.log("found " + treeMemberNames_[k] + "-v" + treeMemberVersions_[k]);
									configMap += affectedArr[a] + "," + 
											treeMemberVersions_[k] + ",";
									break;
								}
						}
						else //use existing version
							configMap += affectedArr[a] + "," + affectedArr[a+1] + ",";

					affectedGroupNames.push(affectedArr[0]);		
					reqStr = ""; //reuse
					reqStr = "Request?RequestType=saveNewConfigurationGroup" +
							"&groupName=" + affectedArr[0] +
							"&allowDuplicates=1" +
							"&ignoreWarnings=" + (ignoreWarnings?1:0) + 
							"&groupComment=" + encodeURIComponent(affectedGroupCommentEls[i].textContent);
					Debug.log(reqStr);
					Debug.log(configMap);

					++numberOfRequests;
					///////////////////////////////////////////////////////////
					DesktopContent.XMLHttpRequest(reqStr, configMap, 
							function(req,treeMemberIndex) 
							{

						var attemptedNewGroupName = DesktopContent.getXMLValue(req,"AttemptedNewGroupName");
						var treeErr = DesktopContent.getXMLValue(req,"TreeErrors");
						if(treeErr) 
						{	
							Debug.log(treeErr,Debug.HIGH_PRIORITY);
							Debug.log("There were problems identified in the tree view of the " +
									"attempted new group '" +
									attemptedNewGroupName +
									"'.\nThe new group was not created.\n" +
									"(Note: Other tables and groups may have been successfully created, " +
									"and would have success indications below this error info)\n\n" +
									"You can save the group anyway (if you think it is a good idea) by clicking " +
									"the button in the pop-up dialog " +
									"'<u>Save Groups with Warnings Ignored</u>.' " +
									"\n\nOtherwise, you can hit '<u>Cancel</u>.' and fix the tree. " +
									"Below you will find the description of the problem:",																		
									Debug.HIGH_PRIORITY);

							//change dialog save button
							var el = document.getElementById("popUpDialog-submitButton");
							el.onmouseup = function() {
								document.getElementById("popUpDialog-submitButton").disabled = true;
								saveModifiedTree(1);								
							};
							el.value = "Save Groups with Warnings Ignored";
							el.disabled = false;
							return;
						}

						var err = DesktopContent.getXMLValue(req,"Error");
						if(err) 
						{					
							Debug.log(err,Debug.HIGH_PRIORITY);

							//kill popup dialog
							var el = document.getElementById("popUpDialog"); 
							if(el) el.parentNode.removeChild(el);	
							return;
						}			

						++numberOfReturns;

						var newGroupKey = DesktopContent.getXMLValue(req,"ConfigurationGroupKey");									
						affectedGroupKeys.push(newGroupKey);

						//need to modify root group name if changed
						Debug.log("Successfully created new group '" + attemptedNewGroupName + 
								" (" + newGroupKey + ")'", Debug.INFO_PRIORITY);
						
						//activate if option was selected
						if(activatingSavedGroups)
							activateSystemConfig(attemptedNewGroupName,newGroupKey);
						
						//if this was root group, modify
						if(rootGroupName == attemptedNewGroupName)
						{
							//modify display and onlick for root group link
							Debug.log("Modifying root group key");
							var str = "";
							str += "<div style='display:none'>" + rootGroupName + "</div>";
							str += "<div style='display:none'>" + newGroupKey + "</div>";
							str += rootGroupName + " (" + newGroupKey + ")";
							rootGroupEl.innerHTML = str;
							rootGroupEl.onclick = function() {
								
								var backLinkStr = "setupConfigGroupTreeView(\"" + 
										rootGroupName + "\",\"" +
										newGroupKey + "\");";
								setupSpecificConfigGroup(rootGroupName,newGroupKey,
										backLinkStr);
								return false;
							};
							
							//modify group details
							{
								str = "";
								str += "Root-Group Details:";
								var groupComment = DesktopContent.getXMLValue(req,"ConfigurationGroupComment");
								groupComment = decodeURIComponent(groupComment);								
								var groupAuthor = DesktopContent.getXMLValue(req,"ConfigurationGroupAuthor");
								var groupCreationTime = DesktopContent.getXMLValue(req,"ConfigurationGroupCreationTime");
								groupCreationTime = ConfigurationAPI.getDateString(new Date((groupCreationTime|0)*1000));
								
								str += "<table border='0' style='" +
										"border: 1px solid #9c5e5e;" +
										"margin: 5px 0 5px 30px;" +
										"background-color: #d2c1c1;" +
										"'>";
								str += "<tr><th>Author:</th><td class='underlineRow'>" + groupAuthor + "</td></tr>";
								str += "<tr><th>Created:</th><td class='underlineRow'>" + groupCreationTime + "</td></tr>";				
								str += "<tr><th>Comment:</th><td>" + 
										groupComment.replace(/\n/g , "<br>") + "</td></tr>";
								str += "</table>";

								document.getElementById("groupDetails").innerHTML = str;
							}
							
							
							//modify the activate link
							rootGroupEl = document.getElementById("treeView-ConfigGroupActivateLink");
							rootGroupEl.onclick = function() {
								activateSystemConfig(rootGroupName,newGroupKey);
								return false;
							};
							
							//edit global key value
							treeGroupKey_ = newGroupKey;
						}

						if(allRequestsSent && 
								numberOfReturns == numberOfRequests)
						{
							Debug.log("Done with group saving.");

							Debug.log("Moving on to Alias creation...");										

							//check each alias checkbox
							//	for each alias that is checked
							//		set alias for new group
							//if any aliases modified, save and activate backbone

							//get checkboxes
							var setAliasCheckboxes = 
									document.getElementsByClassName("popUpDialog-setGroupAlias");

							var groupAlias, groupName, groupKey;
							var setAliasCheckboxIndex = -1;
							var groupAliasName, groupAliasVersion;

							//in order to set alias, we need:
							//	groupAlias
							//	groupName
							//	groupKey				

							//for each set alias checkbox that is checked
							//	modify the active group alias table one after the other

							//localNextAliasHandler
							//	uses setAliasCheckboxIndex to iterate through setAliasCheckboxes
							//	and send the next request to modify the activegroupAlias table
							//	sequentially
							function localNextAliasHandler(retParams) 
							{
								//first time there is no setAliasCheckboxIndex == -1
								if(setAliasCheckboxIndex >= 0) 
								{	
									if(retParams)
									{
										if(retParams.newBackbone)
											Debug.log("Successfully modified the active Backbone group " +
													" to set the System Alias '" + groupAlias + "' to " +
													" refer to the current group '" + groupName + 
													" (" + groupKey + ").'" +
													"\n\n" +
													"Backbone group '" + retParams.groupName + " (" + 
													retParams.groupKey + ")' was created and activated.",
													Debug.INFO_PRIORITY);
										else
											Debug.log("Success, but no need to create a new Backbone group. " +
													"An existing Backbone group " +
													" already has the System Alias '" + groupAlias + "' " +
													" referring to the current group '" + groupName + 
													" (" + groupKey + ").'" +
													"\n\n" +
													"Backbone group '" + retParams.groupName + " (" + 
													retParams.groupKey + ")' was activated.",
													Debug.INFO_PRIORITY);
									}
									else
									{										
										Debug.log("Process interrupted. Failed to modify the currently active Backbone!",Debug.HIGH_PRIORITY);

										//kill popup dialog
										var el = document.getElementById("popUpDialog"); 
										if(el) el.parentNode.removeChild(el);	
										return;
									}	
									
									++setAliasCheckboxIndex; //req back, so ready for next index
								}
								else
									setAliasCheckboxIndex = 0; //ready for first checkbox
							
								//get next affected group index			
								while(setAliasCheckboxIndex < setAliasCheckboxes.length &&
										!setAliasCheckboxes[setAliasCheckboxIndex].checked)
									Debug.log("Skipping checkbox " + (++setAliasCheckboxIndex));

								if(setAliasCheckboxIndex >= setAliasCheckboxes.length)
								{
									Debug.log("Done with alias checkboxes ");

									if(!retParams)//req) 
									{
										Debug.log("No System Aliases were changed, so Backbone was not modified. Done.");

										//kill popup dialog
										var el = document.getElementById("popUpDialog"); 
										if(el) el.parentNode.removeChild(el);
										treeHasChanged(true); // reset
										return;
									}
									
									Debug.log("Saving and activating Backbone done.");
									
									//kill popup dialog
									var el = document.getElementById("popUpDialog"); 
									if(el) el.parentNode.removeChild(el);	
									treeHasChanged(true); // reset
									return;	
								}	

								//get next alias
								{
									var el = document.getElementById("popUpDialog-editAliasSelect-" +
											setAliasCheckboxIndex);
									if(el.style.display == "none")
									{
										//get value from text box
										el = document.getElementById("popUpDialog-editAliasTextBox-" + 
												setAliasCheckboxIndex);					
									}
									groupAlias = el.value;
								}

								groupName = affectedGroupNames[setAliasCheckboxIndex];
								groupKey = affectedGroupKeys[setAliasCheckboxIndex];

								Debug.log("groupAlias = " + groupAlias);
								Debug.log("groupName = " + groupName);
								Debug.log("groupKey = " + groupKey);

								ConfigurationAPI.setGroupAliasInActiveBackbone(groupAlias,groupName,groupKey,
										"TreeEditWiz",
										localNextAliasHandler,										
										true); //request return parameters		
							}

							localNextAliasHandler();

							Debug.log("Aliases set in motion");

							return;
						}

							},0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
					); //end save new group request								
				} //end affected group for loop

				allRequestsSent = true;
				if(numberOfRequests == 0) //no groups to save
				{
					//this could happen if editing tables with no current active groups
					Debug.log("There were no groups to save!", Debug.INFO_PRIORITY);

					//kill popup dialog
					var el = document.getElementById("popUpDialog"); 
					if(el) el.parentNode.removeChild(el);
					treeHasChanged(true); // reset
				}
			}	//end localHandleAffectedGroups
			
			
			//go through each tree member
			//	if modified table
			//		save new version
			//		update tree member table version based on result
			for(var j=0;j<treeMemberNames_.length;++j)
				if((treeMemberVersions_[j]|0) < -1) //for each modified table
				{
					var reqStr = "Request?RequestType=saveSpecificConfiguration" + 
							"&dataOffset=0&chunkSize=0" +  
							"&configName=" + treeMemberNames_[j] + 
							"&version="+treeMemberVersions_[j] +	
							"&temporary=0" +
							"&tableComment=" + treeMemberComments_[j] +
							"&sourceTableAsIs=1"; 
					Debug.log(reqStr);
					
					++numberOfRequests;
					
					//	save new version
					///////////////////////////////////////////////////////////
					DesktopContent.XMLHttpRequest(reqStr, "", 
							function(req,treeMemberIndex) 
							{
						var err = DesktopContent.getXMLValue(req,"Error");
						if(err) 
						{					
							Debug.log(err,Debug.HIGH_PRIORITY);
							
							//kill popup dialog
							var el = document.getElementById("popUpDialog"); 
							if(el) el.parentNode.removeChild(el);	
							return;
						}						

						var configName = DesktopContent.getXMLValue(req,"savedName");
						var version = DesktopContent.getXMLValue(req,"savedVersion");
						
						Debug.log("Successfully created new table '" + configName + "-v" + 
								version + "'",Debug.INFO_PRIORITY);

						//update tree member table version based on result
						treeMemberVersions_[treeMemberIndex] = version;					
						
						++numberOfReturns;

						if(allRequestsSent && 
								numberOfReturns == numberOfRequests)
						{
							localHandleAffectedGroups();							
						}
							},j,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
					);	//end save new table request
				}	//end modified table for loop
			
			allRequestsSent = true;
			if(numberOfRequests == 0) //no requests were sent, so go on to affected groups
				localHandleAffectedGroups();
		}
		
		//treeHasChanged ~~
		function treeHasChanged(reset)
		{
			if(reset)			
			{
				treeHasChanged_ = false;
				//delete all buttons
				var svBtn = document.getElementById("treeSaveButton");
				while(svBtn)				
				{
					svBtn.parentNode.removeChild(svBtn);
					svBtn = document.getElementById("treeSaveButton");
				}
				return;
			}
			
			if(treeHasChanged_) return;

			//delete all buttons
			var svBtn = document.getElementById("treeSaveButton");
			while(svBtn)				
			{
				svBtn.parentNode.removeChild(svBtn);
				svBtn = document.getElementById("treeSaveButton");
			}

			
			treeHasChanged_ = true;
			
			//add buttons to save tree		
									

			var newDiv = document.createElement("div");
			newDiv.setAttribute("id","treeSaveButton");
			str = "";
			str += "<input type='button' onmouseup='popUpSaveTreeForm()' " + 
					"value='Save All Tree Changes' title='" +
					"Save new versions of every modified table\n" +
					"(Optionally, save new active groups and assign system aliases)" + 
					"'/>";
			str += "<br><br>";
			newDiv.innerHTML = str;

			//insert a new div before and after table
			el = document.getElementById("display");
			var targetEl = document.getElementById("treeView-ConfigGroupLink");
			el.insertBefore(newDiv, targetEl);
			newDiv = document.createElement("div");
			newDiv.setAttribute("id","treeSaveButton");
			newDiv.innerHTML = "<br>" + str;				
			el.appendChild(newDiv);	
		}
		
		
		//editTreeNodeOK
		function editTreeNodeOK() 
		{							
			if(!_editingCellEl) return;
			Debug.log("editTreeNodeOK type " + treeEditingNodeType_);
			
			//local initial variables can be used by continuation edit types 
			//	if globals are temporarily modified
			var initTargetTable = treeEditingTargetTable_;
			
			///////////////////////////////////////////////
			//localEditTreeNodeOKRequestsComplete
			function localEditTreeNodeOKRequestsComplete(tableIndex,newValue)
			{			

				//some types should be handled before cell is cleared
				//	e.g. for continuation of editing, like "table-newGroupRow"
				//	and "table-newUIDRow"
				if(treeEditingNodeType_ == "table-newGroupRow") //spawns from group link edit)
				{					
					//clear children and re-toggle if shown	
					//then 
					//reselect target edit node
					
					var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" + 
							treeEditingNodeIdString_);
					var wasDisplayed = elChildrenNode.style.display != "none" && 
							elChildrenNode.innerHTML != "";

					toggleTreeChildren(
							treeEditingNodeIdString_.split('-')[0],
							treeEditingNodeIdString_.split('-')[1],false);
					elChildrenNode.innerHTML = "";

					if(wasDisplayed)
						toggleTreeChildren(
								treeEditingNodeIdString_.split('-')[0],
								treeEditingNodeIdString_.split('-')[1],true);
					
					//reload members in multiselect
					_editingCellEl.getElementsByTagName("select")[0].onchange();										
					return;
				}
				else if(treeEditingNodeType_ == "table-newUIDRow") //spawns from uid link edit)
				{	
					//reload members uid dropdown
					_editingCellEl.getElementsByTagName("select")[0].onchange();										
					return;					
				}
				
				
				// all other types are clearing the cell
				
				_editingCellEl.innerHTML = "";
				
				
				if(treeEditingNodeType_ == "table")
				{
					treeMemberComments_[tableIndex] = newValue;
					_editingCellEl.appendChild(document.createTextNode("//" + newValue)); 
				}						
				else if(treeEditingNodeType_ == "table-newRow")
				{
					//replace the value that was erased with table name
					_editingCellEl.appendChild(document.createTextNode(treeEditingTargetTable_));
					
					//reset children
					toggleTreeChildren(treeEditingNodeIdString_.split('-')[0],
							treeEditingNodeIdString_.split('-')[1],false);
					document.getElementById("treeNode-ChildrenOf-" + 
							treeEditingNodeIdString_).innerHTML = "";
					toggleTreeChildren(treeEditingNodeIdString_.split('-')[0],
							treeEditingNodeIdString_.split('-')[1],true);
				}
				else if(treeEditingNodeType_ == "uid")
				{
					//modify display and nodename with new value
					_editingCellEl.appendChild(document.createTextNode(newValue)); 
					
					var el = document.getElementById("treeNode-nodeName-" + 
							treeEditingNodeIdString_);
					el.innerHTML = "";
					el.appendChild(document.createTextNode(newValue));
					
					//clear children,
					//and if children were displayed
					//		then toggle/show new children 
					var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" + 
							treeEditingNodeIdString_);
					var wasDisplayed = elChildrenNode.style.display != "none" && 
							elChildrenNode.innerHTML != "";

					toggleTreeChildren(
							treeEditingNodeDepth_,
							treeEditingNodeIdString_.split('-')[1],false);
					elChildrenNode.innerHTML = "";

					if(wasDisplayed)
						toggleTreeChildren(
								treeEditingNodeDepth_,
								treeEditingNodeIdString_.split('-')[1],true);
				}
				else if(treeEditingNodeType_ == "delete-uid")
				{
					//reset parent children is enough
					//	correct response should come from server
					
					
					
					//var el = document.getElementById("treeNode-" + treeEditingNodeIdString_);
					var pel = document.getElementById("treeNode-ChildrenOf-" + 
							treeEditingNodeParentIdString_);
					
					//pel.removeChild(el);
					
					//reset parent children
					toggleTreeChildren(treeEditingNodeParentIdString_.split('-')[0],
							treeEditingNodeParentIdString_.split('-')[1],false);
					pel.innerHTML = "";
					toggleTreeChildren(treeEditingNodeParentIdString_.split('-')[0],
							treeEditingNodeParentIdString_.split('-')[1],true);
					
				}
				else if(treeEditingNodeType_.indexOf("link-") == 0)
				{
					//change link table/id and clear children
					//and edit peripheral link info
					
					var csvArr = newValue.split(',');
					var linkTable = csvArr[0];
					var linkId = csvArr[1];
					newValue = 							
							"-(" + 
							treeEditingNodeType_.split('-')[1] + " = " + linkId + ")";
					//add as text node first in case not html safe
					_editingCellEl.appendChild(document.createTextNode(newValue));
					//then add html piece
					newValue = _editingCellEl.innerHTML;
					_editingCellEl.innerHTML = 
							"<label style='color:rgb(65, 86, 146);font-weight:bold;'>" +
							treeEditingTargetColumn_ + 
							"</label>" +
							newValue;
					
					{	//change link table name
						var el; 
						el = document.getElementById("treeNode-linkTableName-" + 
								treeEditingNodeIdString_);
						el.innerHTML = "";
						el.appendChild(document.createTextNode(linkTable)); 
					}

					var retVal = getTreeViewTableStrings(linkTable);
					var treeNavContextMenuItemHandlers = retVal.treeNavContextMenuItemHandlers;
					var tableComment = retVal.tableComment;
					var tableTitle = retVal.tableTitle;

					//change element title
					_editingCellEl.title = tableTitle;
										
					{	//change link table comment
						var el; 
						el = document.getElementById("treeNode-TableComment-" + 
								treeEditingNodeIdString_);
						el.innerHTML = "";
						if(tableComment != "")
							el.appendChild(document.createTextNode("//" + tableComment)); 
					}
					
					{ 	//change context menu for table link
						
						if(treeNavContextMenuItemHandlers.length == 0)
						{
							Debug.log("There is a treeNavContextMenuItemHandlers problem! Alert admins.",
									Debug.HIGH_PRIORITY);
							return;
						}
						
						var el; 
						el = document.getElementById("treeNode-LinkContextMenuTD-" + 
								treeEditingNodeIdString_);
						var str = "";
						str += 
								"<div class='treeNode-Link' " + //start treeNode Link div
								"onmousedown='" + // start link onmousedown	
								"SimpleContextMenu.createMenu(_treeNavContextMenuItems," +
								"[";

						for(j=0;j<treeNavContextMenuItemHandlers.length;++j)
						{
							//Debug.log("treeNavContextMenuItemHandlers[j]= " + treeNavContextMenuItemHandlers[j]);
							//need to escape all quotes by one more level
							treeNavContextMenuItemHandlers[j] = treeNavContextMenuItemHandlers[j].replace(/\\\"/g, "AAAAA");
									treeNavContextMenuItemHandlers[j] = treeNavContextMenuItemHandlers[j].replace(/"/g, "\\\"");
							treeNavContextMenuItemHandlers[j] = treeNavContextMenuItemHandlers[j].replace(/AAAAA/g, "\\\\\\\"");										
							//Debug.log("treeNavContextMenuItemHandlers[j]= " + treeNavContextMenuItemHandlers[j]);
							//Debug.log("this works= " + "Debug.log(\\\"hi\\\");");
							//THIS WORKS: treeViewHandlerStr_ += "\"" + "Debug.log(\\\"hi\\\");" + "\"";
							str += "\"" + treeNavContextMenuItemHandlers[j] + "\"";
							if(j != treeNavContextMenuItemHandlers.length-1)
								str += ",";
						}
						str += "]" + //end treeNavContextMenuItemHandlers array
								",\"treeNavContextMenu\",event.pageX-1,event.pageY-1, " +
								"\"rgb(220, 187, 165)\", \"rgb(130, 51, 51)\");";					
						str += 
								"' " + // end link onmousedown
								//"onmouseup='" + onmouseupJS + "' " +
								">" +	
								"<div class='gotoNavDiv'></div>" +			
								"</div>"; //end treeNode Link div
						
						el.innerHTML = str;
					}
					
					//clear children,
					//and if children were displayed
					//		then toggle/show new children 
					var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" + 
							treeEditingNodeIdString_);
					var wasDisplayed = elChildrenNode.style.display != "none" && 
							elChildrenNode.innerHTML != "";

					toggleTreeChildren(
							treeEditingNodeDepth_,
							treeEditingNodeIdString_.split('-')[1],false);
					elChildrenNode.innerHTML = "";

					if(wasDisplayed)
						toggleTreeChildren(
								treeEditingNodeDepth_,
								treeEditingNodeIdString_.split('-')[1],true);
				}
				else if(treeEditingNodeType_ == "value")
				{
					//if(treeEditingNodeType_ == "MultilineData")
					//MultilineData and normal
					//normal data
					_editingCellEl.appendChild(document.createTextNode(decodeURIComponent(newValue)));
					
				}
				else if(treeEditingNodeType_ == "value-bool")
				{
					var str = "";
					
					//colorize true false														
					str += "<div style='float:left'>";										
					str += newValue;											
					str += "</div>";

					var color = (newValue == "On" || newValue == "Yes" || newValue == "True")?
							"rgb(16, 204, 16)":"rgb(255, 0, 0);";
					str += "<div style='width:10px;height:10px;" +
							"background-color:" + color + ";" +
							"float: left;" +
							"border-radius: 7px;" +
							"border: 2px solid white;" +
							"margin: 2px 0 0 6px;" +								
							"'></div>"; 
					_editingCellEl.innerHTML = str;
				}			
				else if(treeEditingNodeType_ == "value-groupid")
				{					
					//if parent is a link (depth != 2)
					//	then if no longer in group
					//		then delete from group
					//		if no more children, say no children
					//	else just change value
					//else
					//	change value 
					
					if(treeEditingNodeDepth_ != 2)
					{
						//check if in group still:
						//	get LINKID of groupid
						//	get LINKID of parent group link
						//	if not matching link
						//		just change value (still in group) and done						
						//	if matching LINKIDs
						//		check if still in group .. 
						//		(could be separated by | and stil in group)
						
						var parentLinkIndex = 
								document.getElementById("treeNode-childLinkIndex-" + 
								(document.getElementById("treeNode-ParentId-" + 
										treeEditingNodeParentIdString_).textContent)).textContent;
								
						var vel = document.getElementById("treeNode-Value-" + treeEditingNodeIdString_);

						//if value-groupid node, link index is last in element class name
						var colType = vel.className.split(' ')[1];
						var selfLinkIndex = colType.substr(
								("treeNode-ValueType-GroupID").length);
						
						var groupId = document.getElementById("treeNode-Value-" + 
								((document.getElementById("treeNode-ParentId-" + 
										treeEditingNodeParentIdString_).textContent))).textContent;
						groupId = groupId.split('=')[1].substr(1); //get after =
						groupId = groupId.substr(0,groupId.length-1); //remove ending )
						
						Debug.log("parentLinkIndex = " + parentLinkIndex);
						Debug.log("selfLinkIndex = " + selfLinkIndex);
						Debug.log("groupId = " + groupId);
						
						if(parentLinkIndex != selfLinkIndex) //no match
						{
							//just change value (still in group) and done	
							_editingCellEl.appendChild(document.createTextNode(newValue));
						}
						else //matching link ids
						{
							var groupIds = newValue.split('|');
							var stillInGroup = false;
							for(var i=0;i<groupIds.length;++i)								
								if(groupIds[i].trim() == groupId)
								{
									Debug.log("found groupIds[" + i + "] = " + groupIds[i]);
									stillInGroup = true;
									break;
								}

							if(stillInGroup)
								_editingCellEl.appendChild(document.createTextNode(newValue));
							else // remove from group
							{
								//need to remove parent 'treeNode' from 
								//	parent-of-parent childrenNode: 
								var parentTreeNode = document.getElementById("treeNode-" + 
										treeEditingNodeParentIdString_);
								var popChildrenNode = parentTreeNode.parentNode;
								popChildrenNode.removeChild(parentTreeNode);
								
								//if no more children, say so
								var popChildren = popChildrenNode.getElementsByClassName("treeNode");
								if(popChildren.length == 0)
								{
									var str = "";
									str += 
											"<div class='treeNode'> " +
											"<div class='treeNode-Connection'></div>" +
											"<div class='treeNode-Value'>";

									str += "No Children Nodes Found.";

									str += "</div>" + //end treeNode Value div		
											"</div>" + //end treeNode div							
											"<div id='clearDiv'></div>"; 
									popChildrenNode.innerHTML = str;
								}
							}
						}						
					}
					else
						_editingCellEl.appendChild(document.createTextNode(newValue));
				}
				else	//unrecognized type!?
				{
					Debug.log("Unrecognizd tree edit type! Should be impossible!",Debug.HIGH_PRIORITY);
					editCellCancel(); return;
				}
				
				//requests are done, so end editing
				_editingCell = false;
				_editingCellEl = 0;
			} //end localEditTreeNodeOKRequestsComplete
			///////////////////////////////////////////////


			if(
					treeEditingNodeType_ == "table" || 
					treeEditingNodeType_ == "table-newRow" || 
					treeEditingNodeType_ == "uid" ||
					treeEditingNodeType_ == "delete-uid" ||
					treeEditingNodeType_.indexOf("link-") == 0 || //UID or GroupID
					treeEditingNodeType_ == "table-newGroupRow" || //spawns from group link edit
					treeEditingNodeType_ == "table-newUIDRow" || //spawns from uid link edit
					treeEditingNodeType_ == "value" ||
					treeEditingNodeType_ == "value-bool" || 
					treeEditingNodeType_ == "value-groupid")
								
			{
				var newValue;
				
				if(treeEditingNodeType_ == "value-bool")
				{
					var sel = _editingCellEl.getElementsByTagName("select")[0];
					newValue = sel.options[sel.selectedIndex].value;
				}
				else if(treeEditingNodeType_.indexOf("link-") == 0)
				{
					//make csv newValue := linkTable,linkInitId
					var sel = _editingCellEl.getElementsByTagName("select")[0];					
					newValue = sel.options[sel.selectedIndex].value;
					newValue += ",";					
					sel = _editingCellEl.getElementsByTagName("select")[1];
					if(sel.style.display == "none")
					{
						//get value from text box if not displayed 
						newValue += 
								encodeURIComponent(
										_editingCellEl.getElementsByTagName("input")[0].value.trim());
					}
					else
					{
						if(sel.selectedIndex >= 0) //if valid
							newValue += sel.options[sel.selectedIndex].value;
					}
					
					if(treeEditingNodeType_ == "link-GroupID")
					{
						//make csv newValue := linkTable,linkGroupID,linkTableVersion,groupMemberUID,...
						
						//add link target table version and chosen group members						
						var linkTargetTable = _editingCellEl.getElementsByTagName("select")[0].value;
						var tableVersion = -1;
						var tableIndex = -1;
						for(var j=0;j<treeMemberNames_.length;++j)
							if(linkTargetTable == treeMemberNames_[j])
							{
								tableVersion = treeMemberVersions_[j];
								tableIndex = j;
								break;
							}
						if(tableIndex == -1)
						{
							Debug.log("Invalid linked tree member table!",Debug.HIGH_PRIORITY);
							return;					
						}
						newValue += "," + tableVersion;
								
						//save new group members 
						// if different from treeEditingInitGroupMembers_

						var el = document.getElementById("treeView-groupMemberEditDiv");
						var selArr = MultiSelectBox.getSelectionArray(el);

						for(var s in selArr)
						{
							Debug.log("ms selected [" + s + "]: " +
									selArr[s]);
							if(!selArr[s]) continue;
							Debug.log(MultiSelectBox.getSelectionElementByIndex(el,s).textContent);
							newValue += "," + 
									MultiSelectBox.getSelectionElementByIndex(el,s).textContent;
						}
					}
				}
				else if(treeEditingNodeType_ == "table-newGroupRow")
				{
					//coming from edit setup of group link "link-GroupID"
					var sel = _editingCellEl.getElementsByTagName("select")[0];					
					treeEditingTargetTable_ = sel.options[sel.selectedIndex].value;						

					//make csv newValue := linkIndex,linkID

					newValue = document.getElementById("treeNode-childLinkIndex-" + 
							treeEditingNodeIdString_).textContent;
					newValue += ",";		
					sel = _editingCellEl.getElementsByTagName("select")[1];
					if(sel.selectedIndex >= 0) //if valid
						newValue += sel.options[sel.selectedIndex].value;
				}
				else if(treeEditingNodeType_ == "table-newUIDRow")
				{
					//coming from edit setup of group link "link-UID"
					var sel = _editingCellEl.getElementsByTagName("select")[0];					
					treeEditingTargetTable_ = sel.options[sel.selectedIndex].value;
					
					//make new value the new UID 
					newValue = prompt("Please enter the UID for the new record:");
					if(newValue)
						newValue = encodeURIComponent(newValue.trim());
				}
				else if(treeEditingNodeType_ == "table-newRow")
					newValue = ""; //no value needed
				else	//value (normal or multiline data)
				{
					var sel;
					if((sel = _editingCellEl.getElementsByTagName("textarea")).length) //for MultilineData					
						newValue = sel[0].value; //assume the first textarea in the cell is the textarea
					else if((sel = _editingCellEl.getElementsByTagName("select")).length) //for FixedChoiceData					
						newValue = sel[0].options[sel[0].selectedIndex].value; //assume the first select dropbox in the cell is the one
					else
						newValue = _editingCellEl.getElementsByTagName("input")[0].value;
					
					newValue = encodeURIComponent(newValue.trim());
				}
				
				Debug.log("CfgGUI editTreeNodeOK editing " + treeEditingNodeType_ + " node = " +
						newValue);
				
				if(treeEditingNodeInitValue_ == newValue)
				{
					//some types allow no change
					if(treeEditingNodeType_ != "delete-uid" &&
							treeEditingNodeType_ != "table-newGroupRow" &&  
							treeEditingNodeType_ != "table-newUIDRow")
					{
						Debug.log("No change. Do nothing.");
						editCellCancel();
						return;
					}
					else
						Debug.log("No change. OK for operation.");
				}
				else if(	//some types REQUIRE no change
						treeEditingNodeType_ == "delete-uid" ) 
				{
					Debug.log("The UID you are trying to delete has not been " +
							"saved yet. You can not delete a locally modified UID.",
							Debug.HIGH_PRIORITY);
					editCellCancel();
					return;
				}
				
				//save affected table as temporary version (re-use active temporary version at server)
				//		if saved successfully
				//			update value in tree-view and scan for other needed changes				
				
				var tableVersion = -1;
				var tableIndex = -1;
				for(var j=0;j<treeMemberNames_.length;++j)
					if(treeEditingTargetTable_ == treeMemberNames_[j])
					{
						tableVersion = treeMemberVersions_[j];
						tableIndex = j;
						break;
					}
				if(tableIndex == -1)
				{
					Debug.log("Invalid tree member table targeted!",Debug.HIGH_PRIORITY);
					return;					
				}
				
				//send edit to server
				DesktopContent.XMLHttpRequest("Request?RequestType=saveTreeNodeEdit" +	
						"&editNodeType=" + treeEditingNodeType_ +						
						"&targetTable=" + treeEditingTargetTable_ +
						"&targetTableVersion=" + tableVersion +
						"&targetUID=" + treeEditingTargetUID_ +
						"&targetColumn=" + treeEditingTargetColumn_ +
						"&newValue=" + newValue,
						"", function(req) 
						{
					var err = DesktopContent.getXMLValue(req,"Error");
					if(err) 
					{
						var warnings = req.responseXML.getElementsByTagName("Warning");
						for(var i=0;i<warnings.length;++i)
							Debug.log(DesktopContent.getXMLValue(warnings[i]),
									Debug.WARN_PRIORITY);
						
						//suppress same value error
						if(err.indexOf("is the same as the current value. No need to save node.") > 0)
						{
							Debug.log(err);
							return;
						}
						Debug.log("If you do not understand the error, try refreshing the tree from the '>>' menu in the top left of the page",Debug.HIGH_PRIORITY);
						Debug.log(err,Debug.HIGH_PRIORITY);

						editCellCancel();
						return;
					}

					//maintain tree member versions
					// (Note: more than one table may have changed!)
					var resultingTableNames = req.responseXML.getElementsByTagName("savedName");
					var resultingTableVersions = req.responseXML.getElementsByTagName("savedVersion");

					var resultingTableIndex;
					var resultingTableName;
					for(var i=0;i<resultingTableNames.length;++i)
					{
						resultingTableIndex = -1;
						resultingTableName = DesktopContent.getXMLValue(resultingTableNames[i]);
						
						for(var j=0;j<treeMemberNames_.length;++j)
							if(resultingTableName == treeMemberNames_[j])
							{
								treeMemberVersions_[j] = 
										DesktopContent.getXMLValue(resultingTableVersions[i]);
								resultingTableIndex = j;
								break;
							}
						if(resultingTableIndex == -1)
						{
							Debug.log("Invalid tree member '" + resultingTableName +
									"' was changed! Should be impossible. If repeatable, alert admins.",
									Debug.HIGH_PRIORITY);
							return;					
						}		
						Debug.log("New table version for " + resultingTableName + " = " +
								treeMemberVersions_[resultingTableIndex]);					
					}
					
					//change target edit tree node 
					localEditTreeNodeOKRequestsComplete(tableIndex,newValue);

					//now need to propagate changes throughout tree
					//	note: arguments can vary by edit type
					editTreeNodePropagateChange(newValue);

					//add tree save buttons
					treeHasChanged();						
					
					//finish special handling of new row					
					if(treeEditingNodeType_ == "table-newRow")
					{						
						//if hiding status, switch and refresh
						if(treeViewHideStatus_)
						{
							//treeViewHideStatus_ = false;
							//refreshTreeView();
							Debug.log("Note: The tree-view menu option 'Hide Status=False' " +
									" is currently hiding records with Status fields evaluating to " +
									" false. If you do not see your new record, this may be why; click the tree-view menu " + 
									"in the top-left and select '" +
									"<a href='#' onclick='treeViewHideStatus_=false;refreshTreeView();'>" +
									"Show Status=False" +
									"</a>" +									
									".'",
									Debug.INFO_PRIORITY);
						}
						
						Debug.log("Successfully added a new record to temporary version '" +
								treeMemberVersions_[resultingTableIndex] + "' of table '" + 
								treeEditingTargetTable_ + ".'",
								Debug.INFO_PRIORITY);						
					}		
					else if(treeEditingNodeType_ == "table-newGroupRow")
					{
						//revert edit type back to link-GroupID
						treeEditingNodeType_ = "link-GroupID";
					}	
					else if(treeEditingNodeType_ == "table-newUIDRow")
					{
						//revert edit type back to link-GroupID
						treeEditingNodeType_ = "link-UID";
					}

					//recover (possibly) modified target table
					treeEditingTargetTable_ = initTargetTable;

						},0,0,0,true //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
				); //end of getActiveConfigGroups handler
			}
			else	//unrecognized type!?
			{
				Debug.log("Unrecognizd tree edit type! Should be impossible!",Debug.HIGH_PRIORITY);
				editCellCancel(); return;
			}

			
			//withhold ending edit until after request completes
			//			_editingCell = false;
			//			_editingCellEl = 0;	
		}

		//hardRefreshTreeView ~~
		//	redraw tree completely from server request
		function hardRefreshTreeView()
		{	
			treeViewHandlerStr_ = "";
			setupConfigGroupTreeView(treeGroupName_,treeGroupKey_);
		}
		
		//refreshTreeView ~~
		//	reduce tree back to only root children
		function refreshTreeView()
		{	
			var els = document.getElementsByClassName("treeNode-Value-nodeEditType-table");
			var idString;
			
			//for each table, toggle children to hidden, and delete childrenOf node
			for(var i=0;i<els.length;++i)
			{
				idString = els[i].id.substr(("treeNode-Value-").length);
				toggleTreeChildren(idString.split('-')[0],idString.split('-')[1],false);
				document.getElementById("treeNode-ChildrenOf-" + idString).innerHTML = "";
			}
			
			//re-acquired the tree string
			treeViewHandlerStr_ = document.getElementById("display").innerHTML;
			
			//reset editing cell, since it was destroyed
			_editingCell = false;
			_editingCellEl = 0;
		}
		
		//editTreeNodePropagateChange ~~
		//	arguments are different depending on treeEditingNodeType_.
		//	After propagating change,
		//		last step is to update treeViewHandlerStr_ for page nav		
		function editTreeNodePropagateChange()
		{
			Debug.log("arguments.length " + arguments.length);			
			Debug.log("editTreeNodePropagateChange " + treeEditingNodeType_);
			
			if(treeEditingNodeType_ == "table")
			{	
				//parameters:
				// 	treeEditingTargetTable_
				//	newValue -- arg0
				
				var newValue = arguments[0];
				Debug.log("editTreeNodePropagateChange " + newValue);				

				//find all Links with target table and change comment				
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-link");
					var idString;
					var table;
					var el;
					for(var i=0;i<els.length;++i)
					{
						idString = els[i].id.substr(("treeNode-Value-").length);
						table = document.getElementById("treeNode-linkTableName-" + idString).textContent;
						if(table == treeEditingTargetTable_)
						{
							el = document.getElementById("treeNode-TableComment-" + idString);
							el.innerHTML = "";
							el.appendChild(document.createTextNode("//" + newValue));
						}
					}
				}
			}
			else if(treeEditingNodeType_ == "table-newRow" || 
					treeEditingNodeType_ == "table-newGroupRow" || 
					treeEditingNodeType_ == "table-newUIDRow")
			{
				//since add row can only be done at root table
				//find all Links with target table and reset children				
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-link");
					var idString;
					var table, elValSplit;
					var el;
					for(var i=0;i<els.length;++i)
					{
						idString = els[i].id.substr(("treeNode-Value-").length);
						table = document.getElementById("treeNode-linkTableName-" + 
								idString).textContent;
						if(table == treeEditingTargetTable_)
						{
							elValSplit = els[i].textContent.split('(');
							
							//if ( is missing, then this cell is currently being edited 
							// by type "table-newGroupRow", so skip it
							if(elValSplit.length == 1) continue;
								
							linkIdType = elValSplit[1].split(' ')[0];
							
							if(linkIdType != "GroupID") continue; //only consider link GroupIDs
							
							//reset children
							var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" + 
									idString);
							var wasDisplayed = elChildrenNode.style.display != "none" && 
									elChildrenNode.innerHTML != "";

							toggleTreeChildren(
									idString.split('-')[0],
									idString.split('-')[1],false);
							elChildrenNode.innerHTML = "";

							if(wasDisplayed)
								toggleTreeChildren(
										idString.split('-')[0],
										idString.split('-')[1],true);
						}
					}
				}
				
				//for groupRow and UIDRow also have to refresh target table
				if(treeEditingNodeType_ == "table-newGroupRow" ||
						treeEditingNodeType_ == "table-newUIDRow")
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-table");

					for(var i=0;i<els.length;++i)
					{
						if(els[i].textContent != treeEditingTargetTable_) continue;

						idString = els[i].id.substr(("treeNode-Value-").length);
						
						//reset children
						var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" + 
								idString);
						var wasDisplayed = elChildrenNode.style.display != "none" && 
								elChildrenNode.innerHTML != "";

						toggleTreeChildren(
								idString.split('-')[0],
								idString.split('-')[1],false);
						elChildrenNode.innerHTML = "";

						if(wasDisplayed)
							toggleTreeChildren(
									idString.split('-')[0],
									idString.split('-')[1],true);
						
						break; //should only happen once	
					}
				}
			}			
			else if(treeEditingNodeType_ == "uid")
			{								
				//parameters:
				// 	treeEditingTargetTable_
				//	treeEditingTargetUID_
				//	newValue -- arg0
				
				var newValue = arguments[0];
				Debug.log("editTreeNodePropagateChange " + newValue);
				
				
				//find all LinkUIDs with target table and UID and clear children				
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-link");
					var idString;
					var table, uid;
					var linkIdType;
					var elChildrenNode, parentIdString;
					for(var i=0;i<els.length;++i)
					{
						idString = els[i].id.substr(("treeNode-Value-").length);
						uid = els[i].textContent;
						linkIdType = uid.split('(')[1].split(' ')[0];
						
						if(linkIdType == "GroupID") continue; //only consider link UIDs
						
						uid = uid.split(')')[0].split('=')[1].substr(1);
						
						//Debug.log("link-idString " + idString + " " + uid);
						
						table = document.getElementById("treeNode-linkTableName-" + idString).textContent;
						if(table == treeEditingTargetTable_ && 
								uid == treeEditingTargetUID_)
						{
							//hide parent children, delete them, and re-expand

							parentIdString = document.getElementById("treeNode-ParentId-" + 
									idString).textContent;
							elChildrenNode = document.getElementById("treeNode-ChildrenOf-" + 
									parentIdString);							
							toggleTreeChildren(
									parentIdString.split('-')[0],
									parentIdString.split('-')[1],false);
							elChildrenNode.innerHTML = "";							
							toggleTreeChildren(
									parentIdString.split('-')[0],
									parentIdString.split('-')[1],true);
						}							
					}
				}
				
				//find all UID nodes with target table and UID and change
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-uid");
					var table, uid;
					var depth;
					for(var i=0;i<els.length;++i)
					{
						var idString = els[i].id.substr(("treeNode-Value-").length);
						depth = idString.split('-')[0];

						if(treeEditingNodeDepth_ == 1 && 
								depth == 1) continue; //can only possibly be self, which has already changed
						
						//if verifiably self, also skip
						if(idString == treeEditingNodeIdString_) continue;
						
						//Debug.log("uid-idString " + idString + " " + els[i].textContent);

						//need table to verify match.. must get from parent
						if(depth == 1)
							table = document.getElementById("treeNode-Value-" + 
									(document.getElementById("treeNode-ParentId-" + 
											idString).textContent)).textContent;
						else 
							table = document.getElementById("treeNode-linkTableName-" + 
									(document.getElementById("treeNode-ParentId-" + 
											idString).textContent)).textContent;						

						//Debug.log("uid-table " + table);
						uid = els[i].textContent;

						if(table == treeEditingTargetTable_ && 
								uid == treeEditingTargetUID_)
						{
							//modify display and nodename with new value						
							//Debug.log("link-idString " + idString + " " + uid);
							Debug.log("uid-idString CHANGE to " + newValue);

							els[i].innerHTML = "";
							els[i].appendChild(document.createTextNode(newValue)); 

							var el = document.getElementById("treeNode-nodeName-" + idString);
							el.innerHTML = "";
							el.appendChild(document.createTextNode(newValue));
							
							//reset children
							var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" + 
									idString);
							var wasDisplayed = elChildrenNode.style.display != "none" && 
									elChildrenNode.innerHTML != "";

							toggleTreeChildren(
									idString.split('-')[0],
									idString.split('-')[1],false);
							elChildrenNode.innerHTML = "";

							if(wasDisplayed)
								toggleTreeChildren(
										idString.split('-')[0],
										idString.split('-')[1],true);
						}	
					}
				}
			}
			else if(treeEditingNodeType_ == "delete-uid")
			{					
				//for all matches
				//	reset parent children is enough
				//		correct response should come from server
				
				//parameters:
				// 	treeEditingTargetTable_
				//	treeEditingTargetUID_

				//find all LinkUIDs with target table and UID and clear children				
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-link");
					var idString;
					var table, uid;
					var linkIdType;
					var elChildrenNode, parentIdString;
					for(var i=0;i<els.length;++i)
					{
						idString = els[i].id.substr(("treeNode-Value-").length);
						uid = els[i].textContent;
						linkIdType = uid.split('(')[1].split(' ')[0];

						if(linkIdType == "GroupID") continue; //only consider link UIDs

						uid = uid.split(')')[0].split('=')[1].substr(1);

						//Debug.log("link-idString " + idString + " " + uid);

						table = document.getElementById("treeNode-linkTableName-" + idString).textContent;
						if(table == treeEditingTargetTable_ && 
								uid == treeEditingTargetUID_)
						{
							//hide parent children, delete them, and re-expand
							
							parentIdString = document.getElementById("treeNode-ParentId-" + 
									idString).textContent;
							elChildrenNode = document.getElementById("treeNode-ChildrenOf-" + 
									parentIdString);							
							toggleTreeChildren(
									parentIdString.split('-')[0],
									parentIdString.split('-')[1],false);
							elChildrenNode.innerHTML = "";							
							toggleTreeChildren(
									parentIdString.split('-')[0],
									parentIdString.split('-')[1],true);													
						}							
					}
				}
				
				//find all UID nodes with target table and UID and change
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-uid");
					var table, uid;
					var depth;
					var elChildrenNode, parentIdString;
					for(var i=0;i<els.length;++i)
					{
						var idString = els[i].id.substr(("treeNode-Value-").length);
						depth = idString.split('-')[0];

						if(treeEditingNodeDepth_ == 1 && 
								depth == 1) continue; //can only possibly be self, which has already changed

						//if verifiably self, also skip
						if(idString == treeEditingNodeIdString_) continue;

						//Debug.log("uid-idString " + idString + " " + els[i].textContent);

						//need table to verify match.. must get from parent
						if(depth == 1)
							table = document.getElementById("treeNode-Value-" + 
									(document.getElementById("treeNode-ParentId-" + 
											idString).textContent)).textContent;
						else 
							table = document.getElementById("treeNode-linkTableName-" + 
									(document.getElementById("treeNode-ParentId-" + 
											idString).textContent)).textContent;						

						//Debug.log("uid-table " + table);
						uid = els[i].textContent;

						if(table == treeEditingTargetTable_ && 
								uid == treeEditingTargetUID_)
						{
							//hide parent children, delete them, and re-expand
							
							parentIdString = document.getElementById("treeNode-ParentId-" + 
									idString).textContent;
							elChildrenNode = document.getElementById("treeNode-ChildrenOf-" + 
									parentIdString);							
							toggleTreeChildren(
									parentIdString.split('-')[0],
									parentIdString.split('-')[1],false);
							elChildrenNode.innerHTML = "";							
							toggleTreeChildren(
									parentIdString.split('-')[0],
									parentIdString.split('-')[1],true);
						}	
					}
				}
			}
			else if(treeEditingNodeType_.indexOf("link-") == 0)
			{					
				//For all link nodes
				//	change link table/id and clear children
				//	and edit peripheral link info
				
				//parameters:
				// 	treeEditingTargetTable_
				//	treeEditingTargetUID_
				//	treeEditingTargetColumn_
				//	newValue -- arg0

				var newValue = arguments[0];

				var csvIndex = newValue.indexOf(',');
				var linkTable = newValue.substr(0,csvIndex);
				//var linkId = newValue.substr(csvIndex+1);
				//				newValue = 
				//						"<label style='color:rgb(65, 86, 146);font-weight:bold;'>" +
				//						treeEditingTargetColumn_ + 
				//						"</label>" +
				//						"-(" + 
				//						treeEditingNodeType_.split('-')[1] + " = " + linkId + ")";
				//
				//				Debug.log("editTreeNodePropagateChange " + newValue);
				
				//find all Links with target table and UID and column and clear children				
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-link");
					var idString;
					var table, uid, col;
					var depth;
					
					var retVal = getTreeViewTableStrings(linkTable);
					var treeNavContextMenuItemHandlers = retVal.treeNavContextMenuItemHandlers;
					var tableComment = retVal.tableComment;
					var tableTitle = retVal.tableTitle;

					for(var i=0;i<els.length;++i)
					{	
						idString = els[i].id.substr(("treeNode-Value-").length);
						depth = idString.split('-')[0];
						
						//this could save a substantial amount of searching
						if(treeEditingNodeDepth_ == 2 && 
								depth == 2) continue; //can only possibly be self, which has already changed

						//if verifiably self, also skip
						if(idString == treeEditingNodeIdString_) continue;

						Debug.log("value-idString " + idString + " " + els[i].textContent);

						//verify column match...
						
						col = els[i].textContent.split('-')[0]; //get before dash
						if(col != treeEditingTargetColumn_)
							continue; //skip if not column match
						
						//need table/uid to verify match.. must get from parent of parent
						parentIdString = document.getElementById("treeNode-ParentId-" + 
								idString).textContent;
						
						uid = document.getElementById("treeNode-Value-" + 
								parentIdString).textContent;
						
						if(depth == 2)
							table = document.getElementById("treeNode-Value-" + 
									(document.getElementById("treeNode-ParentId-" + 
											parentIdString).textContent)).textContent;
						else 
						{
							//needs to get table from parent OR parent-of-parent
							//	if parent is uid link.. then one level back
							//	if parent is groupid link.. then two levels back

							var pel = document.getElementById("treeNode-linkTableName-" +
									parentIdString);
							if(!pel)
								pel = document.getElementById("treeNode-linkTableName-" +
										(document.getElementById("treeNode-ParentId-" + 
												parentIdString).textContent));
							else //parent is uid link, so UID from path is wrong, fix it
							{
								//take uid from parent value, right side						
								uid = document.getElementById("treeNode-Value-" +
										parentIdString).textContent.
												split(')')[0].split('=')[1].substr(1);
							}

							table = pel.textContent;
						}

						Debug.log("link-table " + table);
						Debug.log("link-uid " + uid);

						if(table != treeEditingTargetTable_ || 
								uid != treeEditingTargetUID_)
							continue; //skip if table/uid does not match
						
						
						{	//change link table name
							var el; 
							el = document.getElementById("treeNode-linkTableName-" + 
									idString);
							el.innerHTML = "";
							el.appendChild(document.createTextNode(linkTable)); 
						}						

						//change element title
						els[i].title = tableTitle;
						
						{	//change link table comment
							var el; 
							el = document.getElementById("treeNode-TableComment-" + 
									idString);
							el.innerHTML = "";
							if(tableComment != "")
								el.appendChild(document.createTextNode("//" + tableComment)); 
						}

						{ 	//change context menu for table link

							if(treeNavContextMenuItemHandlers.length == 0)
							{
								Debug.log("There is a treeNavContextMenuItemHandlers problem! Alert admins.",
										Debug.HIGH_PRIORITY);
								return;
							}

							var el; 
							el = document.getElementById("treeNode-LinkContextMenuTD-" + 
									idString);
							var str = "";
							str += 
									"<div class='treeNode-Link' " + //start treeNode Link div
									"onmousedown='" + // start link onmousedown	
									"SimpleContextMenu.createMenu(_treeNavContextMenuItems," +
									"[";

							for(j=0;j<treeNavContextMenuItemHandlers.length;++j)
							{
								//Debug.log("treeNavContextMenuItemHandlers[j]= " + treeNavContextMenuItemHandlers[j]);
								//need to escape all quotes by one more level
								treeNavContextMenuItemHandlers[j] = treeNavContextMenuItemHandlers[j].replace(/\\\"/g, "AAAAA");
										treeNavContextMenuItemHandlers[j] = treeNavContextMenuItemHandlers[j].replace(/"/g, "\\\"");
								treeNavContextMenuItemHandlers[j] = treeNavContextMenuItemHandlers[j].replace(/AAAAA/g, "\\\\\\\"");										
								//Debug.log("treeNavContextMenuItemHandlers[j]= " + treeNavContextMenuItemHandlers[j]);
								//Debug.log("this works= " + "Debug.log(\\\"hi\\\");");
								//THIS WORKS: treeViewHandlerStr_ += "\"" + "Debug.log(\\\"hi\\\");" + "\"";
								str += "\"" + treeNavContextMenuItemHandlers[j] + "\"";
								if(j != treeNavContextMenuItemHandlers.length-1)
									str += ",";
							}
							str += "]" + //end treeNavContextMenuItemHandlers array
									",\"treeNavContextMenu\",event.pageX-1,event.pageY-1, " +
									"\"rgb(220, 187, 165)\", \"rgb(130, 51, 51)\");";					
							str += 
									"' " + // end link onmousedown
									//"onmouseup='" + onmouseupJS + "' " +
									">" +	
									"<div class='gotoNavDiv'></div>" +			
									"</div>"; //end treeNode Link div

							el.innerHTML = str;
						}

						//clear children,
						//and if children were displayed
						//		then toggle/show new children 
						var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" + 
								idString);
						var wasDisplayed = elChildrenNode.style.display != "none" && 
								elChildrenNode.innerHTML != "";

						toggleTreeChildren(
								idString.split('-')[0],
								idString.split('-')[1],false);
						elChildrenNode.innerHTML = "";

						if(wasDisplayed)
							toggleTreeChildren(
									idString.split('-')[0],
									idString.split('-')[1],true);													
					}  //end for loop
				}
			}
			else if(treeEditingNodeType_ == "value" ||
					treeEditingNodeType_ == "value-bool")
			{		
				//parameters:
				// 	treeEditingTargetTable_
				//	treeEditingTargetUID_
				//	treeEditingTargetColumn_
				//	newValue -- arg0

				var newValue = arguments[0];
				Debug.log("editTreeNodePropagateChange " + newValue);
				
				//find all value nodes with target table and UID and change col
				{
					var els = document.getElementsByClassName(
							"treeNode-Value-leafNode-ColumnName-" + treeEditingTargetColumn_);
					var table, uid;
					var depth;
					var parentIdString;
					for(var i=0;i<els.length;++i)
					{
						var idString = els[i].id.substr(("treeNode-Value-leafNode-").length);
						depth = idString.split('-')[0];

						//this could save a substantial amount of searching
						if(treeEditingNodeDepth_ == 2 && 
								depth == 2) continue; //can only possibly be self, which has already changed
						
						//if verifiably self, also skip
						if(idString == treeEditingNodeIdString_) continue;
						
						Debug.log("value-idString " + idString + " " + els[i].textContent);

						//need table to verify match.. must get from parent of parent
						parentIdString = document.getElementById("treeNode-ParentId-" + 
								idString).textContent;
						if(depth == 2)
							table = document.getElementById("treeNode-Value-" + 
									(document.getElementById("treeNode-ParentId-" + 
											parentIdString).textContent)).textContent;
						else 
							table = document.getElementById("treeNode-linkTableName-" + 
									(document.getElementById("treeNode-ParentId-" + 
											parentIdString).textContent)).textContent;						

						Debug.log("value-table " + table);
						uid = document.getElementById("treeNode-Value-" + 
								parentIdString).textContent;
						Debug.log("value-uid " + table);

						if(table == treeEditingTargetTable_ && 
								uid == treeEditingTargetUID_)
						{
							//modify display with new value						
							//Debug.log("link-idString " + idString + " " + uid);
							Debug.log("value-idString CHANGE to " + newValue);
							
							els[i].innerHTML = ""; //clear target el
							
							if(treeEditingNodeType_ == "value-bool")
							{
								var str = "";

								//colorize true false														
								str += "<div style='float:left'>";										
								str += newValue;											
								str += "</div>";

								var color = (newValue == "On" || newValue == "Yes" || newValue == "True")?
										"rgb(16, 204, 16)":"rgb(255, 0, 0);";
								str += "<div style='width:10px;height:10px;" +
										"background-color:" + color + ";" +
										"float: left;" +
										"border-radius: 7px;" +
										"border: 2px solid white;" +
										"margin: 2px 0 0 6px;" +								
										"'></div>"; 
								els[i].innerHTML = str;
							}	
							else								
								els[i].appendChild(document.createTextNode(newValue));

						}	
					}
				}
			}
			else if(treeEditingNodeType_ == "value-groupid")
			{
				//parameters:
				// 	treeEditingTargetTable_
				//	treeEditingTargetUID_
				//	treeEditingTargetColumn_
				//	newValue -- arg0

				var newValue = arguments[0];
				var groupIds = newValue.split('|');
				Debug.log("editTreeNodePropagateChange " + newValue);
				
				//find the singlular depth 2 value node with target table and UID and change col
				if(treeEditingNodeDepth_ != 2) //only if self was not depth 2
				{
					var els = document.getElementsByClassName(
							"treeNode-Value-leafNode-ColumnName-" + treeEditingTargetColumn_);
					var table, uid;
					var depth;
					var parentIdString;
					for(var i=0;i<els.length;++i)
					{
						var idString = els[i].id.substr(("treeNode-Value-leafNode-").length);
						depth = idString.split('-')[0];

						//this could save a substantial amount of searching
						if(depth != 2) continue; //can only possibly be self, which has already changed


						Debug.log("value-idString " + idString + " " + els[i].textContent);

						//need table to verify match.. must get from parent of parent
						parentIdString = document.getElementById("treeNode-ParentId-" + 
								idString).textContent;
						if(depth == 2)
							table = document.getElementById("treeNode-Value-" + 
									(document.getElementById("treeNode-ParentId-" + 
											parentIdString).textContent)).textContent;
						else 
							table = document.getElementById("treeNode-linkTableName-" + 
									(document.getElementById("treeNode-ParentId-" + 
											parentIdString).textContent)).textContent;						

						Debug.log("value-table " + table);
						uid = document.getElementById("treeNode-Value-" + 
								parentIdString).textContent;
						Debug.log("value-uid " + table);

						if(table == treeEditingTargetTable_ && 
								uid == treeEditingTargetUID_)
						{
							//modify display with new value						
							//Debug.log("link-idString " + idString + " " + uid);
							Debug.log("value-idString CHANGE to " + newValue);

							els[i].innerHTML = ""; //clear target el
							els[i].appendChild(document.createTextNode(newValue));
							break; //done, since can only be one at depth 2
						}
					}
				}
				
				//find all depth != 1 UID nodes with target table and UID and 
				//	check if link is grouplink and check if it is affected
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-uid");
					var table, uid;
					var depth;
					var parentIdString;
					var groupId, linkIdType, stillInGroup, groupIdIndex;					
					for(var i=0;i<els.length;++i)
					{
						var idString = els[i].id.substr(("treeNode-Value-").length);
						depth = idString.split('-')[0];

						if(depth == 1) continue; //only care about group-linked uid nodes

						//Debug.log("uid-idString " + idString + " " + els[i].textContent);

						//need table to verify match.. must get from parent link	
						parentIdString = document.getElementById("treeNode-ParentId-" + 
								idString).textContent;
						table = document.getElementById("treeNode-linkTableName-" + 
								parentIdString).textContent;						

						//Debug.log("uid-table " + table);
						uid = els[i].textContent;

						if(table == treeEditingTargetTable_ && 
								uid == treeEditingTargetUID_)
						{
							//verify parent link is group-link else skip
							groupId = document.getElementById("treeNode-Value-" + 
									parentIdString).textContent;
							linkIdType = groupId.split('(')[1].split(' ')[0];
							
							if(linkIdType != "GroupID") continue;
							
							//Debug.log("link-idString " + idString + " " + uid);
							Debug.log("uid-idString CHANGE to " + newValue);

							//this is a verified uid in a group-link target
							//check if change keeps the uid in the group or not
														
							groupId = groupId.split('=')[1].substr(1); //get after =
							groupId = groupId.substr(0,groupId.length-1); //remove ending )

							Debug.log("groupId = " + groupId);
							
							stillInGroup = false;
							for(groupIdIndex=0;groupIdIndex<groupIds.length;++groupIdIndex)								
								if(groupIds[groupIdIndex].trim() == groupId)
								{
									Debug.log("found groupIds[" + groupIdIndex + "] = " + 
											groupIds[groupIdIndex]);
									stillInGroup = true;
									break;
								}

							if(!stillInGroup)	// remove from group
							{
								//need to this uid nodes' 'treeNode' from 
								//	parent childrenNode: 
								var elTreeNode = document.getElementById("treeNode-" + 
										idString);
								var pChildrenNode = elTreeNode.parentNode;
								pChildrenNode.removeChild(elTreeNode);

								//if no more children, say so
								var pChildren = pChildrenNode.getElementsByClassName("treeNode");
								if(pChildren.length == 0)
								{
									var str = "";
									str += 
											"<div class='treeNode'> " +
											"<div class='treeNode-Connection'></div>" +
											"<div class='treeNode-Value'>";

									str += "No Children Nodes Found.";

									str += "</div>" + //end treeNode Value div		
											"</div>" + //end treeNode div							
											"<div id='clearDiv'></div>"; 
									pChildrenNode.innerHTML = str;
								}
							}

						}	
					}
				}
				
				//find all group links with target table and	
				//	if groupId is match 
				//		and if uid is not present 
				//		then clear children				
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-link");
					var idString;
					var table, groupId, groupIdIndex, foundInGroup;
					var linkIdType;
					for(var i=0;i<els.length;++i)
					{
						idString = els[i].id.substr(("treeNode-Value-").length);
						groupId = els[i].textContent;
						linkIdType = groupId.split('(')[1].split(' ')[0];
						
						if(linkIdType != "GroupID") continue; //only consider group links


						table = document.getElementById("treeNode-linkTableName-" + idString).textContent;
						if(table != treeEditingTargetTable_) continue; //skip if table does not match
							
						//check if group id matches
						groupId = groupId.split('=')[1].substr(1); //get after =
						groupId = groupId.substr(0,groupId.length-1); //remove ending )

						Debug.log("groupId = " + groupId);
						
						foundInGroup = false;
						for(groupIdIndex=0;groupIdIndex<groupIds.length;++groupIdIndex)								
							if(groupIds[groupIdIndex].trim() == groupId)
							{
								Debug.log("found groupIds[" + groupIdIndex + "] = " + 
										groupIds[groupIdIndex]);
								foundInGroup = true;
								break;
							}
						
						if(foundInGroup)
						{
							//if uid is not one of the children then delete them all
							var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" + idString);
							var elChildren = elChildrenNode.childNodes;		
							var foundUIDChild = false;
							var uid;							
							
							for(var j=0;j<elChildren.length;++j)
							{
								if(elChildren[j].id.indexOf("treeNode") != 0) continue; //skip superfluous children
								
								uid = document.getElementById("treeNode-Value-" + 
										elChildren[j].id.substr(("treeNode-").length)).textContent;
								
								Debug.log("uid = " + uid);
								
								if(uid == treeEditingTargetUID_)
								{
									foundUIDChild = true; 
									break;
								}
							}
							
							if(!foundUIDChild)
							{
								//hide children and delete them		
								// if they were shown before, toggle children again to show uids of group
								
								//Debug.log("link-idString " + idString + " " + uid);
								//Debug.log("link-idString CHANGE to " + newValue);
								
								var wasDisplayed = elChildrenNode.style.display != "none" && 
										elChildrenNode.innerHTML != "";
								
								toggleTreeChildren(idString.split('-')[0],idString.split('-')[1],false);
								elChildrenNode.innerHTML = "";
								
								if(wasDisplayed)
									toggleTreeChildren(idString.split('-')[0],idString.split('-')[1],true);
							}
						}							
					}
				}
			}
			else	//unrecognized type!?
			{
				Debug.log("Unrecognizd tree edit type! Should be impossible!",Debug.HIGH_PRIORITY);				
			}
			
			//after propagating change,
			//	last step is to update treeViewHandlerStr_ for page nav			 
			treeViewHandlerStr_ = document.getElementById("display").innerHTML;
		}
		
		//editCellOK
		function editCellOK() 
		{	
			//detect proper views
			var el = document.getElementById("treeView-ConfigGroupLink");
			if(el) //tree view 
				return editTreeNodeOK();
			
			//avoid doing anything while popup is open
			el = document.getElementById("popUpDialog");
			if(el) //config gui popup
				return;
			el = document.getElementById(ConfigurationAPI._POP_UP_DIALOG_ID);
			if(el) //config API popup
				return;
			
			//else table view 
			//...
			
			if(!_editingCellEl) return;
			
			var r = _editingCellPos[0];
			var c = _editingCellPos[1];
			
			//if child link cell or boolean cell
			var sel;
			if((sel = _editingCellEl.getElementsByTagName("select")).length)
			{
				sel = sel[0]; //assume the first select in the cell is the select
				Debug.log("CfgGUI editCellOK editing r,c:" + r + "," + c);				
				var selVal = sel.options[sel.selectedIndex].value;

				Debug.log("CfgGUI editCellOK = " + 
						selVal);

				str = "";
				str += selVal;
				_editingCellEl.innerHTML = str;		
				
				//assume no child link will be named a boolean word
				var boolTypeTrues =  ["On","True","Yes"];
				var statusTypeFalses =  ["Off","False","No"];
				
				//determine if true value
				var isTrue = false;
				var isFalse = false;
				for(var i=0;i<boolTypeTrues.length;++i)
					if(boolTypeTrues[i] == selVal)
					{
						isTrue = true; break;
					}
				for(var i=0;!isTrue && i<statusTypeFalses.length;++i)
					if(statusTypeFalses[i] == selVal)
					{
						isFalse = true; break;
					}
				
				if(isTrue)
					_editingCellEl.style.backgroundColor = _TABLE_BOOL_TYPE_TRUE_COLOR;
				else if(isFalse)
					_editingCellEl.style.backgroundColor = _TABLE_BOOL_TYPE_FALSE_COLOR;
			}
			else if((sel = _editingCellEl.getElementsByTagName("textarea")).length) //for MultilineData
			{
				sel = sel[0]; //assume the first textarea in the cell is the textarea

				Debug.log("CfgGUI editCellOK editing r,c:" + r + "," + c + " = " +
						sel.value);
				
				var str = sel.value;
				_editingCellEl.innerHTML = "";
				_editingCellEl.appendChild(document.createTextNode(str));
			}
			else //normal cell
			{
				Debug.log("CfgGUI editCellOK editing r,c:" + r + "," + c + " = " +
						_editingCellEl.getElementsByTagName("input")[0].value);
				
				var str = _editingCellEl.getElementsByTagName("input")[0].value;
				_editingCellEl.innerHTML = "";
				_editingCellEl.appendChild(document.createTextNode(str));
			}
			
			_editingCell = false;
			_editingCellEl = 0;		
			
			versionHasChanged();
		}
		
		//editCellCancel
		function editCellCancel() 
		{	
			Debug.log("editCellCancel");
			
			if(_editingCellEl) //return old value, convert from text to html
			{
				if(treeEditingNodeType_.indexOf("link") == 0)
				{
					//if canceling from link edit, show tooltip

					DesktopContent.tooltip("Tables Available in Link Editing",
							"It is important to note that, when editing links, only currently active " +
							"tables are available to be linked to. If you do not see the table " +
							"name you are looking for, it is probably because that table is not a member " +
							"of the currently active group. To resolve this issue, you must go to the group view and edit " +
							"the group to include the new table as a member.");
					
				}
				
				if(treeEditingNodeType_ == "value-bool" ||
						treeEditingNodeType_.indexOf("link") == 0) 
				{
					//take old value as HTML for bool values
					_editingCellEl.innerHTML = _editingCellElOldValue;
					
					//show again nav context menu
					if(treeEditingNodeType_.indexOf("link") == 0)
						 document.getElementById("treeNode-LinkContextMenuTD-" + 
								 treeEditingNodeIdString_).style.display = "block";
				}
				else
				{
					_editingCellEl.innerHTML = "";
					_editingCellEl.appendChild(document.createTextNode(_editingCellElOldValue));
				}

				_editingCellEl.title = _editingCellElOldTitle;
			}
			
			_editingCell = false;
			_editingCellEl = 0;
		}
		
		//addRow ~~
		// adds row to position r (relative to view on page)
		// absolute row is _dataOffset + r
		function addRow(rowToAdd) 
		{
			Debug.log("CfgGUI addRow " + rowToAdd);
			
			editCellOK(); //editCellCancel();
			
			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");				
			var str = "";
			var cols = [];

			var colIsBoolType = getTableViewColIsBoolType(rows);
			

			if(!_tableViewIsTransposed) //reading from normal view
			{				
				//get all cols
				for(var r=0,newr=0;r<rows.length+1;++r) 
				{
					if(r-_CONFIG_DATA_ROW_OFFSET == rowToAdd)
					{				
						//create row of default column cells
						var newRowArr = [];		
						for(var c=0;c<rows[0].childNodes.length;++c)
						{
							newRowArr.push(document.createElement("td"));
							if(c >= _CONFIG_DATA_COL_OFFSET) //skip row # column
							{
								if(c - _CONFIG_DATA_COL_OFFSET == 
										_tableDefaultRowValues.length) //add date
									newRowArr[c].innerHTML = ConfigurationAPI.getDateString(new Date());
								else
									newRowArr[c].innerHTML = 
										_tableDefaultRowValues[c - _CONFIG_DATA_COL_OFFSET];
							}
						}
						cols[newr] = newRowArr; //add new row
						++newr;
					}
					
					if(r >= rows.length) continue; //gone through all data already
					
					if(r == _CONFIG_DATA_ROW_OFFSET-1) //col names are headers
						cols[newr] = rows[r].getElementsByTagName("th");
					else
						cols[newr] = rows[r].getElementsByTagName("td");
					++newr;
				}

			}
			else						//reading from transposed view
			{
				//get all cols (transposed)
				var tmpCols;
				var numOfNewRows = -1;
				for(var c=0;c<rows.length;++c) 
				{								 
					cols.push([]); //push empty column, for each 

					//assume there is 1 th cell
					tmpCols = rows[c].getElementsByTagName("td");					
					for(var r=0, newr = 0, tmpColsIndex = 0;r<tmpCols.length+2;++r) //+1 for th, and +1 for new row
					{			
						if(r-_CONFIG_DATA_ROW_OFFSET == rowToAdd) 
						{				
							//create default col cell to new row
							cols[c][newr] = document.createElement("td");
							if(c >= _CONFIG_DATA_COL_OFFSET) //skip row # column
							{
								if(c - _CONFIG_DATA_COL_OFFSET == 
										_tableDefaultRowValues.length) //add date
									cols[c][newr].innerHTML = ConfigurationAPI.getDateString(new Date());
								else
									cols[c][newr].innerHTML = 
										_tableDefaultRowValues[c - _CONFIG_DATA_COL_OFFSET];
							}
							
							++newr;
						}
						
						if(r >= tmpCols.length+1) continue; //gone through all data already

						if(r == _CONFIG_DATA_ROW_OFFSET-1) //col names are headers
							cols[c][newr] = rows[c].getElementsByTagName("th")[0];
						else //take from the td cels
							cols[c][newr] = tmpCols[tmpColsIndex++];
						++newr;		
					}
				}			
			}
			
			//create output string based on cols
			str += createTableViewOutputStr(cols,colIsBoolType);

			el.innerHTML = str;		

			versionHasChanged();

			//update last add row link
			if(_tableViewIsTransposed)
			{
				document.getElementById("lastAddRowLink0").onclick = 
						function() {											
					addRow(cols[0].length-_CONFIG_DATA_ROW_OFFSET); 
					return false;
				};
				document.getElementById("lastAddRowLink1").onclick =
						function() {											
					addRow(cols[0].length-_CONFIG_DATA_ROW_OFFSET); 
					return false;
				};
			}
			else
			{
				document.getElementById("lastAddRowLink0").onclick =
						function() {											
					addRow(cols.length-_CONFIG_DATA_ROW_OFFSET); 
					return false;
				};					
				document.getElementById("lastAddRowLink1").onclick = 
						function() {											
					addRow(cols.length-_CONFIG_DATA_ROW_OFFSET); 
					return false;
				};
			}
				
		}


		//deleteRow ~~
		// delete row at destination
		function deleteRow(rowToDelete) 
		{
			Debug.log("CfgGUI deleteRow " + rowToDelete);
			
			editCellOK(); //editCellCancel();
			
			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");
			var cols = [];
			
			if(!_tableViewIsTransposed) //reading from normal view
			{
				var r = rowToDelete;
				//make sure el references the container of rows ("TR")
				while(el.childNodes[0].tagName != "TR")
					el = el.childNodes[0];
				el.removeChild(rows[r+_CONFIG_DATA_ROW_OFFSET]);
				
				//update all row numbers after row added
				for(var i=_CONFIG_DATA_ROW_OFFSET;i<rows.length;++i)
				{
					if(i < r) continue;
					
					str = (_dataOffset + (i-_CONFIG_DATA_ROW_OFFSET));	//insert row index column
					
					//add +/- row controls
					str += "<br><a href='#' onclick='javascript:addRow(" + (i-_CONFIG_DATA_ROW_OFFSET) + "); return false;'>";
					str += "+";
					str += "</a>";
					str += "/<a href='#' onclick='javascript:deleteRow(" + (i-_CONFIG_DATA_ROW_OFFSET) + "); return false;'>";
					str += "-";
					str += "</a>";							
					rows[i].childNodes[0].innerHTML = str;
				}
			}
			else
			{
				var colIsBoolType = getTableViewColIsBoolType(rows);
				
				//get all cols (transposed)
				var tmpCols;
				var numOfNewRows = -1;
				for(var c=0;c<rows.length;++c) 
				{								 
					cols.push([]); //push empty column, for each 

					//assume there is 1 th cell
					tmpCols = rows[c].getElementsByTagName("td");					
					for(var r=0, newr = 0, tmpColsIndex = 0;r<tmpCols.length+2;++r) //+1 for th, and +1 for new row
					{			
						if(r-_CONFIG_DATA_ROW_OFFSET == rowToDelete) 
						{ ++tmpColsIndex; continue; }//skip row to delete
						
						if(r >= tmpCols.length+1) continue; //gone through all data already

						if(r == _CONFIG_DATA_ROW_OFFSET-1) //col names are headers
							cols[c][newr] = rows[c].getElementsByTagName("th")[0];
						else //take from the td cels
						{	
							cols[c][newr] = tmpCols[tmpColsIndex];
							++tmpColsIndex;
						}				
						++newr;		
					}
				}	
				
				var str = createTableViewOutputStr(cols,colIsBoolType);
				
				document.getElementById("SubSystemTable").innerHTML = str;
			}

			versionHasChanged();
			
			//update last add row link
			if(_tableViewIsTransposed)
			{
				document.getElementById("lastAddRowLink0").onclick = 
						function() {											
					addRow(cols[0].length-_CONFIG_DATA_ROW_OFFSET); 
					return false;
				};
				document.getElementById("lastAddRowLink1").onclick =
						function() {											
					addRow(cols[0].length-_CONFIG_DATA_ROW_OFFSET); 
					return false;
				};
			}
			else
			{
				document.getElementById("lastAddRowLink0").onclick =
						function() {											
					addRow(rows.length-_CONFIG_DATA_ROW_OFFSET); 
					return false;
				};					
				document.getElementById("lastAddRowLink1").onclick = 
						function() {											
					addRow(rows.length-_CONFIG_DATA_ROW_OFFSET); 
					return false;
				};
			}
		}
		
		//popUpVersionAliasSpecificGroupForm
		function popUpVersionAliasSpecificGroupForm(groupName,groupKey)
		{
			Debug.log("CfgGUI popUpVersionAliasSpecificGroupForm");

			var str = "";

			var el = document.getElementById("popUpDialog");
			if(!el)
			{
				el = document.createElement("div");			
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 300;
			var h = 200;
			ConfigurationAPI.setPopUpPosition(el,w /*w*/,h /*h*/);
//			var ww = DesktopContent.getWindowWidth();
//			var wh = DesktopContent.getWindowHeight();
//			el.style.top = (DesktopContent.getWindowScrollTop() + ((wh-h-2)/2)) + "px";
//			el.style.left = (DesktopContent.getWindowScrollLeft() + ((ww-w-2)/2)) + "px";
//			el.style.width = w + "px";
//			el.style.height = h + "px";

			var defaultAlias = "myAlias";
			var str = "<a id='" + 
					"popUpDialog" + 
					"-header' href='#' onclick='javascript:var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "Please enter the Alias you would like to apply to all member table versions:<br><br>";
			str += "<input type='text' id='popUpDialog-alias' value='" +
					defaultAlias + "'></input>";
			str += "</div><br><br>";

			var onmouseupJS = "";
			onmouseupJS += 
					"DesktopContent.XMLHttpRequest(\"Request?RequestType=setAliasOfGroupMembers" +
					"&versionAlias=\" + " + 
					"document.getElementById(\"popUpDialog-alias\").value + \"" +
					"&groupName=" + groupName +
					"&groupKey=" + groupKey + "\", \"\"," +
					"ConfigurationAPI.newWizBackboneMemberHandler,[\"MemberVersionAliasWizBackbone\",undefined]," +
					"0,0,true" +  //progressHandler, callHandlerOnErr, showLoadingOverlay
					");";			
			onmouseupJS += "var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); ";

			str += "<input type='button' onmouseup='" + onmouseupJS + "' " +
					"value='Set Member Aliases' title='" +
					"Set the Alias for all members in the actve Backbone." +
					"'/>";
			el.innerHTML = str;


			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";

			//select comment text
			ConfigurationAPI.setCaretPosition(document.getElementById("popUpDialog-alias"),
					0,defaultAlias.length);
		}
		
		//popUpFilterTreeForm
		function popUpFilterTreeForm()
		{
			Debug.log("CfgGUI popUpFilterTreeForm");

			var str = "";

			var el = document.getElementById("popUpDialog");
			if(!el)
			{
				el = document.createElement("div");			
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 300;
			var h = 200;
			ConfigurationAPI.setPopUpPosition(el,w /*w*/,h /*h*/);

//			var ww = DesktopContent.getWindowWidth();
//			var wh = DesktopContent.getWindowHeight();
//			el.style.top = (DesktopContent.getWindowScrollTop() + ((wh-h-2)/2)) + "px";
//			el.style.left = (DesktopContent.getWindowScrollLeft() + ((ww-w-2)/2)) + "px";
//			el.style.width = w + "px";
//			el.style.height = h + "px";

			Debug.log("Previous filter = " + lastTreeFilter_);
			var defaultFilter = lastTreeFilter_ == ""?"*Port*":lastTreeFilter_;
			
			var str = "<a id='" + 
					"popUpDialog" + 
					"-header' href='#' onclick='javascript:var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "Please enter the filter (* may be used) to select which values are " +
					"shown in the tree:<br><br>";
			str += "<input type='text' id='popUpDialog-filter' value='" +
					defaultFilter + "'></input>";
			str += "</div><br><br>";

			var onmouseupJS = "";
			onmouseupJS += "applyTreeFilter(" +
					"document.getElementById(\"popUpDialog-filter\").value" +
					"); ";
			onmouseupJS += "var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); ";

			str += "<input type='button' onmouseup='" + onmouseupJS + "' " +
					"value='Filter Values' title='" +
					"Select the Alias in the drop-down for all tables." +
					"'/>";
			el.innerHTML = str;


			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";

			//select comment text
			ConfigurationAPI.setCaretPosition(document.getElementById("popUpDialog-filter"),
					0,defaultFilter.length);
		}
		
		//popUpVersionAliasGroupEditorForm
		function popUpVersionAliasGroupEditorForm()
		{
			Debug.log("CfgGUI popUpVersionAliasGroupEditorForm");

			var str = "";

			var el = document.getElementById("popUpDialog");
			if(!el)
			{
				el = document.createElement("div");			
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 300;
			var h = 200;
			ConfigurationAPI.setPopUpPosition(el,w /*w*/,h /*h*/);
			
//			var ww = DesktopContent.getWindowWidth();
//			var wh = DesktopContent.getWindowHeight();
//			el.style.top = (DesktopContent.getWindowScrollTop() + ((wh-h-2)/2)) + "px";
//			el.style.left = (DesktopContent.getWindowScrollLeft() + ((ww-w-2)/2)) + "px";
//			el.style.width = w + "px";
//			el.style.height = h + "px";

			var defaultAlias = "myAlias";
			var str = "<a id='" + 
					"popUpDialog" + 
					"-header' href='#' onclick='javascript:var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "Please enter the Alias you would like to select for all tables:<br><br>";
			str += "<input type='text' id='popUpDialog-alias' value='" +
					defaultAlias + "'></input>";
			str += "</div><br><br>";

			var onmouseupJS = "";
			onmouseupJS += "versionsForCreateConfig(2," +
					"document.getElementById(\"popUpDialog-alias\").value" +
					"); ";
			onmouseupJS += "var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); ";

			str += "<input type='button' onmouseup='" + onmouseupJS + "' " +
					"value='Select Alias' title='" +
					"Select the Alias in the drop-down for all tables." +
					"'/>";
			el.innerHTML = str;


			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";

			//select comment text
			ConfigurationAPI.setCaretPosition(document.getElementById("popUpDialog-alias"),
					0,defaultAlias.length);
		}
		
		
		//popUpClearVersionsPrompt
		function popUpClearVersionsPrompt(clearTemporary,backLinkStr)
		{
			Debug.log("CfgGUI popUpClearVersionsPrompt");
			var str = "";

			var el = document.getElementById("popUpDialog");
			if(!el)
			{
				el = document.createElement("div");			
				el.setAttribute("id", "popUpDialog");
			}

			//set position and size
			var w = 300;
			var h = 170;
			ConfigurationAPI.setPopUpPosition(el,w /*w*/,h /*h*/);
//			var w = 300;
//			var h = 170;
//			var ww = DesktopContent.getWindowWidth();
//			var wh = DesktopContent.getWindowHeight();
//			el.style.top = (DesktopContent.getWindowScrollTop() + ((wh-h-2)/2)) + "px";
//			el.style.left = (DesktopContent.getWindowScrollLeft() + ((ww-w-2)/2)) + "px";
//			el.style.width = w + "px";
//			el.style.height = h + "px";


			var str = "<br><a id='" + 
					"popUpDialog" + 
					"-header' href='#' onclick='javascript:var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "Are you sure you want to clear all " + 
					(clearTemporary?"temporary":"cached") + 
					" versions of <b>" + 
					_currentConfigName + "</b>?<br>";			
			str += "</div>";
			
			//Note: be careful with the source of backLinkStr.. don't use both quote styles!
			if(backLinkStr.indexOf("'") >= 0)
				backLinkStr = backLinkStr.replace(/'/g, "\\\"");
			else
				backLinkStr = backLinkStr.replace(/"/g, "\\\"");

			var refreshLinkStr = "setupSpecificConfig(\"" + 
					_currentConfigName + "\",\"" +
					_version + "\",\"" + backLinkStr + "\");"; 
			
			var clearLinkStr;
			
			if(clearTemporary)
				clearLinkStr = "DesktopContent.XMLHttpRequest(" +
					"\"Request?RequestType=clearConfigurationTemporaryVersions" + 
					"&configName=" + _currentConfigName + "\",\"\"," +
					" function(req) { " +
					"var err = DesktopContent.getXMLValue(req,\"Error\");" +
					"if(err && err != \"\")" +
					"{ Debug.log(err,Debug.HIGH_PRIORITY);	return;	}" +
					refreshLinkStr +
					"}" + //end handler function
					",0,0,0,true" +  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
					");"; 
			else
				clearLinkStr = "DesktopContent.XMLHttpRequest(" +
					"\"Request?RequestType=clearConfigurationCachedVersions" + 
					"&configName=" + _currentConfigName + "\",\"\"," +
					" function(req) { " +
					"var err = DesktopContent.getXMLValue(req,\"Error\");" +
					"if(err && err != \"\")" +
					"{ Debug.log(err,Debug.HIGH_PRIORITY);	return;	}" +
					refreshLinkStr +
					"}" + //end handler function
					",0,0,0,true" +  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
					");"; 
			
			str += "<input style='margin-top: 20px;' " +
					"type='button' onmouseup='" + clearLinkStr + "' " +
					"value='Clear " + 
					(clearTemporary?"Temporary":"Cached") +
					" Versions!' title='" +
					"Permanently delete all the temporary versions associated with " +
					_currentConfigName + "." +
					"'/>";
			el.innerHTML = str;


			document.getElementById("display").appendChild(el); //add element to display div


			el.style.display = "block";
		}
		
		//popUpSaveNewTableForm
		function popUpSaveNewTableForm()
		{
			editCellOK(); //editCellCancel();
			Debug.log("CfgGUI popUpSaveNewTableForm");
			
			var str = "";

			var el = document.getElementById("popUpDialog");
			if(!el)
			{
				el = document.createElement("div");			
				el.setAttribute("id", "popUpDialog");
			}
			
			//set position and size
			var gh = 50;
			var w = 500;
			var h = 425;
			ConfigurationAPI.setPopUpPosition(el,w /*w*/,h-gh*2 /*h*/);

//			var gh = 50;
//			var ww = DesktopContent.getWindowWidth();
//			var wh = DesktopContent.getWindowHeight();
//			//el.style.top = (DesktopContent.getWindowScrollTop() + ((wh-h-2)/2)) + "px";
//			el.style.top = (DesktopContent.getWindowScrollTop() + ((wh-h-2)/2)- gh*2) + "px"; //allow for 2xgh growth for each affected group
//			el.style.left = (DesktopContent.getWindowScrollLeft() + ((ww-w-2)/2)) + "px";
//			el.style.width = w + "px";
//			el.style.height = h + "px";
			
			var str = "<br><a id='" + 
					"popUpDialog" + 
					"-header' href='#' onclick='javascript:var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";
			
			str += "<div id='popUpDialog-div'>";
			
			//Mimicking popUpSaveTreeForm() (3/27/2017) RAR
			{
				str += "Saving will create a new persistent version for this table." + 
						"<br><br>";
				
				str += "Please enter a comment describing this new version of <b>" + 
						_currentConfigName + "</b>:<br>";
				str += "<textarea id='popUpDialog-comment' rows='4' cols='50' style='width:417px;height:68px;'>";
				var comment = _cachedTableComment == ""?ConfigurationAPI._DEFAULT_COMMENT:_cachedTableComment; 
				str += comment;
				str += "</textarea>";
				str += "</div>";

				//Note: 1/13/2017 - changed to always using cached comment 
				//give option to use cached comment
				//			if(_cachedTableComment != "") 			
				//				str += "<a href='#' onclick='" + 
				//					"var el = document.getElementById(" +
				//					"\"popUpDialog-comment\"); el.value = _cachedTableComment; return false;' " +
				//					"title='Load the cached comment associated with last persistent version " +
				//					"of " + _currentConfigName + " that was viewed. " + 
				//					"You will still have a chance to append to the comment.' " +
				//					">Get cached table comment</a><br><br>"; 

				//				str += "<input type='button' onmouseup='saveConfigAsNewVersion(0)' " +
				//						"value='Save Changes as New Version' title='" +
				//						"Save the current table view as new persitent version." +
				//						"'/>";


				
				//put -1 to gaurantee recognizing as a change
				var modifiedTables = _currentConfigName + ",-1"; //csv table, temporay version,...
				Debug.log("modifiedTables= " + modifiedTables);
				//get affected groups
				//	and save member map to hidden div for Save action
				///////////////////////////////////////////////////////////
				DesktopContent.XMLHttpRequest("Request?RequestType=getAffectedActiveGroups" +	
						"&groupName=" + _associatedGroupName + 
						"&groupKey=" + _associatedGroupKey,
						"&modifiedTables=" + modifiedTables,
						function(req) 
						{
					var err = DesktopContent.getXMLValue(req,"Error");
					if(err) 
					{					
						Debug.log(err,Debug.HIGH_PRIORITY);
						el.innerHTML = str;
						return;
					}

					//for each affected group
					//	 put csv: name,key,memberName,memberVersion...
					var groups = req.responseXML.getElementsByTagName("AffectedActiveGroup");				
					var memberNames, memberVersions;
					var xmlGroupName;
					modTblStr = ""; //re-use
					for(var i=0;i<groups.length;++i)
					{
						xmlGroupName = DesktopContent.getXMLValue(groups[i],"GroupName");
						str += "<div style='display:none' class='popUpDialog-affectedGroups' >";
						str += xmlGroupName;
						str += "," + DesktopContent.getXMLValue(groups[i],"GroupKey");

						memberNames = groups[i].getElementsByTagName("MemberName");
						memberVersions = groups[i].getElementsByTagName("MemberVersion");
						Debug.log("memberNames.length " + memberNames.length);
						for(var j=0;j<memberNames.length;++j)
							str += "," + DesktopContent.getXMLValue(memberNames[j]) + 
							"," + DesktopContent.getXMLValue(memberVersions[j]);
						str += "</div>"; //close div popUpDialog-affectedGroups


						if(modTblStr.length)
							modTblStr += ",";
						
												
						modTblStr += "<a style='color:black' href='#' onclick='javascript:" +								
								"var forFirefox = handleGroupCommentToggle(\"" + xmlGroupName + "\");" +								
								" handlePopUpHeightToggle(" + h + "," + gh + ");'>";
						modTblStr += xmlGroupName;
						modTblStr += "</a>";
						
						//store cached group comment in hidden html
						modTblStr += "<div id='popUpDialog-groupComment-" + 
								xmlGroupName + "' " +
								"class='popUpDialog-groupComment-cache' " + 
								"style='display:none'>" + 
								decodeURIComponent(DesktopContent.getXMLValue(groups[i],"GroupComment")) +
								"</div>";
					}

					str += "<br>...and choose the options you want; then click 'Save Table':" +
							"<br>";

					//add checkbox to save affected groups
					str += "<input type='checkbox' id='popUpDialog-bumpGroupVersions' checked " +
							"onclick='handlePopUpHeightToggle(" + h + "," + gh + ");'>";
					//add link so text toggles checkbox
					str += "<a href='#' onclick='javascript:" +
							"var el = document.getElementById(\"popUpDialog-bumpGroupVersions\");" +
							"var forFirefox = (el.checked = !el.checked);" +
							" handlePopUpHeightToggle(" + h + "," + gh + "); return false;'>";
					str += "Save Affected Groups as New Keys";
					str += "</a>";
					str +=	"</input><br>";

					//add checkbox to activate saved affected groups
					str += "<input type='checkbox' id='popUpDialog-activateBumpedGroupVersions' checked " +
							">";
					//add link so text toggles checkbox
					str += "<a href='#' onclick='javascript:" +
							"var el = document.getElementById(\"popUpDialog-activateBumpedGroupVersions\");" +
							"if(el.disabled) return false; " +
							"var forFirefox = (el.checked = !el.checked);" +
							"return false;'>";
					str += "Also Activate New Groups";
					str += "</a>";
					str +=	"</input><br>";

					str += "Here is the list of affected groups - click to set a group comment (count=" + groups.length + 
							"):" +					
							"<br>";

					//display affected groups
					str += "<div style='white-space:nowrap; width:" + w + "px; margin-bottom:20px; " + 
							"overflow:auto; font-weight: bold;'>";
					str += modTblStr;
					
					str += "<div id='clearDiv'></div>";
					str += "<center>";			
					
					str += "<div id='popUpDialog-groupComment-header'></div>";

					str += "<div id='clearDiv'></div>";
					
					str += "<textarea id='popUpDialog-groupComment' rows='4' cols='50' style='width:417px;height:68px;display:none;margin:0;'>";					 
					str += ConfigurationAPI._DEFAULT_COMMENT;
					str += "</textarea>";
					str += "</center>";
					
					str += "</div>"; //end affected groups div	

					str += "<div id='popUpDialog-groupAliasArea' style='margin-bottom:20px' ><center>";

					//get existing group aliases	
					///////////////////////////////////////////////////////////
					DesktopContent.XMLHttpRequest("Request?RequestType=getGroupAliases" +	
							"",
							"",
							function(req) 
							{
						var err = DesktopContent.getXMLValue(req,"Error");
						if(err) 
						{					
							Debug.log(err,Debug.HIGH_PRIORITY);
							el.innerHTML = str;
							return;
						}

						var aliases = req.responseXML.getElementsByTagName("GroupAlias");
						var aliasGroupNames = req.responseXML.getElementsByTagName("GroupName");
						var aliasGroupKeys = req.responseXML.getElementsByTagName("GroupKey");

						//for each affected group
						//	-Show checkbox for setting alias and dropdown for alias
						//	and a pencil to change dropdown to text box to free-form alias.
						//	-Also, identify if already aliased and choose that as default option
						//	in dropwdown.					
						var alias, aliasGroupName, aliasGroupKey;
						var groupName, groupKey;					
						var groupOptionIndex = []; //keep distance and index of option for each group, or -1 if none
						for(var i=0;i<groups.length;++i)
						{				
							groupOptionIndex.push([-1,0]); //index and distance

							groupName = DesktopContent.getXMLValue(groups[i],"GroupName");
							groupKey = DesktopContent.getXMLValue(groups[i],"GroupKey");

							//find alias
							modTblStr = ""; //re-use
							for(var j=0;j<aliasGroupNames.length;++j)
							{
								alias = DesktopContent.getXMLValue(aliases[j]);
								aliasGroupName = DesktopContent.getXMLValue(aliasGroupNames[j]);
								aliasGroupKey = DesktopContent.getXMLValue(aliasGroupKeys[j]);	

								//Debug.log("compare " + aliasGroupName + ":" +
								//		aliasGroupKey);

								//also build drop down
								modTblStr += "<option value='" + alias + "' ";

								//consider any alias with same groupName
								if(aliasGroupName == groupName)
								{
									if(groupOptionIndex[i][0] == -1 ||	//take best match
											Math.abs(groupKey - aliasGroupKey) < groupOptionIndex[i][1])
									{
										Debug.log("found alias");
										groupOptionIndex[i][0] = j; //index
										groupOptionIndex[i][1] = Math.abs(groupKey - aliasGroupKey); //distance
									}
								}
								modTblStr += ">";
								modTblStr += alias;	//can display however
								modTblStr += "</option>";
							}

							str += "<input type='checkbox' class='popUpDialog-setGroupAlias' " +
									(groupOptionIndex[i][0] >= 0?"checked":"") + //check if has an alias already
									">";
							//add link so text toggles checkbox
							str += "<a href='#' onclick='javascript:" +
									"var el = document.getElementsByClassName(\"popUpDialog-setGroupAlias\");" +
									"var forFirefox = (el[" + i + "].checked = !el[" + i + "].checked);" +
									" return false;'>";
							str += "Set '<b style='font-size:16px'>" + groupName + "</b>' to System Alias:";
							str += "</a><br>";

							str += "<table cellpadding='0' cellspacing='0' border='0'><tr><td>";
							str += "<select " +
									"id='popUpDialog-editAliasSelect-" + (i) + "' " +
									"style='margin:2px; height:" + (25) + "px'>";						
							str += modTblStr;
							str += "</select>";						

							str += "<input type='text' " +
									"id='popUpDialog-editAliasTextBox-" + (i) + "' " +
									"style='display:none; margin:2px; width:150px; height:" + 
									(19) + "px'>";						
							str += "";
							str += "</input>";	
							str += "</td><td>";

							str += "<div style='display:block' " + 
									"class='treeNode-Value-editIcon' id='popUpDialog-editIcon-" +
									(i) + "' " +
									"onclick='handleEditTreeAliasEditToggle(" +							 
									i + 
									");' " +
									"title='Toggle free-form system alias editing' " +
									"></div>";

							str += "</td></tr></table>";

							str +=	"</input>";

							//increase height each time a group check is added
							h += gh;
							el.style.height = h + "px";						
						}

						str += "</center></div>"; //close id='popUpDialog-groupAliasArea'


						// done with system alias handling
						// continue with pop-up prompt

						str += "</div>"; //close main popup div

						var onmouseupJS = "";
						onmouseupJS += "document.getElementById(\"popUpDialog-submitButton\").disabled = true;";
						onmouseupJS += "handleGroupCommentToggle(0,1);"; //force cache of group comment
						onmouseupJS += "handlePopUpHeightToggle(" + h + "," + gh + ");";
						onmouseupJS += "saveConfigAsNewVersion(0);";					

						str += "<input id='popUpDialog-submitButton' type='button' onmouseup='" + 
								onmouseupJS + "' " +
								"value='Save Table' title='" +
								"Save new version of the table\n" +
								"(Optionally, save new active groups and assign system aliases)" +
								"'/>";
						el.innerHTML = str;

						//handle default dropdown selections for group alias
						for(var i=0;i<groups.length;++i)
							if(groupOptionIndex[i][0] != -1) //have a default
								document.getElementById("popUpDialog-editAliasSelect-" + 
										i).selectedIndex = groupOptionIndex[i][0];
						
						//select comment text
						ConfigurationAPI.setCaretPosition(document.getElementById("popUpDialog-comment"),
								0,comment.length);

							},0,0,0,true //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
					); //end of getGroupAliases handler

						},0,0,0,true //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
				); //end of getActiveConfigGroups handler			

			}			
			
			//add element to body
			//	because saving/loading table resets the display and activeConfig!
			//	(actually could be more 'proper' than appending to display)
			document.body.appendChild(el); 
			el.style.display = "block";
		}
		
		//popUpSaveNewGroupForm
		//	use sourceType to decide how to create member map
		function popUpSaveNewGroupForm(groupName, sourceGroupKey, sourceType)
		{
			//groupKey is used to select the best matching alias
			//	if sourceGroupKey < 0 choose a high number so matches are biased high
			var groupKey = sourceGroupKey < 0?1E8:sourceGroupKey;
			
			Debug.log("CfgGUI popUpSaveNewGroupForm");

			var str = "";

			var el = document.getElementById("popUpDialog");
			if(!el)
			{
				el = document.createElement("div");			
				el.setAttribute("id", "popUpDialog");
			}

			//set position and size
			var gh = 50;
			var w = 500;
			var h = 335;
			ConfigurationAPI.setPopUpPosition(el,w /*w*/,h-gh*2 /*h*/);
//			var w = 500;
//			var h = 335;
//			var gh = 50;
//			var ww = DesktopContent.getWindowWidth();
//			var wh = DesktopContent.getWindowHeight();
//			//el.style.top = (DesktopContent.getWindowScrollTop() + ((wh-h-2)/2)) + "px";
//			el.style.top = (DesktopContent.getWindowScrollTop() + ((wh-h-2)/2)-gh) + "px"; //allow for 1x gh growth for each affected group
//			el.style.left = (DesktopContent.getWindowScrollLeft() + ((ww-w-2)/2)) + "px";
//			el.style.width = w + "px";
//			el.style.height = h + "px";

			var str = "<br><a id='" + 
					"popUpDialog" + 
					"-header' href='#' onclick='javascript:var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";

			//Mimicking popUpSaveNewTableForm () (4/20/2017) RAR
			{
				str += "Saving will create a new persistent key for this group." + 
						"<br><br>";

				str += "Please enter a comment describing this new key for group <b>" + 
						groupName + "</b>:<br>";
				str += "<textarea id='popUpDialog-comment' rows='4' cols='50' style='width:417px;height:68px;''>";
				var comment = (!_cachedGroupComment || _cachedGroupComment == "")?ConfigurationAPI._DEFAULT_COMMENT:_cachedGroupComment; 
				str += comment;
				str += "</textarea>";
				str += "</div>";

				//affected group is trivial for this case

				var modTblStr = ""; //re-useable str				
				
				str += "<br>...and choose the options you want; then click 'Save Group':" +
						"<br>";

				
				//add checkbox to activate saved affected groups
				str += "<input type='checkbox' id='popUpDialog-activateBumpedGroupVersions' checked " +
						">";
				//add link so text toggles checkbox
				str += "<a href='#' onclick='javascript:" +
						"var el = document.getElementById(\"popUpDialog-activateBumpedGroupVersions\");" +
						"if(el.disabled) return false; " +
						"var forFirefox = (el.checked = !el.checked);" +
						"return false;'>";
				str += "Activate New Group";
				str += "</a>";
				str +=	"</input><br>";

				str += "<div id='popUpDialog-groupAliasArea' ><center>";

				//get existing group aliases	
				///////////////////////////////////////////////////////////
				DesktopContent.XMLHttpRequest("Request?RequestType=getGroupAliases" +	
						"",
						"",
						function(req) 
						{
					var err = DesktopContent.getXMLValue(req,"Error");
					if(err) 
					{					
						Debug.log(err,Debug.HIGH_PRIORITY);
						el.innerHTML = str;
						return;
					}

					var aliases = req.responseXML.getElementsByTagName("GroupAlias");
					var aliasGroupNames = req.responseXML.getElementsByTagName("GroupName");
					var aliasGroupKeys = req.responseXML.getElementsByTagName("GroupKey");

					//for each affected group
					//	-Show checkbox for setting alias and dropdown for alias
					//	and a pencil to change dropdown to text box to free-form alias.
					//	-Also, identify if already aliased and choose that as default option
					//	in dropwdown.					
					var alias, aliasGroupName, aliasGroupKey;										
					var groupOptionIndex = []; //keep distance and index of option for each group, or -1 if none
					for(var i=0;i<1;++i)//groups.length;++i) //only one affected group, the trivial one
					{				
						groupOptionIndex.push([-1,0]); //index and distance

						//groupName = DesktopContent.getXMLValue(groups[i],"GroupName");
						//groupKey = DesktopContent.getXMLValue(groups[i],"GroupKey");

						//find alias
						modTblStr = ""; //re-use
						for(var j=0;j<aliasGroupNames.length;++j)
						{
							alias = DesktopContent.getXMLValue(aliases[j]);
							aliasGroupName = DesktopContent.getXMLValue(aliasGroupNames[j]);
							aliasGroupKey = DesktopContent.getXMLValue(aliasGroupKeys[j]);	

							//Debug.log("compare " + aliasGroupName + ":" +
							//		aliasGroupKey);

							//also build drop down
							modTblStr += "<option value='" + alias + "' ";

							//consider any alias with same groupName
							if(aliasGroupName == groupName)
							{
								if(groupOptionIndex[i][0] == -1 ||	//take best match
										Math.abs(groupKey - aliasGroupKey) < groupOptionIndex[i][1])
								{
									Debug.log("found alias");
									groupOptionIndex[i][0] = j; //index
									groupOptionIndex[i][1] = Math.abs(groupKey - aliasGroupKey); //distance
								}
							}
							modTblStr += ">";
							modTblStr += alias;	//can display however
							modTblStr += "</option>";
						}

						str += "<input type='checkbox' class='popUpDialog-setGroupAlias' " +
								(groupOptionIndex[i][0] >= 0?"checked":"") + //check if has an alias already
								">";
						//add link so text toggles checkbox
						str += "<a href='#' onclick='javascript:" +
								"var el = document.getElementsByClassName(\"popUpDialog-setGroupAlias\");" +
								"var forFirefox = (el[" + i + "].checked = !el[" + i + "].checked);" +
								" return false;'>";
						str += "Set '<b style='font-size:16px'>" + groupName + "</b>' to System Alias:";
						str += "</a><br>";

						str += "<table cellpadding='0' cellspacing='0' border='0'><tr><td>";
						str += "<select " +
								"id='popUpDialog-editAliasSelect-" + (i) + "' " +
								"style='margin:2px; height:" + (25) + "px'>";						
						str += modTblStr;
						str += "</select>";						

						str += "<input type='text' " +
								"id='popUpDialog-editAliasTextBox-" + (i) + "' " +
								"style='display:none; margin:2px; width:150px; height:" + 
								(19) + "px'>";						
						str += "";
						str += "</input>";	
						str += "</td><td>";

						str += "<div style='display:block' " + 
								"class='treeNode-Value-editIcon' id='popUpDialog-editIcon-" +
								(i) + "' " +
								"onclick='handleEditTreeAliasEditToggle(" +							 
								i + 
								");' " +
								"title='Toggle free-form system alias editing' " +
								"></div>";

						str += "</td></tr></table>";

						str +=	"</input>";

						//increase height each time a group check is added
						h += gh;
						el.style.height = h + "px";						
					}

					str += "</center></div>"; //close id='popUpDialog-groupAliasArea'


					// done with system alias handling
					// continue with pop-up prompt

					str += "</div><br>"; //close main popup div

					var onmouseupJS = "";
					onmouseupJS += "document.getElementById(\"popUpDialog-submitButton\").disabled = true;";
					onmouseupJS += "saveConfigGroupAsNewKey(\"" +
							groupName +	"\"," + sourceType + ",0);";					

					str += "<input id='popUpDialog-submitButton' type='button' onmouseup='" + 
							onmouseupJS + "' " +
							"value='Save Group' title='" +
							"Save new key for the group\n" +
							"(Optionally, activate new group and assign system alias)" +
							"'/>";
					el.innerHTML = str;

					//handle default dropdown selections for group alias
					for(var i=0;i<1;++i)//groups.length;++i) //only one affected group, the trivial one
						if(groupOptionIndex[i][0] != -1) //have a default
							document.getElementById("popUpDialog-editAliasSelect-" + 
									i).selectedIndex = groupOptionIndex[i][0];

					//select comment text
					ConfigurationAPI.setCaretPosition(document.getElementById("popUpDialog-comment"),
							0,comment.length);

						},0,0,0,true //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
				); //end of getGroupAliases handler							

			}			

			//add element to body
			//	because saving/loading table resets the display and activeConfig!
			//	(actually could be more 'proper' than appending to display)
			document.body.appendChild(el); 
			el.style.display = "block";
		}
		
		//popUpGroupAliasForm
		// target either isLatest or isActivated
		function popUpGroupAliasForm(isLatest, myAlias)
		{
			Debug.log("CfgGUI popUpGroupAliasForm " + isLatest);

			var str = "";

			var el = document.getElementById("popUpDialog");
			if(!el)
			{
				el = document.createElement("div");			
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 300;
			var h = 220;
			ConfigurationAPI.setPopUpPosition(el,w /*w*/,h /*h*/);
//			var w = 300;
//			var h = 220;
//			var ww = DesktopContent.getWindowWidth();
//			var wh = DesktopContent.getWindowHeight();
//			el.style.top = (DesktopContent.getWindowScrollTop() + ((wh-h-2)/2)) + "px";
//			el.style.left = (DesktopContent.getWindowScrollLeft() + ((ww-w-2)/2)) + "px";
//			el.style.width = w + "px";
//			el.style.height = h + "px";

			var defaultAlias = (myAlias && myAlias != "")? myAlias: "mySystemAlias";
			var str = "<a id='" + 
					"popUpDialog" + 
					"-header' href='#' onclick='javascript:var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "<center>";
			str += "Please enter the System Alias to assign, and select the targeted ";
			str += isLatest?"Latest":"Active";
			str += " Group Type:<br><br>";
			
			str += "<table cellpadding='2px' cellspacing='2px' border='0'><tr><td style='text-align:right'>";
			str += "System Alias:</td><td style='text-align:left'>";
			str += "<input type='text' id='popUpDialog-alias' value='" +
					defaultAlias + "'></input>";
			str += "</td></tr>";
			
			//add group type drop down
			str += "<tr><td style='text-align:right'>";		

			if(isLatest) 
				str += "Latest Group";
			else
				str += "Active Group";
			str += ":</td><td style='text-align:left'>";
			str += "<select " +
					"id='popUpDialog-aliasGroupType' " +
					"style='height:" + (25) + "px'>";						
			str += "<option value='" + "0" + "'>" + "Context" + "</option>";
			str += "<option value='" + "1" + "'>" + "Backbone" + "</option>";
			str += "<option value='" + "2" + "' selected>" + "Configuration" + "</option>";
			str += "</select>";
			str += "</td></tr>";
			
			str += "</table>";
			
			str += "</center>";
			str += "</div>"; 
			str += "<br><br>";
						
			var onmouseupJS = "";
			if(isLatest)
				onmouseupJS += "wizToLatestConfigGroup(" +
					"document.getElementById(\"popUpDialog-alias\").value" +
					",0," +
					"document.getElementById(\"popUpDialog-aliasGroupType\").value" +
					"); ";
			else	//initialized
				onmouseupJS += "wizToActiveConfigGroup(" +
					"document.getElementById(\"popUpDialog-alias\").value" +
					",document.getElementById(\"popUpDialog-aliasGroupType\").value" +
					"); ";
			
			onmouseupJS += "var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); ";

			str += "<input type='button' onmouseup='" + onmouseupJS + "' " +
					"value='Setup System Alias' title='" +
					"Assign a System Alias to the selected ";
			str += isLatest?"Latest":"Active";
			str += " Group Type" +
					" by automatically modifying the active Backbone group." +
					"'/>";
			el.innerHTML = str;


			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";

			//select comment text
			ConfigurationAPI.setCaretPosition(document.getElementById("popUpDialog-alias"),
					0,defaultAlias.length);
		}
		
		//popUpVersionAliasForm
		function popUpVersionAliasForm()
		{
			Debug.log("CfgGUI popUpVersionAliasForm");

			var str = "";

			var el = document.getElementById("popUpDialog");
			if(!el)
			{
				el = document.createElement("div");			
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 300;
			var h = 200;
			ConfigurationAPI.setPopUpPosition(el,w /*w*/,h /*h*/);
			
//			var ww = DesktopContent.getWindowWidth();
//			var wh = DesktopContent.getWindowHeight();
//			el.style.top = (DesktopContent.getWindowScrollTop() + ((wh-h-2)/2)) + "px";
//			el.style.left = (DesktopContent.getWindowScrollLeft() + ((ww-w-2)/2)) + "px";
//			el.style.width = w + "px";
//			el.style.height = h + "px";

			var defaultAlias = "myAlias";
			var str = "<a id='" + 
					"popUpDialog" + 
					"-header' href='#' onclick='javascript:var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "Please enter the Alias you would like to assign to version &apos;" + 
					_version + "&apos; of <b>" + 
					_currentConfigName + "</b>:<br><br>";
			str += "<input type='text' id='popUpDialog-alias' value='" +
					defaultAlias + "'></input>";
			str += "</div><br><br>";

			var onmouseupJS = "";
			onmouseupJS += "setVersionAliasInActiveBackbone(" +
					"document.getElementById(\"popUpDialog-alias\").value" +
					",\"" + 
					_currentConfigName + "\",\"" + 
					_version + "\"); ";
			onmouseupJS += "var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); ";
			
			str += "<input type='button' onmouseup='" + onmouseupJS + "' " +
					"value='Assign Alias' title='" +
					"Assign an Alias to " + _currentConfigName + 
					" version " + _version +					
					" by automatically modifying the active Backbone group." +
					"'/>";
			el.innerHTML = str;


			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";

			//select comment text
			ConfigurationAPI.setCaretPosition(document.getElementById("popUpDialog-alias"),
					0,defaultAlias.length);
		}
		
		//uploadTableFromCSV ~~
		function uploadTableFromCSV()
		{
			editCellOK(); //editCellCancel();
			Debug.log("CfgGUI uploadTableFromCSV _tableUploadStr = " + _tableUploadStr);

			var doReplace = document.getElementById("popUpDialog-replaceData").checked;
			var doAppend = document.getElementById("popUpDialog-appendData").checked;
			Debug.log("CfgGUI uploadTableFromCSV doReplace = " + doReplace);
			Debug.log("CfgGUI uploadTableFromCSV doAppend = " + doAppend);
			
			var srcRows = _tableUploadStr.split('\n');
			var src = []; //src = [r][c]
			for(var i=0;i<srcRows.length;++i)
				src.push(srcRows[i].split(','));
			
			//Note: similar to addRow
			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");				
			var str = "";
			var cols = [];
			var colIsBoolType = getTableViewColIsBoolType(rows);
			
			var rowOffset = 0;
			
			//if transposed cols = [c][r], else cols = [r][c]
			
			//localInsertSourceData ~~
			function localInsertSourceData() 
			{
				if(_tableViewIsTransposed) 
				{
					for(var r=0;r<src.length;++r)
					{
						for(var c=0;c<src[r].length;++c)
						{
							if(rowOffset + r == 0) cols[c] = [];
							if(!c) cols[0][rowOffset + r] = rowOffset + r; //insert row number
							cols[c+1][rowOffset + r] = decodeURIComponent(src[r][c]);
						}
					}
				}
				else
				{
					for(var r=0;r<src.length;++r)
					{
						cols[rowOffset + r] = [];
						for(var c=0;c<src[r].length;++c)
						{
							if(!c) cols[rowOffset + r][0] = rowOffset + r; //insert row number
							cols[rowOffset + r][c+1] = decodeURIComponent(src[r][c]);
						}
					}
				}
				rowOffset += src.length;
			}
			//end localInsertSourceData()
			
			//-------------------------			
			
			
			//localInsertCurrentData ~~
			function localInsertCurrentData(rowStart,rowEnd) 
			{
				if(rowEnd === undefined || rowEnd < 0 || rowEnd >= rows.length)
					rowEnd = (_tableViewIsTransposed?
							(rows[0].getElementsByTagName("td").length + 1):
							rows.length) - 1;
				
				var tmpCols;
				if(!_tableViewIsTransposed) //reading from normal view
				{
					for(var r=rowStart;r<=rowEnd;++r)
					{
						cols.push([]); //push empty column, for each 
						if(r == _CONFIG_DATA_ROW_OFFSET-1) //col names are headers
						{
							tmpCols = rows[r].getElementsByTagName("th");	
							for(var c=0;c<tmpCols.length;++c) 
								cols[rowOffset + r - rowStart][c] = tmpCols[c].innerHTML;
						}
						else
						{
							tmpCols = rows[r].getElementsByTagName("td");	
							for(var c=0;c<tmpCols.length;++c) 
								cols[rowOffset + r - rowStart][c] = tmpCols[c].innerHTML;
						}
					}
				}
				else //reading from transposed view
				{					
					var tmpColsIndex;
					for(var c=0;c<rows.length;++c) 
					{		
						if(c >= cols.length)
							cols.push([]); //push empty column, for each 

						//assume there is 1 th cell
						tmpCols = rows[c].getElementsByTagName("td");	
						for(var r=rowStart, tmpColsIndex=rowStart - 
								(rowStart>=_CONFIG_DATA_ROW_OFFSET?1:0);r<=rowEnd;++r) //-1 for th when starting at DATA OFFSET
						{	
							if(r == _CONFIG_DATA_ROW_OFFSET-1) //col names are headers
								cols[c][rowOffset + r - rowStart] = rows[c].getElementsByTagName("th")[0].innerHTML;
							else //take from the td cels
								cols[c][rowOffset + r - rowStart] = tmpCols[tmpColsIndex++].innerHTML;
						}
					}					
				}
				rowOffset += (rowEnd - rowStart) + 1;
			}
			//end localInsertCurrentData(rowStart,rowEnd)
			
			//-------------------------		
			
			
			
			

			//FIRST, always get rows up to data offset
			localInsertCurrentData(0,_CONFIG_DATA_ROW_OFFSET-1);
			
			if(!doAppend) //prepending or replacing data, so add first
			{
				localInsertSourceData();
			}
			
			if(!doReplace) //get current values from table
			{
				localInsertCurrentData(_CONFIG_DATA_ROW_OFFSET);
			}
			
			if(doAppend) //appending or replacing data, so add last
			{
				localInsertSourceData();
			}
			

			//create output string based on cols
			str += createTableViewOutputStr(cols,colIsBoolType,0,true);
			
			el.innerHTML = str;	
			
			//on succes remove popup
			el = document.getElementById("popUpDialog"); 
			if(el) el.parentNode.removeChild(el);	
		}
		
		//popUpUploadCSVTableForm ~~
		function popUpUploadCSVTableForm(groupName,groupKey)
		{
			Debug.log("CfgGUI popUpUploadCSVTableForm");	
			_tableUploadStr = ""; //clear previous upload
			
			var str = "";

			var el = document.getElementById("popUpDialog");
			if(!el)
			{
				el = document.createElement("div");			
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 380;
			var h = 305;
			ConfigurationAPI.setPopUpPosition(el,w /*w*/,h /*h*/);
//			var w = 380;
//			var h = 305;
//			var ww = DesktopContent.getWindowWidth();
//			var wh = DesktopContent.getWindowHeight();
//			el.style.top = (DesktopContent.getWindowScrollTop() + ((wh-h-2)/2)) + "px"; 
//			el.style.left = (DesktopContent.getWindowScrollLeft() + ((ww-w-2)/2)) + "px";
//			el.style.width = w + "px";
//			el.style.height = h + "px";
			
			var str = "<a id='" + 
					"popUpDialog" + //clear upload string on cancel!
					"-header' href='#' onclick='javascript:_tableUploadStr = \"\"; var el = document.getElementById(" +
					"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";	

			str += "Please choose a CSV formatted data file (i.e. commas for columns, and new lines for rows) " +
					"to upload, and choose whether you want to replace the current " +
					"data or prepend/append the new data:<br><br>";
			
			str += "<center>";
			
			str += "<input type='file' id='popUpDialog-fileUpload' " + 
					"accept='.csv' enctype='multipart/form-data' />";
			str += "<br><br>";
			
			//add checkbox to replaceData
			str += "<input type='checkbox' id='popUpDialog-replaceData' checked " +
					">";			
			//add link so text toggles checkbox
			str += "<a href='#' onclick='javascript:" +
					"var el = document.getElementById(\"popUpDialog-replaceData\");" +
					"var forFirefox = (el.checked = !el.checked);" +					
					"return false;'>";
			str += "Overwrite current data";
			str += "</a>";
			str +=	"</input><br>";
			

			//add append or prepend radop
			str += "<form id='popUpDialog-appendOrPrependForm' style='text-align:left; width:110px;'> ";
			str += "<input checked type='radio' id='popUpDialog-appendData'  name='popUpDialog-appendOrPrepend' value='0'>";
			//add link so text toggles checkbox
			str += "<a href='#' onclick='javascript:" +
					"var el = document.getElementById(\"popUpDialog-appendData\");" +
					"var forFirefox = (el.checked = !el.checked);" +
					"return false;'>";
			str += "Append";
			str += "</a>";
			str +=	"</input><br>";
			
			//add append or prepend radop
			str += "<input type='radio' id='popUpDialog-prependData'  name='popUpDialog-appendOrPrepend' value='0'>";
			//add link so text toggles checkbox
			str += "<a href='#' onclick='javascript:" +
					"var el = document.getElementById(\"popUpDialog-prependData\");" +
					"var forFirefox = (el.checked = !el.checked);" +
					"return false;'>";
			str += "Prepend";
			str += "</a>";
			str +=	"</input><br>";
			
			str += "</form>"; //close radio group

			// done with special handling
			// continue with pop-up prompt
			str += "</center></div><br><br>"; //close main popup div

			var onmouseupJS = "";
			onmouseupJS += "document.getElementById(\"popUpDialog-submitButton\").disabled = true;";
			onmouseupJS += "uploadTableFromCSV();";			

			str += "<input id='popUpDialog-submitButton' disabled type='button' onmouseup='" + 
					onmouseupJS + "' " +
					"value='Upload File' title='" +
					"Upload the chosen file to the current table based on your selected options." +					
					"'/>";

			el.innerHTML = str;
			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";
			
			document.getElementById('popUpDialog-fileUpload').addEventListener(
					'change', function(evt) {
				var files = evt.target.files;
				var file = files[0];           
				var reader = new FileReader();
				reader.onload = function() {
					//store uploaded file and enable button
					_tableUploadStr = this.result;
					Debug.log("_tableUploadStr = " + _tableUploadStr);							
					document.getElementById('popUpDialog-submitButton').disabled = false;
				}
				reader.readAsText(file);
			}, false);
		}
		
		//downloadTableAsCSV ~~
		// online people complain that this doesn't work for big files.
		// Note: if files are too big, could have server create csv file
		//	then link to <a href='/WebPath/download.csv' download></a>
		function downloadTableAsCSV()
		{
			editCellOK(); //editCellCancel();
			Debug.log("CfgGUI downloadTableAsCSV ");
			
			//create CSV data string from html table
			var dataStr = "data:text/csv;charset=utf-8\n";
			el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");				

			var cells;

			if(_tableViewIsTransposed)
			{
				var numOfCols = rows.length - _CONFIG_DATA_COL_OFFSET;
				var numOfRows = rows[0].getElementsByTagName("td").length + 1 - 
						_CONFIG_DATA_ROW_OFFSET; //assume one TH cell

				//have to locate each cell individually
				for(var r=0;r<numOfRows;++r)
				{
					for(var c=0;c<numOfCols;++c) //skip row index column
					{
						cells = rows[_CONFIG_DATA_COL_OFFSET + c].getElementsByTagName("td");
						//assume one th column so minus 1
						if(c)
							dataStr += ",";
						dataStr += encodeURIComponent(encodeURIComponent(
								cells[_CONFIG_DATA_ROW_OFFSET-1 + r].textContent.trim())); //replaces all special characters				
					}
					dataStr += "\n";
				}
			}
			else
			{
				for(var r=_CONFIG_DATA_ROW_OFFSET;r<rows.length;++r) //skip header rows
				{
					cells = rows[r].getElementsByTagName("td");

					for(var c=_CONFIG_DATA_COL_OFFSET;c<cells.length;++c) //skip row index column
					{
						if(c)
							dataStr += ",";
						dataStr += encodeURIComponent(encodeURIComponent(cells[c].textContent.trim())); //replaces all special characters
					}
					dataStr += "\n";
				}
			}
			Debug.log("CfgGUI downloadTableAsCSV dataStr=" + dataStr);
			
			var link = document.createElement("a");
			link.setAttribute("href", dataStr); //double encode, so encoding remains in CSV
			link.setAttribute("style", "display:none");
			link.setAttribute("download", _currentConfigName + "_download.csv");
			document.body.appendChild(link); // Required for FF

			link.click(); // This will download the data file named "my_data.csv"
			
			link.parentNode.removeChild(link);
		}
		
		
		//saveConfigAsNewVersion ~~
		//	ignoreWarnings = true will ignore warnings when saving groups
		//
		//	mimicking saveModifiedTree(ignoreWarnings) for group saving aspects
		function saveConfigAsNewVersion(temporary, backLinkStr, ignoreWarnings) 
		{	
			editCellOK(); //editCellCancel();
			Debug.log("CfgGUI saveConfigAsNewVersion temporary=" + temporary);

			var el = document.getElementById("popUpDialog-comment");
			var comment;
			if(el)
				comment = encodeURIComponent(el.value);
			else
				comment = "This is a temporary table.";

			//create data string from html table
			var dataStr = ""; // semi-colon(;) separated rows.. comma(,) separated entries within row
			el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");				

			var cells;

			if(_tableViewIsTransposed)
			{
				var numOfCols = rows.length - _CONFIG_DATA_COL_OFFSET;
				var numOfRows = rows[0].getElementsByTagName("td").length + 1 - 
						_CONFIG_DATA_ROW_OFFSET; //assume one TH cell

				//have to locate each cell individually
				for(var r=0;r<numOfRows;++r)
				{
					for(var c=0;c<numOfCols;++c) //skip row index column
					{
						cells = rows[_CONFIG_DATA_COL_OFFSET + c].getElementsByTagName("td");
						//assume one th column so minus 1
						dataStr += encodeURIComponent(
								cells[_CONFIG_DATA_ROW_OFFSET-1 + r].textContent.trim()) + ","; //replaces all special characters				
					}
					dataStr += ";";
				}
			}
			else
			{
				for(var r=_CONFIG_DATA_ROW_OFFSET;r<rows.length;++r) //skip header rows
				{
					cells = rows[r].getElementsByTagName("td");

					for(var c=_CONFIG_DATA_COL_OFFSET;c<cells.length;++c) //skip row index column
						dataStr += encodeURIComponent(cells[c].textContent.trim()) + ","; //replaces all special characters					
					dataStr += ";";
				}
			}

			if(temporary)
			{
				var reqStr = "Request?RequestType=saveSpecificConfiguration" + 
						"&dataOffset=" + _dataOffset + "&chunkSize=" + (rows.length-_CONFIG_DATA_ROW_OFFSET) +  
						"&configName=" + _currentConfigName + "&version="+_version +
						"&temporary="+(temporary?1:0) +
						"&tableComment=" + comment; 
				Debug.log(dataStr);
				Debug.log(reqStr);
				DesktopContent.XMLHttpRequest(reqStr, "data=" + dataStr, 
						saveConfigAsNewVersionHandler, backLinkStr,
						0,0,true  //progressHandler, callHandlerOnErr, showLoadingOverlay
				);
				return; //done handling temporary version save
			}
			
			//saving persistent version

			//Note: all information comes from popup dialog
			//	any return must also kill the popup

			//for each modified table
			//	save new version
			//	update tree member table version based on result
			//if saving groups
			//	for each affected group
			//		save member list but with tree table versions
			//		modify root group name if changed
			//if saving aliases
			//	for each alias
			//		set alias for new group

			Debug.log("saveConfigAsNewVersion " + (ignoreWarnings?1:0));
			var numberOfRequests = 0;
			var numberOfReturns = 0;
			var allRequestsSent = false;		

			//localHandleAffectedGroups ~~
			//	savedVersion is the new version of this table
			//	use it to updage member map of affected groups
			function localHandleAffectedGroups(savedVersion)
			{
				Debug.log("Done with table saving.");

				//check if saving groups
				var savingGroups = 
						document.getElementById("popUpDialog-bumpGroupVersions").checked;
				var activatingSavedGroups = 
						document.getElementById("popUpDialog-activateBumpedGroupVersions").checked;

				if(!savingGroups) //then no need to proceed. exit!
				{
					//kill popup dialog
					var el = document.getElementById("popUpDialog"); 
					if(el) el.parentNode.removeChild(el);	
					return;
				}

				Debug.log("On to saving groups");

				numberOfRequests = 0;		//re-use
				numberOfReturns = 0;		//re-use
				allRequestsSent = false; 	//re-use

				var affectedGroupNames = []; //to be populated for use by alias setting
				var affectedGroupKeys = []; //to be populated for use by alias setting
				var affectedGroupEls = 
						document.getElementsByClassName("popUpDialog-affectedGroups");
				var affectedGroupCommentEls = 
						document.getElementsByClassName("popUpDialog-groupComment-cache");
				
				//	for each affected group
				for(var i=0;i<affectedGroupEls.length;++i)
				{
					//save member list but with tree table versions
					Debug.log(affectedGroupEls[i].textContent);
					Debug.log("group comment: " + affectedGroupCommentEls[i].textContent);

					var affectedArr = affectedGroupEls[i].textContent.split(','); 

					//build member config map
					var configMap = "configList=";
					//member map starts after group name/key (i.e. [2])
					for(var a=2;a<affectedArr.length;a+=2)								
						if((affectedArr[a+1]|0) == -1) //replace version with new saved version
						{
							Debug.log("affectedArr " + affectedArr[a] + "-v" + affectedArr[a+1]);
							
							configMap += affectedArr[a] + "," + 
									savedVersion + ",";							
						}
						else //use existing version
							configMap += affectedArr[a] + "," + affectedArr[a+1] + ",";

					affectedGroupNames.push(affectedArr[0]);		
					reqStr = ""; //reuse
					reqStr = "Request?RequestType=saveNewConfigurationGroup" +
							"&groupName=" + affectedArr[0] +
							"&allowDuplicates=1" +
							"&ignoreWarnings=" + (ignoreWarnings?1:0) + 
							"&groupComment=" + encodeURIComponent(affectedGroupCommentEls[i].textContent);										
					Debug.log(reqStr);
					Debug.log(configMap);

					++numberOfRequests;
					///////////////////////////////////////////////////////////
					DesktopContent.XMLHttpRequest(reqStr, configMap, 
							function(req,treeMemberIndex) 
							{

						var attemptedNewGroupName = DesktopContent.getXMLValue(req,"AttemptedNewGroupName");
						var treeErr = DesktopContent.getXMLValue(req,"TreeErrors");
						if(treeErr) 
						{	
							Debug.log(treeErr,Debug.HIGH_PRIORITY);
							Debug.log("There were problems identified in the tree view of the " +
									"attempted new group '" +
									attemptedNewGroupName +
									"'.\nThe new group was not created.\n" +
									"(Note: Other tables and groups may have been successfully created, " +
									"and would have success indications below this error info)\n\n" +
									"You can save the group anyway (if you think it is a good idea) by clicking " +
									"the button in the pop-up dialog " +
									"'<u>Save Groups with Warnings Ignored</u>.' " +
									"\n\nOtherwise, you can hit '<u>Cancel</u>.' and fix the tree. " +
									"Below you will find the description of the problem:",																		
									Debug.HIGH_PRIORITY);

							//change dialog save button
							var el = document.getElementById("popUpDialog-submitButton");
							el.onmouseup = function() {
								document.getElementById("popUpDialog-submitButton").disabled = true;
								saveModifiedTree(1);								
							};
							el.value = "Save Groups with Warnings Ignored";
							el.disabled = false;
							return;
						}

						var err = DesktopContent.getXMLValue(req,"Error");
						if(err) 
						{					
							Debug.log(err,Debug.HIGH_PRIORITY);

							//kill popup dialog
							var el = document.getElementById("popUpDialog"); 
							if(el) el.parentNode.removeChild(el);	
							return;
						}			

						++numberOfReturns;

						var newGroupKey = DesktopContent.getXMLValue(req,"ConfigurationGroupKey");									
						affectedGroupKeys.push(newGroupKey);

						//need to modify root group name if changed
						Debug.log("Successfully created new group '" + attemptedNewGroupName + 
								" (" + newGroupKey + ")'", Debug.INFO_PRIORITY);

						//activate if option was selected
						if(activatingSavedGroups)
							activateSystemConfig(attemptedNewGroupName,newGroupKey);


						if(allRequestsSent && 
								numberOfReturns == numberOfRequests)
						{
							Debug.log("Done with group saving.");

							Debug.log("Moving on to Alias creation...");										

							//check each alias checkbox
							//	for each alias that is checked
							//		set alias for new group
							//if any aliases modified, save and activate backbone

							//get checkboxes
							var setAliasCheckboxes = 
									document.getElementsByClassName("popUpDialog-setGroupAlias");

							var groupAlias, groupName, groupKey;
							var setAliasCheckboxIndex = 0;
							var groupAliasName, groupAliasVersion;

							//in order to set alias, we need:
							//	groupAlias
							//	groupName
							//	groupKey				

							//for each set alias checkbox that is checked
							//	modify the active group alias table one after the other

							//localNextAliasHandler
							//	uses setAliasCheckboxIndex to iterate through setAliasCheckboxes
							//	and send the next request to modify the activegroupAlias table
							//	sequentially
							function localNextAliasHandler(req) 
							{
								//first time there is no req
								if(req)
								{
									var err = DesktopContent.getXMLValue(req,"Error");
									if(err) 
									{
										Debug.log(err,Debug.HIGH_PRIORITY);
										Debug.log("Process interrupted. Failed to modify the currently active Backbone!",Debug.HIGH_PRIORITY);

										//kill popup dialog
										var el = document.getElementById("popUpDialog"); 
										if(el) el.parentNode.removeChild(el);	
										return;
									}	

									groupAliasName = DesktopContent.getXMLValue(req,"savedName");
									groupAliasVersion = DesktopContent.getXMLValue(req,"savedVersion");

									Debug.log("Successfully added the system alias '" + groupAlias + 
											"' reference to group '" + groupName + " (" + groupKey + ")' " + 
											" in table '" + groupAliasName + "-v" + groupAliasVersion +
											"'.",
											Debug.INFO_PRIORITY);
									++setAliasCheckboxIndex; //req back, so ready for next index
								}

								//get next affected group index			
								while(setAliasCheckboxIndex < setAliasCheckboxes.length &&
										!setAliasCheckboxes[setAliasCheckboxIndex].checked)
									Debug.log("Skipping checkbox " + (++setAliasCheckboxIndex));

								if(setAliasCheckboxIndex >= setAliasCheckboxes.length)
								{
									Debug.log("Done with alias checkboxes ");

									if(!req) 
									{
										Debug.log("Backbone was not modified, so no need to save.");

										//kill popup dialog
										var el = document.getElementById("popUpDialog"); 
										if(el) el.parentNode.removeChild(el);
										treeHasChanged(true); // reset
										return;
									}
									Debug.log("Saving and activating modified Backbone");


									Debug.log("groupAliasName=" + groupAliasName);
									Debug.log("groupAliasVersion=" + groupAliasVersion);
									var configNames = req.responseXML.getElementsByTagName("oldBackboneName");
									var configVersions = req.responseXML.getElementsByTagName("oldBackboneVersion");

									//make a new backbone with old versions of everything except Group Alias 
									var configMap = "configList=";
									var name;
									for(var i=0;i<configNames.length;++i)
									{		
										name = configNames[i].getAttribute("value");

										if(name == groupAliasName)
										{
											configMap += name + "," + 
													groupAliasVersion + ",";
											continue;
										}
										//else use old member
										configMap += name + "," + 
												configVersions[i].getAttribute("value") + ",";							
									}
									Debug.log(configMap);

									saveGroupAndActivate("TableEditWizBackone",configMap,
											function(retParams)
											{
										Debug.log("Save and activate is done.");

										if(retParams)
										{							
											Debug.log("Successfully modified the active Backbone group.\n" +
													"Backbone group '" + retParams.groupName + " (" + 
													retParams.groupKey + ")' was created and activated.",
													Debug.INFO_PRIORITY);							
										}

										//kill popup dialog
										var el = document.getElementById("popUpDialog"); 
										if(el) el.parentNode.removeChild(el);	
										treeHasChanged(true); // reset
										return;
											},	//end of done handler for saveGroupAndActivate
											true //request return parameters
									);
									return;
								}	

								//get next alias
								{
									var el = document.getElementById("popUpDialog-editAliasSelect-" +
											setAliasCheckboxIndex);
									if(el.style.display == "none")
									{
										//get value from text box
										el = document.getElementById("popUpDialog-editAliasTextBox-" + 
												setAliasCheckboxIndex);					
									}
									groupAlias = el.value;
								}

								groupName = affectedGroupNames[setAliasCheckboxIndex];
								groupKey = affectedGroupKeys[setAliasCheckboxIndex];

								Debug.log("groupAlias = " + groupAlias);
								Debug.log("groupName = " + groupName);
								Debug.log("groupKey = " + groupKey);

								DesktopContent.XMLHttpRequest("Request?RequestType=setGroupAliasInActiveBackbone" +
										"&groupAlias=" + groupAlias + 
										"&groupName=" + groupName +
										"&groupKey=" + groupKey, "",
										localNextAliasHandler,
										0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
								);
							}

							localNextAliasHandler();

							Debug.log("Aliases set in motion");

							return;
						}

							},0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
					); //end save new group request								
				} //end affected group for loop

				allRequestsSent = true;
				if(numberOfRequests == 0) //no requests were sent, so go on to affected groups
				{
					Debug.log("There were no affected groups found to save.", Debug.INFO_PRIORITY);

					//kill popup dialog
					var el = document.getElementById("popUpDialog"); 
					if(el) el.parentNode.removeChild(el);
					treeHasChanged(true); // reset
				}
			}	//end localHandleAffectedGroups


			///////////
			//save the new table version
						
			var reqStr = "Request?RequestType=saveSpecificConfiguration" + 
					"&dataOffset=" + _dataOffset + "&chunkSize=" + (rows.length-_CONFIG_DATA_ROW_OFFSET) +  
					"&configName=" + _currentConfigName + "&version="+_version +
					"&temporary="+(temporary?1:0) +
					"&tableComment=" + comment; 
			Debug.log(dataStr);
			Debug.log(reqStr);
			
			DesktopContent.XMLHttpRequest(reqStr, "data=" + dataStr, 
					function(req)
					{
				var err = DesktopContent.getXMLValue(req,"Error");
				if(err) 
				{					
					Debug.log(err,Debug.HIGH_PRIORITY);

					//kill popup dialog
					var el = document.getElementById("popUpDialog"); 
					if(el) el.parentNode.removeChild(el);	
					return;
				}		
				
				var savedVersion = DesktopContent.getXMLValue(req,"savedVersion");
				
				var scratchNotice = (ConfigurationAPI._SCRATCH_VERSION == (savedVersion|0))?_SCRATCH_VIEW_NAME:savedVersion;
				Debug.log("New persistent version '" + scratchNotice +
						"' for table '" +
						_currentConfigName + "' was successfully created.", Debug.INFO_PRIORITY);
				
				//handle group handling based on popup options
				localHandleAffectedGroups(savedVersion);
				
				//call normal handler to update main table display
				saveConfigAsNewVersionHandler(req,backLinkStr);
						
				
					},0, 		//parameter
					0,0,true  //progressHandler, callHandlerOnErr, showLoadingOverlay
			);
			
			//done with initial call..
			//all further events happen after request for saving table returns
		}
		
		
		//saveConfigAsNewVersionHandler ~~
		function saveConfigAsNewVersionHandler(req, backLinkStr) 
		{	
			if(!backLinkStr) backLinkStr = _tableViewBackLinkStr;
			Debug.log("saveConfigAsNewVersionHandler requestHandler req " + req.responseText);

			var err = DesktopContent.getXMLValue(req,"Error");
			if(err && err != "")
			{
				Debug.log(err,Debug.HIGH_PRIORITY);
				return;
			}
			
			activateSystemConfigHandler(req);

			var configName = DesktopContent.getXMLValue(req,"savedName");
			var version = DesktopContent.getXMLValue(req,"savedVersion");

			Debug.log("saveConfigAsNewVersionHandler requestHandler configName " + configName + " version " + version);
			setupSpecificConfig(configName, version, backLinkStr);
		}
		
		//changeMemberVersionForConfigGroup ~~
		function changeMemberVersionForConfigGroup(groupName, groupKey, configName, newVersion) 
		{
			Debug.log("CfgGUI changeMemberVersionForConfigGroup configName=" + configName +
					" newVersion=" + newVersion);

			//steps:
			//	change current version
			//	update existing versions
			//	add button to save new group

			//change current version
			var el = document.getElementById(configName + "-currentVersion");
			el.innerHTML = newVersion;
			
			//change link
			el = document.getElementById(configName + "-currentVersionLink");
			var str = el.href;
			var linkSplitArr = str.split(',');
			str = ""; //build link href str back up with new version
			for(var i=0;i<linkSplitArr.length;++i)
			{
				if(i) str += ","; 
				if(i == 1)
					str += "\"" + newVersion + "\"";
				else
					str += linkSplitArr[i];				
			}
			el.href = str;
			
			//update existing
			el = document.getElementById(configName + "-versions");
			str = el.innerHTML;
			var configNameArr = str.split(',');
			str = "";
			//str += newVersion;
			//for each member configuration					
			for(var i=0;i<configNameArr.length-1;++i) //skip last ',' empty element
			{
				//Debug.log(configNameArr[i]);
				//if(configNameArr[i] == newVersion)  //skip link
				if(configNameArr[i] == newVersion || //skip link for current version
						(configNameArr[i] == 
								ConfigurationAPI._VERSION_ALIAS_PREPEND +
								ConfigurationAPI._SCRATCH_ALIAS &&
								newVersion == ConfigurationAPI._SCRATCH_VERSION)) 
				{
					str += " " + configNameArr[i];
 					continue;
				}
				str += " ";
				str += "<a href='#' onclick='javascript:changeMemberVersionForConfigGroup(\"" +
						groupName + "\",\"" + groupKey + "\",\"" + configName + "\"," + 
						"\"" + configNameArr[i] + "\"";
				str += "); return false;'>" + configNameArr[i];
				str += "</a>";
			}

			el = document.getElementById(configName + "-existingVersions");
			el.innerHTML = str;
			

			//get new version comment and show ----------
			DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificConfiguration" + 
					"&dataOffset=0&chunkSize=" + 0 +  
					"&configName=" + configName + 
					"&version=" + newVersion, 
					"", 
					function (req) {		
				
				var err = DesktopContent.getXMLValue(req,"Error");
				if(err) 
				{
					Debug.log(err,Debug.HIGH_PRIORITY);

					Debug.log("There were errors loading this version.\n\n" +
							"Please see the detailed Errors below:",Debug.HIGH_PRIORITY);

					//try to power through
				}

				var warns = DesktopContent.getXMLValue(req,"TableWarnings");
				if(warns)
					Debug.log("There were warnings found when loading this table " +
							"(you can treat them as informational):\n\n" +
							warns,Debug.WARN_PRIORITY);

				var tableComment = DesktopContent.getXMLValue(req,"TableComment");
				Debug.log("tableComment=" + tableComment);	

				document.getElementById(configName + "-comment").innerHTML =
						"//" + tableComment;
			},
			0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
			);
			
			
			
			//add Save Changes button -------------
			el = document.getElementById("display");
			if(document.getElementById("popUpSaveNewGroupForm-button"))//el.getElementsByTagName("div")[0].childNodes[0].tagName == "INPUT")
				return; //only add button once
			
			var dispStr = el.innerHTML;
			str = "";
			str += "<br><div>";
			str += "<input id='popUpSaveNewGroupForm-button' type='button' onmouseup='popUpSaveNewGroupForm(\"" +
//			str += "<input type='button' onmouseup='saveConfigGroupAsNewKey(\"" +
					groupName + "\",\"" +  groupKey + "\",0)" + //0 is sourceType
					"' value='Save Changes as New Group'" +  
					" title='" +
					"Save the modified group as a new persistent key for this group name." +
					"'/>";				
			str += "</div>";
			el.innerHTML = str + "<br>" + dispStr + "<div id='clearDiv'></div>" + str;
			
			el = document.getElementById("configGroupModified");
			el.innerHTML = "*Modified* "; //mark modified

			el = document.getElementById("saveGroupWithWarningsIgnored");
			if(el)
				el.style.display = "none";			
			
			
			
		}
		
		//saveConfigGroupAsNewKey ~~
		//	use sourceType to decide how to create member map
		//	sourceType: 
		//		0 := from specific group view	 (formerly saveConfigGroupAsNewKey())
		//		1 := from add/remove member view (formerly createConfigGroup()) 
		function saveConfigGroupAsNewKey(groupName, sourceType, ignoreWarnings) 
//		{
//			Debug.log("CfgGUI saveConfigGroupAsNewKey");	
//			
//			var memberArr = document.getElementById("GroupMember-names").innerHTML.split(",");
//			Debug.log("memberArr " + memberArr);
//			
//			var configMap = "configList=";
//			var version;
//			for(var i=0;i<memberArr.length-1;++i)
//			{
//				version = document.getElementById(memberArr[i] + 
//						"-currentVersion").innerHTML;
//				Debug.log("subconfig=" + memberArr[i] + 
//						" version=" + version);
//				configMap += memberArr[i] + "," + version + ",";
//			}			
//			
//			DesktopContent.XMLHttpRequest("Request?RequestType=saveNewConfigurationGroup" +
//					"&groupName=" + groupName +
//					"&ignoreWarnings=" + (ignoreWarnings?1:0), 
//					configMap, specificGroupRequestHandler,
//					0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
//			);
//			
//		}
		{	
			Debug.log("CfgGUI saveConfigGroupAsNewKey ignoreWarnings=" + ignoreWarnings);

			var el = document.getElementById("popUpDialog-comment");
			var comment = encodeURIComponent(el.value);
			
			//create member map from from html
			//	depending on sourceType

			var configMap = "configList=";			
			if(sourceType == 0) //0 := from specific group view	 (formerly saveConfigGroupAsNewKey())
			{
				var memberArr = document.getElementById("GroupMember-names").innerHTML.split(",");
				Debug.log("memberArr " + memberArr);
				var version;
				for(var i=0;i<memberArr.length-1;++i)
				{
					version = document.getElementById(memberArr[i] + 
							"-currentVersion").innerHTML;
					Debug.log("table=" + memberArr[i] + 
							" version=" + version);
					configMap += memberArr[i] + "," + version + ",";				
				}
			}			
			else if(sourceType == 1) //1 := from add/remove member view (formerly createConfigGroup())
			{
				var els = document.getElementsByClassName("memberConfigCheckbox");
				var sel;
				for(var el=0;el<els.length;++el)
					if(els[el].checked)
					{
						sel = document.getElementById("select-" + els[el].value);
						if(sel.options.length)
						{
							Debug.log("subconfig=" + els[el].value + " version=" + 
									sel.options[sel.selectedIndex].value);
							configMap += els[el].value + "," + sel.options[sel.selectedIndex].value + ",";
						}
					}
			}	
						
			
			//saving persistent key

			//Note: all information comes from popup dialog
			//	any return must also kill the popup
			
			//save the trivial one group
			//	for each affected group 
			//		activate if checked
			//if saving aliases
			//	for each alias
			//		set alias for new group
			
			var numberOfRequests = 0;
			var numberOfReturns = 0;
			var allRequestsSent = false;		

			//localHandleAffectedGroups ~~
			//	for this case, there is only the one trivial affected group
			function localHandleAffectedGroups()
			{
				var activatingSavedGroups = 
						document.getElementById("popUpDialog-activateBumpedGroupVersions").checked;

				Debug.log("On to saving groups");

				numberOfRequests = 0;		//re-use
				numberOfReturns = 0;		//re-use
				allRequestsSent = false; 	//re-use

				var affectedGroupNames = []; //to be populated for use by alias setting
				var affectedGroupKeys = []; //to be populated for use by alias setting
				
				//	for each affected group
				for(var i=0;i<1;++i)//affectedGroupEls.length;++i) //only the trivial one group
				{	
					affectedGroupNames.push(groupName);
					
					reqStr = ""; //reuse
					reqStr = "Request?RequestType=saveNewConfigurationGroup" +
							"&groupName=" + affectedGroupNames[i] +
							"&allowDuplicates=0" +
							"&ignoreWarnings=" + (ignoreWarnings?1:0) + 
							"&groupComment=" + comment;										
					Debug.log(reqStr);
					Debug.log(configMap);

					++numberOfRequests;
					///////////////////////////////////////////////////////////
					DesktopContent.XMLHttpRequest(reqStr, configMap, 
							function(req,treeMemberIndex) 
							{

						var attemptedNewGroupName = DesktopContent.getXMLValue(req,"AttemptedNewGroupName");
						var treeErr = DesktopContent.getXMLValue(req,"TreeErrors");
						if(treeErr) 
						{	
							Debug.log(treeErr,Debug.WARN_PRIORITY);
							Debug.log("There were problems identified in the tree view of the " +
									"attempted new group '" +
									attemptedNewGroupName +
									"'.\nThe new group was not created.\n\n" +									
									"You can save the group anyway (if you think it is a good idea) by clicking " +
									"the button in the pop-up dialog " +
									"'<u>Save Group with Warnings Ignored</u>.' " +
									"\n\nOtherwise, you can hit '<u>Cancel</u>.' and fix any issues. " +
									"Below you will find the description of the problem:",																		
									Debug.WARN_PRIORITY);

							//change dialog save button
							var el = document.getElementById("popUpDialog-submitButton");
							el.onmouseup = function() {
								document.getElementById("popUpDialog-submitButton").disabled = true;
								saveConfigGroupAsNewKey(attemptedNewGroupName,sourceType,1); //1 = ignore warnings								
							};
							el.value = "Save Group with Warnings Ignored";
							el.disabled = false;
							return;
						}

						var err = DesktopContent.getXMLValue(req,"Error");
						if(err) 
						{					
							Debug.log(err,Debug.HIGH_PRIORITY);

							//kill popup dialog
							var el = document.getElementById("popUpDialog"); 
							if(el) el.parentNode.removeChild(el);	
							return;
						}			

						++numberOfReturns;

						var newGroupKey = DesktopContent.getXMLValue(req,"ConfigurationGroupKey");									
						affectedGroupKeys.push(newGroupKey);

						//need to modify root group name if changed
						Debug.log("Successfully created new group '" + attemptedNewGroupName + 
								" (" + newGroupKey + ")'", Debug.INFO_PRIORITY);
						
						specificGroupRequestHandler(req); //display new group
						
						//activate if option was selected
						if(activatingSavedGroups)
							activateSystemConfig(attemptedNewGroupName,newGroupKey);


						if(allRequestsSent && 
								numberOfReturns == numberOfRequests)
						{
							Debug.log("Done with group saving.");

							Debug.log("Moving on to Alias creation...");										

							//check each alias checkbox
							//	for each alias that is checked
							//		set alias for new group
							//if any aliases modified, save and activate backbone

							//get checkboxes
							var setAliasCheckboxes = 
									document.getElementsByClassName("popUpDialog-setGroupAlias");

							var groupAlias, groupName, groupKey;
							var setAliasCheckboxIndex = 0;
							var groupAliasName, groupAliasVersion;

							//in order to set alias, we need:
							//	groupAlias
							//	groupName
							//	groupKey				

							//for each set alias checkbox that is checked
							//	modify the active group alias table one after the other

							//localNextAliasHandler
							//	uses setAliasCheckboxIndex to iterate through setAliasCheckboxes
							//	and send the next request to modify the activegroupAlias table
							//	sequentially
							function localNextAliasHandler(req) 
							{
								//first time there is no req
								if(req)
								{
									var err = DesktopContent.getXMLValue(req,"Error");
									if(err) 
									{
										Debug.log(err,Debug.HIGH_PRIORITY);
										Debug.log("Process interrupted. Failed to modify the currently active Backbone!",Debug.HIGH_PRIORITY);

										//kill popup dialog
										var el = document.getElementById("popUpDialog"); 
										if(el) el.parentNode.removeChild(el);	
										return;
									}	

									groupAliasName = DesktopContent.getXMLValue(req,"savedName");
									groupAliasVersion = DesktopContent.getXMLValue(req,"savedVersion");

									Debug.log("Successfully added the system alias '" + groupAlias + 
											"' reference to group '" + groupName + " (" + groupKey + ")' " + 
											" in table '" + groupAliasName + "-v" + groupAliasVersion +
											"'.",
											Debug.INFO_PRIORITY);
									++setAliasCheckboxIndex; //req back, so ready for next index
								}

								//get next affected group index			
								while(setAliasCheckboxIndex < setAliasCheckboxes.length &&
										!setAliasCheckboxes[setAliasCheckboxIndex].checked)
									Debug.log("Skipping checkbox " + (++setAliasCheckboxIndex));

								if(setAliasCheckboxIndex >= setAliasCheckboxes.length)
								{
									Debug.log("Done with alias checkboxes ");

									if(!req) 
									{
										Debug.log("Backbone was not modified, so no need to save.");

										//kill popup dialog
										var el = document.getElementById("popUpDialog"); 
										if(el) el.parentNode.removeChild(el);
										treeHasChanged(true); // reset
										return;
									}
									Debug.log("Saving and activating modified Backbone");


									Debug.log("groupAliasName=" + groupAliasName);
									Debug.log("groupAliasVersion=" + groupAliasVersion);
									var configNames = req.responseXML.getElementsByTagName("oldBackboneName");
									var configVersions = req.responseXML.getElementsByTagName("oldBackboneVersion");

									//make a new backbone with old versions of everything except Group Alias 
									var configMap = "configList=";
									var name;
									for(var i=0;i<configNames.length;++i)
									{		
										name = configNames[i].getAttribute("value");

										if(name == groupAliasName)
										{
											configMap += name + "," + 
													groupAliasVersion + ",";
											continue;
										}
										//else use old member
										configMap += name + "," + 
												configVersions[i].getAttribute("value") + ",";							
									}
									Debug.log(configMap);

									saveGroupAndActivate("TableEditWizBackone",configMap,
											function(retParams)
											{
										Debug.log("Save and activate is done.");

										if(retParams)
										{							
											Debug.log("Successfully modified the active Backbone group.\n" +
													"Backbone group '" + retParams.groupName + " (" + 
													retParams.groupKey + ")' was created and activated.",
													Debug.INFO_PRIORITY);							
										}

										//kill popup dialog
										var el = document.getElementById("popUpDialog"); 
										if(el) el.parentNode.removeChild(el);	
										treeHasChanged(true); // reset
										return;
											},	//end of done handler for saveGroupAndActivate
											true //request return parameters
									);
									return;
								}	

								//get next alias
								{
									var el = document.getElementById("popUpDialog-editAliasSelect-" +
											setAliasCheckboxIndex);
									if(el.style.display == "none")
									{
										//get value from text box
										el = document.getElementById("popUpDialog-editAliasTextBox-" + 
												setAliasCheckboxIndex);					
									}
									groupAlias = el.value;
								}

								groupName = affectedGroupNames[setAliasCheckboxIndex];
								groupKey = affectedGroupKeys[setAliasCheckboxIndex];

								Debug.log("groupAlias = " + groupAlias);
								Debug.log("groupName = " + groupName);
								Debug.log("groupKey = " + groupKey);

								DesktopContent.XMLHttpRequest("Request?RequestType=setGroupAliasInActiveBackbone" +
										"&groupAlias=" + groupAlias + 
										"&groupName=" + groupName +
										"&groupKey=" + groupKey, "",
										localNextAliasHandler,
										0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
								);
							}

							localNextAliasHandler();

							Debug.log("Aliases set in motion");

							return;
						}

							},0,0,0,true  //reqParam, progressHandler, callHandlerOnErr, showLoadingOverlay
					); //end save new group request								
				} //end affected group for loop

				allRequestsSent = true;
				if(numberOfRequests == 0) //no requests were sent, so go on to affected groups
				{
					Debug.log("There were no affected groups found to save.", Debug.INFO_PRIORITY);

					//kill popup dialog
					var el = document.getElementById("popUpDialog"); 
					if(el) el.parentNode.removeChild(el);
					treeHasChanged(true); // reset
				}
			}	//end localHandleAffectedGroups

			
			//handle group handling based on popup options
			localHandleAffectedGroups();

			//done with initial call..
			//all further events happen after request for saving table returns
		}
		
		//addMemberToConfigGroup ~~
		function addMemberToConfigGroup(groupName,backLinkStr) 
		{
			Debug.log("CfgGUI addMemberToConfigGroup " + groupName);
			
			var memberArr = document.getElementById("GroupMember-names").innerHTML.split(",");
			Debug.log("memberArr " + memberArr);
			
			//make special preselectStr CSV string with groupName and then current members
			var preSelectStr = groupName + ",";
			var version;
			for(var i=0;i<memberArr.length-1;++i)
			{
				version = document.getElementById(memberArr[i] + 
						"-currentVersion").innerHTML;
				Debug.log("subconfig=" + memberArr[i] + 
						" version=" + version);
				preSelectStr += memberArr[i] + "," + version + ",";
			}
			
			if(backLinkStr && backLinkStr != "")
				preSelectStr += "&backLinkStr=" + backLinkStr;
			setupConfigCreator(preSelectStr);			
		}
		
		//jump ~~
		function jump(anchor)
		{
			Debug.log("jump = " + anchor);
			var url = location.href;
			location.href = "#" + anchor;
			history.replaceState(null,null,url);
		}
		
		//evaluateJS ~~
		function evaluateJS(str)
		{
			Debug.log("evaluateJS = " + str);
			eval(str);
		}		
		
		//createEditTableMenu ~~
		function createEditTableMenu(event)
		{
			var menuItems = [
							 "Find and Replace",
							 "Copy and Move",
							 _showTableDetails?
									 "Hide Table Details":
									 "Show Table Details",
							 "Transpose Table View",
							 _useTableLinkDropdown?
									 "Disable Table Link Drop-down Assistance":
									 "Enable Table Link Drop-down Assistance",
							 "Download Data (CSV)",
							 "Upload Data (CSV)"
									 ];
			var menuItemHandlers = [
							 "setupFindAndReplace()",
							 "setupCopyAndMoveRows()",
							 "toggleTableDetails()",
							 "transposeTableView()",
							 "_useTableLinkDropdown = !_useTableLinkDropdown;",
							 "downloadTableAsCSV()",
							 "popUpUploadCSVTableForm()"													 
									 ];
			Debug.log("createEditTableMenu()");
			SimpleContextMenu.createMenu(
					menuItems,
					menuItemHandlers,
					"editTableMenu",					//element ID
					event.pageX-1,event.pageY-1, 	//top left position
					"rgb(220, 187, 165)", 			//primary color
					"rgb(130, 51, 51)"				//secondary color
			);
		}
		
		//createEditTableMenu ~~
		function createTreeViewMenu(event)
		{
			var menuItems = [
							 "Refresh",
							 _showGroupDetails?
									 "Hide Group Details":
									 "Show Group Details",
							 treeViewHideStatus_?
									 "Show Status=False":
									 "Hide Status=False",
							 treeFilterApplied_?
									 "Clear Tree View Filter":
									 "Filter Tree View Values",
							 treeViewHideInfo_?
									 "Show Info Fields":
									 "Hide Info Fields"
									 ];
						
			var refreshLinkStr = "refreshTreeView();";
			var hardRefreshLinkStr = "hardRefreshTreeView();";
	
			//if tree has changed, ask if you really want to refresh
			//else, refresh
			var refreshWrapper = "if(treeHasChanged_) DesktopContent.popUpVerification(" + 
					"\"The tree has been modified. Refreshing will discard changes and " +
					"revert to the tree-view of group '" + treeGroupName_ + " (" + 
					treeGroupKey_ + ").' <br><br>Are you sure you want to Refresh?\", " +
					"function() {" + hardRefreshLinkStr + "},0,\"#efeaea\",0,\"#770000\");" + 
					"else {" + hardRefreshLinkStr + "}";
						
			var menuItemHandlers = [
							refreshWrapper,
							"toggleGroupDetails()",
							"treeViewHideStatus_ = !treeViewHideStatus_;" +
													refreshLinkStr,
							"treeFilterApplied_?applyTreeFilter():popUpFilterTreeForm()",
							"treeViewHideInfo_ = !treeViewHideInfo_; " +
													"applyTreeFilter('',0,1)"
									 ];
			Debug.log("createEditTableMenu()");
			SimpleContextMenu.createMenu(
					menuItems,
					menuItemHandlers,
					"editTableMenu",				//element ID
					event.pageX-1,event.pageY-1, 	//top left position
					"rgb(220, 187, 165)", 			//primary color
					"rgb(130, 51, 51)"				//secondary color
			);
		}

		//transposeTableView ~~
		//	returns a bool array indicating the columns 
		//	that have a bool type
		function getTableViewColIsBoolType(rows)
		{
			var colIsBoolArray 	= [];
			var boolTypes 		= ["OnOff","TrueFalse","YesNo"];	
			
			//init pre-data columns
			for(var c=0;c<_CONFIG_DATA_COL_OFFSET;++c)
				colIsBoolArray.push(false);	
			
			//////////////////////////
			{	//determine the boolean columns			
				var isStatusType;		
				var colType;

				if(_tableViewIsTransposed) //table is currently transposed, type is at col 0
				{
					for(var c=_CONFIG_DATA_COL_OFFSET;c<rows.length;++c)
					{
						colType = rows[c].getElementsByTagName("td")[0].childNodes[0].innerHTML.split('<')[0];
						isStatusType = false;
						for(var i=0;i<boolTypes.length;++i)
							if(boolTypes[i] == 
									colType)
							{
								isStatusType = true; break;
							}
						colIsBoolArray.push(isStatusType);
					}
				}
				else						//table is currently normal view, type is at row 0
				{
					var firstRowEls = rows[0].getElementsByTagName("td");
					for(var c=_CONFIG_DATA_COL_OFFSET;c<firstRowEls.length;++c)
					{
						colType = firstRowEls[c].childNodes[0].innerHTML.split('<')[0]; //type text is in a div for smaller font
						isStatusType = false;
						for(var i=0;i<boolTypes.length;++i)
							if(boolTypes[i] == 
									colType)
							{
								isStatusType = true; break;
							}
						colIsBoolArray.push(isStatusType);
					}
				}		
			}
			/////////// done determining bool columns
			
			return colIsBoolArray;
		}

		//createTableViewOutputStr ~~
		//	must exactly match the data table section of specificConfigRequestHandler()
		function createTableViewOutputStr(cols,colIsBoolType,transposeOutput,colsIsArray)
		{
			var boolTypeTrues = ["On","True","Yes"];
			var tdStyle;	
			var str = "";
			var val;
			var rowsSz = transposeOutput? cols[0].length : cols.length;
			var colsSz = transposeOutput? cols.length : cols[0].length;
			var uidCol,uidVal,colHdr;
			var r,c;
			
			//determine colUID
			{
				var found = false;
				for(var rr=0;!found && rr<rowsSz;++rr) 
				{	
					for(var cc=0;!found && cc<colsSz;++cc) 
					{	
						//choose proper value based on situation
						if(!_tableViewIsTransposed && !transposeOutput) //normal source and leaving normal
						{
							r = rr;
							c = cc;
							val = colsIsArray?cols[rr][cc]:cols[rr][cc].innerHTML;
						}	
						else if(!_tableViewIsTransposed && transposeOutput) //normal source and transposing
						{
							r = cc;
							c = rr;
							val = colsIsArray?cols[cc][rr]:cols[cc][rr].innerHTML;	
						}					
						else if(_tableViewIsTransposed && !transposeOutput) //transposed source and leaving transpoed
						{
							r = cc;
							c = rr;
							val = colsIsArray?cols[rr][cc]:cols[rr][cc].innerHTML;
						}
						else if(_tableViewIsTransposed && transposeOutput) //transposed source and normalizing
						{
							r = rr;
							c = cc;
							val = colsIsArray?cols[cc][rr]:cols[cc][rr].innerHTML;
						}
						
						if(r == _CONFIG_DATA_ROW_OFFSET-2 && 
								c >= _CONFIG_DATA_COL_OFFSET) //col types
						{
							if(val.substr(val.indexOf('title=') + ('title=').length + 1,3) == //val.split('>')[1].split('<')[0] == 
									"UID")
							{
								uidCol = c;
								Debug.log("uidCol " + c);
								found = true;
							}
							Debug.log("uidval? " + val);
						}
					}
				}
			}
			
			//create output string based on cols
			for(var rr=0;rr<rowsSz;++rr) 
			{				
				str += "<tr>";	
				for(var cc=0;cc<colsSz;++cc) 
				{		
					//choose proper value based on situation
					if(!_tableViewIsTransposed && !transposeOutput) //normal source and leaving normal
					{
						r = rr;
						c = cc;
						val = colsIsArray?cols[rr][cc]:cols[rr][cc].innerHTML;
						uidVal = colsIsArray?cols[rr][uidCol]:cols[rr][uidCol].innerHTML;
						colHdr = colsIsArray?cols[_CONFIG_DATA_ROW_OFFSET-1][cc]:cols[_CONFIG_DATA_ROW_OFFSET-1][cc].innerHTML;						
					}	
					else if(!_tableViewIsTransposed && transposeOutput) //normal source and transposing
					{
						r = cc;
						c = rr;
						val = colsIsArray?cols[cc][rr]:cols[cc][rr].innerHTML;	
						uidVal = colsIsArray?cols[cc][uidCol]:cols[cc][uidCol].innerHTML;	
						colHdr = colsIsArray?cols[_CONFIG_DATA_ROW_OFFSET-1][rr]:cols[_CONFIG_DATA_ROW_OFFSET-1][rr].innerHTML;	
					}					
					else if(_tableViewIsTransposed && !transposeOutput) //transposed source and leaving transpoed
					{
						r = cc;
						c = rr;
						val = colsIsArray?cols[rr][cc]:cols[rr][cc].innerHTML;
						uidVal = colsIsArray?cols[cc][uidCol]:cols[cc][uidCol].innerHTML;	
						colHdr = colsIsArray?cols[_CONFIG_DATA_ROW_OFFSET-1][rr]:cols[_CONFIG_DATA_ROW_OFFSET-1][rr].innerHTML;
					}
					else if(_tableViewIsTransposed && transposeOutput) //transposed source and normalizing
					{
						r = rr;
						c = cc;
						val = colsIsArray?cols[cc][rr]:cols[cc][rr].innerHTML;
						uidVal = colsIsArray?cols[uidCol][rr]:cols[uidCol][rr].innerHTML;
						colHdr = colsIsArray?cols[cc][_CONFIG_DATA_ROW_OFFSET-1]:cols[cc][_CONFIG_DATA_ROW_OFFSET-1].innerHTML;
					}
					
					
					//handle bool style
					tdStyle = "";	
					if(colIsBoolType[c]) //use r/c depending on source data
					{
						//determine if true value
						var isTrue = false;
						for(var i=0;i<boolTypeTrues.length;++i)
							if(boolTypeTrues[i] == val)
							{
								isTrue = true; break;
							}
						tdStyle += "style='background-color:";
						tdStyle += (isTrue)?_TABLE_BOOL_TYPE_TRUE_COLOR:_TABLE_BOOL_TYPE_FALSE_COLOR;
						tdStyle += "'";
					}	
					
					
					//open table cell
					if(r == _CONFIG_DATA_ROW_OFFSET-1) //col names are headers
						str += "<th>"; 
					else if(r >= _CONFIG_DATA_ROW_OFFSET &&	//data cells
							c >= _CONFIG_DATA_COL_OFFSET) 
						str += "<td onmouseup='selectThisCell("+(r-_CONFIG_DATA_ROW_OFFSET)+","+
						(c-_CONFIG_DATA_COL_OFFSET)+",this,event);' " + 
						tdStyle +
						
						" title='UID : " + uidVal + "\n" + 
						colHdr + 
						" : " + 
						(val.replace(/"/g, "&quot;").replace(/'/g, "&apos;")) +
						"' " + 
						
						">";
					else						
						str += "<td>";

					//cell value
					//first column is row numbers
					if(c == 0 && r >= _CONFIG_DATA_ROW_OFFSET)
					{							
						str += (_dataOffset + (r-_CONFIG_DATA_ROW_OFFSET));	//insert row index column

						//add +/- row controls
						str += "<br><a href='#' onclick='javascript:addRow(" + (r-_CONFIG_DATA_ROW_OFFSET) + "); return false;'>";
						str += "+";
						str += "</a>";
						str += "/<a href='#' onclick='javascript:deleteRow(" + (r-_CONFIG_DATA_ROW_OFFSET) + "); return false;'>";
						str += "-";
						str += "</a>";	
					}
					else if(c == 0 && r == _CONFIG_DATA_ROW_OFFSET-1)
						str += "Row";
					else
						str += val;
					
					//close table cell
					if(r == _CONFIG_DATA_ROW_OFFSET-1) //col names are headers
						str += "</th>"; 
					else
						str += "</td>";
				}
				str += "</tr>";	
			}

			return str;
			
		}		
		
		//transposeTableView ~~
		function transposeTableView()
		{
			editCellOK(); //editCellCancel();
			Debug.log("transposeTableView() transposed was =" + _tableViewIsTransposed);

			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");				
			var str = "";
			var cols = [];
			
			var colIsBoolType = getTableViewColIsBoolType(rows);				
	
			
			if(!_tableViewIsTransposed) //reading from normal view and transposing
			{
				//get all cols
				for(var r=0;r<rows.length;++r) 
				{
					if(r == _CONFIG_DATA_ROW_OFFSET-1) //col names are headers
						cols[r] = rows[r].getElementsByTagName("th");
					else
						cols[r] = rows[r].getElementsByTagName("td");					
				}

				//create output string based on cols
				str += createTableViewOutputStr(cols,colIsBoolType,true);							
				
				document.getElementById("lastAddRowLink0").style.display = "none";
				document.getElementById("lastAddRowLink1").style.display = "block";
			}
			else
			{
				//get all cols (transposed)
				var tmpCols, tmpColsIndex;
				var numOfNewRows = -1;
				for(var c=0;c<rows.length;++c) 
				{								 
					cols.push([]); //push empty column, for each 
					
					//assume there is 1 th cell
					tmpCols = rows[c].getElementsByTagName("td");
					tmpColsIndex = 0;
					for(var r=0;r<tmpCols.length+1;++r)
					{			
						if(r == _CONFIG_DATA_ROW_OFFSET-1) //col names are headers
							cols[cols.length-1][r] = rows[c].getElementsByTagName("th")[0];
						else //take from the td cels
						{
							cols[cols.length-1][r] = tmpCols[tmpColsIndex];
							++tmpColsIndex;
						}						
					}
				}

				//create output string based on cols
				str += createTableViewOutputStr(cols,colIsBoolType, true);
				
				document.getElementById("lastAddRowLink0").style.display = "block";
				document.getElementById("lastAddRowLink1").style.display = "none";
			}
				
			el.innerHTML = str;		

			_tableViewIsTransposed = !_tableViewIsTransposed;
			Debug.log("transposeTableView() transposed now =" + _tableViewIsTransposed);
		}
		
		//handlePopUpHeightToggle ~~
		//	checkbox was already set before this function call
		//	this responds to current value
		//
		//	pass height and group height
		function handlePopUpHeightToggle(h,gh)
		{
			var el = document.getElementById("popUpDialog-bumpGroupVersions");			
			Debug.log("handlePopUpHeightToggle " + el.checked);

			var ael = document.getElementById("popUpDialog-activateBumpedGroupVersions");	
			
			var groupCommentEl = document.getElementById("popUpDialog-groupComment");
			var groupCommentHeight = 0;
			
			if(groupCommentEl && groupCommentEl.style.display != "none")
				groupCommentHeight += 100;
			
			var popEl = document.getElementById("popUpDialog");			
			if(!el.checked)
			{
				//hide alias area and subtract the height
				
				document.getElementById("popUpDialog-groupAliasArea").style.display = "none";								
				popEl.style.height = (h + groupCommentHeight) + "px";		
				ael.disabled = true;
			}
			else
			{
				//show alias area and add the height
				
				//count if grps is 1 or 2
				var grps = document.getElementsByClassName("popUpDialog-affectedGroups");				
				popEl.style.height = (h + grps.length*gh + groupCommentHeight) + "px";
				document.getElementById("popUpDialog-groupAliasArea").style.display = "block";
				ael.disabled = false;
			}			
		}
		
		//handleGroupCommentToggle ~~		
		// toggles affected group comment box and handles details
		function handleGroupCommentToggle(groupName,setHideVal)
		{
			var el = document.getElementById("popUpDialog-groupComment");			
			var hel = document.getElementById("popUpDialog-groupComment-header");
			
			var doHide = el.style.display != "none";
			if(setHideVal !== undefined)
				doHide = setHideVal;
			
			if(doHide) //cache (possibly modified) group comment
			{
				if(hel.textContent == "") return; //assume was a force hide when already hidden
				
				//get current groupName so we know where to cache comment
				var gn = hel.textContent.split("'")[1];
				Debug.log("gn " + gn);
				var cel = document.getElementById("popUpDialog-groupComment-" + 
							gn);				
				cel.innerHTML = "";
				cel.appendChild(document.createTextNode(el.value));
				
				//setup group comment header properly
				hel.innerHTML = "";
				el.style.display = "none";
				
				//if for sure hiding, then done
				if(gn == groupName || setHideVal !== undefined) 
					return;
				//else show immediately the new selection
			}
			
			//show groupName comment
			{
				var cel = document.getElementById("popUpDialog-groupComment-" + 
						groupName);
				el.value = cel.textContent;
				el.style.display = "block"; //show display before set caret (for Firefox)
				ConfigurationAPI.setCaretPosition(el,0,cel.textContent.length);
				
				hel.innerHTML = ("&apos;" + groupName + "&apos; group comment:");				
			}
		}
		
		//handleEditTreeGroupIDEditFreeformToggle
		function handleEditTreeGroupIDEditFreeformToggle()
		{
			Debug.log("handleEditTreeGroupIDEditFreeformToggle ");

			var sel = document.getElementById("editTree-groupIdFreeform-select");
			var tel = document.getElementById("editTree-groupIdFreeform-input");
			Debug.log("sel.style.display  " + sel.style.display);
			if(sel.style.display == "none")
			{
				sel.style.display = "block";
				tel.style.display = "none";
			}
			else
			{
				tel.style.width = (sel.offsetWidth-2) + "px";
				sel.style.display = "none";
				tel.style.display = "block";
				ConfigurationAPI.setCaretPosition(tel,0,tel.value.length);
			}
		}
		
		//handleEditTreeAliasEditToggle ~~
		function handleEditTreeAliasEditToggle(i)
		{	
			Debug.log("handlePopUpHeightToggle " + i);
			
			var sel = document.getElementById("popUpDialog-editAliasSelect-"+i);
			var tel = document.getElementById("popUpDialog-editAliasTextBox-"+i);
			Debug.log("sel.style.display  " + sel.style.display);
			if(sel.style.display == "none")
			{
				sel.style.display = "block";
				tel.style.display = "none";
			}
			else
			{
				tel.style.width = (sel.offsetWidth-2) + "px";
				sel.style.display = "none";
				tel.style.display = "block";
				ConfigurationAPI.setCaretPosition(tel,0,tel.value.length);
			}
						
		}		

		//bodyMouseMoveHandler ~~
		function bodyMouseMoveHandler(e)
		{
			if(treeEditingEditIconShownEl_)
			{
				//Debug.log("bodyMouseMoveHandler clearing ");
				treeEditingEditIconShownEl_.style.display = "none";
				treeEditingEditIconShownEl_ = 0;

				var vel = document.getElementById("treeNode-Value-" + treeEditingEditIconShownIdString_);
				if(vel)
					vel.style.backgroundColor = "transparent";
			}

		}
		//handleTreeNodeMouseMove ~~
		function handleTreeNodeMouseMove(depth,uid,event)
		{
			event.stopPropagation();
			DesktopContent.mouseMove(event); //keep desktop content happy

			if(_editingCell) return; //no setting while editing

			var idString = depth + "-" + uid;
			var el = document.getElementById("treeNode-Value-editIcon-" + idString);
			if(treeEditingEditIconShownEl_ == el) return;

			if(treeEditingEditIconShownEl_)
			{
				//Debug.log("bodyMouseMoveHandler clearing ");
				bodyMouseMoveHandler();
			}

			//Debug.log("handleTreeNodeMouseMove setting ");
			treeEditingEditIconShownIdString_ = idString;
			treeEditingEditIconShownEl_ = el;
			treeEditingEditIconShownEl_.style.display = "block";	
			var vel = document.getElementById("treeNode-Value-" + treeEditingEditIconShownIdString_);
			vel.style.backgroundColor = "rgb(218, 194, 194)";		
		}
		
		</script>
</head>
	

<body onload='Javascript:init();'>	
		
	<h1>Configuration GUI</h1>
		
		<div style='width:550px'>		
	<a href='#' onclick='javascript:setupSystemViewMode(); return false;'>System View</a> 	&nbsp;&nbsp;
	<a href='#' onclick='javascript:setupGroupViewMode(); return false;'>Group View</a>	&nbsp;&nbsp;
	<a href='#' onclick='javascript:setupTableViewMode(); return false;'>Table View</a>	&nbsp;&nbsp;

	<a style='margin-left:50px;' target="_blank" 
			href="https://cdcvs.fnal.gov/redmine/projects/otsdaq/search?utf8=%E2%9C%93&wiki_pages=1&q=configuration+gui&all_words=1&issues=1&documents=1" 
					title="Click to open ots documentation">
	<img src="/WebPath/images/dashboardImages/icon-Help.png"></a>
		</div>
	
	<hr>
	<div id='activeConfig'></div>
	<div id='activateConfigWithWarnings'></div>
	<hr>
	<div id='tempTree'></div>
	<div id='display'></div>
	<div class='preloadImage' id='preloadImage-treeEditIconHover'></div>
	<div class='preloadImage' id='preloadImage-treeEditTrashIcon'></div>
	<div class='preloadImage' id='preloadImage-treeEditTrashIconHover'></div>
	
</body>
	
</html>
