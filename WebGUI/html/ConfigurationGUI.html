<!DOCTYPE HTML>
<html lang="en">

<head>
	<script>

		// Configuration GUI 
		/////////////////////////////////////////////////////////////////////////////////////////
		/////////////////////////////////////////////////////////////////////////////////////////

		//functions:	=============================		
		//init()
		//niceName(str)									//removes "Table" from name
		//encodeHTML(s)
		
		//setupSystemViewMode(anchorTarget)							//gets table groups aliases
		//groupAliasesRequestHandler(req,anchorTarget)		 

		//setupGroupViewMode(anchorTarget)							//gets all table groups
		//tableGroupsRequestHandler(req,anchorTarget)
		//groupSearchSelectionHandler(el)
		//makeGroupInfoDisplayString(groupName,allKeys,latestKey,latestMembersHdr,backLinkToList)
		//gotoSelectedMSGroup()

		//setupTableViewMode(anchorTarget)							//gets tables
		//tableViewRequestHandler(req,anchorTarget)
		//tableSearchSelectionHandler(el)
		//showTableTooltip(tableName)

		//setupSpecificTableGroup(groupName,groupKey,backLinkStr,anchorTarget)	//setup editor for specific table group
		//specificGroupRequestHandler(req,param)			

		//setupSpecificTable(tableName,version,backLinkStr,allowIllegalColumns)			//setup editor for specific table
		//setupSpecificTableInRight(tableName,version)
		//specificTableRequestHandler(req,backLinkStr)			
		//toggleTableDetails(setVal)
		//toggleGroupDetails(setVal)
		//transposeTableView()
		//getTableViewColTypes(rows)
		//createTableViewOutputStr(cols,colTypes,transposeOutput,colsIsArray)
		//downloadTableAsCSV()
		//uploadTableFromCSV()
		//launchRecordCreationWizard(typeOfLaunch)
		//launchRecordDeletionWizard(typeOfLaunch)

		//tree-view focused =========
		//setupTableGroupTreeView(tableGroupName,tableGroupKey,backLinkStr)
		//treeViewHandler(req,parentId,errStr)
		//doCaptureTreeViewExpand()
		//doRestoreNextTreeViewExpand()
		//recursiveDrawTree(parent,depth,path,parentIdString)
		//getTreeViewTableStrings(tableLinkName,isLink,linkId,childLinkIndex,isGroupLink)
		//hardRefreshTreeView()
		//refreshTreeView();
		//applyTreeFilter(filter,reapplyFilter,infoWasToggled)
		//toggleTreeChildren(depth,uid,setVal)
		//expandTreeChildrenDepth()
		//hideTreeChildrenDepth()
		//createTreeViewMenu(event)
		//addTableToConfigurationGroup(tableName)

		//handleTreeNodeClick(depth,uid,editClick,type)			
		//treeHasChanged(reset)
		//saveModifiedTree(ignoreWarnings)
		//editTreeAddNewRow(tableName)
		//editTreeNodeOK()
		//editTreeNodePropagateChange()

		//selectThisTreeNode(idString,type,event)
		//treeViewGroupMemberEditMultiSelectHandler(sel) 
		//handleEditTreeGroupIDEditFreeformToggle()

		//refreshLinkTreeNode(targetEl,idString,LinkColumnNameLabel,linkType,linkTable,linkId,tableComment,tableTitle,menuItems,menuItemHandlers)
		//refreshTreeTableVersions()
		//end tree-view focused =========

		//selectThisCell(r,c,el,event)
		//		localGetPairColumnInfo()
		//		localHandleDropdownForLinkUID()
		//		localHandleDropdownForLinkGroupID()
		//			localFinishGroupIdDropdown()
		//		localFinishUpSelectCell()
		//editCellCancel()
		//keyHandler(e)
		//bodyKeyHandler(e,keyEl)
		//bodyMouseHandler(e)
		//bodyMouseMoveHandler(e)

		//editCellOK()									//assumes edited cell is specified by its global variables
		//addRow(r)										//add row at destination with default values populated
		//deleteRow(r)									//delete row at destination

		//popUpClearVersionsPrompt(clearTemporary,backLinkStr)
		//popUpSaveNewTableForm()
		//popUpSaveNewGroupForm(groupName, sourceGroupKey, sourceTye)
		//popUpGroupAliasForm(isLatest, myAlias)
		//popUpVersionAliasForm()
		//popUpVersionAliasGroupEditorForm()
		//popUpVersionAliasSpecificGroupForm(groupName,groupKey)
		//popUpFilterTreeForm()
		//popUpGroupViewAliasForm(groupName,groupKey)
		//popUpGroupViewAliasFormSubmit(groupName,groupKey)
		//popUpSaveTreeForm()

		//handleGroupCommentToggle(groupName,setHideVal)
		//handlePopUpHeightToggle(h,gh)

		//handleFixedChoiceEditToggle()

		//setupGroupCreator(preSelectStr)
		//setupGroupCreatorHandler(req,preSelectStr)
		//handleGroupMemberGoto(name,backLinkStr)
		//handleGroupMemberChange()
		//addMemberToConfigGroup(groupName,backLinkStr) 

		//activateSystemConfig(groupName, groupKey, ignoreWarnings, doneHandler)
		//activateSystemConfigHandler(req)
		//versionTrackingHandler(req)
		//selectForCreateTableGroup(i)
		//versionsForCreateTableGroup(i, alias)		
		//createTableGroup(ignoreWarnings)
		//createTableGroupHandler(req)

		//setVersionAliasInActiveBackbone(versionAlias,tableName,version,newBackboneNameAdd,doneHandler,doReturnParams)			
		//wizToLatestTableGroup(groupAlias, ignoreWarnings, groupType)
		//wizToActiveTableGroup(groupAlias, groupType)
		//saveGroupAndActivate(groupName,tableMap,doneHandler,doReturnParams)



		//saveTableAsNewVersion(temporary, backLinkStr, ignoreWarnings)
		//saveTableAsNewVersionHandler(req, backLinkStr)
		//saveTableGroupAsNewKey(groupName, sourceType, ignoreWarnings)	
		//changeMemberVersionForTableGroup(groupName, groupKey, tableName, newVersion)

		//isTemporary(version)

		//setupFindAndReplace()
		//tableFind()
		//tableReplace() 
		//configIncrementByReplace()
		//versionHasChanged()

		//tableVersionDiff()
		//setupTableVersionDiff()
		//setupCopyAndMoveRows()
		//configCopyView(sourceVersion)
		//tableCopyOrMoveRow(deleteSrc)					//copy/move row from source to destination row			
		//jump(anchor)
		//evaluateJS(str)			
		//createEditTableMenu(event)
		//createSystemViewMenu(event)
		//verifyRelaunchNormalMode()
		//verifyRelaunchWizMode()
		//toggleVersionTracking()
		//flattenToSystemAliases()
		//createAppStatusDesktopIcon()
		//mergeGroups(groupANameContext, groupAKeyContext, groupBNameContext, groupBKeyContext,groupANameConfig, groupAKeyConfig, groupBNameConfig, groupBKeyConfig, mergeApproach)
		//mergeGroupsDialog()
		//popUpGroupUploadDownloadForm(groupName,groupKey,isUpload)

		//tableLinkTooltip(prependString)

		//handleFlattenSystemAliasesResponse(req)


		//ConfigurationAPI functions =========
		//ConfigurationAPI.getDateString(date)
		//ConfigurationAPI.setCaretPosition(el,start,stop)
		//ConfigurationAPI.setGroupAliasInActiveBackbone(groupAlias,groupName,groupKey,newBackboneNameAdd,doneHandler,doReturnParams)
		//ConfigurationAPI.newWizBackboneMemberHandler(req,params)
		//ConfigurationAPI.setPopUpPosition(el,w,h,padding,border,margin)
		//end ConfigurationAPI functions =========

		//ConfigurationAPI constants =========
		//ConfigurationAPI._DEFAULT_COMMENT
		//end ConfigurationAPI constants =========

		//htmlOpen(tag,attObj,innerHTML,closeTag)
		//htmlClearDiv()

		/////////////////////////////////////////////////////////////////////////////////////////
		/////////////////////////////////////////////////////////////////////////////////////////

		//=====================================================================================
		//htmlOpen ~~		
		//	tab name and attribute/value map object
		function htmlOpen(tag, attObj, innerHTML, doCloseTag) {
			var str = "";
			var attKeys = attObj ? Object.keys(attObj) : [];
			str += "<" + tag + " ";
			for (var i = 0; i < attKeys.length; ++i)
				str += " " + attKeys[i] + "='" +
					attObj[attKeys[i]] + "' ";
			str += ">";
			if (innerHTML) str += innerHTML;
			if (doCloseTag)
				str += "</" + tag + ">";
			return str;
		} // end htmlOpen()

		//=====================================================================================
		//htmlClearDiv ~~		
		function htmlClearDiv() {
			return "<div id='clearDiv'></div>";
		} //end htmlClearDiv()


	</script>

	<title>ConfigurationGUI</title>

	<link href='/WebPath/css/fonts.css?family=Inconsolata:400' rel='stylesheet' type='text/css'>

	
	<link rel="stylesheet" type="text/css" href="/WebPath/css/ConfigurationGUI.css">
	<link rel="stylesheet" type="text/css" href="/WebPath/css/ConfigurationAPI.css">

	<!-- MultiSelectBox: Must include .css style sheet and .js functionality -->
	<link rel="stylesheet" type="text/css" href="/WebPath/css/MultiSelectBox.css">
	<script type="text/JavaScript" src="/WebPath/js/js_lib/MultiSelectBox.js"></script>

	<script type="text/JavaScript" src="/WebPath/js/Globals.js"></script>
	<script type="text/JavaScript" src="/WebPath/js/Debug.js"></script>
	<script type="text/JavaScript" src="/WebPath/js/DesktopContent.js"></script>
	<script type="text/JavaScript" src="/WebPath/js/js_lib/SimpleContextMenu.js"></script>
	<script type="text/JavaScript" src="/WebPath/js/js_lib/ConfigurationAPI.js"></script>

	<script type="text/JavaScript" src="/WebPath/js/RecordWiz_ConfigurationGUI.js"></script>
	<script type="text/JavaScript" src="/WebPath/js/DeleteWiz_ConfigurationGUI.js"></script>

	<style type="text/css">
		/*fix margin for this page in Multi-Select (must have changed because of font/font-size)*/
		/*#groupSearchDiv input, textarea { 
			margin: 			19px 5px 5px 12px;
		}*/

		/* make buttons have a hand cursor */
		input[type="button"],
		button {
			cursor: pointer;
		}

		.treeNode {
			margin-left: 30px;
			float: left;
			position: relative;
		}

		.treeNode-Connection {
			border-left: 1px solid rgb(44, 44, 187);
			border-bottom: 1px solid rgb(44, 44, 187);
			width: 24px;
			height: 17px;
			/* +1 for firefox */
			margin-top: -7px;
			position: absolute;
		}

		.treeNode-Expander {
			background-image: url(/WebPath/images/windowContentImages/ConfigurationGUI-expandTree.png);
			width: 11px;
			height: 9px;
			position: absolute;
			margin: 5px 0 0 25px;
			z-index: 1000;
			/* make sure it is on top of connect lines */
		}

		.treeNode-Expander:hover {
			cursor: pointer;
		}

		.treeNode-Value {
			margin-left: 38px;
			float: left;
		}

		/*
		.treeNode-Value:hover {
			background-color:	rgb(218, 194, 194);
		}*/

		.treeNode-Value-nonLeafNode:hover,
		.treeNode-Value-nonLeafNode label:hover {
			cursor: pointer;
		}

		.treeNode-Value-editIcon {
			background-image: url(/WebPath/images/windowContentImages/ConfigurationGUI-pencilEdit.png);
			width: 24px;
			height: 20px;
			float: left;
			border: 0;
			margin: -2px 0 -7px 10px;
			display: none;
		}

		.treeNode-Value-editIcon:hover {
			background-image: url(/WebPath/images/windowContentImages/ConfigurationGUI-pencilEditHover.png);
			cursor: pointer;
		}

		.treeNode-deleteIcon {
			background-image: url(/WebPath/images/windowContentImages/ConfigurationGUI-trashCan.png);
			width: 16px;
			height: 20px;
			border: 0;
			margin: -9px 0 -10px 10px;
		}

		.treeNode-deleteIcon:hover {
			background-image: url(/WebPath/images/windowContentImages/ConfigurationGUI-trashCanHover.png);
			cursor: pointer;
		}

		.preloadImage {
			width: 24px;
			height: 20px;
			position: absolute;
			left: -100px;
			top: 0;
		}

		#preloadImage-treeEditIconHover {
			background-image: url(/WebPath/images/windowContentImages/ConfigurationGUI-pencilEditHover.png);
		}

		#preloadImage-treeEditTrashIcon {
			background-image: url(/WebPath/images/windowContentImages/ConfigurationGUI-trashCan.png);
		}

		#preloadImage-treeEditTrashIconHover {
			background-image: url(/WebPath/images/windowContentImages/ConfigurationGUI-trashCanHover.png);
		}

		.treeNode-Link {
			float: left;
			margin: -1px 0 -3px 10px;
			padding: 3px 4px 3px 4px;
			border-radius: 3px;
		}

		.treeNode-Link:hover {
			background-color: rgb(218, 194, 194);
			margin: -2px 0 -2px 10px;
			cursor: pointer;
		}

		.treeNode-Children {
			border-left: 1px solid rgb(181, 170, 210);
		}

		.treeNode-LinkColumnNameLabel {
			color: rgb(65, 86, 146);
			font-weight: bold;
		}

		.treeNode-LinkDisconnectedLabel {
			color: red;
			font-weight: bold;
		}

		#activateConfigWithWarnings {
			margin-top: 10px;
			font-size: 14px;
		}

		#tableDetails th,
		#groupDetails th {
			font-size: 14px;
			text-align: right;
			vertical-align: top;
		}

		#tableDetails td,
		#tableDetails a,
		#tableDetails label,
		#tableDetails div,
		#tableDetails b,
		#groupDetails td,
		#groupDetails a,
		#groupDetails label,
		#groupDetails div,
		#groupDetails b {
			font-size: 14px;
			text-align: left;
			vertical-align: top;
		}

		#tableDetails .underlineRow,
		#groupDetails .underlineRow {
			border-bottom: 1px solid #b9a3a3;
		}

		#popUpDialog {
			position: absolute;
			z-index: 1000;
			border: 1px solid #770000;
			background-color: #efeaea;
			text-align: center;
			padding: 10px;
		}

		.popUpOkCancel:hover {
			text-decoration: underline;
			cursor: pointer;
		}
		
		#groupAddRemoveTable {
			margin-bottom: 		10px;
		}
		#groupAddRemoveTable tr:nth-child(even),
		#systemViewActiveTable tr:nth-child(even),
		#systemAliasTable tr:nth-child(even),
		#tableViewTable tr:nth-child(even) {
			background-color: 	rgb(218, 194, 194);
		}
		#systemViewActiveTable tr,
		#systemAliasTable tr {
			height: 			18px;
		}
		#systemViewActiveTable td,
 	 	#tableViewTable td {
			padding: 			0 5px 0 5px;
		}
		#systemAliasTable {
			padding-right:		20px;
		}
		#systemAliasTable th {
			color: 				rgb(65, 86, 146);
			border-left: 		2px solid rgb(140, 86, 86);
			padding-bottom:		5px;
		}
	</style>



	<script>

		//Start by offering System view, Group view, Table view
		//	and default to System view
		//
		//High Level Goals:
		//	- Allow to select a System Config to edit or start anew (all table versions are dont cares)
		//		- Be able to edit the versions associated with the System Config while 
		//		viewing other System Configs for inspiration
		//	- Allow to select a table to edit or start anew (from mock-up)
		//		- Be able to edit a table, and view others to copy chunks from them
		//


		//In System View mode:
		//	List the existing system aliases
		//		with possibly ability to scroll through associated sub-configs
		//

		//In Table View mode:
		//	List the existing versions
		//		with possibly scrolling information about the version (# of rows, lastuseddate, etc.)
		//	Some tables will need special views:
		//		ability to add chips (of certain types) to system config...
		//

		var _MAX_CHUNK_SIZE = 100; //100 rows per page
		var _CONFIG_DATA_ROW_OFFSET = 2;
		var _CONFIG_DATA_COL_OFFSET = 1;

		var _TABLE_BOOL_TYPE_TRUE_COLOR = "rgb(201, 255, 201)";
		var _TABLE_BOOL_TYPE_FALSE_COLOR = "rgb(255, 178, 178)";
		var _CONTEXT_MENU_PRIMARY_COLOR = "rgb(241, 233, 233)";
		var _CONTEXT_MENU_SECONDARY_COLOR = "rgb(50, 0, 0)";

		var _SCRATCH_VIEW_NAME = "Scratch-View";
		var _MOCKUP_VIEW_NAME = "Mockup-View";

		var _OK_CANCEL_DIALOG_STR = "";

		_OK_CANCEL_DIALOG_STR += "<div title='' style='padding:5px;background-color:#eeeeee;border:1px solid #555555;position:relative;z-index:2000;" + //node the expander nodes in tree-view are z-index:1000  
			"width:95px;height:20px;margin:0 -122px -32px 10px; font-size: 16px; white-space:nowrap; text-align:center;'>";
		_OK_CANCEL_DIALOG_STR += "<a class='popUpOkCancel' onclick='editCellOK(); event.stopPropagation();' onmouseup='event.stopPropagation();' title='Accept Changes' style='color:green'>" +
			"<b style='color:green;font-size: 16px;'>OK</b></a> | " +
			"<a class='popUpOkCancel' onclick='editCellCancel(); event.stopPropagation();' onmouseup='event.stopPropagation();' title='Discard Changes' style='color:red'>" +
			"<b style='color:red;font-size: 16px;'>Cancel</b></a>";
		_OK_CANCEL_DIALOG_STR += "</div>";

		var _OTS_RELAUNCH_STR =
			//Normal mode
			"Click here to relaunch ots in " +
			"<a onclick='" +
			"verifyRelaunchNormalMode();" +
			"'>Normal Mode</a>" +
			" or " +
			//Wiz Mode
			"<a onclick='" +
			"verifyRelaunchWizMode();" +
			"'>Wiz Mode</a>." +
			"<br>" +
			//Toggle Version Tracking
			"Click here to " +
			"<a id='versionTrackingSystemLink' onclick='" +
			"toggleVersionTracking();" +
			"'>Turn Version Tracking OFF</a>." +
			//Flatten Versions
			"<br>" +
			"Click here to " +
			"<a onclick='" +
			"flattenToSystemAliases();" +
			"'>Flatten to System Aliases</a>."
			;

		var _currentTableName, _associatedGroupName, _associatedGroupKey;
		var _editingCell = false;
		var _editingCellEl, _editingCellElOldValue, _editingCellElOldTitle, _editingCellType;
		var _editingCellPos = [-1, -1];
		var _versionIsChanged = false;
		var _version;
		var _dataOffset = 0;
		var _lastFindRow, _lastFindCol;
		var _cachedTableComment, _cachedGroupComment;

		var _activeTableGroups = []; //sz 6 (each 2) := holds the group name,key for currently active (could be none on failure) Context, Backbone, Config
		var _lastTableGroups = []; //sz 18 (each 3):= holds the group name,key,TIME for last successfully Configured, Started, activated-Config, activated-Context, activated-Backbone, activated-Iterator 

		var _versionTrackingIsOn = true;
		var _firstTimeSilentActive = true;
		var _useTableLinkDropdown = true;
		var _tableViewIsTransposed = false;
		var _showTableDetails = true;
		var _showGroupDetails = true;
		var _tableLinkDropdownChoices = [];
		var _tableFixedChoiceData = {};
		var _tableDefaultRowValues = [];
		var _tableViewBackLinkStr;
		var _tableUploadStr = "";

		var _displayTargetEl = 0;

		var _contextMemberNames = [];
		var _backboneMemberNames = [];
		var _iterateMemberNames = [];


		var _contextMenuEl = 0;

		var _msChosenGroupName;
		var _msChosenGroupKey;
		var _groupViewFilterIndex = 2; //-1=all, 0=context, 1=backbone, 2=configuration

		var _mouseIsSelecting = false;	//to block switching cells when selecting text

		//for tree view
		var treeViewHandlerStr_; //used by recursive function to build html string
		var fancyTreeViewHandlerStr_;
		var treeNodeUID_;		//incrementing unique id for nodes
		var treeMemberNames_, treeMemberVersions_, treeMemberComments_;
		var treeViewBackLinkStr_;
		var treeViewExpandedCapture_; //object to capture and load from on refresh
		var treeGroupName_, treeGroupKey_;
		var treeViewHideStatus_ = true;
		var treeFilterApplied_ = false;
		var treeViewHideInfo_ = true;
		var treeFilter_ = "";
		var lastTreeFilter_ = "";
		var lastTreeWarnStr_ = "";

		var treeHasChanged_ = false;
		var treeEditingNodeType_ = "";
		var treeEditingTargetTable_ = "";
		var treeEditingTargetUID_ = "";
		var treeEditingTargetColumn_ = "";
		var treeEditingNodeParentIdString_ = "";
		var treeEditingNodeDepth_ = -1;
		var treeEditingNodeIdString_ = "";
		var treeEditingNodeInitValue_ = "";
		var treeEditingEditIconShownEl_ = 0;
		var treeEditingEditIconShownIdString_ = "";
		var treeEditingInitGroupMembers_ = [];
		var treeEditingGroupMembersLastSelect_ = "";

		var _memberMapForGroupSave = {}; //used by saveTableGroupAsNewKey()

		var firstInit_ = true;
		var systemViewPreventInfiniteLoop_ = false;

		var _codeEditorAppId; //Code Editor Supervisor LID
														  
		//==============================================================================				
		//init called once body has loaded
		function init()
		{

			Debug.log("CfgGUI init ");
			Debug.logv({firstInit_});
			

//			ConfigurationAPI.getActiveGroups(function(activeGroups)
//					{
//				Debug.logv({activeGroups});		
//				
//				var tableName = "ARTDAQParamTable";
//				if(!activeGroups.Configuration || 
//						!activeGroups.Configuration.groupName || 
//						!activeGroups.Configuration.groupKey || 
//						activeGroups.Configuration.groupName.length < 2 || 
//						(activeGroups.Configuration.groupKey|0) < 0)
//					{
//						Debug.err("Could not find an active Configuration group to which to add table '" + 
//								tableName + ".'");
//						return;
//					}
//				DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificTableGroup" +
//								"&groupName=" + activeGroups.Configuration.groupName +
//								"&groupKey=" + activeGroups.Configuration.groupKey,
//								"", function(req)
//								{
//					
//					
//								}); //end getSpecificTableGroup call
//				
//					}); //end ConfigurationAPI.getActiveGroups() call
//			
//			return;
			
			var windowTooltip = "Welcome to the Configuration GUI. Here you can manipulate every configuration " +
				"parameter in your entire <i>otsdaq</i> system. \n\n" +
				"The organization of the Configuration GUI is as follows:\n" +
				"There are links at the top of the page to switch between the main views" +
				" 'System View', 'Group View', and " +
				"'Table View'; " +
				"then below those links is a display of the currently Active groups; " +
				"and then below that is the view content." +
				"\n\nIf you would like to take a look at the available online documentation, " +
				"click the question mark at the top of the Configuration GUI window.\n\n" +

				"Briefly, here is a description of the main views: " +
				"\n\t- <b>System View:</b>\n<INDENT>This view is for viewing and editing the translation from System Aliases to groups.</INDENT>" +
				"\n\t- <b>Group View:</b>\n<INDENT>This view is for viewing and editing groups of tables.</INDENT>" +
				"\n\t- <b>Table View:</b>\n<INDENT>This view is for viewing and editing tables.</INDENT>" +
				"\n\n" +
				"You will see one more type view in the Configuration GUI and that is the 'Tree-view'." +
				"Briefly, the 'Tree-view' is a way of viewing tables that are linked together - " +
				"each group can be viewed in 'Tree-view' format.";


			DesktopContent.tooltip("Configuration GUI Introduction",
				windowTooltip
			);
			DesktopContent.setWindowTooltip(windowTooltip);


			window.onkeydown = bodyKeyHandler;
			window.onmouseup = bodyMouseHandler;
			//be careful to not override the window.onmousemove DesktopContent action
			DesktopContent.mouseMoveSubscriber(bodyMouseMoveHandler);

			//get context, backbone, and iterate member list 
			DesktopContent.XMLHttpRequest("Request?RequestType=getContextMemberNames", "",
				function (req) {
					var memberNames = req.responseXML.getElementsByTagName("ContextMember");
					_contextMemberNames = []; //reset
					for (var i = 0; i < memberNames.length; ++i)
						_contextMemberNames[i] = memberNames[i].getAttribute("value");
					Debug.log(_contextMemberNames);
					if (_contextMemberNames.length == 0)
						Debug.log("Empty context member list found!", Debug.HIGH_PRIORITY);
				}); //end request handler

			DesktopContent.XMLHttpRequest("Request?RequestType=getBackboneMemberNames", "",
				function (req) {
					var memberNames = req.responseXML.getElementsByTagName("BackboneMember");
					_backboneMemberNames = []; //reset
					for (var i = 0; i < memberNames.length; ++i)
						_backboneMemberNames[i] = memberNames[i].getAttribute("value");
					Debug.log(_backboneMemberNames);
					if (_backboneMemberNames.length == 0)
						Debug.log("Empty backbone member list found!", Debug.HIGH_PRIORITY);
				}); //end request handler

			DesktopContent.XMLHttpRequest("Request?RequestType=getIterateMemberNames", "",
				function (req) {
					var memberNames = req.responseXML.getElementsByTagName("IterateMember");
					_iterateMemberNames = []; //reset
					for (var i = 0; i < memberNames.length; ++i)
						_iterateMemberNames[i] = memberNames[i].getAttribute("value");
					Debug.log(_iterateMemberNames);
					if (_iterateMemberNames.length == 0)
						Debug.log("Empty iterate member list found!", Debug.HIGH_PRIORITY);
				}); //end request handler

			//============================
			//		for debugging

			//setupSpecificTable("DesktopIconTable","2",""); return;
			//setupSpecificTable("XDAQContextTable","2","setupTableViewMode('anchorTag-XDAQContextTable');"); return;

			//setupSpecificTableGroup("artdaqFclTest","46","","anchorTag-RawDataSaverConsumerTable"); return;			
			//setupSpecificTableGroup("TableEditWizBackbone","0"); 

			//mergeGroups("TableEditWizBackbone","0","TableEditWizBackbone","3","rename");
			//mergeGroups("  ","2","testContext","3","defaultConfig","1","defaultConfig","4","Rename");

			//mergeGroupsDialog();
			//return;

			//setupGroupCreator(); return

			//setupTableGroupTreeView("test","10"); return; //"46"); return;
			//setupTableGroupTreeView("defaultConfig","3"); return;

			//setupGroupViewMode(); return;

			//setupGroupCreator(); return;


			//============================




			//get command string if opening a new window
			var cmdStr = DesktopContent.getParameter(1); //from  location.search
			if (cmdStr && cmdStr != "") {
				//do incoming commands!
				Debug.log("cmdStr=" + cmdStr);
				//replace %22 with "
				cmdStr = cmdStr.replace(/%22/g, "\"");

				evaluateJS(cmdStr);
			}
			else
				setupSystemViewMode();
			

			//fill in CodeEditor appId
			DesktopContent.XMLHttpRequest("Request?RequestType=getAppId" + 
					"&classNeedle=ots::CodeEditorSupervisor",
					"", //end post data, 
					function(req) 
					{			
				_codeEditorAppId = DesktopContent.getXMLValue(req,"id") | 0;
				Debug.log("_codeEditorAppId " + _codeEditorAppId);
					}, //end handler
					0, 0, true,//reqParam, progressHandler, callHandlerOnErr, 
					false,//doNotShowLoadingOverlay,
					true //targetSupervisor
			); //end getAppId request

		} //end init()

		//==============================================================================	
		//return name without "Table" unless it is start of the name 
		//or part of the word "Table"
		function niceName(str) 
		{
			var i = str.lastIndexOf("Table");
			return str.substr(0, (i > 1 && str[i + 13] != 's') ? i : str.length);
		} //end niceName()
		
		//==============================================================================	
		//encodeHTML ~~
		function encodeHTML(s)
		{
			Debug.log("encodeHTML()",s);
			var el = document.createElement("div");
			el.innerText = el.textContent = s;
			s = el.innerHTML;
			return s.replace(/'/g, '&apos;');
		} //end encodeHTML()

		//==============================================================================	
		//setupSystemViewMode ~
		function setupSystemViewMode(anchorTarget) 
		{

			editCellCancel();

			var el = document.getElementById("display");
			el.innerHTML = "Loading...";

			DesktopContent.XMLHttpRequest("Request?RequestType=getLastTableGroups",
				"",
				function (req) {

					//extract last config groups
					_lastTableGroups = [
						DesktopContent.getXMLValue(req, "LastConfiguredGroupName"),
						DesktopContent.getXMLValue(req, "LastConfiguredGroupKey"),
						DesktopContent.getXMLValue(req, "LastConfiguredGroupTime"),
						DesktopContent.getXMLValue(req, "LastStartedGroupName"),
						DesktopContent.getXMLValue(req, "LastStartedGroupKey"),
						DesktopContent.getXMLValue(req, "LastStartedGroupTime"),
						
						DesktopContent.getXMLValue(req, "LastActivatedConfigGroupName"),
						DesktopContent.getXMLValue(req, "LastActivatedConfigGroupKey"),
						DesktopContent.getXMLValue(req, "LastActivatedConfigGroupTime"),
						DesktopContent.getXMLValue(req, "LastActivatedIteratorGroupName"),
						DesktopContent.getXMLValue(req, "LastActivatedIteratorGroupKey"),
						DesktopContent.getXMLValue(req, "LastActivatedIteratorGroupTime"),
						DesktopContent.getXMLValue(req, "LastActivatedBackboneGroupName"),
						DesktopContent.getXMLValue(req, "LastActivatedBackboneGroupKey"),
						DesktopContent.getXMLValue(req, "LastActivatedBackboneGroupTime"),
						DesktopContent.getXMLValue(req, "LastActivatedContextGroupName"),
						DesktopContent.getXMLValue(req, "LastActivatedContextGroupKey"),
						DesktopContent.getXMLValue(req, "LastActivatedContextGroupTime")
						
					];
					//console.log(_lastTableGroups);

					systemViewPreventInfiniteLoop_ = true;
					DesktopContent.XMLHttpRequest("Request?RequestType=getGroupAliases&" +
						"reloadActiveGroups=" + (firstInit_ ? "0" : "1"), 
						//reload persistent active groups (persistent active config group will be modified when state machine configures)
						//firstInit_ should be used to stop the reload -- for example, after a group activation with warnings ignored
						"",
						function(req,anchorTarget) 
						{
							groupAliasesRequestHandler(req,anchorTarget);
							systemViewPreventInfiniteLoop_ = false;
						}, anchorTarget,
						0/*progressHandler*/, true /*callHandlerOnErr*/);

					firstInit_ = false;
				}); //end getLastTableGroups


			DesktopContent.XMLHttpRequest("Request?RequestType=versionTracking&Type=Get", "",
				versionTrackingHandler);
		} //end setupSystemViewMode()

		//==============================================================================
		//setupGroupViewMode ~
		function setupGroupViewMode(anchorTarget) 
		{
			editCellCancel();

			var el = document.getElementById("display");
			el.innerHTML = "Loading...";
			DesktopContent.XMLHttpRequest("Request?RequestType=getTableGroups", "",
				tableGroupsRequestHandler, anchorTarget,
				0/*progressHandler*/, true /*callHandlerOnErr*/);
		} //end setupGroupViewMode()

		//==============================================================================
		//setupTableViewMode ~
		function setupTableViewMode(anchorTarget) 
		{
			editCellCancel();

			var el = document.getElementById("display");
			el.innerHTML = "Loading...";
			DesktopContent.XMLHttpRequest("Request?RequestType=getTables", "",
				tableViewRequestHandler, anchorTarget);
		} //end setupTableViewMode()

		//==============================================================================
		//handleFlattenSystemAliasesResponse ~
		function handleFlattenSystemAliasesResponse(req)
		{
			Debug.log("Attempting to Flatten System Aliases... ",
				Debug.INFO_PRIORITY);
			handleOtsRelaunchResponse(req, undefined, true /*isOther*/);
		} //end handleFlattenSystemAliasesResponse()

		//==============================================================================
		//handleFlattenSystemAliasesResponse ~
		function handleOtsRelaunchResponse(req, isWiz, isOther)
		{
			if (req) //if supervisor is killed, then req will be 0, which is a good sign of progress
			{ 	//else check error response
				var err = DesktopContent.getXMLValue(req, "Error");
				if (err) {
					Debug.log(err, Debug.HIGH_PRIORITY);
					return;
				}
			}

			var countDown = 10;
			if (isWiz)
				Debug.log("Attempting to restart your system in Wiz Mode... " +
					"\n\n Please wait " + countDown +
					" seconds and then reload the System View to verify changes.",
					Debug.INFO_PRIORITY);
			else {
				countDown = 20;
				if (!isOther)
					Debug.log("Attempting to restart your system in Normal Mode... " +
						"\n\n Please wait " + countDown +
						" seconds and then reload the System View to verify changes.",
						Debug.INFO_PRIORITY);
				else
					Debug.log("\n\n Please wait " + countDown +
						" seconds and then reload the System View to verify changes.",
						Debug.INFO_PRIORITY);
			}

			localCountDown();
			//=================
			function localCountDown() {
				Debug.log("Waiting " + countDown + " seconds operation...",
					Debug.INFO_PRIORITY);

				window.setTimeout(function () {
					Debug.log("localCountDown handler ");
					--countDown;
					if (countDown == 0) {
						//end blackout
						DesktopContent.systemBlackout(false);
						//DesktopContent._blockSystemCheckMailbox.innerHTML = "";
						Debug.log("And we are back!<br>If you are switching modes, you will need to manually change the URL in your browser.", Debug.INFO_PRIORITY);
						setupSystemViewMode();
						DesktopContent.XMLHttpRequest("Request?" +
							"RequestType=clearTableCachedVersions" +
							"&tableName=*" +
							"&refresh=1"
						);
						return;
					}
					localCountDown();
				}, //end blackout-end handler 
					1000/*ms*/);
			}// end localCountDown
		} //end handleOtsRelaunchResponse()

		//==============================================================================
		//setupSpecificTableGroup ~		
		function setupSpecificTableGroup(groupName, groupKey, backLinkStr, anchorTarget) {

			Debug.log("setupSpecificTableGroup");

			var el = document.getElementById("display");
			el.innerHTML = "Loading...";
			var param = "";
			if (backLinkStr && backLinkStr != "")
				param += "&backLinkStr=" + backLinkStr;
			if (anchorTarget && anchorTarget != "")
				param += "&anchorTarget=" + anchorTarget;

			DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificTableGroup" +
				"&groupName=" + groupName +
				"&groupKey=" + groupKey,
				"", specificGroupRequestHandler, param,
				0, true  //progressHandler, callHandlerOnErr
			);
		} //end setupSpecificTableGroup()

		//==============================================================================
		//setupSpecificTable ~
		//	undefined version gives latest
		function setupSpecificTable(tableName, version, backLinkStr, allowIllegalColumns) 
		{
			var el;
			if (_displayTargetEl && backLinkStr == "special display target") {
				el = _displayTargetEl;
				backLinkStr = ""; //clear the link string
			}
			else {
				el = document.getElementById("display");
				_displayTargetEl = 0;
			}

			el.innerHTML = "Loading...";
			var v = "";
			if (version !== undefined && version != "") v = "&version=" + version;
			DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificTable" +
				"&dataOffset=0&chunkSize=" + _MAX_CHUNK_SIZE +
				(allowIllegalColumns?"&allowIllegalColumns=1":"") +
				"&tableName=" + tableName +
				v,
				"",
				function(req)
				{
					//call with attemptedVersion parameter
					specificTableRequestHandler(req, backLinkStr,
							(version !== undefined && version != "")?version:undefined);
				}, 
				0, //parameter 
				0, true  //progressHandler, callHandlerOnErr
			);
		} //end setupSpecificTable()

		//==============================================================================
		//setupSpecificTableInRight ~
		//	undefined version gives latest
		function setupSpecificTableInRight(tableName, version) 
		{
			_displayTargetEl = document.getElementById("display-right");
			setupSpecificTable(tableName, version, "special display target");
		} //end setupSpecificTableInRight()

		//==============================================================================
		//groupAliasesRequestHandler ~
		function groupAliasesRequestHandler(req, anchorTarget) 
		{

			var err = DesktopContent.getXMLValue(req, "Error");
			if (err) {
				Debug.log(err, Debug.HIGH_PRIORITY);

				//attempt to go on, in case error was just associtate with one group
				//return;
			}

			DesktopContent.tooltip("System View",
				"You are currently looking at your configuration through the 'System View.' " +
				"From this view you can see existing System Aliases, edit them, " +
				"and create new ones." +
				"\n\n" +
				"It is important to note that the Backbone group has a table called " +
				"'GroupAliases' and this is the table that defines your " +
				"System Aliases (Clicking <i>Edit System Aliases</i> at the top of " +
				"this view will take you to the 'GroupAliases' table). " +
				"The System Aliases defined in the Active Backbone group are what you " +
				"are seeing now!\n\n" +
				"You can edit and create System Aliases from this view. All of the links " +
				"with <i>Wiz-</i> in the name will either edit or create a System Alias for you. " +
				"The wiz process you select, under the hood, will modify the currently active " +
				"'GroupAliases' table, save it, create a new Backbone group with the new 'GroupAliases' " +
				"table as a member, and activate the new Backbone group. Handling many steps for you " +
				"like a wiz!" +
				"\n\n" +
				"There are two key terms you will find in the 'System View' involving 'Latest' and " +
				"'Active'; here is a brief " +
				"description of each: " +
				"<INDENT>" +
				"- <b>Wiz-to-Latest:</b>" +
				"<INDENT>" +
				"This will setup a System Alias to refer to a group comprised " +
				"of the latest/newest versions of each table in the group. When you select this route, you will " +
				"be prompted for the group type: Context, Backbone, or Configuration. " +
				"For example, if you select the table group type, then a table group consisting of the " +
				"latest versions of each table, that are not members of Context or Backbone table groups, will be " +
				"created, the active 'GroupAliases' table will be modified to include a System Alias to the" +
				"new table group, the modified 'GroupAlias' table will saved as a new version, " +
				"and a new Backbone table group (with that new 'GroupAlias' table as a member) will be created and activated. Very handy!" +
				"</INDENT>" +
				"</INDENT>" +
				"<INDENT>" +
				"- <b>Wiz-to-Active:</b>" +
				"<INDENT>" +
				"This will setup a System Alias to refer to one of the Active groups. " +
				"When you select this route, you will " +
				"be prompted for the table group type: Context, Backbone, or Configuration." +
				"For example, if you select the table group type, then the active 'GroupAliases' table " +
				"will be modified to include a System Alias to the" +
				"currently Active table group, the modified 'GroupAlias' table will saved as a new version, " +
				"and a new Backbone group (with that new 'GroupAlias' table as a member) will be created and activated. Also very handy!" +
				"</INDENT>" +
				"</INDENT>" +
				"\n\nRemember, if you would like to take a look at the available online documentation, " +
				"click the question mark at the top of the page.\n\n"
			);

			activateSystemConfigHandler(req); //display active config groups			

			var groupAliases = req.responseXML.getElementsByTagName("GroupAlias");
			var groupNames = req.responseXML.getElementsByTagName("GroupName");
			var groupKeys = req.responseXML.getElementsByTagName("GroupKey");
			var groupComments = req.responseXML.getElementsByTagName("GroupComment");
			var aliasComments = req.responseXML.getElementsByTagName("AliasComment");

			var groupAliasesVersion =
				DesktopContent.getXMLValue(req, "GroupAliasesTableVersion");
			var groupAliasesName =
				DesktopContent.getXMLValue(req, "GroupAliasesTableName");

			var str = ""; //string for html content			
			str += "<div style='display:none'>System View</div>"; //Note: this is children[0] tag is used in some place to determine mode after a series of events

			var groupAlias, groupName, groupKey, groupComment, aliasComment;
			var backLinkStr;

			backLinkStr = "setupSystemViewMode();";


			//display edit menu
			str +=
				"<div style='margin-top:-4px' class='tableView-Menu' onmousedown='createSystemViewMenu(event,\"" +
				groupAliasesName + "\",\"" + groupAliasesVersion + "\",\"" + backLinkStr + "\"" +
				");' title='System View Menu'>" +
				"<div class='gotoNavDiv'></div>" +
				"</div>"; //end context menu link div

			str += "<h3 style='margin-top:-10px'><u>System View</u></h3>";


			//str += _OTS_RELAUNCH_STR + "<br>";		
			//str += "<br>";

			//show active backbone and config
			function localShowActiveBackboneAndConfig() 
			{
				var activeConfigHeaders = ["Context", "Backbone", "Iterate Group", "Configuration"];

				str += "<table id='systemViewActiveTable' cellpadding='0' cellspacing='0' border='0' >"; //open active groups table

				insertLocalLastConfigGroups();
				
				for (var i = activeConfigHeaders.length-1; i >= 0 && i < activeConfigHeaders.length; --i) 
				{
					str += "<tr><td style='text-align:left; white-space:nowrap;'>";

					//if (i == activeConfigHeaders.length - 1) //for last configured 
					//	str += "Last Activated " + activeConfigHeaders[i] + ": ";
					//else	//for backbone, iterate
					if(i != 3)
						str += "Currently Active " + activeConfigHeaders[i] + ": ";
					else
						str += "Current Editor " + activeConfigHeaders[i] + ": ";

					str += "</td><td style='text-align:left; padding-left:20px;'>";

					if (!_activeTableGroups[i * 2] || _activeTableGroups[i * 2] == "")
					{
						str += "None";
					}
					else 
					{
						str += "<a href='#' onclick='setupSpecificTableGroup(\"" + _activeTableGroups[i * 2] +
							"\",\"" + _activeTableGroups[i * 2 + 1] + "\"); return false;'>";
						str += _activeTableGroups[i * 2] + "</a>(" + _activeTableGroups[i * 2 + 1] + ")";
					}

					str += "</td><td style='text-align:left; padding-left:20px;'>";
					
					if (!(!_activeTableGroups[i * 2] || _activeTableGroups[i * 2] == ""))
						str += "<a href='#' onclick='setupTableGroupTreeView(\"" +
							_activeTableGroups[i * 2] +
							"\",\"" +
							_activeTableGroups[i * 2 + 1] + "\"); return false;' " +
							"title='Open the tree-view for " + _activeTableGroups[i * 2] + 
							"(" + _activeTableGroups[i * 2 + 1] + ")'" +
							">Tree-view</a>";

					str += "</td></tr>";

					//if (i == activeConfigHeaders.length - 1) //for last configured 
						//insertLocalLastConfigGroups();
				}

				/////////////////////
				function insertLocalLastConfigGroups()
				{
					//last config groups for "Configured" and "Started:
					var extraPadding = "";
					for (var i = 0; i < _lastTableGroups.length; i += 3) 
					{
							
//						if(((i/3)|0) == 5) //add padding to last
//							extraPadding = "padding-bottom:10px;";
//						else
//							extraPadding = "";
						
						str += "<tr><td style='text-align:left;white-space:nowrap;" +
								extraPadding + "'>";


						if (!_lastTableGroups[i] || _lastTableGroups[i] == "") 
						{
							//no last group

							switch((i/3)|0)
							{
							case 0:
								str += "Last Configured by FSM: "; 
								break;
							case 1:
								str += "Last Run Started by FSM: ";
								break;
							case 2:
								str += "Last Editor Config: ";
								break;
							case 3:
								str += "Last Activated Iterate Group: ";
								break;
							case 4:
								str += "Last Activated Backbone: ";
								break;
							case 5:
								str += "Last Activated Context: ";
							default:; //impossible
							}
						}
						else 
						{
							//there is a last group, so show time

							switch((i/3)|0)
							{
							case 0:
								str += "Last Configured by FSM ";
								break;
							case 1:
								str += "Last Run Started by FSM ";
								break;
							case 2:
								str += "Last Activated Config ";
								break;
							case 3:
								str += "Last Activated Iterate ";
								break;
							case 4:
								str += "Last Activated Backbone ";
								break;
							case 5:
								str += "Last Activated Context ";
							default:; //impossible
							}

							str += "<label style='font-size:10px;white-space:nowrap;'>[" +
									_lastTableGroups[i + 2] + "]</label>: ";
						}

						str += "</td><td style='text-align:left; padding-left:20px;" + extraPadding + "'>";

						if (!_lastTableGroups[i] || _lastTableGroups[i] == "") 
						{
							str += "None";
						}
						else 
						{
							str += "<a href='#' onclick='setupSpecificTableGroup(\"" +
									_lastTableGroups[i] +
									"\",\"" + _lastTableGroups[i + 1] + "\"); return false;'>";
							str += _lastTableGroups[i] + "</a>(" + _lastTableGroups[i + 1] + ")";
						}

						str += "</td><td style='text-align:left; padding-left:20px;" + extraPadding + "'>";
					
						if(!(!_lastTableGroups[i] || _lastTableGroups[i] == ""))
							str += "<a href='#' onclick='setupTableGroupTreeView(\"" +
									_lastTableGroups[i] +
									"\",\"" +
									_lastTableGroups[i + 1] + "\"); return false;' " +
								"title='Open the tree-view for " + _lastTableGroups[i] + 
								"(" + _lastTableGroups[i + 1] + ")'" +
								">Tree-view</a>";

						str += "</td></tr>";
						
						if(((i/3)|0) == 5 ||
								((i/3)|0) == 1) //add extra rows for spacing
							str += "<tr style='background-color: rgb(140, 86, 86);height:2px;'>" +
								"<td colspan=3></td></tr>";
						if(((i/3)|0) == 5 ||
								((i/3)|0) == 1) //swap odd even coloring
							str += "<tr style='background-color: rgb(140, 86, 86);height:0px;'>" +
							"<td colspan=3></td></tr>";
					}
				}  //end insertLocalLastConfigGroups()


				str += "</table>"; //close active groups table

			} localShowActiveBackboneAndConfig();


			//			str += "<a href='#' onclick='setupSpecificTable(\"" + 
			//					groupAliasesName + "\",\"" +
			//					groupAliasesVersion + "\",\"" + backLinkStr + "\"); return false;'>";
			//			str += "Edit System Aliases</a>";
			//
			//			str += "<br>";
			//			
			//			str += "<a onclick='popUpGroupAliasForm(1); return false;' " +
			//					"title='Automatically assign a new System Alias to a Group comprised of the latest table versions.'" +
			//					">";
			//			str += "Wiz-New System Alias-to-Latest</a>";
			//
			//			//str += "&nbsp;&nbsp;&nbsp;&nbsp;";
			//			str += "<br>";
			//
			//			str += "<a onclick='popUpGroupAliasForm(0); return false;'  " +
			//						"title='Automatically assign a new System Alias to an Active Group.'" +
			//						">";
			//			str += "Wiz-New System Alias-to-Active</a>";

			str += "<br><br><br>";

			Debug.log("CfgGUI groupAliasesRequestHandler groupAliases.length " + groupAliases.length);



			str += "<table id='systemAliasTable' style='white-space:nowrap' cellpadding='0' cellspacing='0' border='0' >"; //open system aliases table

			str += "<tr>";
			str += "<th style='border-left: 0'>";
			str += "<u>System Alias</u>";
			str += "</th><th>";
			str += "<u>Translation</u>";
			str += "</th><th colspan='4'>";
			str += "";
			str += "<th style='text-align:left;padding-left: 20px;'>";
			str += "<u>Alias Comment</u>";
			str += "</th>";
			str += "<th style='text-align:left;padding-left: 20px;'>";
			str += "<u>Group Comment</u>";
			str += "</th>";
			str += "</tr>";


			if (!groupAliases.length)
				str += "No Table Group Aliases found.";
			for (var i = 0; i < groupNames.length; ++i) {
				groupAlias = groupAliases[i].getAttribute("value");
				groupName = groupNames[i].getAttribute("value");
				groupKey = groupKeys[i].getAttribute("value");
				groupComment = decodeURIComponent(groupComments[i].getAttribute("value"));
				aliasComment = decodeURIComponent(aliasComments[i].getAttribute("value"));

				backLinkStr = "setupSystemViewMode(\\\"anchorTag-" +
					groupAlias + "\\\");";


				str += "<tr style='height:10px !important;'>" +
						"<td style='text-align:left;padding: 0 10px 0 5px;'>";

				//system alias
				str += "<a name='anchorTag-" +
					groupAlias + "'></a>";
				str += "&quot;";
				str += "<a href='#' onclick='setupSpecificTable(\"" +
					groupAliasesName + "\",\"" +
					groupAliasesVersion + "\",\"" + backLinkStr + "\"); return false;' " +
					"title='Alias Comment:\n\"" + aliasComment + "\"' " +
					">";
				str += groupAlias + "</a>&quot;";


				str += "</td><td style='border-left: 2px solid rgb(140, 86, 86); " +						
						"text-align:center; padding: 0 10px 0 10px;'>";


				//add group view link				
				//str += "&lt; ";
				str += " <a href='#' onclick='setupSpecificTableGroup(\"" + groupName +
					"\",\"" + groupKey + "\",\"" + backLinkStr + "\"); return false;' " +
					"title='Open group-view for " + groupName +
					"(" + groupKey + ")' " +
					">";
				str += groupName + "</a>";
				str += "(" + groupKey + ")";
				//str += " &gt;";


				str += "</td><td style='border-left: 2px solid rgb(140, 86, 86); " +
						"text-align:left; padding-left:10px;'>";


				//add tree view link
				str += " <a href='#' onclick='setupTableGroupTreeView(\"" + groupName +
					"\",\"" + groupKey + "\",\"" + backLinkStr + "\"); return false;' " +
					"title='Open tree-view for " + groupName +
					"(" + groupKey + ")'>";
				str += "Tree-view</a>";


				str += "</td><td style='text-align:left; padding: 0 0 0 10px;'>";


				//add Activate link
				str += " <a onclick='activateSystemConfig(\"" + groupName +
					"\",\"" + groupKey + "\"); return false;' " +
					"title='Activate " + groupName +
					"(" + groupKey + ")'>";
				str += "Activate</a>";


				str += "</td><td style='text-align:left; padding: 0 0 0 10px;'>";


				//Wiz to latest of all tables
				str += " <a onclick='" +
					//"wizToLatestTableGroup(\"" + groupAlias + "\"); return false;' "+
					"popUpGroupAliasForm(1,\"" + groupAlias + "\"); return false;' " +
					"title='Automatically assign this System Alias to a Group comprised of the latest table versions.'" +
					">";
				str += "Wiz-to-Latest</a>";


				str += "</td><td style='text-align:left; padding: 0 10px 0 10px;'>";


				//Wiz to active config group
				str += " <a onclick='" +
					//"wizToInitializedConfigGroup(\"" + groupAlias + "\"); return false;' " +
					"popUpGroupAliasForm(0,\"" + groupAlias + "\"); return false;' " +
					"title='Automatically assign this System Alias to the Active Group.'" +
					">";
				str += "Wiz-to-Active</a>";


				str += "</td>";

				//add alias comment
				str += "<td style='border-left: 2px solid rgb(140, 86, 86); " +
						"text-align:left; padding: 0 10px 0 10px;' " +
						"title='For...    " + groupAlias + " <" +
						groupName + "(" + groupKey + ")>' " +
						">"
				str += "<pre style='white-space:nowrap;'>//" + aliasComment + "</pre>";
				str += "</td>";

				//add group comment
				str += "<td style='border-left: 2px solid rgb(140, 86, 86); " +
						"text-align:left; padding: 0 10px 0 10px;' " +
						"title='For...    " + groupName + "(" + groupKey + ")' " +
						">"
				str += "<pre style='white-space:nowrap;'>//" + groupComment + "</pre>";
				str += "</td>";

				str += "</tr>";
			}
			str += "</table>"; //close system aliases table

			var el = document.getElementById("display");
			el.innerHTML = str;
		} //end groupAliasesRequestHandler()

		//==============================================================================
		//tableGroupsRequestHandler ~
		function tableGroupsRequestHandler(req, anchorTarget) 
		{
			var err = DesktopContent.getXMLValue(req, "Error");
			if (err) {
				Debug.log(err, Debug.HIGH_PRIORITY);

				//attempt to go on, in case error was just associtate with one group
				//return;
			}

			activateSystemConfigHandler(req);

			var groupNames = req.responseXML.getElementsByTagName("TableGroupName");
			var keys = req.responseXML.getElementsByTagName("TableGroupKey");
			var membersHdr = req.responseXML.getElementsByTagName("TableGroupMembers");
			var types = req.responseXML.getElementsByTagName("TableGroupType");

			var groupName, key;

			var el = document.getElementById("display");

			var str = "";
			str += "<div style='display:none'>Group View</div>"; //Note: this is children[0] tag is used in some place to determine mode after a series of events

			var tableNames, tableVersions;
			var backLinkStr;
			var tableName, tableVersion;

			backLinkStr = "setupGroupViewMode();";

			str += "<h3 style='margin-top:-10px'><u>Group View</u></h3>";

			var typeName = ["All", "Context", "Backbone", "Configuration", "Iterate"];
			var typeFilterIndex = [-1, 0, 1, 2, 3];

			str += "Showing groups of type:";
			for (var i = 0; i < typeName.length; ++i) {
				if (_groupViewFilterIndex == typeFilterIndex[i])
					str += " <b>" + typeName[i] + "</b>";
				else {
					str += " <a href='#' onclick='_groupViewFilterIndex=" +
						typeFilterIndex[i] + ";setupGroupViewMode(); return false;'>";
					str += typeName[i];
					str += "</a>";
				}
			}

			str += "<br>";
			str += "<label id='filteredGroupCount'></label> of " +
				groupNames.length + " groups. ";
			str += "Do not see what you need? ";
			str += "<a href='#' onclick='" +
				"setupGroupCreator(\"&backLinkStr=" + backLinkStr +
				"\");' title='" +
				"Goto the group creator interface." +
				"'>" +
				"Create a new Group</a>";
			str += "<br>";


			Debug.log("CfgGUI requestHandler groupNames.length " + groupNames.length);
			if (!groupNames.length)
				str += "No Table Groups found.";
			else {
				_msChosenGroupName = "";
				_msChosenGroupKey = "";
				//////////////////////////////////////
				//add search box div

				str += "<button type='button' onmouseup='gotoSelectedMSGroup()' title='" +
					"View the Latest Key for the Selected Group." +
					"'>" +
					"View Latest Key for Selected Group</button>";
				str += "<div id='groupSearchDiv' ";
				str += "style='margin-top:-20px; height:200px; width:450px;'";
				str += ">";
				str += "</div>";

				str += "<div id='clearDiv'></div>";

				str += "<button style='margin-top:-25px' " +
					"type='button' onmouseup='gotoSelectedMSGroup()' title='" +
					"View the Latest Key for the Selected Group." +
					"'>" +
					"View Latest Key for Selected Group</button>";

				str += "<div style='margin-top:10px' id='msSelectedGroupDiv'></div>";

				str += "<div style='margin-top:0px'>";
				str += "<hr><b >";
				str += "Exhaustive Table Group List:";
				str += "</b></div><br>";

				//end search box add div
				//////////////////////////////////////				
			}

			str += "<div id='exhaustiveGroupList'></div>";

			el.innerHTML = str;

			//////////// make search box
			{
				var noMultiSelect = true; // true or false (false for multiselect functionality) 

				var msValues = []; 	//group names for multi-select
				var msKeys = []; 	//group keys for multi-select
				var msTypes = [];	//back link strings for multi-select
				var skipRepeat;
				var msAllKeys = []; //all keys separated by '-'
				var indexToLatest = []; //index to latest, used for exhaustive list
				var filteredGroupCount = 0;
				backLinkStr = "setupGroupViewMode();";

				var filterOutGroup;

				for (var i = 0; i < groupNames.length; ++i) 
				{
					groupName = groupNames[i].getAttribute("value");
					key = keys[i].getAttribute("value");

					filterOutGroup = false;
					//filter based on selected filter index
					if (_groupViewFilterIndex >= 0)
						for (var j = 0; j < typeName.length; ++j) 
						{
							if (_groupViewFilterIndex == typeFilterIndex[j] &&
								types[i].getAttribute("value") != typeName[j]) 
							{
								filterOutGroup = true;
								break;
							}
						}

					if (filterOutGroup) 
					{
						Debug.log("Filtering out " + groupName + "_v" + key);
						continue;
					}

					//if here, group is to be shown

					++filteredGroupCount;
					skipRepeat = false;
					for (var j = 0; j < msValues.length; ++j)
						if (msValues[j] == groupName)
						{
							//only represent single latest group/key
							if ((key | 0) > (msKeys[j] | 0))
							{
								msKeys[j] = key; //found new latest key
								indexToLatest[j] = i; //update latest index
							}

							//add to all keys
							msAllKeys[j] += "-" + key;

							skipRepeat = true;
							break;
						}
					if (skipRepeat) continue; //do not add repeats to multi-select array

					msValues.push(groupName);
					msKeys.push(key);
					msTypes.push(backLinkStr);
					msAllKeys.push(key);
					indexToLatest.push(i);
				}


				//prepare key string (last key in key string is latest)
				// and display exhastive list
				str = "";
				for (var i = 0; i < msValues.length; ++i) 
				{
					msAllKeys[i] += "-" + msKeys[i] + "-" + msValues[i];

					str += makeGroupInfoDisplayString(
						msValues[i],
						msAllKeys[i].split('-'),
						msKeys[i],
						membersHdr[indexToLatest[i]],
						true  //back link to the exhaustive list
					);
				}
				var el = document.getElementById('exhaustiveGroupList');
				el.innerHTML = str;
				el = document.getElementById('filteredGroupCount');
				el.innerHTML = filteredGroupCount;


				//write to a particular div
				el = document.getElementById('groupSearchDiv');
				if(el)
				{
					MultiSelectBox.createSelectBox(el,
						"groupSearch",
						"Search and Select a Group:",
						msValues, msAllKeys, msTypes, groupSearchSelectionHandler, noMultiSelect);
	
					MultiSelectBox.initMySelectBoxes();
	
					//if anything is selected from before.. handle as selected
					var selArr = MultiSelectBox.getSelectionArray(el);
					for (var s in selArr) 
					{
						if (selArr[s])
							groupSearchSelectionHandler(
								MultiSelectBox.getSelectionElementByIndex(el, s));
					}
				}

			}
			//////////// end make search box

			//if there is a target to jump to, do it
			if (anchorTarget) 
			{
				Debug.log("anchorTarget = " + anchorTarget);
				jump(anchorTarget);
			}
		} //end tableGroupsRequestHandler()

		//==============================================================================
		//groupSearchSelectionHandler ~~
		//	make group search selection handler
		//	el points to the div of selected element
		function groupSearchSelectionHandler(el) 
		{
			var i = MultiSelectBox.getSelectedIndex(el);
			var selArr = MultiSelectBox.getSelectionArray(el);
			if (selArr[i]) {
				Debug.log("Chosen element index:" + i +
					" value:" + el.innerHTML +
					" key:" + el.getAttribute("key-value") +
					" type:" + el.getAttribute("type-value"));
				var keyArr = el.getAttribute("key-value").split('-');

				_msChosenGroupName = keyArr[keyArr.length - 1];
				_msChosenGroupKey = keyArr[keyArr.length - 2];

				//copy selected div and show as selected
				var srcEl = document.getElementById("groupViewGroupDiv-" +
					_msChosenGroupName + "-" + _msChosenGroupKey);
				var str = "";

				str += "<b class='bold-header'>";
				str += "Selected Group: " + _msChosenGroupName;
				str += "</b><br>";
				str += srcEl.innerHTML;
				str += "<br>";

				el = document.getElementById('msSelectedGroupDiv');
				el.innerHTML = str;
			}
			else {
				_msChosenGroupName = "";
				_msChosenGroupKey = "";
				el = document.getElementById('msSelectedGroupDiv');
				el.innerHTML = "";
			}
		} //end groupSearchSelectionHandler()

		//==============================================================================
		//tableSearchSelectionHandler ~~
		//	make table search selection handler
		//	el points to the div of selected element
		function tableSearchSelectionHandler(el) 
		{
			var i = MultiSelectBox.getSelectedIndex(el);
			var selArr = MultiSelectBox.getSelectionArray(el);
			if (selArr[i]) {
				Debug.log("Chosen element index:" + i +
					" value:" + el.innerHTML +
					" key:" + el.getAttribute("key-value") +
					" type:" + el.getAttribute("type-value"));
				var keyArr = el.getAttribute("key-value").split('-');

				_msChosenGroupName = keyArr[keyArr.length - 1];
				_msChosenGroupKey = keyArr[keyArr.length - 2];

				//copy selected div and show as selected
				var srcEl = document.getElementById("groupViewGroupDiv-" +
					_msChosenGroupName + "-" + _msChosenGroupKey);
				var str = "";

				str += "<b class='bold-header'>";
				str += "Selected Group: " + _msChosenGroupName;
				str += "</b><br>";
				str += srcEl.innerHTML;
				str += "<br>";

				el = document.getElementById('msSelectedGroupDiv');
				el.innerHTML = str;
			}
			else {
				_msChosenGroupName = "";
				_msChosenGroupKey = "";
				el = document.getElementById('msSelectedGroupDiv');
				el.innerHTML = "";
			}
		} //end tableSearchSelectionHandler()

		//==============================================================================
		//getGroupInfoDisplayString ~~
		function makeGroupInfoDisplayString(groupName, allKeys, latestKey, latestMembersHdr,
			backLinkToList) 
		{
			var str = "";

			str += "<b class='bold-header'>";
			str += groupName;
			str += "</b>";
			str += "<br>";

			str += "<div id='groupViewGroupDiv-" + groupName + "-" + latestKey + "'>";
			str += "Existing Valid Keys: ";

			var backLinkStr;
			if (backLinkToList)
				backLinkStr = "setupGroupViewMode(\\\"anchorTag-" +
					groupName + "-" + latestKey + "\\\");";
			else
				backLinkStr = "setupGroupViewMode()";
			for (var j = 0; j < allKeys.length - 2; ++j) {
				str += "<a href='#' onclick='setupSpecificTableGroup(\"" +
					groupName + "\",\"" +
					allKeys[j] + "\",\"" +
					backLinkStr + "\"); return false;'>";
				str += allKeys[j] + "</a> ";

			}
			str += "<br>";
			str += "Latest Key: " + latestKey + " (shown below)";
			str += "<br>";

			str += "<a name='anchorTag-" +
				groupName + "-" + latestKey + "'></a>";
			str += "<a href='#' onclick='setupSpecificTableGroup(\"" + groupName +
				"\",\"" + latestKey + "\",\"" + backLinkStr + "\"); return false;'>";
			str += groupName + "</a> (" + latestKey + ")";

			//add tree view link
			str += " <a href='#' onclick='setupTableGroupTreeView(\"" + groupName +
				"\",\"" + latestKey + "\",\"" + backLinkStr + "\"); return false;'>";
			str += "Tree-view</a>";

			//add Activate link
			str += " <a href='#' onclick='activateSystemConfig(\"" + groupName +
				"\",\"" + latestKey + "\"); return false;'>";
			str += "Activate</a>";

			//show  members for latest version
			str += "<br><table><tr>";

			//members are only returned for the latest
			tableNames = latestMembersHdr.getElementsByTagName("MemberName");
			tableVersions = latestMembersHdr.getElementsByTagName("MemberVersion");

			Debug.log("CfgGUI requestHandler tableNames.length " + tableNames.length);

			for (var j = 0; j < tableNames.length; ++j) {
				tableName = tableNames[j].getAttribute("value");
				tableVersion = tableVersions[j].getAttribute("value");
				backLinkStr = "setupGroupViewMode(\\\"anchorTag-" +
					groupName + "-" + tableName + "\\\");";

				str += "<td align='center'>";

				str += "<a name='anchorTag-" +
					groupName + "-" + tableName + "'></a>";
				str += "<a href='#' onclick='setupSpecificTable(\"" + tableName +
					"\",\"" + tableVersion + "\",\"" + backLinkStr + "\"); return false;'>";
				str += niceName(tableName) + "</a><br>" +
					((tableVersion | 0) == ConfigurationAPI._SCRATCH_VERSION ? _SCRATCH_VIEW_NAME : tableVersion);
				str += "</td>";
			}
			str += "</tr></table>";
			str += "</div>"; //close groupViewGroupDiv-*

			str += "<hr>";

			return str;
		} //end makeGroupInfoDisplayString()

		//==============================================================================
		//gotoSelectedMSGroup ~~
		function gotoSelectedMSGroup() 
		{
			if (_msChosenGroupName == "" || _msChosenGroupKey == "") {
				Debug.log("Must first select a Group name from the select box.",
					Debug.HIGH_PRIORITY);
				return;
			}
			setupSpecificTableGroup(_msChosenGroupName, _msChosenGroupKey,
				"setupGroupViewMode()");
		} //end gotoSelectedMSGroup()

		//==============================================================================
		//tableViewRequestHandler ~~
		function tableViewRequestHandler(req, anchorTarget) 
		{
			var tableNames = req.responseXML.getElementsByTagName("TableName");
			var tableVersionHdr = req.responseXML.getElementsByTagName("TableVersions");

			var el = document.getElementById("display");

			var str = "";
			str += "<div style='display:none'>Table View</div>"; //Note: this is children[0] tag is used in some place to determine mode after a series of events

			var tableVersions;
			var tableName, version;
			var backLinkStr;

			str += "<h3 style='margin-top:-10px'><u>Table View</u></h3>";
			
//			str += "<div id='tableSearchDiv' ";
//			str += "style='margin-top:-20px; height:200px; width:450px;'";
//			str += ">";
//			str += "</div>";

			str += "<div id='clearDiv'></div>";
			

			Debug.log("CfgGUI requestHandler tableNames.length " + tableNames.length);
			
			str += "<table id='tableViewTable'>";
			for (var i = 0; i < tableNames.length; ++i) 
			{
				str += "<tr><td>";
				tableName = tableNames[i].getAttribute("value");

				backLinkStr = "setupTableViewMode(\\\"anchorTag-" + tableName + "\\\");";

				str += "<a name='anchorTag-" + tableName + "'></a>";
				str += "<a href='#' onclick='setupSpecificTable(\"" + tableName +
					"\",\"\",\"" + backLinkStr + "\"); return false;'>";
				str += niceName(tableName);
				str += "</a><br><table style='margin-left:40px'><tr>";

				tableVersions = tableVersionHdr[i].getElementsByTagName("Version");

				//Debug.log("CfgGUI requestHandler config= " + tableName +
				//				+ " tableNames.length " + tableVersions.length);

				for (var j = 0; j < tableVersions.length; ++j) {
					version = tableVersions[j].getAttribute("value");
					str += "<td align='center'>";
					str += "version" + "<br>";
					str += "<a href='#' onclick='setupSpecificTable(\"" + tableName +
						"\",\"" + version + "\",\"" + backLinkStr + "\"); return false;'>";
					str += ((version | 0) == ConfigurationAPI._SCRATCH_VERSION ? _SCRATCH_VIEW_NAME : version);
					str += "</td>";
				}
				str += "</tr></table>";
				str += "</td></tr>";
			}
			str += "</table>";
			//Debug.log("CfgGUI requestHandler str " + str);
			el.innerHTML = str;

//			//////////// make search box - similar to tableGroupsRequestHandler()
//			{
//				var noMultiSelect = true; // true or false (false for multiselect functionality) 
//
//				var msValues = []; 	//group names for multi-select
//				var msKeys = []; 	//group keys for multi-select
//				
//				
//				for (var i = 0; i < tableNames.length; ++i) 
//				{				
//					msValues.push(tableNames[i].getAttribute("value"));
//					msKeys.push(i);
//				}				
//
//				//write to a particular div
//				el = document.getElementById('tableSearchDiv');
//				MultiSelectBox.createSelectBox(el,
//						"tableSearch",
//						"Search and Select a Table:",
//						msValues, msKeys, msKeys, tableSearchSelectionHandler, noMultiSelect);
//
//				MultiSelectBox.initMySelectBoxes();
//
//				//if anything is selected from before.. handle as selected
//				var selArr = MultiSelectBox.getSelectionArray(el);
//				for (var s in selArr) 
//				{
//					if (selArr[s])
//						tableSearchSelectionHandler(
//								MultiSelectBox.getSelectionElementByIndex(el, s));
//				}
//
//			}
			

			//if there is a target to jump to, do it
			if (anchorTarget) 
			{
				Debug.log("anchorTarget = " + anchorTarget);
				jump(anchorTarget);
			}
		} //end tableViewRequestHandler()

		//==============================================================================
		//showTableTooltip ~~
		function showTableTooltip(tableName)
		{
			Debug.log("showTableTooltip() " + tableName);
			
			DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificTable" +
					"&tableName=" + tableName,"",
					function(req)
					{
				var tableDescription = DesktopContent.getXMLValue(req, "TableDescription");
				Debug.log("tableDescription: " + tableDescription);
				//if there is a description show tooltip
				if (tableDescription != "" &&
						tableDescription.toUpperCase().indexOf("NO DESCRIPTION") != 0)
					DesktopContent.tooltip(tableName + " Description",
							"The table description may be useful in determining how to use this " +
							"table or the meaning of the column fields (admins can edit the description in the Table Editor in wiz mode). Here is the description for " +
							"the '" + tableName + "' table:<br><br>" +
							"<div style='margin-left:20px'>" +
							tableDescription + "</div>", true /*alwaysShow*/);
				else
					DesktopContent.tooltip("Missing " + tableName + " Description",
							"There is no table description for '" + 
							tableName + 
							".' To create or edit a table description, go to the Table Editor in wiz mode.",
							true /*alwaysShow*/);
					}, //end table response handler

					0, //parameter 
					0, true  //progressHandler, callHandlerOnErr
			); //end request
		} //end showTableTooltip
		
		//==============================================================================
		//specificGroupRequestHandler ~~
		//	backLinkStr is defined to call functions one after the other
		function specificGroupRequestHandler(req, param)
		{

			//remove all previous buttons
			var el;
			do {
				el = document.getElementById("saveGroupWithWarningsIgnored");
				if (el) el.parentNode.removeChild(el);
			} while (el);

			var attemptedNewGroupName = DesktopContent.getXMLValue(req, "AttemptedNewGroupName");

			var groupName = DesktopContent.getXMLValue(req, "TableGroupName");
			var groupKey = DesktopContent.getXMLValue(req, "TableGroupKey");

			var treeErr = DesktopContent.getXMLValue(req, "TreeErrors");
			if (treeErr) {
				Debug.log(treeErr, Debug.WARN_PRIORITY);

				//don't power through if a new group was attempted
				if (attemptedNewGroupName && attemptedNewGroupName != "")
					return;
			}

			var err = DesktopContent.getXMLValue(req, "Error");
			if (err) {
				Debug.log(err, Debug.HIGH_PRIORITY);

				var el = document.getElementById("display");
				var str = "";
				str += "Failed.<br><br>" + err;

				if (groupName && groupKey) {
					str += "<br><br>&nbsp;&nbsp;&nbsp;&nbsp;";
					str += "<a href='#' onclick='setupSpecificTableGroup(\"" + groupName +
						"\",\"" + groupKey + "\"); return false;'>";
					str += "Go-to group &quot;" + groupName + "&quot;</a>";
				}

				var errSplit = err.split('"');
				if (errSplit.length > 1) {
					str += "<br><br>It seems like there was trouble with a specific table, " +
						"&quot;" + errSplit[1] + "&quot;. Try using the Table Editor " +
						"in ots wiz to verify the column info is valid; or you can try " +
						"going to to the table view:";
					str += "<br>&nbsp;&nbsp;&nbsp;&nbsp;";
					str += "<a href='#' onclick='setupSpecificTable(\"" + errSplit[1] +
						"\"); return false;'>";
					str += "Go-to table &quot;" + errSplit[1] + "&quot;</a>";
				}

				Debug.log(str, Debug.WARN_PRIORITY);
				//el.innerHTML = str;
				//return;

				//don't power through if a new group was attempted
				if (attemptedNewGroupName && attemptedNewGroupName != "")
					return;
			}
			else if (attemptedNewGroupName && attemptedNewGroupName != "") //if attempted and no errors, shout success
			{
				var foundEquivalentKey = DesktopContent.getXMLValue(req, "foundEquivalentKey") | 0; //as int

				if (foundEquivalentKey)
					Debug.log("Found equivalent group '" + attemptedNewGroupName +
						" (" + groupKey + ")'", Debug.INFO_PRIORITY);
				else
					Debug.log("Successfully created new group '" + attemptedNewGroupName +
						" (" + groupKey + ")'", Debug.INFO_PRIORITY);
			}


			var backLinkStr = "";
			var anchorTarget = "";

			var DEFAULT_groupNavContextMenuItems = [
				"Go-to Table View",
				"Open in new Desktop Window",
				"Open in new Browser Tab"];

			if (param) {
				Debug.log("param= " + param);
				param = param.split("&");
				for (var i = 1; i < param.length; i += 2) {
					var pi;
					if ((pi = param[i].indexOf("backLinkStr=")) >= 0)
						backLinkStr = param[i].substr(param[i].indexOf("=") + 1);
					if ((pi = param[i].indexOf("anchorTarget=")) >= 0)
						anchorTarget = param[i].substr(param[i].indexOf("=") + 1);
				}
			}

			var groupType = DesktopContent.getXMLValue(req, "TableGroupType");
			var historicalKeys = req.responseXML.getElementsByTagName("HistoricalTableGroupKey");

			var tableNames = req.responseXML.getElementsByTagName("MemberName");
			var tableVersions = req.responseXML.getElementsByTagName("MemberVersion");
			var configComments = req.responseXML.getElementsByTagName("MemberComment");

			var key, version, tableName, configComment;
			var el = document.getElementById("display");

			var str = "";

			var tableExistingVersions;

			if (backLinkStr != "") {
				//Note: be careful with the source of backLinkStr.. don't use both quote styles!
				if (backLinkStr.indexOf("'") >= 0)
					backLinkStr = backLinkStr.replace(/'/g, "\\\"");
				else
					backLinkStr = backLinkStr.replace(/"/g, "\\\"");
				Debug.log("Back-link = " + backLinkStr);

				str += "<a href='#' onclick='evaluateJS(\"" + backLinkStr + "\");  return false;'>Back</a>";
				str += "&nbsp;&nbsp;&nbsp;&nbsp;";
			}
			else backLinkStr = "";

			var refreshLinkStr = "setupSpecificTableGroup(\"" +
				groupName + "\",\"" +
				groupKey + "\",\"" + backLinkStr + "\");";
			str += "<a href='#' onclick='" + refreshLinkStr +
				"; return false;'>Refresh</a>";
			str += "<br>";

			str += "<h3><u>Specific Table Group View</u></h3>";
			str += "<label id='tableGroupModified'></label><b>" +
				groupName + "</b> (group key: " + groupKey + ") ";

			//add tree view link
			var returnToHereLink = "setupSpecificTableGroup(\\\"" + groupName + "\\\",\\\"" +
				groupKey + "\\\");";
			str += " <a href='#' onclick='setupTableGroupTreeView(\"" + groupName +
				"\",\"" + groupKey + "\",\"" + returnToHereLink + "\"); return false;' title='" +
				"Display the tree-view for the current group &apos;" + groupName +
				" (" + groupKey + ").&apos;'" +
				">";
			str += "Tree-view</a>";

			//add Activate link
			str += " <a href='#' onclick='activateSystemConfig(\"" + groupName +
				"\",\"" + groupKey + "\"); return false;' title='" +
				"Activate the current group &apos;" + groupName +
				" (" + groupKey + ").&apos;'" +
				">";
			str += "Activate</a>";

			//add Alias link
			str += " <a href='#' onclick='popUpGroupViewAliasForm(\"" + groupName +
				"\",\"" + groupKey + "\"); return false;' title='" +
				"Create a System to Alias that refers to the current group &apos;" +
				groupName +
				" (" + groupKey + ").&apos;'" +
				">";
			str += "Alias</a>";


			//create group details
			{
				str += "<div id='clearDiv'></div>";
				str += "<div id='groupDetails' style='display:block'>Group Details:";
				var groupComment = DesktopContent.getXMLValue(req, "TableGroupComment");
				groupComment = decodeURIComponent(groupComment);
				_cachedGroupComment = groupComment;
				var groupAuthor = DesktopContent.getXMLValue(req, "TableGroupAuthor");
				var groupCreationTime = DesktopContent.getXMLValue(req, "TableGroupCreationTime");
				groupCreationTime = ConfigurationAPI.getDateString(new Date((groupCreationTime | 0) * 1000));

				str += "<table border='0' style='" +
					"border: 1px solid #9c5e5e;" +
					"margin: 5px 0 5px 30px;" +
					"background-color: #d2c1c1;" +
					"'>";
				str += "<tr><th>Type:</th><td class='underlineRow'>" + groupType + " Group</td></tr>";
				str += "<tr><th>Author:</th><td class='underlineRow'>" + groupAuthor + "</td></tr>";
				str += "<tr><th>Created:</th><td class='underlineRow'>" + groupCreationTime + "</td></tr>";
				str += "<tr><th>Comment:</th><td>" +
					groupComment.replace(/\n/g, "<br>") + "</td></tr>";
				str += "</table>";
				str += "</div>";

				str += "<div id='clearDiv'></div>";
			}

			if (historicalKeys.length) {
				str += "Existing &quot;" + groupName + "&quot; group keys: ";
				//str += " " + groupKey;

				for (var i = 0; i < historicalKeys.length; ++i) {
					key = historicalKeys[i].getAttribute("value");
					if (groupKey == key) { str += " " + key; continue; }

					str += " <a href='#' onclick='setupSpecificTableGroup(\"" +
						groupName + "\",\"" + key + "\",\"" + backLinkStr + "\"); return false;'>";
					str += key;
					str += "</a>";
				}
			}
			else
				str += "No Historical keys exist for " + groupName + ".<br>";


			str += "<br><a href='#' onclick='addMemberToConfigGroup(\"" +
				groupName + "\",\"" + returnToHereLink + "\"); return false;'>";
			str += "Add/Remove/Modify Member Tables</a> for group '" + groupName + "(" + groupKey + ")'";

			str += "<br>";
			var setMembersToDefaultReq =
				"DesktopContent.XMLHttpRequest(\"Request?RequestType=setAliasOfGroupMembers" +
				"&versionAlias=Default" +
				"&groupName=" + groupName +
				"&groupKey=" + groupKey + "\", \"\"," +
				"ConfigurationAPI.newWizBackboneMemberHandler," +
				"[\"MemberVersionAliasWizBackbone\",undefined]," +
				"0,true" +  //progressHandler, callHandlerOnErr
				");";

			str += "<a href='#' onclick='" + setMembersToDefaultReq + "; return false;' title='Make all member versions" +
				" the &apos;Default&apos; version for that member " +
				" by automatically setting up the &apos;Default&apos; alias " +
				"in the active Backbone group.'" +
				">";
			str += "Set all Members' chosen Version to the 'Default' table-Alias";
			str += "</a>";
			str += "<br>";

			str += "<a href='#' onclick='popUpVersionAliasSpecificGroupForm(" +
				"\"" + groupName + "\",\"" + groupKey + "\"); return false;' title='Set an Alias for all member versions" +
				" by automatically setting up the specified Alias " +
				"in the active Backbone group.'" +
				">";
			str += "Set all Members' chosen Versions to a table-Alias";
			str += "</a>";


			//add Download link
			str += "<br>";
			str += htmlOpen("a",
				{
					"onclick": "popUpGroupUploadDownloadForm(\"" + groupName +
						"\",\"" + groupKey + "\", false /*isUpload*/);",
					"title": "Download a selection of member tables from the current group &apos;" + groupName + "(" + groupKey + ").&apos;",
				},
				"Download a selection of member tables" /*innerHTML*/,
				true /*doCloseTag*/);
			//add Upload link
			str += "<br>";
			str += htmlOpen("a",
				{
					"onclick": "popUpGroupUploadDownloadForm(\"" + groupName +
						"\",\"" + groupKey + "\", true /*isUpload*/);",
					"title": "Upload a selection of member tables from the current group &apos;" + groupName + "(" + groupKey + ").&apos;",
				},
				"Upload a selection of member tables" /*innerHTML*/,
				true /*doCloseTag*/);

			str += "<br><br>";


			str += "<div style='margin-left:30px'>";

			var cfgVersionStr;
			var cfgNameStr = "";
			var replaceScreenJS, newWindowStr, newwindowJS, newtabJS;
			var groupMemberNavContextMenuItemHandlers = [];

			str += "<table cellpadding='0' cellspacing='0' border='0' style='float:left;'>";

			//Debug.log("CfgGUI specificTableRequestHandler Member length " + tableNames.length + " - " + tableVersions.length);
			for (var i = 0; i < tableNames.length && i < tableVersions.length; ++i) {
				tableName = tableNames[i].getAttribute("value");
				version = tableVersions[i].getAttribute("value");
				if (configComments[i])
					configComment = configComments[i].getAttribute("value");
				else
					configComment = "UNKNOWN";


				backLinkStr = "setupSpecificTableGroup(\\\"" + groupName + "\\\",\\\"" +
					groupKey + "\\\",undefined,\\\"anchorTag-" +
					tableName + "\\\");";
				//make replace screen js
				replaceScreenJS = "setupSpecificTable(\"" +
					tableName + "\",\"" +
					version + "\",\"" + backLinkStr + "\");";

				str += "<tr>"; //open pre/comment table row
				str += "<td style='width:10px;'>";
				str += "<div style='float:left;margin-right:20px;'>";	//open name div
				str += "<a name='anchorTag-" + tableName + "'></a>";
				str += "<b>" + niceName(tableName) + "</b> ";
				str += "</div>"; //close member name 

				str += "</td><td style='background-color: rgb(218, 194, 194); width:10px;'>"; //open "curren version" link

				str += "<div style='float:left;white-space:nowrap;'>";	//open name div
				str += "<a id='" + tableName + "-currentVersionLink' " +
					"href='javascript:" + replaceScreenJS + "'>"; //FIXME .. back to onclick, but L12808  changeMemberVersionForTableGroup()!!
				str += "(Member version: ";
				str += "<label id='" + tableName + "-currentVersion'>";
				str += ((version | 0) == ConfigurationAPI._SCRATCH_VERSION ? _SCRATCH_VIEW_NAME : version);
				str += "</label>";

				str += ")";
				str += "</a>";
				str += "</div>"; //close member current version link

				str += "</td><td style='width:20px;'>"; //open table nav link

				//add member nav goto link
				{
					//make context menu
					groupMemberNavContextMenuItemHandlers = [];
					groupMemberNavContextMenuItemHandlers.push(replaceScreenJS);

					//make new window link
					newWindowStr = "setupSpecificTable(\"" +
						tableName + "\",\"" +
						version + "\")";
					newWindowStr = newWindowStr.replace(/"/g, "\\\"");
					newWindowStr = location.pathname +
						location.search +
						"&newWindowOps=" + newWindowStr;
					newwindowJS = "DesktopContent.openNewWindow(" +
						"\"Configure\",\"\",\"" +
						newWindowStr + "\",false);";
					groupMemberNavContextMenuItemHandlers.push(newwindowJS);

					//make new tab link
					newtabJS = "DesktopContent.openNewBrowserTab(" +
						"\"Configure\",\"\",\"" +
						newWindowStr + "\",false);";
					groupMemberNavContextMenuItemHandlers.push(newtabJS);

					str += //start member Link div
						"<div class='treeNode-Link' style='float:left;'  " +
						"onmousedown='" + // start link onmousedown
						SimpleContextMenu.createMenuCallAsString(
							DEFAULT_groupNavContextMenuItems,
							groupMemberNavContextMenuItemHandlers,
							"groupMemberNavContextMenu",
							_CONTEXT_MENU_PRIMARY_COLOR,
							_CONTEXT_MENU_SECONDARY_COLOR) + "' ";// end link onmousedown

					str +=
						//"onmouseup='" + onmouseupJS + "' " +
						">" +
						"<div class='gotoNavDiv'></div>" +
						"</div>"; //end nav Link					
				}

				str += "</td><td>";

				//add comment
				//make comment html safe
				configComment = configComment.replace(/</g, "&lt");
				configComment = configComment.replace(/>/g, "&gt");

				str += "<div id='" + tableName + "-comment' " +
					"style='font-size:14px; margin:2px 0 0 20px; float:left; white-space: nowrap;'>";
				if (configComment != ConfigurationAPI._DEFAULT_COMMENT) //do not show if default
					str += "//" + configComment;

				str += "</div>";
				str += "</td></tr>"; //close pre/comment table row

				str += "<tr><td colspan='4'>"

				//add prompt and existing versions
				str += "<div id='clearDiv'></div>";
				str += "Click below to change " + niceName(tableName) +
					" Version for " + groupName + ":<br>";

				str += "<div style='white-space:nowrap'>";
				str += "Existing versions: ";
				str += "<label id='" + tableName + "-existingVersions'>";
				cfgVersionStr = ""; //keep CSV list of versions for use by changeMemberVersionForTableGroup

				tableExistingVersions = tableVersions[i].getElementsByTagName("TableExistingVersion");
				var existingVersion;
				for (var j = 0; j < tableExistingVersions.length; ++j) {
					existingVersion = tableExistingVersions[j].getAttribute("value");
					if ((existingVersion | 0) < 0 || //skip temporary versions and scratch version
						(existingVersion | 0) == ConfigurationAPI._SCRATCH_VERSION) //scratch version will be shown as an alias
						continue;

					if (existingVersion == version || //skip link for current version
						(existingVersion == 		//including if it's the scratch alias
							ConfigurationAPI._VERSION_ALIAS_PREPEND +
							ConfigurationAPI._SCRATCH_ALIAS &&
							version == ConfigurationAPI._SCRATCH_VERSION)) {
						cfgVersionStr += existingVersion + ",";
						str += " " + existingVersion; continue;
					}
					str += " ";
					str += "<a href='#' onclick='changeMemberVersionForTableGroup(\"" +
						groupName + "\",\"" + groupKey + "\",\"" + tableName + "\"," +
						"\"" + existingVersion + "\"";
					str += "); return false;' " +
						"title='Select v" + existingVersion + " of table &apos;" +
						tableName + "&apos; to be a member of the &apos;" + groupName + "&apos; group.' " +
						">" + existingVersion;
					str += "</a>";
					cfgVersionStr += existingVersion + ",";
				}
				str += "</label>";
				str += "</div>";

				//add div holding existing versions for modifications
				str += "<div id='" + tableName + "-versions' style='display:none'>";
				str += cfgVersionStr;
				str += "</div>";

				str += "<br>";
				str += "</td></tr>";

				cfgNameStr += tableName + ",";
			}

			str += "</table>";

			str += "</div>";

			str += "<div id='GroupMember-names' style='display:none'>";
			str += cfgNameStr;
			str += "</div>";


			el.innerHTML = str;

			//if there is a target to jump to, do it
			if (anchorTarget && anchorTarget != "") {
				Debug.log("anchorTarget = " + anchorTarget);
				jump(anchorTarget);
			}
		} //end specificGroupRequestHandler()

		//==============================================================================
		//specificTableRequestHandler
		function specificTableRequestHandler(req, backLinkStr, attemptedVersion) 
		{

			_tableViewBackLinkStr = backLinkStr;

			var showSaveButtons = false;

			var err = DesktopContent.getXMLValue(req, "Error");
			if (err) {
				Debug.log(err, Debug.HIGH_PRIORITY);

				Debug.log("There were errors loading this version.\n\n(You may want to try loading this version again " +
					"to see what was partially loaded into the cache before failure. " +
					"If you think, the failure is due to a column name change, " +
					"you can also try to Copy the failing view to the new column names using the " +
					"'Copy and Move' functionality.) " +
					"\n\nPlease see the detailed Errors below:", Debug.HIGH_PRIORITY);

				showSaveButtons = true; //allow user to try to save and have server fix

				//try to power through
			}

			var warns = DesktopContent.getXMLValue(req, "TableWarnings");
			if (warns) {
				Debug.log("There were warnings found when loading this table " +
					"(you can treat them as informational):\n\n" +
					warns, Debug.WARN_PRIORITY);

				showSaveButtons = true; //allow user to try to save and have server fix
			}

			activateSystemConfigHandler(req); //display active config groups

			var tableName = DesktopContent.getXMLValue(req, "TableName");
			var version = DesktopContent.getXMLValue(req, "TableVersion");
			var allowIllegalColumns = DesktopContent.getXMLValue(req, "allowIllegalColumns");
			if(allowIllegalColumns == "1")
				showSaveButtons = true; //allow user to save loose column loaded version

			var existingNames = req.responseXML.getElementsByTagName("ExistingTableNames");
			_tableLinkDropdownChoices = [];
			for (var i = 0; i < existingNames.length; ++i)
				_tableLinkDropdownChoices.push(existingNames[i].getAttribute("value"));

			Debug.log("_tableLinkDropdownChoices " + _tableLinkDropdownChoices.length);

			var kocVersionHdr = req.responseXML.getElementsByTagName("TableVersions");
			if (!kocVersionHdr.length) {	//should never happen (tag can be empty, but must be there)
				Debug.log("Error?! No tag for versions returned for tableName: " + tableName, Debug.HIGH_PRIORITY);
				return;
			}
			var tableVersions = kocVersionHdr[0].getElementsByTagName("Version");

			var xmlRows = req.responseXML.getElementsByTagName("CurrentVersionRows");
			if (!xmlRows.length) {
				var el;
				if (_displayTargetEl)
					el = _displayTargetEl;
				else
					el = document.getElementById("display");
				var str = el.innerHTML;
				str += "<br><br>";
				str += "The column names failed to load!<br>" +
					"Go to the 'Table Editor' to check on the validity of the table '" + tableName + "'...";
				el.innerHTML = str;
				return;
			}
			var rows = req.responseXML.getElementsByTagName(
				"CurrentVersionRows")[0].getElementsByTagName("Row");

			var colHdrs = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnHeader");
			var colTypeEls = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnType");
			var colDataTypes = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnDataType");
			var colChoices = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnChoices");
			var colMinValues = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnMinValue");
			var colMaxValues = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnMaxValue");

			//fill fixed choice structure
			_tableFixedChoiceData = {};
			var fixedChoiceArr;
			for (var i = 0; i < colChoices.length; ++i) {
				fixedChoiceArr = colChoices[i].getElementsByTagName("ColumnChoice");
				if (fixedChoiceArr.length) {
					_tableFixedChoiceData[i] = [];
					for (var j = 0; j < fixedChoiceArr.length; ++j)
						_tableFixedChoiceData[i].push(fixedChoiceArr[j].getAttribute("value"));
				}
			}

			_tableDefaultRowValues = [];
			var defaultRowValues = req.responseXML.getElementsByTagName("DefaultRowValue");
			for (var i = 0; i < defaultRowValues.length; ++i)
				_tableDefaultRowValues.push(decodeURIComponent(defaultRowValues[i].getAttribute("value")));

			//reset globals

			if (_currentTableName != tableName) //clear  cached comment
			{
				_cachedTableComment = "";
				_associatedGroupName = "";
				_associatedGroupKey = -1;
			}
			_currentTableName = tableName;
			_version = version;
			_editingCell = false;
			_editingCellEl = 0;
			_versionIsChanged = false;
			_dataOffset = rows.length ? (rows[0].getAttribute("value") | 0) : 0;

			var str = "";
			str += "<div style='display:none'>Specific Table View</div>"; //Note: this is children[0] tag is used in some place to determine mode after a series of events


			if (backLinkStr && backLinkStr != "")
			{
				//Note: be careful with the source of backLinkStr.. don't use both quote styles!
				if (backLinkStr.indexOf("'") >= 0)
					backLinkStr = backLinkStr.replace(/'/g, "\\\"");
				else
					backLinkStr = backLinkStr.replace(/"/g, "\\\"");
				Debug.log("Back-link = " + backLinkStr);

				str += "<a href='#' onclick='evaluateJS(\"" + backLinkStr + "\"); return false;'>Back</a>";
				str += "&nbsp;&nbsp;&nbsp;&nbsp;";

				var backLinkStrSplit = backLinkStr.split('"');

				//take a clue from backlink about associated group 
				if (backLinkStr.indexOf("setupTableViewMode(") < 0 && //attempt to identify a group source
					backLinkStr.indexOf("setupSpecificTable(") < 0 &&
					backLinkStrSplit.length > 3) {
					_associatedGroupName = backLinkStrSplit[1].split('\\')[0];
					_associatedGroupKey = backLinkStrSplit[3].split('\\')[0];
				}
			}
			else backLinkStr = "";

			var refreshLinkStr = "setupSpecificTable(\"" +
				tableName + "\",\"" +
				version + "\",\"" + backLinkStr + "\");";
			str += "<a href='#' onclick='" + refreshLinkStr +
				"; return false;'>Refresh</a>";

			{
				//clear cached versions
				var clearLinkStr = "popUpClearVersionsPrompt(0,\"" +
					backLinkStr + "\");";
				str += "&nbsp;&nbsp;&nbsp;&nbsp;";
				str += "<a href='#' onclick='" + clearLinkStr +
					"; return false;'>Clear Cache</a>";
			}

			{
				//clear temporary versions
				var clearLinkStr = "popUpClearVersionsPrompt(1,\"" +
					backLinkStr + "\");";
				str += "&nbsp;&nbsp;&nbsp;&nbsp;";
				str += "<a href='#' onclick='" + clearLinkStr +
					"; return false;'>Clear Temporary Versions</a>";
			}



			str += "<br><br>";



			//display edit menu
			str +=
				"<div class='tableView-Menu' onmousedown='createEditTableMenu(event);' title='Edit Menu'>" +
				"<div class='gotoNavDiv'></div>" +
				"</div>"; //end context menu link div

			//display config name and version
			str += "<div style='float:left;'>";
			str += "<b>" + tableName + "</b> (version: " + (version == -1 ? _MOCKUP_VIEW_NAME :
				(version == ConfigurationAPI._SCRATCH_VERSION ? _SCRATCH_VIEW_NAME : version)) + ")";
			str += "</div>";

			//add link for wiz to default
			if (version != -1) {
				str += "<div style='float:left;margin: 3px 0 0 15px;'>";
				str += "<a onclick='setVersionAliasInActiveBackbone(\"Default\",\"" +
					tableName + "\",\"" +
					version + "\",0,/*done handler*/ function()" +
					"{setupSpecificTable(\"" +
					tableName + "\",\"" +
					version + "\");}" +
					"); return false;' title='Make '" + tableName + "' version " + version +
					" the 'Default' table version " +
					" by automatically setting up the 'Default' alias " +
					"in the active Backbone group.'" +
					">";
				str += "Wiz-to-Default";
				str += "</a>";
				str += "</div>";

				str += "<div style='float:left;margin: 3px 0 0 15px;'>";
				str += "<a onclick='popUpVersionAliasForm(); return false;' " +
					"title='Assign an Alias you specify to '" + tableName +
					"' version " + version +
					" by automatically modifying the active Backbone group.'" +
					">";
				str += "Wiz-to-Other-Alias";
				str += "</a>";
				str += "</div>";
			}


			str += "<div id='clearDiv'></div>";

			str += "All versions:";

			//display mockup link (mockup always present)
			str += " ";
			if (-1 != version)
				str += "<a onclick='setupSpecificTable(\"" + tableName +
					"\",\"" + "-1" + "\", \"" + backLinkStr + "\"); return false;'>";
			str += _MOCKUP_VIEW_NAME;
			if (-1 != version)
				str += "</a>";

			//display all other version links
			{
				var tableVersion;
				var aliasString;
				var versionAliases;
				for (var j = 0; j < tableVersions.length; ++j)
				{
					tableVersion = tableVersions[j].getAttribute("value");

					aliasString = "";
					versionAliases = tableVersions[j].getElementsByTagName("VersionAlias");
					for (var k = 0; k < versionAliases.length; ++k)
						aliasString += (k == 0 ? "==>" : ",") + versionAliases[k].getAttribute("value");

					str += " ";
					if (tableVersion != version)
						str += "<a href='#' onclick='setupSpecificTable(\"" + tableName +
							"\",\"" + tableVersion +
							"\", \"" + backLinkStr + "\"); return false;'>";
					str += ((tableVersion | 0) == ConfigurationAPI._SCRATCH_VERSION ? _SCRATCH_VIEW_NAME : tableVersion);
					//add alias string
					str += aliasString;
					if (tableVersion != version)
						str += "</a>";
				}
			}

			str += "<div id='clearDiv'></div>";
			str += "<div id='findAndReplace'></div>";
			str += "<div id='aboveTableDialog'></div>";

			//create table details
			str += "<div id='tableDetails' style='display:none'>Table Details:";
			var tableComment = DesktopContent.getXMLValue(req, "TableComment");
			if (version[0] != '-') //only cache permanent table comments
				_cachedTableComment = tableComment;
			var tableAuthor = DesktopContent.getXMLValue(req, "TableAuthor");
			var tableCreationTime = DesktopContent.getXMLValue(req, "TableCreationTime");
			var tableLastAccessTime = DesktopContent.getXMLValue(req, "TableLastAccessTime");
			var tableDescription = DesktopContent.getXMLValue(req, "TableDescription");

			//if there is a description show tooltip
			if (tableDescription != "" &&
				tableDescription.toUpperCase().indexOf("NO DESCRIPTION") != 0)
				DesktopContent.tooltip(tableName + " Table Description",
					"The table description may be useful in determining how to use this " +
					"table or the meaning of the column fields (admins can edit the description in the Table Editor in wiz mode). Here is the description for " +
					"the '" + tableName + "' table:<br><br>" +
					"<div style='margin-left:20px'>" +
					tableDescription + "</div>");


			//convert linux time to Date
			tableCreationTime = ConfigurationAPI.getDateString(new Date((tableCreationTime | 0) * 1000));
			tableLastAccessTime = ConfigurationAPI.getDateString(new Date((tableLastAccessTime | 0) * 1000));

			str += "<table border='0' style='" +
				"border: 1px solid #9c5e5e;" +
				"margin: 5px 0 5px 30px;" +
				"background-color: #d2c1c1;" +
				"'>";
			str += "<tr><th>Author:</th><td class='underlineRow'>" + tableAuthor + "</td></tr>";
			str += "<tr><th>Created:</th><td class='underlineRow'>" + tableCreationTime + "</td></tr>";
			str += "<tr><th>Last Load:</th><td class='underlineRow'>" + tableLastAccessTime + "</td></tr>";
			str += "<tr><th>Comment:</th><td class='underlineRow'>" +
				tableComment.replace(/\n/g, "<br>") + "</td></tr>";
			str += "<tr><th>Description:</th><td>";

			str += "<label id='tableDescriptionText-Show' style='display:block'>";
			str += "<a onclick='document.getElementById(\"tableDescriptionText\").style.display = \"block\"; document.getElementById(\"tableDescriptionText-Show\").style.display = \"none\";'>" +
				"show</a>";
			str += "</label>";
			str += "<label id='tableDescriptionText' style='display:none'>";
			str += "<a onclick='document.getElementById(\"tableDescriptionText\").style.display = \"none\"; document.getElementById(\"tableDescriptionText-Show\").style.display = \"block\";'>" +
				"hide</a><br>" +
				Debug.errorPopConditionString(DesktopContent.tooltipConditionString(tableDescription)) +
				"</label>";
			str += "</td></tr>";

			str += "</table>"
			str += "</div>";

			str += "<div id='clearDiv'></div>";

			//four corners for last +/- (w & w/o transpose)
			str += "<table><tr><td>";
			//display table
			str += "<table id='SubSystemTable' border='0' cellspacing='3' cellpadding='2'>";


			//create structure for call to createTableViewOutputStr
			{
				var colTypes = [];
				var cols = [];
				var typeDivStr;

				//add types (first column is for row numbers)
				//	and fill colTypes
				{
					var boolTypes = ["OnOff", "TrueFalse", "YesNo"];
					var colType, colDataType, isStatusType;

					cols.push([]);
					//init pre-data columns
					for (var c = 0; c < _CONFIG_DATA_COL_OFFSET; ++c) 
					{
						cols[cols.length - 1].push("");
						colTypes.push("Header");
					}
					//handle data columns
					for (var c = 0; c < colHdrs.length; ++c) 
					{
						colType = colTypeEls[c].getAttribute("value");
						colDataType = colDataTypes[c].getAttribute("value");
						colMinValue = colMinValues[c].getAttribute("value");
						colMaxValue = colMaxValues[c].getAttribute("value");

						typeDivStr = "";
						typeDivStr += "<div style='font-size:12px' title='";
						typeDivStr += colType;
						typeDivStr += " &#60;" + colDataType + "&#62;";
						typeDivStr += "'>";
						typeDivStr += colType;
						typeDivStr += "<br>&#60;" + colDataType + "&#62;"
						if (colDataType == "NUMBER") 
						{
							if (colMinValues[c] != undefined && colMaxValues[c] != undefined && colMinValue!=colMaxValue) {
								typeDivStr += "<br>MIN VALUE ALLOWED: " + colMinValue + "<br>MAX VALUE ALLOWED: " + colMaxValue
							}
						}

						typeDivStr += "</div>";

						cols[cols.length - 1].push(typeDivStr);

						isStatusType = false;
						for (var i = 0; i < boolTypes.length; ++i)
							if (boolTypes[i] == colType) 
							{
								isStatusType = true; break;
							}
						colTypes.push(isStatusType ? "Bool" : colType);
					}
				}

				//add headers (first column is for row numbers)
				cols.push([]);
				//init pre-data columns
				for (var c = 0; c < _CONFIG_DATA_COL_OFFSET; ++c)
					cols[cols.length - 1].push("");
				for (var c = 0; c < colHdrs.length; ++c)
					cols[cols.length - 1].push(colHdrs[c].getAttribute("value"));

				//add data
				{
					var rowEntries;
					for (var r = 0; r < rows.length; ++r) 
					{
						rowEntries = rows[r].getElementsByTagName("Entry");

						cols.push([]);
						for (var c = 0; c < _CONFIG_DATA_COL_OFFSET; ++c)
							cols[cols.length - 1].push("");

						for (var c = 0; c < colHdrs.length; ++c)
							cols[cols.length - 1].push(rowEntries[c].getAttribute("value"));
					}
				}

				var transposeOutput = false;
				var colsIsArray = true;
				if (_tableViewIsTransposed) //check if need to transpose view
				{
					//invert so it can be inverted again in transposeTableView()
					_tableViewIsTransposed = !_tableViewIsTransposed;
					transposeOutput = true;
					str += createTableViewOutputStr(cols, colTypes, transposeOutput, colsIsArray);
					_tableViewIsTransposed = !_tableViewIsTransposed;
				}
				else
					str += createTableViewOutputStr(cols, colTypes, transposeOutput, colsIsArray);
			}

			str += "</table>";

			str += "</td><td valign='top'>"; //four corners continued

			//add + row controls for new last row
			str += " <a id='lastAddRowLink1' ";
			if (_tableViewIsTransposed)
				str += "";
			else
				str += "style='display:none' ";
			str += "title='Append a new row to the table.' ";
			str += "class='tableAddRowButton' onclick='addRow(" + r + "); return false;'>";
			str += "+";
			str += "</a>";

			str += "</td></tr>"; //four corners continued
			str += "<tr><td valign='top'>"; //four corners continued

			//add + row controls for new last row
			str += " <a id='lastAddRowLink0' ";
			if (!_tableViewIsTransposed)
				str += "";
			else
				str += "style='display:none' ";
			str += "title='Append a new row to the table.' ";
			str += "class='tableAddRowButton' onclick='addRow(" + r + "); return false;'>";
			str += "+";
			str += "</a>";

			str += "</td><td></td></tr></table>"; //four corners ended


			var el;
			if (_displayTargetEl)
				el = _displayTargetEl;
			else
				el = document.getElementById("display");

			el.innerHTML = str;

			if (isTemporary(version)) //if temporary
			{
				//show save button
				var dispStr = el.innerHTML;
				str = "";
				str += "<div id='config-firstSaveButton'>";
				str += "<input type='button' onmouseup='popUpSaveNewTableForm()' value='Save Changes as New Version' title='" +
					"Save the current table view as a new persistent version." +
					"'/>";
				str += "</div><br>";

				var i = dispStr.indexOf("<div class=\"tableView-Menu\"");

				el.innerHTML = dispStr.substr(0, i) + str +
					dispStr.substr(i) + "<br>" + str;
			}
			else if (showSaveButtons)
				versionHasChanged(attemptedVersion);

			toggleTableDetails(_showTableDetails);
		 } //end specificTableRequestHandler()

		//==============================================================================
		//toggleTableDetails ~~
		function toggleTableDetails(setVal) 
		{
			if (setVal !== undefined)
				_showTableDetails = setVal;
			else
				_showTableDetails = !_showTableDetails; //invert

			Debug.log("toggleTableDetails " + _showTableDetails);
			var el = document.getElementById("tableDetails");
			el.style.display = _showTableDetails ? "block" : "none";
		} //end toggleTableDetails()

		//==============================================================================
		//toggleGroupDetails ~~
		function toggleGroupDetails(setVal) 
		{
			if (setVal !== undefined)
				_showGroupDetails = setVal;
			else
				_showGroupDetails = !_showGroupDetails; //invert

			Debug.log("showGroupDetails " + _showGroupDetails);
			var el = document.getElementById("groupDetails");
			el.style.display = _showGroupDetails ? "block" : "none";
		} //end toggleGroupDetails()

		//==============================================================================
		//launchRecordCreationWizard ~~
		function launchRecordCreationWizard(launchType) 
		{
			Debug.log("launchRecordCreationWizard " + launchType);
			if (launchType == "tree") //from tree view
			{
				RecordWiz.createWiz(
					function (atLeastOneRecordWasModified) 
					{
						if (atLeastOneRecordWasModified) 
						{
							var str = "Record creation complete. You may want to ";
							str += "<a onclick='refreshTreeView()' " +
								" title='Click to Refresh the current tree-view' " +
								">";
							str += "Refresh";
							str += "</a>";
							str += " the tree " +
								"to view modifications. ";
							str += "The active groups are now ";
							str += "<a onclick='setupTableGroupTreeView(\"" +
								ConfigurationAPI._activeGroups.Context.groupName + "\"," +
								ConfigurationAPI._activeGroups.Context.groupKey + ");' " +
								" title='Click to open in tree-view' " +
								">";
							str += ConfigurationAPI._activeGroups.Context.groupName + " (" +
								ConfigurationAPI._activeGroups.Context.groupKey + ")";
							str += "</a>";
							str += " and ";
							str += "<a onclick='setupTableGroupTreeView(\"" +
								ConfigurationAPI._activeGroups.Configuration.groupName + "\"," +
								ConfigurationAPI._activeGroups.Configuration.groupKey + ");' " +
								" title='Click to open in tree-view' " +
								">";
							str += ConfigurationAPI._activeGroups.Configuration.groupName + " (" +
								ConfigurationAPI._activeGroups.Configuration.groupKey + ")";
							str += "</a>";
							str += " for the Context and Configuration table groups respectively.";
							Debug.log(str,
								Debug.INFO_PRIORITY);
						}

					});
			}
			else
				throw ("Unknown type for launchRecordCreationWizard: " + launchType);
		} //end launchRecordCreationWizard

		//==============================================================================
		//launchRecordDeletionWizard ~~
		function launchRecordDeletionWizard(launchType) 
		{
			Debug.log("launchRecordDeletionWizard " + launchType);
			if (launchType == "tree") //from tree view
			{
				DeleteWiz.createWiz(
					function (atLeastOneRecordWasDeleted)
					{
						if (atLeastOneRecordWasDeleted) 
						{
							var str = "Record deletion complete. You may want to ";
							str += "<a onclick='refreshTreeView()' " +
								" title='Click to Refresh the current tree-view' " +
								">";
							str += "Refresh";
							str += "</a>";
							str += " the tree " +
								"to view changes. ";
							str += "The active groups are now ";
							str += "<a onclick='setupTableGroupTreeView(\"" +
								ConfigurationAPI._activeGroups.Context.groupName + "\"," +
								ConfigurationAPI._activeGroups.Context.groupKey + ");' " +
								" title='Click to open in tree-view' " +
								">";
							str += ConfigurationAPI._activeGroups.Context.groupName + " (" +
								ConfigurationAPI._activeGroups.Context.groupKey + ")";
							str += "</a>";
							str += " and ";
							str += "<a onclick='setupTableGroupTreeView(\"" +
								ConfigurationAPI._activeGroups.Configuration.groupName + "\"," +
								ConfigurationAPI._activeGroups.Configuration.groupKey + ");' " +
								" title='Click to open in tree-view' " +
								">";
							str += ConfigurationAPI._activeGroups.Configuration.groupName + " (" +
								ConfigurationAPI._activeGroups.Configuration.groupKey + ")";
							str += "</a>";
							str += " for the Context and Configuration table groups respectively.";
							Debug.log(str,
								Debug.INFO_PRIORITY);
						}

					});
			}
			else
				throw ("Unknown type for launchRecordDeletionWizard: " + launchType);
		} //end launchRecordDeletionWizard()

		//==============================================================================
		//setVersionAliasInActiveBackbone ~~
		//	Used to setup a table-alias.
		//	It will activate the resuling backbone and call a done handler
		function setVersionAliasInActiveBackbone(versionAlias, tableName, version,
			newBackboneNameAdd, doneHandler, doReturnParams) 
		{
			Debug.log("setVersionAliasInActiveBackbone versionAlias " + versionAlias);
			Debug.log("setVersionAliasInActiveBackbone tableName " + tableName);
			Debug.log("setVersionAliasInActiveBackbone version " + version);

			if (!tableName || tableName == "" || !version || version == "") 
			{
				Debug.log("Process interrupted. Invalid group name and key given!", Debug.HIGH_PRIORITY);
				return;
			}

			if (!newBackboneNameAdd || newBackboneNameAdd == "")
				newBackboneNameAdd = "Wiz";
			newBackboneNameAdd += "Backbone";
			Debug.log("setVersionAliasInActiveBackbone newBackboneNameAdd=" + newBackboneNameAdd);

			DesktopContent.XMLHttpRequest("Request?RequestType=setVersionAliasInActiveBackbone" +
				"&versionAlias=" + versionAlias +
				"&tableName=" + tableName +
				"&version=" + version, "",
				ConfigurationAPI.newWizBackboneMemberHandler,
				[("VersionAlias" + newBackboneNameAdd), doneHandler, doReturnParams],
				0, true  //progressHandler, callHandlerOnErr
			);
		} //end setVersionAliasInActiveBackbone()

		//==============================================================================
		//isTemporary
		function isTemporary(version) { return version < -1;} 

		//==============================================================================
		//treeViewHandler ~		
		function treeViewHandler(req, parentId, err) 
		{
			if (err) //show login access errors
			{
				Debug.log(err, Debug.HIGH_PRIORITY);
				return;
			}
			
			err = DesktopContent.getXMLValue(req, "Error");
			if (err) 
			{
				Debug.log("If you do not understand the error, try refreshing the tree from the '>>' menu in the top left of the page", Debug.HIGH_PRIORITY);
				Debug.log(err, Debug.HIGH_PRIORITY);
				Debug.log("If you do not understand the error, try refreshing the tree from the '>>' menu in the top left of the page", Debug.HIGH_PRIORITY);

				if (parentId)
					return;
				// else try to power through 
			}

			var warn = DesktopContent.getXMLValue(req, "Warning");
			if (warn) 
			{
				if (warn != lastTreeWarnStr_) 
				{
					Debug.log("If you made changes to this tree, they may have been lost.", Debug.WARN_PRIORITY);
					Debug.log(warn, Debug.WARN_PRIORITY);
					Debug.log("If you made changes to this tree, they may have been lost.", Debug.WARN_PRIORITY);
				}
				else
					Debug.log(warn);
			}
			lastTreeWarnStr_ = warn;



			//draw tree		

			var tableGroupName = DesktopContent.getXMLValue(req, "tableGroup");
			var tableGroupKey = DesktopContent.getXMLValue(req, "tableGroupKey");


			//always update tree names
			var activeTableNames = req.responseXML.getElementsByTagName("ActiveTableName");
			var activeTableVersions = req.responseXML.getElementsByTagName("ActiveTableVersion");
			var activeTableComments = req.responseXML.getElementsByTagName("ActiveTableComment");
			treeMemberNames_ = [];
			treeMemberVersions_ = [];
			treeMemberComments_ = [];

			_tableLinkDropdownChoices = [];
			_tableLinkDropdownChoices.push(DesktopContent.getXMLValue(req, "DefaultNoLink"));
			for (var i = 0; i < activeTableNames.length; ++i) {
				treeMemberNames_.push(activeTableNames[i].getAttribute("value"));
				_tableLinkDropdownChoices.push(treeMemberNames_[i]);
				treeMemberVersions_.push(activeTableVersions[i].getAttribute("value"));
				treeMemberComments_.push(activeTableComments[i].getAttribute("value"));
			}


			if (!parentId &&
				treeViewHandlerStr_ && treeViewHandlerStr_ != "" &&
				treeGroupName_ == tableGroupName &&
				treeGroupKey_ == tableGroupKey) {
				Debug.log("Re-using tree handler string that we already have!");
				var el = document.getElementById("display");
				el.innerHTML = treeViewHandlerStr_;

				if (treeHasChanged_) //if tree was changed before, trick into showing buttons again
				{
					treeHasChanged_ = false;
					treeHasChanged();
				}


				//setup back link string properly for menu generation
				if (treeViewBackLinkStr_ && treeViewBackLinkStr_ != "") {
					//Note: be careful with the source of treeViewBackLinkStr_.. don't use both quote styles!
					if (treeViewBackLinkStr_.indexOf("'") >= 0)
						treeViewBackLinkStr_ = treeViewBackLinkStr_.replace(/'/g, "\\\"");
					else
						treeViewBackLinkStr_ = treeViewBackLinkStr_.replace(/"/g, "\\\"");
					Debug.log("Back-link = " + treeViewBackLinkStr_);
				}


				//fix root group name/key links just in case
				//	(this avoids errors in manipulating treeViewHandlerStr_ and re-acquiring the tree string)
				{
					var rootGroupEl = document.getElementById("treeView-ConfigGroupLink");
					Debug.log("Modifying root group key " + treeGroupKey_);
					var str = "";
					str += "<div style='display:none'>" + treeGroupName_ + "</div>";
					str += "<div style='display:none'>" + treeGroupKey_ + "</div>";
					str += treeGroupName_ + " (" + treeGroupKey_ + ")";
					rootGroupEl.innerHTML = str;
					rootGroupEl.onclick = function () {

						var backLinkStr = "setupTableGroupTreeView(\"" +
							treeGroupName_ + "\",\"" +
							treeGroupKey_ + "\");";
						setupSpecificTableGroup(treeGroupName_, treeGroupKey_,
							backLinkStr);
						return false;
					};

					//modify the activate link
					rootGroupEl = document.getElementById("treeView-ConfigGroupActivateLink");
					rootGroupEl.onclick = function () {
						activateSystemConfig(treeGroupName_, treeGroupKey_);
						return false;
					};
				}

				applyTreeFilter("", 1); //reapplyFilter

				return;
			}
			else
				treeViewHandlerStr_ = "";


			var treeErr = DesktopContent.getXMLValue(req, "TreeErrors");
			if (treeErr) {
				Debug.log("There were errors detected when attempting to verify the group '" +
					tableGroupName + " (" + tableGroupKey + ")'. " +
					"Please see the detailed report below:\n\n" + treeErr, Debug.WARN_PRIORITY);
			}

			treeGroupName_ = tableGroupName;
			treeGroupKey_ = tableGroupKey;


			Debug.log("treeEditingNodeParentIdString_ " + treeEditingNodeParentIdString_);


			var el;
			var depth;

			if (parentId) //this is an expansion
			{
				depth = (parentId.split("-")[0] | 0) + 1; //parent depth + 1

				//target is children area				
				el = document.getElementById("treeNode-ChildrenOf-" + parentId);
				el.style.display = "block"; //make sure it is shown

				//change toggle to "-"
				var toggleEl = document.getElementById("treeNode-toggle-" + parentId);
				toggleEl.style.backgroundImage =
					"url(/WebPath/images/windowContentImages/ConfigurationGUI-hideTree.png)";

				//if disconnected link remove "DISCONNECTED"
				var valEl = document.getElementById("treeNode-Value-" + parentId);
				var valElText = valEl.textContent;
				var i;
				if ((i = valElText.indexOf(")-DISCONNECTED")) > 0) {
					var testStillDisconnected = DesktopContent.getXMLValue(req, "DisconnectedStartNode");
					if (testStillDisconnected && testStillDisconnected == "1") {
						Debug.log("Still disconnected.");
					}
					else {
						//only remove disconnected indicator if really 
						valEl.innerHTML = "";
						valEl.appendChild(document.createTextNode(valElText.substr(0, i + 1)));
					}
				}
			}
			else //this is the initial top level request
			{
				//reset globals
				_editingCell = false;
				_editingCellEl = 0;
				treeHasChanged_ = false;

				depth = 0;
				treeNodeUID_ = 0; //reset node id
				el = document.getElementById("display");

				//add back link				
				if (treeViewBackLinkStr_ && treeViewBackLinkStr_ != "") {
					//setup back link string properly
					//Note: be careful with the source of treeViewBackLinkStr_.. don't use both quote styles!
					if (treeViewBackLinkStr_.indexOf("'") >= 0)
						treeViewBackLinkStr_ = treeViewBackLinkStr_.replace(/'/g, "\\\"");
					else
						treeViewBackLinkStr_ = treeViewBackLinkStr_.replace(/"/g, "\\\"");
					Debug.log("Back-link = " + treeViewBackLinkStr_);

					treeViewHandlerStr_ += "<a onclick='evaluateJS(\"" + treeViewBackLinkStr_ +
						"\"); return false;'>Back</a>";
					treeViewHandlerStr_ += "&nbsp;&nbsp;&nbsp;&nbsp;";
				}

				//				var refreshLinkStr = "treeViewHandlerStr_=\"\"; setupTableGroupTreeView(\"" + 
				//						treeGroupName_ + "\",\"" +
				//						treeGroupKey_ + "\",\"" + treeViewBackLinkStr_ + "\");"; 
				//				treeViewHandlerStr_ += "<a onclick='" + refreshLinkStr + 
				//						"; return false;'>Refresh</a>";	
				//treeViewHandlerStr_ += "&nbsp;&nbsp;&nbsp;&nbsp;";

				treeViewHandlerStr_ += "<a onclick='expandTreeChildrenDepth(); return false;' " +
					"title='Expand all children at deepest depth; " +
					"if no nodes are expanded, then expand XDAQContextTable preferentially.\n\n" +
					"(Hot-keys: + , &gt; , } , A , E )" +
					"\nNote: hot-keys will target the highlighted node.'" +
					">+ All Children</a>";

				treeViewHandlerStr_ += "&nbsp;&nbsp;&nbsp;&nbsp;";
				treeViewHandlerStr_ += "<a onclick='hideTreeChildrenDepth(); return false;'" +
					"title='Hide all children at deepest depth.\n\n" +
					"(Hot-keys: - , &lt; , { , Z , M )" +
					"\nNote: hot keys will target the highlighted node.'" +
					">- All Children</a>";


				//				treeViewHandlerStr_ += "&nbsp;&nbsp;&nbsp;&nbsp;";
				//				treeViewHandlerStr_ += "<a href='#' onclick='" +
				//						"treeViewHideStatus_ = !treeViewHideStatus_;" +
				//						refreshLinkStr +
				//						"; return false;' title='' " +
				//						">" + (treeViewHideStatus_?"Show":"Hide") + " Status=False</a>";				
				//				

				//display edit menu
				treeViewHandlerStr_ +=
					"<div class='tableView-Menu' onmousedown='createTreeViewMenu(event);' " +
					"title='Edit Menu'>" +
					"<div class='gotoNavDiv'></div>" +
					"</div>"; //end context menu link div

				//create group details
				{
					var groupComment = DesktopContent.getXMLValue(req, "tableGroupComment");
					groupComment = decodeURIComponent(groupComment);
					var groupAuthor = DesktopContent.getXMLValue(req, "tableGroupAuthor");
					var groupCreationTime = DesktopContent.getXMLValue(req, "tableGroupCreationTime");
					groupCreationTime = ConfigurationAPI.getDateString(new Date((groupCreationTime | 0) * 1000));

					treeViewHandlerStr_ += "<div id='clearDiv'></div>";
					treeViewHandlerStr_ += "<div id='groupDetails' style='display:block'>" +
						"Root-Group Details:";
					treeViewHandlerStr_ += "<table border='0' style='" +
						"border: 1px solid #9c5e5e;" +
						"margin: 5px 0 5px 30px;" +
						"background-color: #d2c1c1;" +
						"'>";
					treeViewHandlerStr_ += "<tr><th>Author:</th><td class='underlineRow'>" + groupAuthor + "</td></tr>";
					treeViewHandlerStr_ += "<tr><th>Created:</th><td class='underlineRow'>" + groupCreationTime + "</td></tr>";
					treeViewHandlerStr_ += "<tr><th>Comment:</th><td>" +
						groupComment.replace(/\n/g, "<br>") + "</td></tr>";
					treeViewHandlerStr_ += "</table>";
					treeViewHandlerStr_ += "</div>";

					treeViewHandlerStr_ += "<div id='clearDiv' style='height:15px'></div>";
				}


				if (treeErr || err || warn) {
					treeViewHandlerStr_ += "<div style='color:red; cursor:pointer' title='" +
						//treeErr.replace(/'/g , "&apos;") + "' ";
						"Click to view errors' ";
					treeViewHandlerStr_ += "onmouseup='" +
						"var el = document.getElementById(\"treeViewErrors\"); el.style.display = " +
						"el.style.display == \"none\"?\"block\":\"none\"" +
						"'>";
					treeViewHandlerStr_ += "<u>Warning: Errors were detected in this tree!</u>";
					treeViewHandlerStr_ += "</div>";
					treeViewHandlerStr_ += "<div id='treeViewErrors' style='display:none'>" +
						(err ? err.replace(/\n/g, "<br>") : "") +
						(warn ? warn.replace(/\n/g, "<br>") : "") +
						(treeErr ? treeErr.replace(/\n/g, "<br>") : "") + "</div>";
					treeViewHandlerStr_ += "<div id='clearDiv' style='margin-bottom:10px'></div>";
				}

				var backLinkStr = "setupTableGroupTreeView(\\\"" +
					treeGroupName_ + "\\\",\\\"" +
					treeGroupKey_ + "\\\");";

				//add config group header
				treeViewHandlerStr_ += "<a id='treeView-ConfigGroupLink' " +
					"href='#' onclick='setupSpecificTableGroup(\"" + tableGroupName +
					"\",\"" + tableGroupKey + "\",\"" + backLinkStr + "\"); return false;'>";
				treeViewHandlerStr_ += "<div style='display:none'>" + tableGroupName + "</div>";
				treeViewHandlerStr_ += "<div style='display:none'>" + tableGroupKey + "</div>";
				treeViewHandlerStr_ += tableGroupName + " (" + tableGroupKey + ")";
				treeViewHandlerStr_ += "</a>";

				treeViewHandlerStr_ += "&nbsp;&nbsp;&nbsp;";

				//add Activate link
				treeViewHandlerStr_ += " <a id='treeView-ConfigGroupActivateLink' " +
					"onclick='activateSystemConfig(\"" + tableGroupName +
					"\",\"" + tableGroupKey + "\"); return false;'>";
				treeViewHandlerStr_ += "Activate</a>";

				treeViewHandlerStr_ += "<div id='clearDiv' style='margin-bottom:10px'></div>";

				//preload hide image
				treeViewHandlerStr_ += "<img style='display:none' src='" +
					"/WebPath/images/windowContentImages/ConfigurationGUI-hideTree.png" + "'>";
			}

			//add tree
			var tree = DesktopContent.getXMLNode(req, "tree");
			var childrenLength = tree.children.length;

			if (childrenLength)
				recursiveDrawTree(tree, depth, tree.getAttribute("value"), parentId);
			else								//no children found					
			{
				//treat no children as an empty value node!

				//////////=======================
				treeViewHandlerStr_ +=
					"<div class='treeNode'> " +
					"<div class='treeNode-Connection'></div>" +
					"<div class='treeNode-Value'>";

				treeViewHandlerStr_ += "<label style='color:rgb(212, 0, 0)'>";
				treeViewHandlerStr_ += "No Children Nodes Found.";
				treeViewHandlerStr_ += "</label>";

				treeViewHandlerStr_ += "</div>" + //end treeNode Value div		
					"</div>" + //end treeNode div							
					"<div id='clearDiv'></div>";
				//////////=======================				
			}

			el.innerHTML = treeViewHandlerStr_;

			//addTableToConfigurationGroup("ARTDAQParamT"); //for Debuggin!!!
			if(treeViewExpandedCapture_ && treeViewExpandedCapture_.length)
			{
				Debug.log("Nodes to expand from treeViewExpandedCapture_",treeViewExpandedCapture_);
				
				doRestoreNextTreeViewExpand();
				return;
			}
			
			//save the full string for posterity (and for back links)
			treeViewHandlerStr_ = document.getElementById("display").innerHTML;

			applyTreeFilter("", 1); //reapplyFilter
			toggleGroupDetails(_showGroupDetails);

			activateSystemConfigHandler(req); //display active config groups



			//consider offering to delete the parent of last deleted child
			if (parentId == treeEditingNodeParentIdString_ &&
				treeEditingNodeType_ == "delete-uid") {
				treeEditingNodeType_ = ""; //clear so parent not get considered again

				Debug.log("parentId " + parentId + " treeEditingNodeParentIdString_ " +
					treeEditingNodeParentIdString_ + " treeEditingNodeType_ " +
					treeEditingNodeType_);

				var parentIsEmpty = childrenLength == 0;

				if (!parentIsEmpty) //check for disconnected due to deleting the uid-link
				{
					try {
						var fieldName = treeEditingNodeInitValue_.split('-')[0];
						//look through children for fieldName
						for (var i = 0; i < tree.children.length; ++i)
							if (tree.children[i].getAttribute("value") == fieldName) {
								//found field, check for disconnected
								if (tree.children[i].children[0].getAttribute("value") ==
									"Disconnected")
									parentIsEmpty = true;
								break;
							}
					}
					catch (e) {
						Debug.log("Ignoring error trying verify deleted uid-link: " + e);
					}
				}

				//if no children at parent, then find closest parent that is a UID record
				//	and prompt for deletion
				if (parentIsEmpty)
					localHandleEmptyParent();
			}

			//===========
			//localHandleEmptyParent ~~
			function localHandleEmptyParent() {
				//Steps:
				//	- navigate up tree until UID or LinkUID node found				
				//		start at parent element.. is it a UID? etc.
				//	- offer to delete that UID node
				//	- delete using tree deletion mechanism, and is recursive for free
				//		i.e. when tree is drawn after deleting, it will check for empty parent again								

				var parentType;
				var parentIdString = treeEditingNodeParentIdString_;
				var traversalCount = 0;

				try {
					Debug.log("Trying " + parentIdString);
					parentType = document.getElementById("treeNode-Value-" +
						parentIdString).className.split(' ')[2].split('-')[3];
					if (parentType == "link")  //get link type
						parentType += document.getElementById("treeNode-childLinkIdType-" +
							parentIdString).innerText;
					Debug.log("parentType " + parentType);


					while (parentType != "uid" && parentType != "linkUID") {
						//current parent is not a UID node
						//	so keep ascending tree

						if (++traversalCount > 10) {
							Debug.log("Is tree path somehow circular?! Giving up. " + traversalCount);
							return;
						}

						//check depth
						if (((parentIdString.split('-')[0]) | 0) <= 1) {
							Debug.log("Reached top of tree?! Still no UID node found?");
							return;
						}


						//get parent's parentIdString
						parentIdString =
							document.getElementById("treeNode-ParentId-" + parentIdString).textContent;

						Debug.log("Trying " + parentIdString);
						parentType = document.getElementById("treeNode-Value-" +
							parentIdString).className.split(' ')[2].split('-')[3];
						if (parentType == "link") //get link type
							parentType += document.getElementById("treeNode-childLinkIdType-" +
								parentIdString).innerText;
						Debug.log("parentType " + parentType);
					}
				}
				catch (e) {
					Debug.log("Error finding UID parent... " + e);
					return;
				}

				Debug.log("Found " + parentIdString);
				Debug.log("parentType " + parentType);


				var depth = (parentIdString.split('-')[0]) | 0;
				var idString = parentIdString;
				var path = document.getElementById("treeNode-path-" + idString).innerText;
				var uid;

				if (parentType == "linkUID")
					uid = document.getElementById("treeNode-Value-" +
						parentIdString).innerText.split('(')[1].split(' ')[2].split(')')[0];
				else //uid
					uid = document.getElementById("treeNode-nodeName-" + parentIdString).innerText;

				Debug.log("path " + path);
				Debug.log("uid " + uid);

				DesktopContent.popUpVerification(
					"The removed record &apos;" + treeEditingNodeInitValue_ +
					"&apos; left the parent record at path &apos;" +
					path +
					"REPLACE&apos; childless.<br><br>" +
					"Would you like to also delete the parent record &apos;REPLACE?&apos;",
					function () //delete the parent handler
					{

						Debug.log("Deleting the parent also. " + idString);

						//copied code from handleTreeNodeClick() and selectThisTreeNode()

						var el = document.getElementById("treeNode-Value-" + idString);

						treeEditingNodeDepth_ = depth;
						treeEditingNodeIdString_ = parentIdString;

						var splitArr = path.split('/');
						treeEditingNodeParentIdString_ =
							document.getElementById("treeNode-ParentId-" + idString).textContent;


						//get target table - similar to handleTreeNodeClick()
						if (parentType == "linkUID") {
							treeEditingTargetTable_ = document.getElementById("treeNode-linkTableName-" +
								idString).textContent;
						}
						else //uid
						{
							if (depth == 1)
								treeEditingTargetTable_ = splitArr[splitArr.length - 2]; //table should be before last slash in path
							else //accessing through link so need to get from parent
							{
								//needs to get from parent OR parent-of-parent
								//	if parent is uid link.. then one level back
								//	if parent is groupid link.. then two levels back

								var pel = document.getElementById("treeNode-linkTableName-" +
									treeEditingNodeParentIdString_);
								if (!pel)
									pel = document.getElementById("treeNode-linkTableName-" +
										(document.getElementById("treeNode-ParentId-" +
											treeEditingNodeParentIdString_).textContent));

								treeEditingTargetTable_ = pel.textContent;
							}
						}

						treeEditingTargetUID_ = uid;
						treeEditingTargetColumn_ = "UID";
						Debug.log("edit uid mode target=" + treeEditingTargetTable_ +
							"/" + treeEditingTargetUID_ + "/" +
							treeEditingTargetColumn_);

						treeEditingNodeType_ = "delete-uid";
						_editingCellElOldValue = el.textContent;
						treeEditingNodeInitValue_ = _editingCellElOldValue;

						_editingCell = true;
						_editingCellEl = el;

						_editingCellElOldTitle = el.title;
						el.title = "";


						Debug.log("treeEditingTargetTable_ " + treeEditingTargetTable_);
						Debug.log("treeEditingTargetColumn_ " + treeEditingTargetColumn_);
						Debug.log("treeEditingTargetUID_ " + treeEditingTargetUID_);
						Debug.log("treeEditingNodeType_ " + treeEditingNodeType_);
						editTreeNodeOK();


					}, //end delete the parent handler
					uid /* REPLACE val*/,
					"#efeaea" /*bgColor*/, 0 /*textColor*/,
					"#770000" /*borderColor*/, 0 /*getUserInput*/, 400 /*dialogWidth*/
				); //end of DesktopContent.popUpVerification


			} //end localHandleEmptyParent
			
		} //end treeViewHandler()
		//==============================================================================
		//doCaptureTreeViewExpand ~		
		function doCaptureTreeViewExpand() 
		{
			//capture expanded children status
			Debug.log("doCaptureTreeViewExpand()");
			var allNodes = document.getElementsByClassName("treeNode-Expander");
			treeViewExpandedCapture_ = [];
			for (var i = 0; i < allNodes.length; ++i)
			{
				//skip hidden nodes in search
				if (allNodes[i].offsetParent === null) continue;

				var params = allNodes[i].onmouseup.toString().split("(")[2].split(")")[0].split(",");

				var idString = params[0] + "-" + params[1];
				var el = document.getElementById("treeNode-ChildrenOf-" + idString);
				if(el && el.style.display == "block")
				{
					treeViewExpandedCapture_.push([
							document.getElementById("treeNode-path-" + idString).innerText,
							document.getElementById("treeNode-Value-" + idString).innerText
							 ]);
					Debug.log("Found shown ",
							treeViewExpandedCapture_[treeViewExpandedCapture_.length-1]);
				}

			}//end node capture expanded loop

		} //end doCaptureTreeViewExpand()
				
		//==============================================================================
		//doRestoreNext ~		
		function doRestoreNextTreeViewExpand() 
		{
			//expand them in order	

			if(treeViewExpandedCapture_.length) //trigger chain reaction
			{
				Debug.log("Try ",treeViewExpandedCapture_[0]);
				//find matching path

				var allNodes = document.getElementsByClassName("treeNode-Expander");
				for (var i = 0; i < allNodes.length; ++i)
				{
					//skip hidden nodes in search
					if (allNodes[i].offsetParent === null) continue;
					var params = allNodes[i].onmouseup.toString().split("(")[2].split(")")[0].split(",");

					var idString = params[0] + "-" + params[1];
					if(document.getElementById("treeNode-path-" + idString).innerText ==
							treeViewExpandedCapture_[0][0] &&
							document.getElementById("treeNode-Value-" + idString).innerText ==
									treeViewExpandedCapture_[0][1])
					{

						try 
						{
							toggleTreeChildren(
									params[0] | 0, 		//make integer
									params[1] | 0,
									true,
									true /*doNext*/);
						}
						catch(e){break;} //ignore error
						
						Debug.log("Completed ",treeViewExpandedCapture_[0]);
						treeViewExpandedCapture_.splice(0,1);
						return;
					}
				}

				//if here, can not find current node.. so remove and proceed
				Debug.log("Not found ",treeViewExpandedCapture_[0]);
				treeViewExpandedCapture_.splice(0,1);
				doRestoreNextTreeViewExpand();
			}

		} //end doRestoreNextTreeViewExpand()

		//==============================================================================
		//recursiveDrawTree ~		
		function recursiveDrawTree(parent, depth, path, parentIdString) 
		{
			document.getElementById("display").style.width = (30 * depth + 740) + "px";
			document.getElementById("tempTree").style.width = (30 * depth + 740) + "px";

			var uid;
			var nodes = parent.children;
			var nodeName;
			var value, valueType;

			var tableLinkName, childLinkIndex, linkIdType, linkId;
			var i, j;
			var childrenLength;
			var newWindowStr;
			var backLinkStr;
			var titleStr;
			var nodeEditType, nodeEditTypeDisplay;
			var isLink, isDisconnected, isGroupLink;
			var choices;

			var pathHTML = path;
			//make path html safe
			pathHTML = pathHTML.replace(/</g, "&lt");
			pathHTML = pathHTML.replace(/>/g, "&gt");

			for (i = 0; i < nodes.length; ++i) {
				uid = treeNodeUID_++;
				nodeName = nodes[i].getAttribute("value");

				//make nodeName html safe
				nodeName = nodeName.replace(/</g, "&lt");
				nodeName = nodeName.replace(/>/g, "&gt");

				//Debug.log("nodeName= " + nodeName + " depth=" + depth + " uid=" + uid);

				childrenLength = nodes[i].children.length;
				//Debug.log("child's childrenLength=" + childrenLength);

				//handle value nodes
				if (childrenLength &&
					(value = nodes[i].children[0]).nodeName == "value"
				)//&& (valueType = nodes[i].children[1]).nodeName != "Disconnected")
				{
					value = value.getAttribute("value");
					valueType = nodes[i].children[1].getAttribute("value"); //dataType

					//make value html safe
					value = value.replace(/</g, "&lt");
					value = value.replace(/>/g, "&gt");

					//this is a value node!	
					//////////=======================
					treeViewHandlerStr_ +=
						"<div class='treeNode' id='treeNode-" +
						(depth + "-" + uid) + "' >" +
						"<div class='treeNode-Path' style='display:none' id='treeNode-path-" +
						(depth + "-" + uid) + "'>" + // end path id
						pathHTML + //save path for future use.. and a central place to edit when changes occur
						"</div>" +
						"<div class='treeNode-ParentId' style='display:none' id='treeNode-ParentId-" +
						(depth + "-" + uid) + "'>" +
						parentIdString + //save parentId for future use navigating up tree
						"</div>" +
						"<div class='treeNode-Connection'></div>";

					if (valueType == "FixedChoiceData") 
					{
						//add CSV choices div
						treeViewHandlerStr_ +=
							"<div class='treeNode-FixedChoice-CSV' style='display:none' " +
							"id='treeNode-FixedChoice-CSV-" +
							(depth + "-" + uid) + "'>";

						choices = nodes[i].children[1].children; //xml elements
						for (var j = 0; j < choices.length; ++j) 
						{
							if (j) treeViewHandlerStr_ += ",";
							treeViewHandlerStr_ += encodeURIComponent(choices[j].getAttribute("value"));
						}
						treeViewHandlerStr_ += "</div>";
					}
					else if (valueType == "BitMap")
					{
						//add bitmap params div
						treeViewHandlerStr_ +=
							"<div class='treeNode-BitMap-Params' style='display:none' " +
							"id='treeNode-BitMap-Params-" +
							(depth + "-" + uid) + "'>";

						var choices = nodes[i].children[1].children; //xml elements
						for (var j = 1; j < choices.length; ++j) //skip the first DEFAULT param
						{
							if (j - 1) treeViewHandlerStr_ += ";"; //assume no ';' in fields, so likely no issue to replace ; with ,
							treeViewHandlerStr_ += choices[j].getAttribute("value").replace(/;/g, ","); //change all ; to , for split safety
						}
						treeViewHandlerStr_ += "</div>";
					}

					//normal value node and edit icon
					{
						//start value node
						treeViewHandlerStr_ +=
							"<div class='treeNode-Value treeNode-ValueType-" + valueType +
							"' " +
							"id='treeNode-Value-" +
							(depth + "-" + uid) + "' " +

							"onclick='handleTreeNodeClick(" +
							depth + "," + uid + "," +
							"0,\"value\")' " +

							"onmousemove='handleTreeNodeMouseMove(" +
							depth + "," + uid + "," +
							"event)' " +

							">";

						titleStr = "~ Leaf Value Node ~\n";
						titleStr += "Path: \t" + path + nodeName + "\n";

						//left side of value
						treeViewHandlerStr_ +=
							"<div style='float:left' title='" + titleStr + "'>" +
							"<b class='treeNode-Value-leafNode-fieldName bold-header'>" +
							nodeName + "</b>" +
							"</div><div style='float:left'>&nbsp;:</div>";

						//normal edit icon
						treeViewHandlerStr_ +=
							"<div class='treeNode-Value-editIcon' id='treeNode-Value-editIcon-" +
							(depth + "-" + uid) + "' " +
							"onclick='handleTreeNodeClick(" +
							depth + "," + uid + "," +
							"1,\"value\"); event.stopPropagation();' " +
							"title='Edit the value of this node.' " +
							"></div>";
					}

					treeViewHandlerStr_ += "<div style='float:left; margin-left:9px;' id='treeNode-Value-leafNode-" +
						(depth + "-" + uid) +
						"' class='" +
						"treeNode-Value-leafNode-ColumnName-" + nodeName +
						"' " +
						">";

					if (valueType == "OnOff" ||
						valueType == "YesNo" ||
						valueType == "TrueFalse") {
						//colorize true false														
						treeViewHandlerStr_ += "<div style='float:left'>";
						treeViewHandlerStr_ += value;
						treeViewHandlerStr_ += "</div>";

						var color = (value == "On" || value == "Yes" || value == "True") ?
							"rgb(16, 204, 16)" : "rgb(255, 0, 0);";
						treeViewHandlerStr_ += "<div style='width:10px;height:10px;" +
							"background-color:" + color + ";" +
							"float: left;" +
							"border-radius: 7px;" +
							"border: 2px solid white;" +
							"margin: 2px 0 0 6px;" +
							"'></div>";
					}
					else if (valueType == "Timestamp")
						treeViewHandlerStr_ += ConfigurationAPI.getDateString(new Date((value | 0) * 1000));
					else
						treeViewHandlerStr_ += value;


					treeViewHandlerStr_ +=
						"</div>" + //end treeNode Value value side div

						"</div>" + //end treeNode Value div		
						"</div>" + //end treeNode div							
						"<div id='clearDiv'></div>";
					//////////=======================

					continue; //so no need to recurse
				}

				//not a value node so try to recurse				

				isLink = false;
				isDisconnected = false;
				isGroupLink = false;
				tableLinkName = "";

				//get value and table link name for this parent
				if (childrenLength && (value = nodes[i].children[0]).nodeName != "value") {
					--childrenLength; //subtract the link ID node from children length

					//this is a link node!	
					
					var offset = 1;

					if (value.getAttribute("value") == "Disconnected") {
						//this is a disconnected link node!						
						value = nodes[i].children[offset++]; //get link ID node
						--childrenLength; //subtract the link ID node from children length
						isGroupLink = value.nodeName == "GroupID";
						isDisconnected = true;

					}
					else //define check if group link
						isGroupLink = nodes[i].children[0].nodeName == "GroupID";

					value =
						"<label style='color:rgb(65, 86, 146);font-weight:bold;'>" +
						nodeName.replace(/</g, "&lt").replace(/>/g, "&gt") +
						"</label>" +
						"-(" +
						value.nodeName.replace(/</g, "&lt").replace(/>/g, "&gt") +
						" = " +
						value.getAttribute("value").replace(/</g, "&lt").replace(/>/g, "&gt") +
						")";

					if (isDisconnected)
						value += "-" +
							"<label style='color:red;font-weight:bold;'>" +
							"DISCONNECTED" +
							"</label>";

					tableLinkName = nodes[i].children[offset++].getAttribute("value"); //LinkTableName node
					--childrenLength; //subtract the tableLinkName name node from children length
					childLinkIndex = nodes[i].children[offset++].getAttribute("value"); //LinkIndex node					
					--childrenLength; //subtract the childLinkIndex node from children length
					
					//get fixed choices
					choices = nodes[i].children[offset++].children; //xml elements		
					--childrenLength; //subtract the fixed choice node from children length		



					isLink = true;

				}
				else {
					value = nodeName;
					tableLinkName = nodeName;

					//make value html safe
					value = value.replace(/</g, "&lt");
					value = value.replace(/>/g, "&gt");
				}

				//make tableLinkName html safe
				tableLinkName = tableLinkName.replace(/</g, "&lt");
				tableLinkName = tableLinkName.replace(/>/g, "&gt");

				var linkId = "";
				if(isLink)
				{
					var p = value.lastIndexOf('=')+2; //get past "= "
					linkId = value.substr(p,value.length-p-1); //remove last )
				}

				var treeNavContextMenuItems = [];
				var treeNavContextMenuItemHandlers = [];
				var tableComment = "";
				var tableTitle = "";

				{
					var retVal = getTreeViewTableStrings(tableLinkName, isLink,
							linkId, childLinkIndex, isGroupLink);

					treeNavContextMenuItems = retVal.treeNavContextMenuItems;
					treeNavContextMenuItemHandlers = retVal.treeNavContextMenuItemHandlers;
					tableComment = retVal.tableComment;
					tableTitle = retVal.tableTitle;
				}

				//////////=======================

				nodeEditType = ((treeNavContextMenuItemHandlers.length == 0 && !isLink) ? "uid" :
					(depth == 0 ? "table" : "link"));
				nodeEditTypeDisplay = ((treeNavContextMenuItemHandlers.length == 0 && !isLink) ? "UID" :
					(depth == 0 ? "Table" : "Link"));

				treeViewHandlerStr_ +=
					"<div class='treeNode' id='treeNode-" +
					(depth + "-" + uid) + "' ";

				treeViewHandlerStr_ += "onmousemove='handleTreeNodeMouseMove(" +
					depth + "," + uid + "," +
					"event)' "
					;

				treeViewHandlerStr_ += ">"; //end treeNode div open


				//add CSV choices div	
				if (choices) {
					treeViewHandlerStr_ +=
						"<div class='treeNode-FixedChoice-CSV' style='display:none' " +
						"id='treeNode-FixedChoice-CSV-" +
						(depth + "-" + uid) + "'>";
					for (var j = 0; j < choices.length; ++j) {
						if (j) treeViewHandlerStr_ += ",";
						treeViewHandlerStr_ += choices[j].getAttribute("value");
					}
					treeViewHandlerStr_ += "</div>";
				}


				treeViewHandlerStr_ +=
					"<div class='treeNode-Path' style='display:none' id='treeNode-path-" +
					(depth + "-" + uid) + "'>" + // end path id
					pathHTML + //save path for future use.. and a central place to edit when changes occur
					"</div>" +
					"<div class='treeNode-ParentId' style='display:none' id='treeNode-ParentId-" +
					(depth + "-" + uid) + "'>" +
					parentIdString + //save parentId for future use navigating up tree
					"</div>" +
					"<div class='treeNode-NodeName' style='display:none' id='treeNode-nodeName-" +
					(depth + "-" + uid) + "'>" + // end nodeName id
					nodeName + //save nodeName for future use.. and a central place to edit when changes occur
					"</div>" +
					"<div class='treeNode-Connection'></div>" +
					"<div class='treeNode-Expander' id='treeNode-toggle-" +
					(depth + "-" + uid) + "' " + // end expander id
					"onmouseup='toggleTreeChildren(" +
					depth + "," +
					uid + ");' " + // end expander onmouseup
					"></div>";

				if (isLink) //if link node save table name and childLinkIndex in hidden div
				{
					treeViewHandlerStr_ +=
						"<div class='treeNode-linkTableName' style='display:none' " +
						"id='treeNode-linkTableName-" +
						(depth + "-" + uid) + "'>" + // end path id
						tableLinkName + //save table name for future use.. and a central place to edit when changes occur
						"</div>";

					treeViewHandlerStr_ +=
						"<div class='treeNode-childLinkIndex' style='display:none' " +
						"id='treeNode-childLinkIndex-" +
						(depth + "-" + uid) + "'>" + // end path id
						childLinkIndex + //save link index name for future use.. and a central place to edit when changes occur
						"</div>";

					treeViewHandlerStr_ +=
						"<div class='treeNode-childLinkIdType' style='display:none' " +
						"id='treeNode-childLinkIdType-" +
						(depth + "-" + uid) + "'>" + // end path id
						(isGroupLink ? "GroupID" : "UID") + //save link id type for future use.. and a central place to edit when changes occur
						"</div>";
				}

				treeViewHandlerStr_ += "<table cellpadding='0' cellspacing='0' border='0' style='float:left;'><tr>"; //open pre/comment table row 
				if (treeNavContextMenuItemHandlers.length) //fix width if this is a config node so comments show up aligned
					treeViewHandlerStr_ += "<td><div style='width:470px'>"; //open pre-comment td and div
				else
					treeViewHandlerStr_ += "<td><div>"; //open pre-comment td and div

				treeViewHandlerStr_ += "<table cellpadding='0' cellspacing='0' border='0' style='float:left;'><tr><td>"; //open tree node name/link table row


				titleStr =
					"~ " + nodeEditTypeDisplay + " Tree Node ~";
				if (tableTitle)
					titleStr += "\n" + tableTitle;
				if (depth > 0)
					titleStr += "\nPath: \t\t" + path + nodeName + "\n";
				titleStr += "\n\n" + "Expand children w/Hot-keys:   + , &gt; , } , A , E \n"+
						"Collapse children w/Hot-keys: - , &lt; , { , Z , M \n";

				treeViewHandlerStr_ += "<div class='treeNode-Value treeNode-Value-nonLeafNode " +
					"treeNode-Value-nodeEditType-" + nodeEditType +
					"' " +
					"id='treeNode-Value-" +
					(depth + "-" + uid) + "' ";

				treeViewHandlerStr_ += "onclick='handleTreeNodeClick(" +
					depth + "," + uid + "," +
					"0,\"" +
					nodeEditType +
					"\")' ";

				treeViewHandlerStr_ += "title='" + titleStr + "' ";

				treeViewHandlerStr_ += ">";
				treeViewHandlerStr_ += value;
				treeViewHandlerStr_ += "</div>"; //end treeNode Value

				treeViewHandlerStr_ += "</td><td>";

				//within this TD, put editClick and link
				treeViewHandlerStr_ += "<table cellpadding='0' cellspacing='0' border='0' style='float:left;'><tr>"; //open edit/link table row
				treeViewHandlerStr_ += "<td>";
				if (nodeEditType != "table" && nodeEditType != "link") //uid edit icon
					treeViewHandlerStr_ +=
						"<div style='margin-top:-4px; float:left;'>" + //to account for not being in value node
						"<div class='treeNode-Value-editIcon' id='treeNode-Value-editIcon-" +
						(depth + "-" + uid) + "' " +
						"onclick='handleTreeNodeClick(" +
						depth + "," + uid + "," +
						"1,\"" +
						nodeEditType +
						"\"); event.stopPropagation();' " +
						"title='Edit the UID for this record (with the option to delete this record entirely).' " +
						"></div>" +
						"</div>";
				treeViewHandlerStr_ += "</td><td style='width:100px'>";

				//if there is a table link menu (or if disconnected link), add it
				if (treeNavContextMenuItemHandlers.length || isLink) {
					treeViewHandlerStr_ += "<table cellpadding='0' cellspacing='0' border='0' style='float:left;'><tr>"; //open linkmenu/editicon table row
					treeViewHandlerStr_ += "<td  id='treeNode-LinkContextMenuTD-" +
						(depth + "-" + uid) + "'>";

					treeViewHandlerStr_ +=
						"<div class='treeNode-Link' "; //start treeNode Link div


					if (isDisconnected) //hide link if disconnected
						treeViewHandlerStr_ += "style='display:none' ";

					treeViewHandlerStr_ +=
						"onmousedown='" + // start link onmousedown
						SimpleContextMenu.createMenuCallAsString(
							treeNavContextMenuItems,
							treeNavContextMenuItemHandlers,
							"treeNavContextMenu",
							_CONTEXT_MENU_PRIMARY_COLOR,
							_CONTEXT_MENU_SECONDARY_COLOR) + "' ";

					treeViewHandlerStr_ +=
						">" +
						"<div class='gotoNavDiv'></div>" +
						"</div>"; //end treeNode Link div

					treeViewHandlerStr_ += "</td><td>"; //delimit linkmenu/editicon table row

					if (nodeEditType == "link") //add edit icon for links
						treeViewHandlerStr_ +=
							//"<div style='margin-top:-4px; float:left;'>" + //to account for not being in value node
							"<div class='treeNode-Value-editIcon' id='treeNode-Value-editIcon-" +
							(depth + "-" + uid) + "' " +
							"onclick='handleTreeNodeClick(" +
							depth + "," + uid + "," +
							"1,\"" +
							nodeEditType +
							"\"); event.stopPropagation();' " +
							"title='Edit this link.' " +
							"></div>";

					treeViewHandlerStr_ += "</td></tr></table>"; //close linkmenu/editicon table row
				}

				treeViewHandlerStr_ += "</td></tr></table>"; //close edit/link table row
				treeViewHandlerStr_ += "</td></tr></table>"; //close tree node name/link table row

				treeViewHandlerStr_ += "</div></td>"; //close pre-comment div and td

				if (nodeEditType == "table")
					treeViewHandlerStr_ +=
						"<td><div style='margin-top:-4px; float:left;'>" + //to account for not being in value node
						"<div class='treeNode-Value-editIcon' id='treeNode-Value-editIcon-" +
						(depth + "-" + uid) + "' " +
						"onclick='handleTreeNodeClick(" +
						depth + "," + uid + "," +
						"1,\"" +
						nodeEditType +
						"\"); event.stopPropagation();' " +
						"title='Edit the comment for this table.' " +
						"></div>" +
						"</div></td>";

				if (nodeEditType == "link")
					treeViewHandlerStr_ +=
						"<td><div style='margin-top:-4px; float:left;'>" + //to account for not being in value node
						"<div class='treeNode-Value-editIcon' id='treeNode-Value-editCommentIcon-" +
						(depth + "-" + uid) + "' " +
						"onclick='handleTreeNodeClick(" +
						depth + "," + uid + "," +
						"1,\"" +
						"link-comment" +
						"\"); event.stopPropagation();' " +
						"title='Edit the comment for this table.' " +
						"></div>" +
						"</div></td>";


				//add comment if applicable
				treeViewHandlerStr_ += "<td style='font-size:14px; white-space: nowrap;' id='" +
					"treeNode-TableComment-" +
					(depth + "-" + uid) + "' " +
					">";
				if (tableComment != "")
					treeViewHandlerStr_ += //"<td style='font-size:14px; white-space: nowrap;'>" +
						"//" + tableComment;
				else
					treeViewHandlerStr_ += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"; //for mouse over area
				treeViewHandlerStr_ += "</td>";
				treeViewHandlerStr_ += "</tr></table>"; //close pre/comment table row

				treeViewHandlerStr_ +=
					"<div id='clearDiv'></div>" +
					"<div class='treeNode-Children' id='treeNode-ChildrenOf-" +
					(depth + "-" + uid) + "'>";

				if (childrenLength) {
					recursiveDrawTree(nodes[i], depth + 1, path + nodeName + "/",
						(depth + "-" + uid));
				}

				treeViewHandlerStr_ +=
					"</div>" +
					"</div>" + //end treeNode div
					"<div id='clearDiv'></div>";
				//////////=======================



			} //end children loop
		} //end recursiveDrawTree()

		//==============================================================================
		//getTreeViewTableStrings ~
		function getTreeViewTableStrings(tableLinkName,isLink,linkId,
				childLinkIndex,isGroupLink) 
		{
			var backLinkStr;
			var onmouseupJS = "";
			var newwindowJS = "";
			var newtabJS = "";

			var DEFAULT_treeNavContextMenuItems = [
				"Go-to Table View",
				"See Table Tooltip",
				"Open Table View in new Desktop Window",
				"Open Table View in new Browser Tab",
				"Open Subset Editor in new Desktop Window",
				"Open Subset Editor in new Browser Tab",
				"Create Subset Editor desktop icon",
				"Add new Record to Table"];
			var treeNavContextMenuItems = []
			var treeNavContextMenuItemHandlers = [];
			var menuIndex = 0;

			var tableComment = "";
			var tableTitle = "";

			//search for table link
			for (j = 0; j < treeMemberNames_.length; ++j)
				if (tableLinkName == treeMemberNames_[j])
					break;
			if (j != treeMemberNames_.length) //found table link
			{
				backLinkStr = "setupTableGroupTreeView(\\\"" +
					treeGroupName_ + "\\\",\\\"" +
					treeGroupKey_ + "\\\");";


				//make replace screen js
				{
					onmouseupJS = "setupSpecificTable(\"" +
						treeMemberNames_[j] + "\",\"" +
						treeMemberVersions_[j] + "\",\"" + backLinkStr + "\");";

					treeNavContextMenuItems.push(DEFAULT_treeNavContextMenuItems[menuIndex++]);
					treeNavContextMenuItemHandlers.push(onmouseupJS);
				}
				
				//see table tooltip
				{
					onmouseupJS = "showTableTooltip(\"" +
											treeMemberNames_[j] + "\");";

					treeNavContextMenuItems.push(DEFAULT_treeNavContextMenuItems[menuIndex++]);
					treeNavContextMenuItemHandlers.push(onmouseupJS);											
				}

				//open table-view in new window link
				{
					newWindowStr = "setupSpecificTable(\"" +
						treeMemberNames_[j] + "\",\"" +
						treeMemberVersions_[j] + "\")";
					newWindowStr = newWindowStr.replace(/"/g, "\\\"");

					newWindowStr = location.pathname +
						location.search +
						"&newWindowOps=" + newWindowStr;

					newwindowJS = "DesktopContent.openNewWindow(" +
						"\"Configure\",\"\",\"" +
						newWindowStr + "\",false);";

					treeNavContextMenuItems.push(DEFAULT_treeNavContextMenuItems[menuIndex++]);
					treeNavContextMenuItemHandlers.push(newwindowJS);
				}

				//open table-view in new browser tab link
				{
					newtabJS = "DesktopContent.openNewBrowserTab(" +
						"\"Configure\",\"\",\"" +
						newWindowStr + "\",false);";

					treeNavContextMenuItems.push(DEFAULT_treeNavContextMenuItems[menuIndex++]);
					treeNavContextMenuItemHandlers.push(newtabJS);
				}

				//open Subset-Configuration in new window link
				{
					//make record alias with spaces instead of all one word
					// and remove table
					var recordAlias = "";
					for (var c = 0; c < treeMemberNames_[j].length - ("Table").length; ++c) {
						if (c && c + 1 < treeMemberNames_[j].length &&
							(treeMemberNames_[j][c] >= 'A' &&
								treeMemberNames_[j][c] <= 'Z') &&
							(treeMemberNames_[j][c + 1] >= 'a' &&
								treeMemberNames_[j][c + 1] <= 'z'))
							recordAlias += ' ';
						recordAlias += treeMemberNames_[j][c];
					}
					if(recordAlias.length && recordAlias[recordAlias.length-1] != 's')
						recordAlias += 's'; //make plural

					newWindowStr = "/WebPath/html/ConfigurationGUI_subset.html?urn=" +
						DesktopContent._localUrnLid +
						"&subsetBasePath=" + treeMemberNames_[j] +
						"&groupingFieldList=AUTO" +
						"&recordAlias=" + recordAlias +
						"&editableFieldList=" + "!*CommentDescription";
					
					if(isLink) //include special parameters to focus on link targets
					{
						if(isGroupLink)
						{
							//for group link, pre-select GroupID value							
							newWindowStr += "&selectedGroupIDs=" +
									encodeURIComponent(
											childLinkIndex + "=" +
											linkId);
						}
						else
						{
							//for unique link, presect UID record							
							newWindowStr += "&selectedRecords=" + linkId;							
						}
					} //end special link parameter handling


					//DesktopContent.openNewWindow = function(name,subname,windowPath,unique,completeHandler) {
					newwindowJS = "DesktopContent.openNewWindow(" +
						"\"" + treeMemberNames_[j] +
						" Subset\",\"\",\"" +
						//windowPath
						newWindowStr +
						"\",false /*unique*/);";

					treeNavContextMenuItems.push(DEFAULT_treeNavContextMenuItems[menuIndex++]);
					treeNavContextMenuItemHandlers.push(newwindowJS);
				}

				//open Subset-Configuration in new browser tab link
				{
					//DesktopContent.openNewBrowserTab = function(name,subname,windowPath,unique)
					newtabJS = "DesktopContent.openNewBrowserTab(" +
						"\"" + treeMemberNames_[j] +
						" Subset\",\"\",\"" +
						newWindowStr + "\",false /*unique*/);";

					treeNavContextMenuItems.push(DEFAULT_treeNavContextMenuItems[menuIndex++]);
					treeNavContextMenuItemHandlers.push(newtabJS);
				}
				
				//add Subset-Configuration desktop icon
				{
					//DesktopContent.addDesktopIcon = function(caption, altText,
						//	folderPath, unique, permissionString, 
						//	imageURL, windowContentURL, linkedApp, parameters)
							
					newtabJS = "DesktopContent.addDesktopIcon(" +
						"\"" + treeMemberNames_[j] +
						" Subset\",\"CfgSub\",\"Config Subsets\"" +
						", false /*unique*/" +
						", 255 /*permissionsString*/" +
						", \"icon-Configure.png\" /*imageURL*/" +
						", \"ConfigurationGUI_subset.html?urn=\" /*windowContentURL*/" +
						", \"ots::ConfigurationGUISupervisor\" /*linkedApp*/" +
						", /*parameters*/ \"" +
						"subsetBasePath=" + treeMemberNames_[j] +
						"&groupingFieldList=AUTO" +
						"&recordAlias=" + encodeURIComponent(recordAlias) +
						"&editableFieldList=" + encodeURIComponent("!*CommentDescription") +
						"\"" +
						");"; 

					treeNavContextMenuItems.push(DEFAULT_treeNavContextMenuItems[menuIndex++]);
					treeNavContextMenuItemHandlers.push(newtabJS);
				}


				//make add new row js
				{
					onmouseupJS = "editTreeAddNewRow(\"" +
						treeMemberNames_[j] + "\");";

					if (!isLink) {
						treeNavContextMenuItems.push(DEFAULT_treeNavContextMenuItems[menuIndex++]);
						treeNavContextMenuItemHandlers.push(onmouseupJS);
					}
					else
						++menuIndex; //skip 1st menu item

				}

				tableComment = treeMemberComments_[j];
				//make comment html safe
				tableComment = tableComment.replace(/</g, "&lt");
				tableComment = tableComment.replace(/>/g, "&gt");
				if (tableComment == ConfigurationAPI._DEFAULT_COMMENT) //do not show if default
					tableComment = "";
				tableTitle = "Table: \t\t" + treeMemberNames_[j] + "-v" +
					treeMemberVersions_[j];
				if (tableComment != "")
					tableTitle += "\nComment: \t\"" +
						tableComment + "\"";
			}

			return {
				"tableTitle": tableTitle,
				"tableComment": tableComment,
				"treeNavContextMenuItems": treeNavContextMenuItems,
				"treeNavContextMenuItemHandlers": treeNavContextMenuItemHandlers
			};
		} //end getTreeViewTableStrings()

		//==============================================================================
		//editTreeAddNewRow ~~
		function editTreeAddNewRow(tableName) 
		{
			Debug.log("editTreeAddNewRow " + tableName);

			//find table node element
			var els = document.getElementsByClassName("treeNode-Value-nodeEditType-table");
			{
				var i;
				for (i = 0; i < els.length; ++i)
					if (els[i].textContent == tableName) {
						_editingCellEl = els[i];
						break;
					}
				if (i == els.length) {
					Debug.log("Invalid tree member table targeted!", Debug.HIGH_PRIORITY);
					return;
				}
			}

			//setup globals (acting like a node edit)
			treeEditingNodeType_ = "table-newRow";
			treeEditingNodeIdString_ = _editingCellEl.id.substr(("treeNode-Value-").length);
			treeEditingTargetTable_ = _editingCellEl.textContent;
			_editingCellElOldValue = tableName;
			treeEditingNodeDepth_ = 0;


			//other globals are unused
			treeEditingNodeParentIdString_ = "";
			treeEditingTargetUID_ = "";
			treeEditingTargetColumn_ = "";
			treeEditingNodeInitValue_ = "1"; //just something so editTreeNodeOK proceeds

			editTreeNodeOK();//act on globals			
		} //end editTreeAddNewRow()

		//==============================================================================
		//handleTreeNodeClick ~~
		function handleTreeNodeClick(depth, uid, editClick, type) 
		{
			var idString = depth + "-" + uid;
			treeEditingNodeDepth_ = depth;
			treeEditingNodeIdString_ = idString;

			//Debug.log("handleTreeNodeClick editClick " + editClick);

			var el = document.getElementById("treeNode-Value-" + idString);

			if (treeEditingEditIconShownEl_) {
				//Debug.log("handleTreeNodeClick editClick clearing ");
				bodyMouseMoveHandler();
			}

			if (_editingCell) //already have the edit box open, cancel it
			{
				if (_editingCellEl == el) //if same cell do nothing
					return true;
				editTreeNodeOK(); //if new cell, click ok on old cell before continuing
			}

			var path = document.getElementById("treeNode-path-" + idString).textContent;

			//			Debug.log("handleTreeNodeClick el       " + el.innerHTML);
			//Debug.log("handleTreeNodeClick idString    " + idString);
			//Debug.log("handleTreeNodeClick uid      " + uid);
			//			Debug.log("handleTreeNodeClick nodeName " + nodeName);
			Debug.log("handleTreeNodeClick path     " + path);
			//Debug.log("handleTreeNodeClick editClick " + editClick);
			//Debug.log("handleTreeNodeClick type     " + type);

			//determine type clicked:
			//	- table name 
			//	- uid
			//	- link ID 
			//	- value
			//
			//allow different behavior for each	depending on single or edit(2x) click	
			//	- table name 	
			//		1x = toggle Children
			//		2x = N/A
			//	- uid		 	
			//		1x = toggle Children, 
			//		2x = edit UID mode (up/down tab/shtab enter esc active)
			//	- link ID 	 	
			//		1x = toggle Children 
			//		2x = edit ID (no keys active)
			//	- value		 	
			//		1x = N/A 
			//		2x = edit record Value mode (up/down tab/shtab enter esc active)
			//
			//on tree node edit OK
			//	- table name 
			//		N/A
			//	- uid
			//		save affected table as temporary version (re-use active temporary version at server)
			//		if saved successfully
			//			scan tree nodes for all other table/uid nodes and change that uid 
			//	- link ID 
			//		save affected table as temporary version (re-use active temporary version at server)
			//		if saved successfully
			//			clear children and re-request children (just one level)
			//			scan tree nodes for all other table/uid/linkid nodes and change that linkid
			//				for each, clear children and re-request children (just one level)
			//	- value
			//		save affected table as temporary version (re-use active temporary version at server)
			//		if saved successfully
			//			scan tree nodes for all other table/uid/value nodes and change that value
			//
			//on tree node edit cancel
			//	return previous value


			//==================
			//take action based on editClick and type string:
			//	- table 
			//	- uid
			//	- link 
			//	- value
			//
			//params:
			//	(el,depth,uid,path,editClick,type,delayed)

			if (editClick)	//2x click
			{
				if (type == "table" || type == "link-comment") {
					//edit table comment
					if (type == "table")
						treeEditingTargetTable_ = el.textContent;
					else //type == "link-comment"
						treeEditingTargetTable_ = document.getElementById("treeNode-linkTableName-" + idString).textContent;

					//other globals are unused
					treeEditingNodeParentIdString_ = "";
					treeEditingTargetUID_ = "";
					treeEditingTargetColumn_ = "";

					selectThisTreeNode(idString, type);
					return;
				}

				var splitArr = path.split('/');
				treeEditingNodeParentIdString_ =
					document.getElementById("treeNode-ParentId-" + idString).textContent;

				if (type == "uid") {
					//edit UID mode 
					if (depth == 1)
						treeEditingTargetTable_ = splitArr[splitArr.length - 2]; //table should be before last slash in path
					else //accessing through link so need to get from parent
					{
						//needs to get from parent OR parent-of-parent
						//	if parent is uid link.. then one level back
						//	if parent is groupid link.. then two levels back

						var pel = document.getElementById("treeNode-linkTableName-" +
							treeEditingNodeParentIdString_);
						if (!pel)
							pel = document.getElementById("treeNode-linkTableName-" +
								(document.getElementById("treeNode-ParentId-" +
									treeEditingNodeParentIdString_).textContent));

						treeEditingTargetTable_ = pel.textContent;
					}

					treeEditingTargetUID_ = el.textContent;
					treeEditingTargetColumn_ = "UID";
					Debug.log("edit uid mode target=" + treeEditingTargetTable_ +
						"/" + treeEditingTargetUID_ + "/" +
						treeEditingTargetColumn_);

					selectThisTreeNode(idString, type);
				}
				else if (type == "link" || type == "value" ||
					type == "link-disconnected") {
					//edit ID (no keys active)
					Debug.log("edit link/value mode");

					//almost all cases, uid is correct in path (NOT when parent is uid-link)
					treeEditingTargetUID_ = splitArr[splitArr.length - 2];

					if (depth == 2)
						treeEditingTargetTable_ = splitArr[splitArr.length - 3]; //table should be before last slash in path
					else //accessing through link so need to get table name from parent
					{
						//needs to get from parent OR parent-of-parent
						//	if parent is uid link.. then one level back
						//	if parent is groupid link.. then two levels back

						var pel = document.getElementById("treeNode-linkTableName-" +
							treeEditingNodeParentIdString_);
						if (!pel)
							pel = document.getElementById("treeNode-linkTableName-" +
								(document.getElementById("treeNode-ParentId-" +
									treeEditingNodeParentIdString_).textContent));
						else //parent is uid link, so UID from path is wrong, fix it
						{
							//take uid from parent value, right side						
							treeEditingTargetUID_ = document.getElementById("treeNode-Value-" +
								treeEditingNodeParentIdString_).textContent.
								split(')')[0].split('=')[1].substr(1);
						}

						treeEditingTargetTable_ = pel.textContent;
					}

					if (type == "value" || type == "link-disconnected")
						treeEditingTargetColumn_ = el.childNodes[0].textContent; //get from bold node
					else //link has col as start of value
						treeEditingTargetColumn_ = el.textContent.split('-')[0]; //get before dash

					Debug.log("edit link/value mode target=" + treeEditingTargetTable_ +
						"/" + treeEditingTargetUID_ + "/" +
						treeEditingTargetColumn_);
					selectThisTreeNode(idString, type);
				}
				else {
					Debug.log("This should be impossible - tell a developer how you got here!", Debug.HIGH_PRIORITY);
					return;
				}
			}
			else		//1x click
			{
				if (type == "table" || type == "uid" || type == "link") {
					toggleTreeChildren(depth, uid);
				}
				else if (type == "value") {
					//N/A
				}
				else {
					Debug.log("This should be impossible - tell a developer how you got here!", Debug.HIGH_PRIORITY);
					return;
				}
			}


		} //end handleTreeNodeClick()

		//==============================================================================
		//applyTreeFilter ~
		function applyTreeFilter(filter, reapplyFilter, infoWasToggled) 
		{
			Debug.log("applyTreeFilter " + filter);
			Debug.log("treeViewHideInfo_ " + treeViewHideInfo_);

			var valName;

			var allValues = document.getElementsByClassName("treeNode-Value-leafNode-fieldName");
			if (treeFilterApplied_ || treeViewHideInfo_ || infoWasToggled) 
			{
				//clear Tree Filter
				for (var i = 0; i < allValues.length; ++i) 
				{
					allValues[i].parentNode.parentNode.parentNode.style.display = "block";

					//if not hiding info (comment/author/time) then done
					if (!treeViewHideInfo_)
						continue;

					//else hide all info fields
					valName = allValues[i].innerHTML;
					if (valName == "CommentDescription" ||
						valName == "Author" ||
						valName == "RecordInsertionTime")
						allValues[i].parentNode.parentNode.parentNode.style.display = "none";
				}

				treeFilterApplied_ = false;

				lastTreeFilter_ = treeFilter_;
			}

			if (reapplyFilter)
				filter = treeFilter_;
			else
				treeFilter_ = filter;

			if (!filter || filter == "" || filter == "*") return;

			//apply new filter
			var filterArr = filter.split('*');

			//if only one element find exact
			//for each !"" component find it one after the other..

			var filterMatch;
			for (var i = 0; i < allValues.length; ++i) 
			{
				filterMatch = true;
				valName = allValues[i].innerHTML;
				if (filterArr.length == 1) 
				{
					if (valName != filterArr[0])
						filterMatch = false;
				}
				else 
				{
					var nextIndex = -1;
					for (var j = 0; j < filterArr.length; ++j) 
					{
						Debug.log("j=" + j + " filterArr[j]=" + filterArr[j] +
							" nextIndex=" + nextIndex);
						if (filterArr[j] == "") continue; //skip empty filters

						if (j == 0) //must start with this filter
						{
							if ((nextIndex = valName.indexOf(filterArr[j])) != 0) 
							{
								filterMatch = false;
								break; //done
							}
						}
						else if (j == filterArr.length - 1) //must end with this filter
						{
							if (valName.lastIndexOf(filterArr[j]) !=
								valName.length - filterArr[j].length) 
							{
								filterMatch = false;
								break;
							}
						}
						else if ((nextIndex = valName.indexOf(filterArr[j], nextIndex + 1)) < 0) 
						{
							filterMatch = false;
							break; //done
						}
					}
				}

				if (!filterMatch)	//get to treeNode element
					allValues[i].parentNode.parentNode.parentNode.style.display = "none";
			}

			treeFilterApplied_ = true;
		} //end applyTreeFilter()

		//==============================================================================
		//expandTreeChildrenDepth ~
		//	expand all children at deepest depth
		//	if deepest depth is 0, expand XDAQContextTable preferentially
		function expandTreeChildrenDepth() 
		{
			Debug.log("expandTreeChildrenDepth " + "");

			//prevent overloading expand/hide commands
			if (DesktopContent._loadBoxRequestStack)
			{
				Debug.log("rejected command due to active load box stack " +
					DesktopContent._loadBoxRequestStack);
				return;
			}

			var params = []; //(depth,uid)
			var allNodes;
			var contextIndex = -1;
			var deepestDepth = -1;
			var nameOfTargetNode = "";

			//choose which nodes are considered:
			//if a node is highlighted only expand and collapse considering its children
			if (treeEditingEditIconShownEl_) 
			{
				Debug.log("treeEditingEditIconShownIdString_ " + treeEditingEditIconShownIdString_);

				//if this is a leaf node 
				//	consider parent the target node

				var telIdString = treeEditingEditIconShownIdString_;
				var tel = document.getElementById("treeNode-Value-leafNode-" +
					treeEditingEditIconShownIdString_);
				if (tel) //if leaf node, change target id string
					telIdString = document.getElementById("treeNode-ParentId-" +
						treeEditingEditIconShownIdString_).textContent;

				tel = document.getElementById("treeNode-" +
					telIdString);

				nameOfTargetNode = document.getElementById("treeNode-Value-" +
					telIdString).textContent;
				Debug.log("nameOfTargetNode " + nameOfTargetNode);

				//add self and all children				
				allNodes = tel.getElementsByClassName("treeNode-Expander");
			}
			else	//all nodes
				allNodes = document.getElementsByClassName("treeNode-Expander");

			//find deepest depth and build params array
			for (var i = 0; i < allNodes.length; ++i)
			{
				//skip hidden nodes in search
				if (allNodes[i].offsetParent === null) continue;

				params.push(
					allNodes[i].onmouseup.toString().split("(")[2].split(")")[0].split(","));
				if ((params[params.length - 1][0] | 0) > deepestDepth)
					deepestDepth = params[params.length - 1][0] | 0;

				if (contextIndex == -1 &&
					(params[params.length - 1][0] | 0) == 0 &&
					document.getElementById("treeNode-nodeName-" +
						params[params.length - 1][0] + "-" +
						params[params.length - 1][1]).textContent ==
					"XDAQContextTable")
					contextIndex = params.length - 1; //found XDAQContextTable, save index
			}

			Debug.log("deepestDepth " + deepestDepth);
			if (deepestDepth < 0) return;

			//if deepestDepth is 0 and XDAQContextTable is present
			//	expand only XDAQContextTable
			//else expand all children at deepestDepth

			if (deepestDepth == 0 && contextIndex != -1) 
			{	//	expand only XDAQContextTable
				Debug.log("Expand only XDAQContextTable " + contextIndex);
				toggleTreeChildren(
					params[contextIndex][0] | 0, 		//make integer
					params[contextIndex][1] | 0);		//make integer					
				return;
			}

			var countExpanded = 0;
			for (var i = 0; i < params.length; ++i)
				if ((params[i][0] | 0) == deepestDepth) 
				{
					if (toggleTreeChildren(
						params[i][0] | 0, 		//make integer
						params[i][1] | 0,			//make integer
						true))					//show
						++countExpanded;
				}

			if (!countExpanded)
				Debug.log("The tree has been expanded as far as possible" +
					(treeEditingEditIconShownEl_ ? (" with respect to the highlighted node " +
						"'" + nameOfTargetNode + "'") : "") + "!", Debug.INFO_PRIORITY);
		} //end expandTreeChildrenDepth()

		//==============================================================================
		//hideTreeChildrenDepth ~
		//	hide all children at deepest depth
		function hideTreeChildrenDepth() 
		{
			Debug.log("hideTreeChildrenDepth " + "");

			//prevent overloading expand/hide commands
			if (DesktopContent._loadBoxRequestStack)
			{
				Debug.log("rejected command due to active load box stack " +
					DesktopContent._loadBoxRequestStack);
				return;
			}

			//this means toggling all children at second deepest depth
			var allNodes;
			var params = []; //(depth,uid)
			var paramSplit;
			var contextIndex = -1;
			var nameOfTargetNode = "";

			var deepestDepth = -1;
			//var secondDeepestDepth = -1;

			//choose which nodes are considered:
			//if a node is highlighted only expand and collapse considering its children
			if (treeEditingEditIconShownEl_) 
			{
				Debug.log("treeEditingEditIconShownIdString_ " + treeEditingEditIconShownIdString_);

				//if this is a leaf node 
				//	consider parent the target node

				var telIdString = treeEditingEditIconShownIdString_;
				var tel = document.getElementById("treeNode-Value-leafNode-" +
					treeEditingEditIconShownIdString_);
				if (tel) //if leaf node, change target id string
					telIdString = document.getElementById("treeNode-ParentId-" +
						treeEditingEditIconShownIdString_).textContent;

				tel = document.getElementById("treeNode-" +
					telIdString);

				nameOfTargetNode = document.getElementById("treeNode-Value-" +
					telIdString).textContent;
				Debug.log("nameOfTargetNode " + nameOfTargetNode);

				//add self and all children				
				allNodes = tel.getElementsByClassName("treeNode-Children");
			}
			else	//all nodes
				allNodes = document.getElementsByClassName("treeNode-Children");


			//find deepest depth and build params array
			//	since using expander now as element search, only look for deepest depth
			for (var i = 0; i < allNodes.length; ++i) 
			{
				//skip hidden nodes in search
				if (allNodes[i].offsetParent === null) continue;

				paramSplit = allNodes[i].id.split('-');
				params.push([paramSplit[2], paramSplit[3]]);

				//if not expanded then skip
				if (document.getElementById("treeNode-ChildrenOf-" + paramSplit[2] +
					"-" + paramSplit[3]).style.display != "block") continue;


				//allNodes[i].onmouseup.toString().split("(")[2].split(")")[0].split(","));
				if ((params[params.length - 1][0] | 0) > deepestDepth) {
					//secondDeepestDepth = deepestDepth; //track 2nd place
					deepestDepth = params[params.length - 1][0] | 0;
				}
			}

			//Debug.log("secondDeepestDepth " + secondDeepestDepth);
			Debug.log("deepestDepth " + deepestDepth);
			if (deepestDepth < 0) //secondDeepestDepth < 0) 
			{
				Debug.log("The tree has been collapsed as far as possible" +
					(treeEditingEditIconShownEl_ ? (" with respect to the highlighted node " +
						"'" + nameOfTargetNode + "'") : "") + "!", Debug.INFO_PRIORITY);
				return;
			}

			var countHidden = 0;
			for (var i = 0; i < params.length; ++i)
				if ((params[i][0] | 0) == deepestDepth)//secondDeepestDepth)
				{
					if (toggleTreeChildren(
						params[i][0] | 0, 		//make integer
						params[i][1] | 0,			//make integer							
						false)) //hide
						++countHidden;
				}

			if (!countHidden)
				Debug.log("The tree has been collapsed as far as possible" +
					(treeEditingEditIconShownEl_ ? (" with respect to the highlighted node " +
						"'" + nameOfTargetNode + "'") : "") + "!", Debug.INFO_PRIORITY);
		} //end hideTreeChildrenDepth()

		//==============================================================================
		//toggleTreeChildren ~ 
		//	if expanding
		//		if no children div, request new depth
		//		else display children
		//	if minimizing
		//		hide children
		//
		//	setVal can be used to avoid toggling
		//		- true = show, false = hide, undefined = toggle
		//
		// return true if action taken, else false
		//
		// if doNext, then always call treeViewHandler()
		function toggleTreeChildren(depth, uid, setVal, doNext) 
		{
			if(doNext) Debug.log("Do Next",depth,uid,setVal,_mouseIsSelecting);
			if (_mouseIsSelecting) return;

			var setValUsed = (setVal !== undefined);

			//			Debug.log("depth: " + depth);
			//			Debug.log("uid: " + uid);
			//			Debug.log("nodeName: " + nodeName);
			//			Debug.log("path: " + path);

			var idString = depth + "-" + uid;
			//Debug.log("idString: " + idString);

			var el = document.getElementById("treeNode-ChildrenOf-" + idString);
			var tableGroupEls = document.getElementById("treeView-ConfigGroupLink").childNodes;
			var str = el.innerHTML;

			if (!doNext && str != "") //if children already exist, then toggle display
			{
				var toggleEl = document.getElementById("treeNode-toggle-" + idString);
				var doShow = false;

				if ((!setValUsed && el.style.display == "none") ||
					(setValUsed && setVal))
					doShow = true;

				if (doShow) //if not shown, show and "-"
				{					
					if (el.style.display == "block") return false; //already was shown
					el.style.display = "block";
					toggleEl.style.backgroundImage =
						"url(/WebPath/images/windowContentImages/ConfigurationGUI-hideTree.png)";
					
					return true;
				}
				else //else shown, so hide and "+"
				{
					if (el.style.display == "none") return false; //already was hidden
					el.style.display = "none";
					toggleEl.style.backgroundImage =
						"url(/WebPath/images/windowContentImages/ConfigurationGUI-expandTree.png)";
					return true;
				}
			}
			else if (!setValUsed || setVal)	//if no children div, then request it
			{
				var path = document.getElementById("treeNode-path-" + idString).textContent;
				var nodeName = document.getElementById("treeNode-nodeName-" + idString).textContent;

				var modifiedTables = ""; //csv table, temporay version,...
				for (var j = 0; j < treeMemberNames_.length; ++j)
					if ((treeMemberVersions_[j] | 0) < -1)
					{
						if (modifiedTables.length)
							modifiedTables += ",";
						modifiedTables += treeMemberNames_[j];
						modifiedTables += ",";
						modifiedTables += treeMemberVersions_[j];
					}

				if(doNext)
					Debug.log("Do Next",idString);
				
				DesktopContent.XMLHttpRequest("Request?RequestType=getTreeView" +
					"&tableGroup=" + tableGroupEls[0].innerHTML +
					"&tableGroupKey=" + tableGroupEls[1].innerHTML +
					"&hideStatusFalse=" + (treeViewHideStatus_ ? 1 : 0) +
					"&depth=1",
					"startPath=" + path + nodeName + "/" +
					"&modifiedTables=" + modifiedTables,
					treeViewHandler,
					idString,
					0, true); //progressHandler, callHandlerOnErr 
				return true; //do not do localReturn!, the request handles it
			}
			return false;
		} //end toggleTreeChildren()

		//==============================================================================
		//setupTableGroupTreeView ~
		function setupTableGroupTreeView(tableGroupName, tableGroupKey, backLinkStr) 
		{
			if (backLinkStr && backLinkStr != "")
				treeViewBackLinkStr_ = backLinkStr;
			else
				treeViewBackLinkStr_ = "";
			DesktopContent.XMLHttpRequest("Request?RequestType=getTreeView" +
				"&tableGroup=" + tableGroupName +
				"&tableGroupKey=" + tableGroupKey +
				"&hideStatusFalse=" + (treeViewHideStatus_ ? 1 : 0) +
				"&depth=1",
				"startPath=/", treeViewHandler,
				0, 0, true); //reqIndex, progressHandler, callHandlerOnErr					
		} //end setupTableGroupTreeView()

		//==============================================================================
		//activateSystemConfig ~
		function activateSystemConfig(groupName, groupKey, ignoreWarnings, doneHandler) 
		{
			document.getElementById("activateConfigWithWarnings").innerHTML = "";

			if(ignoreWarnings)  //firstInit_ should be used to stop the reload of active groups (e.g. in System View) -- for example, after a group activation with warnings ignored
				firstInit_ = true;
			
			DesktopContent.XMLHttpRequest("Request?RequestType=activateTableGroup&groupName=" +
				groupName + "&groupKey=" + groupKey +
				(ignoreWarnings ? ("&ignoreWarnings=" + ignoreWarnings) : ""),
				"",
				function (req) {
					//call normal handler and return handler
					activateSystemConfigHandler(req, true /*display errors*/);
					if (doneHandler !== undefined) doneHandler(req);
				},
				0, 0, true); //reqIndex, progressHandler, callHandlerOnErr					
		} //end activateSystemConfig()

		//==============================================================================
		//versionTrackingHandler ~
		function versionTrackingHandler(req) 
		{
			var versionTrackingSystemLink = document.getElementById("versionTrackingSystemLink");

			//set tracking is OFF set Debug prepend message
			var versionTracking = DesktopContent.getXMLValue(req, "versionTrackingStatus");
			if (versionTracking == "OFF") 
			{
				Debug.prependMessage = "Version TRACKING OFF:::";
				if (versionTrackingSystemLink) versionTrackingSystemLink.innerHTML = "Turn Version Tracking ON";
				Debug.log("ALERT! ALERT! Version Tracking is OFF!!!", Debug.WARN_PRIORITY);
				_versionTrackingIsOn = false;
			}
			else if (versionTracking != "ON") 
			{
				//check ever-present message
				//	and only give indication if there was a change
				versionTracking = DesktopContent.getXMLValue(req, "versionTracking");
				if (versionTracking == "OFF" &&  //identify mismatch
					_versionTrackingIsOn) 
				{
					Debug.prependMessage = "Version TRACKING OFF:::";
					if (versionTrackingSystemLink) versionTrackingSystemLink.innerHTML = "Turn Version Tracking ON";
					Debug.log("ALERT! ALERT! Version Tracking is OFF!!!", Debug.WARN_PRIORITY);
					_versionTrackingIsOn = false;
				}
				else if (versionTracking == "ON" &&  //identify mismatch
					!_versionTrackingIsOn) 
				{
					Debug.prependMessage = "";
					if (versionTrackingSystemLink) versionTrackingSystemLink.innerHTML = "Turn Version Tracking OFF";
					Debug.log("Note: Version Tracking is ON!!!", Debug.WARN_PRIORITY);
					_versionTrackingIsOn = true;
				}
				else if (versionTracking != "ON" &&
					versionTracking != "OFF") 
				{
					Debug.prependMessage = "Version TRACKING UNKNOWN:::";
					if (versionTrackingSystemLink) versionTrackingSystemLink.innerHTML = "Turn Version Tracking ON";
					_versionTrackingIsOn = false;
				}
			}
			else //as normal, Turn Version Tracking is ON
			{
				Debug.prependMessage = "";
				if (versionTrackingSystemLink) versionTrackingSystemLink.innerHTML = "Turn Version Tracking OFF";
				if (!_versionTrackingIsOn)
					Debug.log("Version Tracking is ON!!!", Debug.INFO_PRIORITY);
				_versionTrackingIsOn = true;
			}

			Debug.log("_versionTrackingIsOn " + _versionTrackingIsOn);
		} //end versionTrackingHandler()

		//==============================================================================
		//activateSystemConfigHandler ~
		function activateSystemConfigHandler(req, displayErrors)
		{
			var withWarningsStr = "";
			var name, key; //only filled in if withWarningsStr != ""
			if (displayErrors)
			{
				try 
				{
					var err = DesktopContent.getXMLValue(req, "Error");
					if (err) 
					{
						Debug.log(err, Debug.HIGH_PRIORITY);

						Debug.log(_OTS_RELAUNCH_STR, Debug.INFO_PRIORITY);

						//try to find group name and key
						//	if found, show activate with warnings button
						var i = err.indexOf("'") + 1;//("activating group '") + ("activating group '").length;
						name = err.substr(i, err.indexOf("'", i) - i).split("(");
						if (name.length == 2) 
						{
							key = name[1].split(")")[0] | 0; //force integer
							name = name[0];

							//add ignore warnings Activate link
							withWarningsStr += " <a onclick='activateSystemConfig(\"" +
								name +
								"\",\"" + key + "\",1); return false;'>"; //ignore warnings
							withWarningsStr += "Activate " +
								name + "(" + key + ") w/warnings ignored</a>";
						}
					}
				}
				catch (e) 
				{
					Debug.log("Missing request response. " +
						"Something is very wrong. Did the server crash?", Debug.HIGH_PRIORITY);
					return;
				}
			} 

			//update version tracking
			versionTrackingHandler(req);

			_activeTableGroups = [
				DesktopContent.getXMLValue(req, "Context-ActiveGroupName"),
				DesktopContent.getXMLValue(req, "Context-ActiveGroupKey"),
				DesktopContent.getXMLValue(req, "Backbone-ActiveGroupName"),
				DesktopContent.getXMLValue(req, "Backbone-ActiveGroupKey"),
				DesktopContent.getXMLValue(req, "Iterate-ActiveGroupName"),
				DesktopContent.getXMLValue(req, "Iterate-ActiveGroupKey"),
				DesktopContent.getXMLValue(req, "Configuration-ActiveGroupName"),
				DesktopContent.getXMLValue(req, "Configuration-ActiveGroupKey")];
			
			var activeTableGroupAliases = [
				DesktopContent.getXMLValue(req, "Context-ActiveGroupAlias"),
				DesktopContent.getXMLValue(req, "Backbone-ActiveGroupAlias"),
				DesktopContent.getXMLValue(req, "Iterate-ActiveGroupAlias"),
				DesktopContent.getXMLValue(req, "Configuration-ActiveGroupAlias")];

			var activeConfigHeaders = ["Context", "Backbone", "Iterate Group", "Configuration"];
			Debug.log("activeConfigGroups: " + _activeTableGroups);

			var oldStr = document.getElementById("activeConfig").innerHTML;
			var str = "";
			var thereIsAnEmpty = false;

			str += "<table cellpadding='0' cellspacing='0' border='0' >"; //open active groups table

			for (var i = 0; i < activeConfigHeaders.length; ++i)
			{
				if(i == 1 || i == 2) continue; //only context and config
				
				str += "<tr><td style='text-align:left'>";

				if(i != 3) //not config		
					str += "Active ";
				else
					str += "Editor ";

				str += activeConfigHeaders[i] + ": ";

				str += "</td><td style='text-align:left; padding-left:20px;'>";

				if(activeTableGroupAliases[i] && activeTableGroupAliases[i] != "")
					str += "&quot;" + activeTableGroupAliases[i] + "&quot; ";

				str += "</td><td style='text-align:left; padding-left:20px;'>";

				if (!_activeTableGroups[i * 2] || _activeTableGroups[i * 2] == "") 
				{
					str += "None";
					thereIsAnEmpty = true;
				}
				else 
				{
					str += "<a href='#' onclick='setupSpecificTableGroup(\"" + _activeTableGroups[i * 2] +
						"\",\"" + _activeTableGroups[i * 2 + 1] + "\"); return false;'>";
					str += _activeTableGroups[i * 2] + "</a>(" + _activeTableGroups[i * 2 + 1] + ")";
				}
				//str += "<br>";

				str += "</td><td style='text-align: left; padding-left:20px;'>";
				
				if(!(!_activeTableGroups[i * 2] || _activeTableGroups[i * 2] == ""))
					str += "<a href='#' onclick='setupTableGroupTreeView(\"" +
						_activeTableGroups[i * 2] +
						"\",\"" +
						_activeTableGroups[i * 2 + 1] + "\"); return false;' " +
						"title='Open the tree-view for " + _activeTableGroups[i * 2] + 
						"(" + _activeTableGroups[i * 2 + 1] + ")'" +
						">Tree-view</a>";

				str += "</td></tr>";
			}
			str += "</table>"; //close active groups table


			if (withWarningsStr != "") 
			{
				document.getElementById("activateConfigWithWarnings").innerHTML = withWarningsStr;

				Debug.log("Group " + name + "(" + key + ") was not activated.\n\n" +
					"Please see detailed Warnings and Errors below. " +
					"You can try to activate " +
					"with warnings ignored " +
					"<label style='font-weight:bold;text-decoration:underline;font-size:inherit;'>" +
					"(MAKE SURE YOU KNOW WHY!)</label> by clicking " +

					//add ignore warnings Activate link
					"'<a onclick='activateSystemConfig(\"" +
					name +
					"\",\"" + key + "\",1/*ignoreWarnings*/); return false;'>" +
					"Activate " +
					name + "(" + key + ") w/warnings ignored</a>' " +

					"at the top of the page.", Debug.HIGH_PRIORITY);
				//Debug.log(_OTS_RELAUNCH_STR,Debug.INFO_PRIORITY);

			}
			else 
			{
				var el = document.getElementById("activeConfig");
				el.innerHTML = str;
				str = el.innerHTML;

				//if flag from server that an activation was attempted..)
				if (DesktopContent.getXMLValue(req, "AttemptedGroupActivation") == "1")
				{
					Debug.log("Note: There was a successful activation of the group '" +
						DesktopContent.getXMLValue(req, "AttemptedGroupActivationName") +
						" (" +
						DesktopContent.getXMLValue(req, "AttemptedGroupActivationKey") +
						").'",
						Debug.INFO_PRIORITY);
				}
				else if (!_firstTimeSilentActive && //only popup after the first time
					str != oldStr)  //if change							  
				{
					if (thereIsAnEmpty) //may have been a deactivationg (due to error?)
						Debug.log("Note: There was a change to the active Context group (check the top of the page)!",
							Debug.INFO_PRIORITY);
					else //must have been an activation
						Debug.log("Note: There was a successful activation of a group (likely from a different GUI, check the System View for changes)!",
							Debug.INFO_PRIORITY);

					//Debug.log(_OTS_RELAUNCH_STR,Debug.INFO_PRIORITY);
				}

				_firstTimeSilentActive = false;
			}

			//if system view, refresh it to show active
			try 
			{
				if (!systemViewPreventInfiniteLoop_ && 
						document.getElementById("display").children[0].textContent ==
					"System View")
					setupSystemViewMode();				
			}
			catch (e) { ; }

		} // end activateSystemConfigHandler()

		//==============================================================================
		//wizToActiveTableGroup ~~
		//	groupType := 0-context, 1-backbone, 2-configuration
		function wizToActiveTableGroup(groupAlias, groupType) 
		{
			if (groupType !== undefined) groupType |= 0; //make integer
			else groupType = 2; //default to config group

			var groupTypeName = groupType == 0 ? "Context" : (groupType == 1 ? "Backbone" : "Configuration");

			Debug.log("CfgGUI wizToActiveTableGroup " + groupType + ":" + groupTypeName);

			//set group alias to the last initialized configuration group

			var el = document.getElementById("display");
			el.innerHTML = "Loading...";

			//get active table groups
			DesktopContent.XMLHttpRequest("Request?RequestType=getActiveTableGroups",
				"", function (req) 
				{
					activateSystemConfigHandler(req);

					var name = DesktopContent.getXMLValue(req,
						groupTypeName + "-ActiveGroupName");
					var key = DesktopContent.getXMLValue(req,
						groupTypeName + "-ActiveGroupKey");

					if (!name || !key) {
						Debug.log("Process interrupted. There was no active " +
							groupTypeName + " Group found.",
							Debug.HIGH_PRIORITY);
						setupSystemViewMode();
						return;
					}

					ConfigurationAPI.setGroupAliasInActiveBackbone(
						groupAlias, name, key, 0, setupSystemViewMode);

				},
				0, 0, true  //reqParam, progressHandler, callHandlerOnErr
			); //end of getActiveTableGroups handler
		} //end wizToActiveTableGroup()

		//==============================================================================
		//wizToLatestTableGroup ~~
		//	groupType := 0-context, 1-backbone, 2-configuration
		function wizToLatestTableGroup(groupAlias, ignoreWarnings, groupType)
		{
			if (groupType !== undefined) groupType |= 0; //make integer
			else groupType = 2; //default to config group

			var groupTypeName = groupType == 0 ? "Context" : (groupType == 1 ? "Backbone" : "Configuration");

			Debug.log("CfgGUI wizToLatestTableGroup " + groupType + ":" + groupTypeName);


			//get latest version of all tables for table group
			//make a new group with those versions
			//set group alias to the resulting group

			var el = document.getElementById("display");
			var originalDisplayStr = el.innerHTML;
			el.innerHTML = "Loading...";

			DesktopContent.XMLHttpRequest("Request?RequestType=getTables",
				"", function (req)
				{

					var tableNames = req.responseXML.getElementsByTagName("TableName");
					var tableVersionHdr = req.responseXML.getElementsByTagName("TableVersions");

					var name;
					var tableVersions;

					Debug.log("tableNames.length " + tableNames.length);

					var context = _contextMemberNames;
					var backbone = _backboneMemberNames;
					var iterate = _iterateMemberNames;
					var tableMap = "tableList=";
					var found;
					for (var i = 0; i < tableNames.length; ++i)
					{
						name = tableNames[i].getAttribute("value");
						tableVersions = tableVersionHdr[i].getElementsByTagName("Version");

						found = false;
						if (groupType == 0 || groupType == 2)
							for (var c in context)
								if (name == context[c])
								{
									found = true;
									break;
								}
						if (!found &&
							(groupType == 1 || groupType == 2))
							for (var c in backbone)
								if (name == backbone[c]) 
								{
									found = true;
									break;
								}

						if (!found && groupType == 2)
							for (var c in iterate)
								if (name == iterate[c])
								{
									found = true;
									break;
								}

						if (groupType == 2 && found) continue; //not in config group, so skip
						if (groupType != 2 && !found) continue; //not in group type, so skip

						//this is an included table in target group type!

						//find the latest that is not temporary
						for (var v = tableVersions.length - 1; v >= 0; --v)
							if (tableVersions[v].getAttribute("value")[0] !=
								'-') //assume leading '-' means temporary
							{
								tableMap += name + "," +
									tableVersions[v].getAttribute("value") + ",";
								break;
							}
					}

					Debug.log("tableMap " + tableMap);
					//return;

					DesktopContent.XMLHttpRequest("Request?RequestType=" +
						"&groupName=" + (groupTypeName + "Group" + "WizToLatest") +
						"&ignoreWarnings=" + (ignoreWarnings ? 1 : 0),
						tableMap,
						function (req) 
						{
							var err = DesktopContent.getXMLValue(req, "Error");
							var name = DesktopContent.getXMLValue(req, "TableGroupName");
							var key = DesktopContent.getXMLValue(req, "TableGroupKey");
							if (err) 
							{
								if (!name || !key) 
								{
									Debug.log(err, Debug.HIGH_PRIORITY);
									Debug.log("Process interrupted. Failed to create a new table group!" +
										" Please see details below.",
										Debug.HIGH_PRIORITY);
									setupSystemViewMode();
									return;
								}
								Debug.log(err, Debug.WARN_PRIORITY);
								Debug.log("Going on with existing name=" + name + " & key=" + key,
									Debug.WARN_PRIORITY);
								Debug.log("Process interrupted. Failed to create a new table group!" +
									" (Likely the Group Alias points to an equivalent table group already)",
									Debug.WARN_PRIORITY);
							}

							//handle "TreeError" warnings
							{
								var treeErr = DesktopContent.getXMLValue(req, "TreeErrors");
								if (treeErr) 
								{
									var attemptedNewGroupName = DesktopContent.getXMLValue(req, "AttemptedNewGroupName");
									Debug.log(treeErr, Debug.WARN_PRIORITY);
									Debug.log("There were problems identified in the tree view of the " +
										"attempted new group &apos;" +
										attemptedNewGroupName +
										"&apos;.\nYou can wiz the group anyway (if you think it is a good idea) by clicking " +
										"'<u>Wiz-to-Latest with Warnings Ignored</u>'",
										Debug.WARN_PRIORITY);
									var str = "";
									str += " <input id='saveGroupWithWarningsIgnored' " +
										"style='margin-bottom:15px;' " +
										"type='button' onmouseup='wizToLatestTableGroup(\"" +
										groupAlias + "\",1," + groupType +
										")' value='Wiz-to-Latest with Warnings Ignored' " +
										"title='Automatically assign System Alias &apos;" + groupAlias +
										"&apos; to a ";
									str += groupTypeName;
									str += " Group comprised of the latest table versions.'" +
										"'/>";
									str += "<div id='clearDiv'></div>";

									var displayEl = document.getElementById("display");
									//since "Loading..." hid the popup from being closed properly
									// relaod original html and do it here
									displayEl.innerHTML = originalDisplayStr;
									//remove all previous buttons
									var el;
									do 
									{
										el = document.getElementById("saveGroupWithWarningsIgnored");
										if (el) el.parentNode.removeChild(el);
									} while (el);
									el = document.getElementById("popUpDialog");
									if (el) el.parentNode.removeChild(el);

									//add new button
									el = document.createElement("div");
									el.innerHTML = str; //create element with save with warnings ignored button							
									displayEl.insertBefore(el, displayEl.childNodes[0]); //insert new first child					

									return;
								}
							}

							//else proceeding normally

							ConfigurationAPI.setGroupAliasInActiveBackbone(
								groupAlias, name, key, 0, setupSystemViewMode);


						},
						0, 0, true  //reqParam, progressHandler, callHandlerOnErr
					); //end of saveNewTableGroup handler


				});	//end of getTables handler
		} //end wizToLatestTableGroup()

		//==============================================================================
		//saveGroupAndActivate
		function saveGroupAndActivate(groupName, tableMap, doneHandler, doReturnParams) 
		{
			DesktopContent.XMLHttpRequest("Request?RequestType=saveNewTableGroup" +
				"&groupName=" + groupName +
				"&allowDuplicates=0" +
				"&lookForEquivalent=1" +
				"", //end get data
				tableMap, //end post data
				function (req) 
				{
					var err = DesktopContent.getXMLValue(req, "Error");
					var name = DesktopContent.getXMLValue(req, "TableGroupName");
					var key = DesktopContent.getXMLValue(req, "TableGroupKey");
					var newBackbone = true;
					if (err) 
					{
						if (!name || !key) 
						{
							Debug.log(err, Debug.HIGH_PRIORITY);
							Debug.log("Process interrupted. Failed to create a new Backbone group!" +
								" Please see details below.",
								Debug.HIGH_PRIORITY);

							if (doneHandler)
								doneHandler(); //error so call done handler
							return;
						}
						else 
						{
							Debug.log(err, Debug.WARN_PRIORITY);
							Debug.log("Process interrupted. Failed to create a new Backbone group!" +
								" (Likely the currently active Backbone already represents what is being requested)\n\n" +
								"Going on with existing backbone group, name=" + name + " & key=" + key,
								Debug.WARN_PRIORITY);
							newBackbone = false;
						}
					}

					//now activate the new backbone group

					DesktopContent.XMLHttpRequest("Request?RequestType=activateTableGroup" +
						"&groupName=" + name +
						"&groupKey=" + key, "",
						function (req) 
						{

							activateSystemConfigHandler(req);

							if (doneHandler) 
							{
								//done so call done handler (and indicate success)
								if (!doReturnParams)
									doneHandler(); //done so call done handler
								else
								{
									var retParams = {
										"groupName": name,
										"groupKey": key,
										"newBackbone": newBackbone
									}
									doneHandler(retParams); 	 //(and indicate success)
								}
							}

						});	//end of activate new backbone handler

				}, 0, 0, true  //reqParam, progressHandler, callHandlerOnErr
			); //end of backbone saveNewTableGroup handler
		} //end saveGroupAndActivate()

		//==============================================================================
		//setupGroupCreator ~
		function setupGroupCreator(preSelectStr) 
		{
			var el = document.getElementById("display");
			el.innerHTML = "Loading...";
			DesktopContent.XMLHttpRequest("Request?RequestType=getTables",
				"", setupGroupCreatorHandler, preSelectStr,
				0, true  //progressHandler, callHandlerOnErr
			);
		} //end setupGroupCreator()

		//==============================================================================
		//setupGroupCreatorHandler ~
		// preSelectStr may contain "&backLinkStr=..." in it
		function setupGroupCreatorHandler(req, preSelectStr) 
		{
			var err = DesktopContent.getXMLValue(req, "Error");
			if (err) 
			{
				Debug.log(err, Debug.HIGH_PRIORITY);
				var el = document.getElementById("display");
				el.innerHTML = "Failed.";
				return;
			}

			activateSystemConfigHandler(req);

			var backLinkStr = "";
			//if backLinkStr is present parse it out
			if (preSelectStr && preSelectStr.indexOf("&") >= 0)
			{
				preSelectStr = preSelectStr.split("&");
				backLinkStr = preSelectStr[1].substr(preSelectStr[1].indexOf("=") + 1);
				preSelectStr = preSelectStr[0];
			}
			Debug.log("preSelectStr=" + preSelectStr);
			Debug.log("backLinkStr=" + backLinkStr);

			var el = document.getElementById("display");
			var str = "";

			if (backLinkStr && backLinkStr != "") 
			{
				//Note: be careful with the source of backLinkStr.. don't use both quote styles!
				if (backLinkStr.indexOf("'") >= 0)
					backLinkStr = backLinkStr.replace(/'/g, "\\\"");
				else
					backLinkStr = backLinkStr.replace(/"/g, "\\\"");
				Debug.log("Back-link = " + backLinkStr);

				str += "<a href='#' onclick='evaluateJS(\"" + backLinkStr + "\"); return false;'>Back</a>";
				str += "&nbsp;&nbsp;&nbsp;&nbsp;";
			}

			var refreshLinkStr = "setupGroupCreator(\"" +
				preSelectStr + "&backLinkStr=" + backLinkStr + "\");";
			str += "<a href='#' onclick='" + refreshLinkStr +
				"; _cachedGroupComment=\"" + _cachedGroupComment + "\"; return false;'>Refresh</a>";
			str += "<br>";

			if (preSelectStr)
				str += "<br>Choose the versions of tables you would like to add...<br>";

			str += "<div id='createGroupInfo'></div><br>";

			var createButtonStr = "<button type='button' onmouseup='" +
				"popUpSaveNewGroupForm(document.getElementById(\"newConfigName\").value," +
				"-1,1);" + //sourceGroupKey, sourceType
				//createTableGroup()'
				"' title='" +
				"Create the new persistent group and group key pair." +
				"'>" +
				"Create the new Group</button>";
			str += createButtonStr;
			str += "<br><br>";
			str += "Group Name: <input id='newConfigName'/>";
			str += "<br><br>";

			var tableNames = req.responseXML.getElementsByTagName("TableName");
			var tableVersionHdr = req.responseXML.getElementsByTagName("TableVersions");
			var name;
			var tableVersions, version;

			Debug.log("tableNames.length " + tableNames.length);

			str += "<table id='groupAddRemoveTable' cellpadding=0 cellspacing=0>";

			str += "<tr style='height:30px;'><td>";

			var title = "Select/Deselect checkboxes based on this selection.";
			str += "<a onclick='selectForCreateTableGroup(1); return false;' title='" + title + "'>All</a> | " +
				"<a onclick='selectForCreateTableGroup(0); return false;' title='" + title + "'>None</a> | " +
				"<a onclick='selectForCreateTableGroup(2); return false;' title='" + title + "'>Context</a> | " +
				"<a onclick='selectForCreateTableGroup(3); return false;' title='" + title + "'>Backbone</a> | " +
				"<a onclick='selectForCreateTableGroup(4); return false;' title='" + title + "'>Configuration</a>";
			str += "&nbsp;&nbsp;&nbsp;&nbsp;";
			str += "</td><td colspan='2' style='white-space: nowrap;'>";
			var title = "Select the version in the drop-downs for all tables based on this selection.";
			str += "<a onclick='versionsForCreateTableGroup(0); return false;' title='" + title + "'>Latest</a> | " +
				"<a onclick='versionsForCreateTableGroup(1); return false;' title='" + title + "'>Defaults</a> | " +
				"<a onclick='popUpVersionAliasGroupEditorForm(); return false;' title='" + title + "'>Other Alias</a>";
			str += "</td>";
			str += "</tr>";

			for (var i = 0; i < tableNames.length; ++i)
			{
				str += "<tr><td style='white-space: nowrap;'>";
				name = tableNames[i].getAttribute("value");


				//add checkbox
				str += "<input type='checkbox' class='memberTableCheckbox' value='" +
					name + "' onclick='handleGroupMemberChange();' >";
				//add link so text toggles checkbox
				str += "<a style='text-decoration:none;color:black;' onclick='" +
					"var el = document.getElementsByClassName(\"memberTableCheckbox\");" +
					"var forFirefox = (el[" + i + "].checked = !el[" + i + "].checked);" +
					"handleGroupMemberChange(); return false;'>";
				str += niceName(name); //can display however
				str += "</a>";
				str += "</input>";

				tableVersions = tableVersionHdr[i].getElementsByTagName("Version");
				//Debug.log("CfgGUI requestHandler tableNames.length " + tableVersions.length);

				str += "</td><td>";

				str += "<select id='select-" + name + "' onchange='handleGroupMemberChange();'>";
				for (var j = 0; j < tableVersions.length; ++j)
				{
					version = tableVersions[j].getAttribute("value");
					str += "<option value='" + version + "'>";
					str += version;	//can display however
					str += "</option>";
				}
				str += "</select>";
				str += "</td>";

				backLinkStr = "setupGroupCreator(\\\"" + preSelectStr + "\\\");";				

				str += "<td id='goto-" + name + "' >";
				str += "<a onclick='" +
					"return handleGroupMemberGoto(\"" + name + "\",\"" + backLinkStr + "\");'" +
					" title='Go to " + name + "&apos;s selected version.'" +
					">";
				str += "goto</a>";
				//"(tableName, version)"
				str += "</td>";
				str += "</tr>";
			}
			str += "</table>";

			str += createButtonStr;
			el.innerHTML = str;


			if (preSelectStr) 
			{
				//preSelectStr is CSV with groupName followed by member name/version pairs
				//use preset string to fill in preselected config group components
				var preSelectArr = preSelectStr.split(",");
				el = document.getElementById("newConfigName");
				el.value = preSelectArr[0]; //set group name
				var els = document.getElementsByClassName("memberTableCheckbox");
				var options;
				//set member configs and versions
				for (el = 0; el < els.length; ++el) 
				{
					els[el].checked = false;
					for (var c = 1; c < preSelectArr.length - 1; c += 2)
						if (els[el].value == preSelectArr[c]) 
						{
							//found so check to include
							els[el].checked = true;
							//and set version
							sel = document.getElementById("select-" + els[el].value);
							options = sel.options;
							for (var i = 0; i < options.length; ++i)
								if (options[i].value == preSelectArr[c + 1]) 
								{
									options[i].selected = true;
									break;
								}
							break;
						}
				}
			}
		} //end setupGroupCreatorHandler()

		//==============================================================================
		//selectForCreateTableGroup ~
		//0 is none, 1 is all, 2 is context, 3 is backbone, 4 is others (configuration)			
		function selectForCreateTableGroup(i)
		{
			var els = document.getElementsByClassName("memberTableCheckbox");

			//use list of context/backbone configuration from server
			var context = _contextMemberNames;
			var backbone = _backboneMemberNames;
			var iterate = _iterateMemberNames;

			switch (i) 
			{
				case 1: //check all
					for (var el = 0; el < els.length; ++el)
						els[el].checked = true;
					break;
				case 2: //context	
					for (var el = 0; el < els.length; ++el) 
					{
						//Debug.log(els[el].value);
						els[el].checked = false;
						for (var c = 0; c < context.length; ++c)
							if (els[el].value == context[c]) 
							{
								els[el].checked = true;
								break;
							}
					}
					break;
				case 3: //backbone	
					for (var el = 0; el < els.length; ++el) 
					{
						//Debug.log(els[el].value);
						els[el].checked = false;
						for (var c = 0; c < backbone.length; ++c)
							if (els[el].value == backbone[c]) 
							{
								els[el].checked = true;
								break;
							}
					}
					break;
				case 4: //configuration	
					for (var el = 0; el < els.length; ++el) 
					{
						els[el].checked = true;
						for (var c in context)
							if (els[el].value == context[c]) 
							{
								els[el].checked = false;
								break;
							}
						for (var c in backbone)
							if (els[el].value == backbone[c]) 
							{
								els[el].checked = false;
								break;
							}
						for (var c in iterate)
							if (els[el].value == iterate[c]) 
							{
								els[el].checked = false;
								break;
							}
					}
					break;
				default:
					//select none
					for (var el = 0; el < els.length; ++el)
						els[el].checked = false;
			}

			handleGroupMemberChange();
		} //end selectForCreateTableGroup()

		//==============================================================================
		//handleGroupMemberGoto ~
		function handleGroupMemberGoto(name, backLinkStr)
		{
			Debug.log("handleGroupMemberGoto " + name);

			var sel = document.getElementById("select-" + name);

			if (sel.selectedIndex < 0) sel.selectedIndex = 0; //default to default

			setupSpecificTable(name,
				sel.options[sel.selectedIndex] ?
					sel.options[sel.selectedIndex].value : -1,
				backLinkStr);
			return false;
		} //endemberGoto()
		
		//==============================================================================
		//handleGroupMemberChange ~
		function handleGroupMemberChange()
		{
			Debug.log("handleGroupMemberChange ");
					
			var els = document.getElementsByClassName("memberTableCheckbox");
			var sel;
			var tableMap = document.getElementById("newConfigName").value + ",";
			for (var el = 0; el < els.length; ++el)
				if (els[el].checked)
				{
					sel = document.getElementById("select-" + els[el].value);
					if (sel.options.length) 
					{
						if (sel.selectedIndex < 0) sel.selectedIndex = 0; //default to default
						Debug.log("table=" + els[el].value + " version=" +
							sel.options[sel.selectedIndex].value);
						tableMap += els[el].value + "," + sel.options[sel.selectedIndex].value + ",";
					}
					else //if no options, choose mockup version, -1
					{
						Debug.log("table=" + els[el].value + " version=" +
							(-1));
						tableMap += els[el].value + "," + (-1) + ",";
					}
				}
			
			Debug.log("new preSelectStr=", tableMap);
			
			var backLinkStr = "setupGroupCreator(\\\"" + tableMap + "\\\");";
				
			//now replace all goto actions
			// copied from L5695 setupGroupCreatorHandler()
			for (var el = 0; el < els.length; ++el)
			{				
				var tableName = els[el].value;
				sel = document.getElementById("goto-" + tableName);
				var str = "<a onclick='" +
					"return handleGroupMemberGoto(\"" + tableName + "\",\"" + backLinkStr + "\");'" +
					" title='Go to " + tableName + "&apos;s selected version.'" +
					">goto</a>";
				sel.innerHTML = str;
			}
			
			return false;
		} //end handleGroupMemberChange()

		//==============================================================================
		//versionsForCreateTableGroup ~
		//0 is latest, 1 is default, 2 is otherAlias 
		function versionsForCreateTableGroup(i, alias) 
		{
			var els = document.getElementsByClassName("memberTableCheckbox");
			var sel, options;
			switch (i) 
			{
				case 0: //latest
					for (var el = 0; el < els.length; ++el) 
					{
						//Debug.log(els[el].value);
						sel = document.getElementById("select-" + els[el].value);
						options = sel.options;

						//find the latest that is not temporary
						for (var i = options.length - 1; i >= 0; --i)
							if (options[i].value[0] != '-') //assume leading '-' means temporary
							{
								options[i].selected = true;
								break;
							}
					}
					break;
				case 1: //defaults

					var defaultToSel;
					for (var el = 0; el < els.length; ++el) 
					{
						//Debug.log(els[el].value);
						sel = document.getElementById("select-" + els[el].value);
						options = sel.options;

						//find ALIAS:Default or else first that is not temporary and not an ALIAS:
						defaultToSel = -1;
						for (var i = 0; i < options.length; ++i)
							if (options[i].value == "ALIAS:Default") 
							{
								//done!
								defaultToSel = i;
								break;
							}
							else if (defaultToSel == -1 &&
								options[i].value[0] != '-' &&  //assume leading '-' means temporary
								options[i].value.indexOf("ALIAS:") != 0) //skip aliases 
								defaultToSel = i; //found backup default, keep looking for ALIAS:Default				

						if (defaultToSel >= 0)
							options[defaultToSel].selected = true;
					}

					break;
				case 2: //other alias

					var defaultToSel;
					for (var el = 0; el < els.length; ++el) 
					{
						//Debug.log(els[el].value);
						sel = document.getElementById("select-" + els[el].value);
						options = sel.options;

						//find ALIAS:Default or else first that is not temporary
						defaultToSel = -1;
						for (var i = 0; i < options.length; ++i)
							if (options[i].value == "ALIAS:" + alias) 
							{
								//done!
								defaultToSel = i;
								break;
							}
							else if (defaultToSel == -1 &&
								options[i].value[0] != '-') //assume leading '-' means temporary
								defaultToSel = i; //found backup default, keep looking for ALIAS:Default				

						if (defaultToSel >= 0)
							options[defaultToSel].selected = true;
					}

					break;
				default:
					Debug.log("Impossible! Should never happen!! Alert system admins.", Debug.HIGH_PRIORITY);
			}

			handleGroupMemberChange();
		} //end versionsForCreateTableGroup()

		//==============================================================================
		//createTableGroupHandler ~
		function createTableGroupHandler(req) 
		{
			//remove all previous buttons
			var el;
			do 
			{
				el = document.getElementById("saveGroupWithWarningsIgnored");
				if (el) el.parentNode.removeChild(el);
			} while (el);

			var treeErr = DesktopContent.getXMLValue(req, "TreeErrors");
			if (treeErr)
			{
				var attemptedNewGroupName = DesktopContent.getXMLValue(req, "AttemptedNewGroupName");
				Debug.log(treeErr, Debug.WARN_PRIORITY);
				Debug.log("There were problems identified in the tree view of the " +
					"attempted new group &apos;" +
					attemptedNewGroupName +
					"&apos;.\nYou can save the group anyway (if you think it is a good idea) by clicking " +
					"'<u>Save Group with Warnings Ignored</u>'",
					Debug.WARN_PRIORITY);
				var str = "";
				str += " <input id='saveGroupWithWarningsIgnored' " +
					"style='margin-bottom:15px;' " +
					"type='button' onmouseup='createTableGroup(1);' " +
					" value='Save Group with Warnings Ignored' title='" +
					"Save the modified group as a new persistent key for this group name." +
					"'/>";
				str += "<div id='clearDiv'></div>";

				el = document.createElement("div");
				el.innerHTML = str; //create element with save with warnings ignored button
				var displayEl = document.getElementById("display");
				displayEl.insertBefore(el, displayEl.childNodes[0]); //insert new first child
				return;
			}

			var err = DesktopContent.getXMLValue(req, "Error");
			var el = document.getElementById('createGroupInfo');
			if (err) 
			{
				Debug.log(err, Debug.HIGH_PRIORITY);
				el.innerHTML = ""; //clear any previous success stories
				return;
			}

			var name = DesktopContent.getXMLValue(req, "TableGroupName");
			var key = DesktopContent.getXMLValue(req, "TableGroupKey");
			var str = "";

			str += "<br>";
			str += "New Table Group Created: <b class='bold-header'>" +
				name + " (" + key + ")</b>";
			str += "<br>Goto its ";
			str += "<a href='#' onclick='setupSpecificTableGroup(\"" + name +
				"\",\"" + key + "\"); return false;'>Member-view</a> or ";
			str += "<a href='#' onclick='setupTableGroupTreeView(\"" + name +
				"\",\"" + key + "\"); return false;'>Tree-view</a>, or ";
			str += "<a onclick='activateSystemConfig(\"" + name +
				"\",\"" + key + "\"); return false;'>Activate</a> it.";

			el.innerHTML = str;

			//scroll to the top
			window.scrollTo(0, 0);
			Debug.log("New Table Group Created: " +
				name + " (" + key + ")", Debug.INFO_PRIORITY);
		} //end createTableGroupHandler()

		//==============================================================================
		//tableVersionDiff
		function tableVersionDiff() 
		{			
			var vA = document.getElementById("tableVersionDiffA").value;
			var vB = document.getElementById("tableVersionDiffB").value;
			
			Debug.log("tableVersionDiff vA=" + vA + " vB=" + vB);

			var allowIllegalColumns = false;

			DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificTable" +
				"&dataOffset=0&chunkSize=" + _MAX_CHUNK_SIZE +
				(allowIllegalColumns?"&allowIllegalColumns=1":"") +
				"&tableName=" + _currentTableName +
				"&version=" + vA,
				"",
				function(reqA)
				{
					
					DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificTable" +
						"&dataOffset=0&chunkSize=" + _MAX_CHUNK_SIZE +
						(allowIllegalColumns?"&allowIllegalColumns=1":"") +
						"&tableName=" + _currentTableName +
						"&version=" + vB,
						"",
						function(reqB)
						{

							var errA = DesktopContent.getXMLValue(reqA, "Error");
							var errB = DesktopContent.getXMLValue(reqB, "Error");
							
							if (errA) 
							{
								Debug.log("Error A:",errA, Debug.HIGH_PRIORITY);

								Debug.log("There were errors loading version A='" + vA + 
									"'.\n\n(You may want to try loading this version again " +
									"to see what was partially loaded into the cache before failure. " +
									"If you think, the failure is due to a column name change, " +
									"you can also try to Copy the failing view to the new column names using the " +
									"'Copy and Move' functionality.) " +
									"\n\nPlease see the detailed Errors below:", Debug.HIGH_PRIORITY);
								//try to power through
							}

							if (errB) 
							{
								Debug.log("Error B:",errB, Debug.HIGH_PRIORITY);

								Debug.log("There were errors loading version B='" + vB + 
									"'.\n\n(You may want to try loading this version again " +
									"to see what was partially loaded into the cache before failure. " +
									"If you think, the failure is due to a column name change, " +
									"you can also try to Copy the failing view to the new column names using the " +
									"'Copy and Move' functionality.) " +
									"\n\nPlease see the detailed Errors below:", Debug.HIGH_PRIORITY);
								//try to power through
							}


							var rowsA = reqA.responseXML.getElementsByTagName(
								"CurrentVersionRows")[0].getElementsByTagName("Row");
							var rowsB = reqB.responseXML.getElementsByTagName(
								"CurrentVersionRows")[0].getElementsByTagName("Row");
							
							var displayTableRow = 0;
							var firstRowValueDifference = true;
							var rowEntriesA;
							var rowEntriesB;
							var diffStr = "";
							if(rowsA.length != rowsB.length)
								diffStr += "<tr" + 
									(displayTableRow++ % 2?" style='background-color:rgb(95 27 27);' ":"") +
									"><td colspan='2'>Row count mismatch in vA v" + vA + " = " + rowsA.length + 
									"</td><td colspan='2'>Row count mismatch in vB" + vB + " = " + rowsB.length + 
									"</td></tr>";

							for (var rA = 0, rB = 0; rA < rowsA.length && rB < rowsB.length; ++rA, ++rB) 
							{
								rowEntriesA = rowsA[rA].getElementsByTagName("Entry");
								rowEntriesB = rowsB[rB].getElementsByTagName("Entry");

								Debug.log("r" + " " + rA + " " + rB,rowEntriesA.length,rowEntriesB.length);

								if(rA == 0 && rB == 0 && rowEntriesA.length != rowEntriesB.length)
									diffStr += "<tr" + 
										(displayTableRow++ % 2?" style='background-color:rgb(95 27 27);' ":"") +
										"><td colspan='2'>Column count mismatch in vA v" + vA + " = " + columns.A.length + 
										"</td><td colspan='2'>Column count mismatch in vB" + vB + " = " + rowEntriesB.length + 
										"</td></tr>";
										
								for (var cA = 0, cB = 0; cA < rowEntriesA.length && cB < rowEntriesB.length; ++cA, ++cB)
								{
									Debug.log("rc",rA,cA,rowEntriesA[cA].getAttribute("value"),
										"vs",rB,cB,rowEntriesB[cB].getAttribute("value"));
									if(rowEntriesA[cA].getAttribute("value") != rowEntriesB[cB].getAttribute("value"))
									{
										if(firstRowValueDifference)
										{
											//first time give header columns
											firstRowValueDifference = false;
											diffStr += "<tr" + 
												" style='background-color:rgb(82 0 0);' " + 
												"><th>v" + vA + " [row,col]</th><th>v" + vA + " value" +
												"</th><th>v" + vB + " [row,col]</th><th>v" + vB + " value" +
												"</th></tr>";									
										}
										diffStr += "<tr" + 
											(displayTableRow++ % 2?" style='background-color:rgb(95 27 27);' ":"") +
											"><td style='text-align:center'>[" + rA + "," + cA + "]:</td><td style='white-space: nowrap'>" + rowEntriesA[cA].getAttribute("value") +
											"</td><td style='text-align:center'>[" + rB + "," + cB + "]:</td><td style='white-space: nowrap'>" + rowEntriesB[cB].getAttribute("value") +
											"</td></tr>";
									}
								} //end vA-vB col loop
							} //end vA-vB row loop

							if(diffStr != "")
							{
								var tmp = Debug._ERR_TRUNCATION_LENGTH;
								Debug._ERR_TRUNCATION_LENGTH = diffStr.length + 200;
								Debug.log("Differences were found between tables v" + vA + 
									" and v" + vB + ". Here are the results:\n" + 
									"<table>" +
									diffStr + "</table>", Debug.WARN_PRIORITY);
								Debug._ERR_TRUNCATION_LENGTH = tmp; //replace original truncation value
							}
							else if(rowsA.length == 0 && rowsB.length == 0)
								Debug.log("Both tables v" + vA + " and v" + vB + " were empty!", Debug.WARN_PRIORITY);
							else
								Debug.log("This should be impossible? No differences found between v" + 
									vA + " and v" + vB,Debug.INFO_PRIORITY);
						}, 
						0, //parameter 
						0, true  //progressHandler, callHandlerOnErr
					);

				}, 
				0, //parameter 
				0, true  //progressHandler, callHandlerOnErr
			);

		} //end tableVersionDiff()

		//==============================================================================
		//setupTableVersionDiff
		function setupTableVersionDiff() 
		{
			Debug.log("setupTableVersionDiff()");
			
			var el = document.getElementById('findAndReplace');
			el.innerHTML = ""; //clear the other type of controls
			el = document.getElementById('aboveTableDialog'); //share with copyAndMove
			var i =  el.innerText.indexOf("Table");
			if ( i >= 0 && i < 5) { el.innerHTML = ""; return; } //hide if already shown

			var str = "";
			str += "<br>Table Version A to compare... ";
			str += "<input type='text' id='tableVersionDiffA' style='margin:0;width:" +
				(el.offsetWidth - 6) + "px; height:" + (17) + "px' value='" + _version + "'>";
			str += "<br>";
			str += "Table Version B to compare... ";
			str += "<input type='text' id='tableVersionDiffB' style='margin:0;width:" +
				(el.offsetWidth - 6) + "px; height:" + (17) + "px' value='" + ((_version|0)-1) + "'>";
			str += "<br>";		
			str += "<br>";
			str += "<input type='button' onmouseup='tableVersionDiff()' value='Diff A and B' title='" +
				"Create a report of differences between Table Version A and B which can be downloaded." +
				"'/>";
			str += "<br><br>";
			el.innerHTML = str;
		} //end setupTableVersionDiff()

		//==============================================================================
		//setupCopyAndMoveRows
		function setupCopyAndMoveRows() 
		{
			Debug.log("setupCopyAndMoveRows()");

			var el = document.getElementById('findAndReplace');
			el.innerHTML = ""; //clear the other type of controls
			el = document.getElementById('aboveTableDialog'); //share with tableVersionDiff
			var i =  el.innerText.indexOf("Source");
			if ( i >= 0 && i < 5) { el.innerHTML = ""; return; } //hide if already shown

			var str = "";
			str += "<br>Source starting row or Source Version... ";
			str += "<input type='text' id='copyAndMoveRowsSrc' style='margin:0;width:" +
				(el.offsetWidth - 6) + "px; height:" + (17) + "px' value='0'>";
			str += "<br>";
			str += "Number of rows to Copy or Move... ";
			str += "<input type='text' id='copyAndMoveRowsSrcCount' style='margin:0;width:" +
				(el.offsetWidth - 6) + "px; height:" + (17) + "px' value='1'>";
			str += "<br>";
			str += "Destination row (-1 for new last row)... ";
			str += "<input type='text' id='copyAndMoveRowsDest' style='margin:0;width:" +
				(el.offsetWidth - 6) + "px; height:" + (17) + "px' value='-1'>";

			//make div for translating innerHTML and value
			str += "<div id='copyAndMoveRowsHTML' style='display:none'></div>";

			str += "<br><br>";
			str += "<input type='button' onmouseup='tableCopyOrMoveRow(0)' value='Copy Row' title='" +
				"Copy Source Row and paste at Destination Row, pushing previously existing rows down." +
				"'/>";
			str += " ";
			str += "<input type='button' onmouseup='tableCopyOrMoveRow(1)' value='Move Row' title='" +
				"Cut Source Row and paste at Destination Row, pushing previously existing rows down." +
				"'/>";
			str += " ";
			str += "<input type='button' onmouseup='configCopyView()' value='" +
				"Copy Source Version to new Temporary Version' title='" +
				"Copy Source Version (with possibly different column names) to a new Temporary Version with current column names." +
				"'/>";
			str += "<br><br>";
			el.innerHTML = str;
		} //end setupCopyAndMoveRows()

		//==============================================================================
		//configCopyView ~~
		function configCopyView(sourceVersion) 
		{
			//allow input override of source version
			var src = sourceVersion?sourceVersion:document.getElementById("copyAndMoveRowsSrc").value;
			Debug.log("configCopyView src=" + src);
			Debug.log("configCopyView _currentTableName=" + _currentTableName);

			DesktopContent.XMLHttpRequest("Request?RequestType=copyViewToCurrentColumns" +
				"&tableName=" + _currentTableName +
				"&sourceVersion=" + src,
				"", specificTableRequestHandler,
				0, 0, true  //reqParam, progressHandler, callHandlerOnErr
			);
		} // end configCopyView()

		//==============================================================================
		//tableCopyOrMoveRow
		function tableCopyOrMoveRow(deleteSrc) 
		{
			var src = document.getElementById("copyAndMoveRowsSrc").value | 0;
			var dest = document.getElementById("copyAndMoveRowsDest").value | 0;
			var srcCount = document.getElementById("copyAndMoveRowsSrcCount").value | 0;


			Debug.log("tableCopyOrMoveRow src=" + src + " srcCount=" + srcCount + " dest=" + dest);

			if (srcCount < 1) {
				Debug.log("Error: Illegal Number of Rows '" + (srcCount) +
					"' given. Number of Rows must be greater than or equal to 1.",
					Debug.HIGH_PRIORITY);
				return;
			}

			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");
			var str = "";
			var cols = [];
			var newCols = [];

			var colTypes = getTableViewColTypes(rows);
			var val;
			var uniqueVals;

			if (!_tableViewIsTransposed) //reading from normal view
			{
				if (dest == -1)
					dest = rows.length - _CONFIG_DATA_ROW_OFFSET; //add to end

				//get all cols
				//	and add new empty rows
				for (var r = 0, newr = 0; r < rows.length + 1; ++r) //+1 to account for block of rows to add
				{

					//handle adding new rows
					if (newr - _CONFIG_DATA_ROW_OFFSET >= dest &&
						newr - _CONFIG_DATA_ROW_OFFSET < dest + srcCount)
					{
						//add new empty TD row
						var newRowArr = [];
						for (var c = 0; c < rows[0].childNodes.length; ++c)
							newRowArr.push(document.createElement("td"));

						cols[newr] = newRowArr; //add new row
						++newr;

						//if this is not last row added, continue adding
						if (newr - _CONFIG_DATA_ROW_OFFSET < dest + srcCount)
						{
							--r;
							continue;
						}
						//else last row in new block, so proceed with data
					}

					//handle adding existing rows

					if (r >= rows.length) continue; //gone through all data already

					if (r == _CONFIG_DATA_ROW_OFFSET - 1) //col names are headers
						cols[newr] = rows[r].getElementsByTagName("th");
					else
						cols[newr] = rows[r].getElementsByTagName("td");

					++newr
				}

				//copy source values to dest values
				if (src >= dest) //account for source index being pushed back
					src += srcCount;

				for (var r = 0; r < srcCount; ++r) 
				{
					for (var c = 0; c < rows[0].childNodes.length; ++c) 
					{
						val = cols[_CONFIG_DATA_ROW_OFFSET + src + r][c].innerHTML;

						if (colTypes[c] == "UID" || colTypes[c] == "UniqueData") 
						{
							//create array for existing unique values
							uniqueVals = [];
							for (var rr = _CONFIG_DATA_ROW_OFFSET; rr < cols.length; ++rr)
								uniqueVals.push(cols[rr][c].innerHTML)

							cols[_CONFIG_DATA_ROW_OFFSET + dest + r][c].innerHTML = ConfigurationAPI.createNewRecordName(val, uniqueVals);
						}
						else
							cols[_CONFIG_DATA_ROW_OFFSET + dest + r][c].innerHTML = val;
					}
				}

				//if move, delete source values
				if (deleteSrc)
					cols.splice(_CONFIG_DATA_ROW_OFFSET + src, srcCount); //remove srcCount elements at src index

			} // end normal view handling
			else 					//reading from transposed view
			{
				//get all cols (transposed)
				var tmpCols;
				var numOfNewRows = -1;
				for (var c = 0; c < rows.length; ++c) 
				{
					cols.push([]); //push empty column, for each 

					//assume there is 1 th cell
					tmpCols = rows[c].getElementsByTagName("td");

					if (dest == -1)
						dest = tmpCols.length + 1 - _CONFIG_DATA_ROW_OFFSET; //add to end	

					for (var r = 0, newr = 0, tmpColsIndex = 0; r < tmpCols.length + 1 + 1; ++r) //+1 for th, and +1 for new block of rows
					{
						if (newr - _CONFIG_DATA_ROW_OFFSET >= dest &&
							newr - _CONFIG_DATA_ROW_OFFSET < dest + srcCount) 
						{
							//create default col cell to new row
							cols[c][newr] = document.createElement("td");
							++newr;

							//if this is not last row added, continue adding
							if (newr - _CONFIG_DATA_ROW_OFFSET < dest + srcCount) 
							{
								--r;
								continue;
							}
							//else last row in new block, so proceed with data
						}

						if (r >= tmpCols.length + 1) continue; //gone through all data already

						if (r == _CONFIG_DATA_ROW_OFFSET - 1) //col names are headers
							cols[c][newr] = rows[c].getElementsByTagName("th")[0];
						else //take from the td cels
							cols[c][newr] = tmpCols[tmpColsIndex++];
						++newr;
					}
				}

				//copy source values to dest values
				if (src >= dest) //account for source index being pushed back
					src += srcCount;
				for (var r = 0; r < srcCount; ++r) 
				{
					for (var c = 0; c < rows.length; ++c) 
					{
						val = cols[c][_CONFIG_DATA_ROW_OFFSET + src + r].innerHTML;


						if (colTypes[c] == "UID" || colTypes[c] == "UniqueData")
						{
							//create array for existing unique values
							uniqueVals = [];
							for (var rr = _CONFIG_DATA_ROW_OFFSET; rr < cols.length; ++rr)
								uniqueVals.push(cols[c][rr].innerHTML)

							cols[c][_CONFIG_DATA_ROW_OFFSET + dest + r].innerHTML = ConfigurationAPI.createNewRecordName(val, uniqueVals);
						}
						else
							cols[c][_CONFIG_DATA_ROW_OFFSET + dest + r].innerHTML = val;
					}
				}

				//if move, delete source values
				if (deleteSrc)
					for (var c = 0; c < rows.length; ++c)
						cols[c].splice(_CONFIG_DATA_ROW_OFFSET + src, srcCount); //remove srcCount elements at src index

			} //end transpose view handling


			//create output string based on cols
			str += createTableViewOutputStr(cols, colTypes);
			el.innerHTML = str;
			versionHasChanged();

			//update last add row link
			if (_tableViewIsTransposed) 
			{
				document.getElementById("lastAddRowLink0").onclick =
					function () 
					{
						addRow(cols[0].length - _CONFIG_DATA_ROW_OFFSET);
						return false;
					};
				document.getElementById("lastAddRowLink1").onclick =
					function () 
					{
						addRow(cols[0].length - _CONFIG_DATA_ROW_OFFSET);
						return false;
					};
			}
			else 
			{
				document.getElementById("lastAddRowLink0").onclick =
					function () 
					{
						addRow(cols.length - _CONFIG_DATA_ROW_OFFSET);
						return false;
					};
				document.getElementById("lastAddRowLink1").onclick =
					function () 
					{
						addRow(cols.length - _CONFIG_DATA_ROW_OFFSET);
						return false;
					};
			}

			////////////done 			
		} //end tableCopyOrMoveRow()

		//==============================================================================
		//setupFindAndReplace
		function setupFindAndReplace()
		{
			var el = document.getElementById('aboveTableDialog');
			el.innerHTML = ""; //clear the other type of controls
			el = document.getElementById('findAndReplace');
			if (el.innerHTML != "") { el.innerHTML = ""; return; } //hide if already shown

			_lastFindRow = _lastFindCol = -1; //initialize find location
			var str = "";
			str += "<br>Search in column ('*' for all)... <br>";
			str += "<input type='text' id='findAndReplaceTarget' style='margin:-4px -2px -4px -1px;width:" + (el.offsetWidth - 6) + "px; height:" + (el.offsetHeight - 8) + "px' value='*'>";
			str += "<br>";
			str += "For text... <br>";
			str += "<input type='text' id='findAndReplaceNeedle' style='margin:-4px -2px -4px -1px;width:" + (el.offsetWidth - 6) + "px; height:" + (el.offsetHeight - 8) + "px' value=''>";
			str += "<br>";
			str += "Replace with... <br>";
			str += "<input type='text' id='findAndReplaceWith' style='margin:-4px -2px -4px -1px;width:" + (el.offsetWidth - 6) + "px; height:" + (el.offsetHeight - 8) + "px' value=''>";

			//make div for translating innerHTML and value
			str += "<div id='findAndReplaceHTML' style='display:none'></div>";

			str += "<br><br>";
			str += "<div style='white-space:nowrap;'>";
			str += "<input type='button' onmouseup='tableFind()' value='Find' title='" +
				"Find every occurance of &apos;For text...&quot; in the Column(s) specified by &apos;Search in column.&apos;" +
				"'/>";
			str += " ";
			str += "<input type='button' onmouseup='tableReplace()' value='Replace' title='" +
				"Replace every occurance of &apos;For text...&quot; in the Column(s) specified by &apos;Search in column&apos; with the string specified in &apos;Replace with...&apos;" +
				"'/>";
			str += "&nbsp;&nbsp; or..."
			for (var i = 0; i < 3; ++i)
				str += "&nbsp;";
			str += "<input type='button' onmouseup='configIncrementByReplace()' " +
				"value='Increment by &quot;Replace with...&quot; Field' title='" +
				"Increment the trailing number in all fields in the Column(s) specified by &apos;Search in column&apos; by the signed integer number specified in &apos;Replace with...&apos; If there is no trailing number, a zero is inferred." +
				"'/>";
			str += " ";
			str += "<input type='button' onmouseup='configIncrementByReplace(true)' " +
				"value='Increment each row uniquely by &quot;Replace with...&quot; Field' title='" +
				"Increment the trailing number in all fields, uniquely from row to row, in the Column(s) specified by &apos;Search in column&apos; by the signed integer number specified in &apos;Replace with...&apos; The starting number comes from the first cell encountered; if there is no trailing number, a zero is inferred." +
				"'/>";
			str += "</div>";
			str += "<br>";
			el.innerHTML = str;
		} //end setupFindAndReplace()

		//==============================================================================
		//tableFind
		//	use _lastFindRow, _lastFindCol as starting point
		function tableFind() 
		{
			editCellOK(); //editCellCancel();
			var target = document.getElementById("findAndReplaceTarget").value;
			var needle = document.getElementById("findAndReplaceNeedle").value;
			var convertEl = document.getElementById("findAndReplaceHTML");

			//convert needle to HTML for search
			convertEl.innerHTML = "";
			convertEl.appendChild(document.createTextNode(needle));
			needle = convertEl.innerHTML; //converted text
			Debug.log("tableFind '" + needle + "' @ " + target);


			Debug.log("_lastFindRow=" + _lastFindRow + " _lastFindCol=" + _lastFindCol);

			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");
			var cells;
			var cols = rows[_CONFIG_DATA_ROW_OFFSET - 1].getElementsByTagName("th");
			var cellStr;
			var svLast = [_lastFindRow - _CONFIG_DATA_ROW_OFFSET,
			_lastFindCol - _CONFIG_DATA_COL_OFFSET];
			for (var r = _CONFIG_DATA_ROW_OFFSET; r < rows.length; ++r) //skip header rows
			{
				if (r < _lastFindRow) continue; //skip rows already looked at 

				cells = rows[r].getElementsByTagName("td");

				if (r != _lastFindRow) 
				{
					_lastFindCol = -1; //reset last col for row
					_lastFindRow = r;
				}

				for (var c = _CONFIG_DATA_COL_OFFSET; c < cells.length; ++c) //skip row index column
				{
					if (target != "*" && cols[c].innerHTML != target) continue; //skip if not target column 

					if (c <= _lastFindCol) continue; //skip cols already looked at in this row

					_lastFindCol = c;

					cellStr = cells[c].innerHTML;
					Debug.log("[" + r + "," + c + "]=" + cellStr);
					if (cellStr.indexOf(needle) >= 0) 
					{
						Debug.log("FOUND=" + cellStr);

						//cancel any other cells and target the found cell
						editCellOK(); //editCellCancel();
						selectThisCell(r, c, cells[c]);
						return;
					}

				}
			}
			Debug.log("Info: Reached end of table and was not able to find '" +
				needle + "' in columns '" +
				target + "' after row,col = [" + svLast[0] + "," + svLast[1] +
				"]. Try Find again to wrap around.",
				Debug.HIGH_PRIORITY);
			_lastFindRow = -1; //reset for next find
		} //end tableFind()

		//==============================================================================
		//configIncrementByReplace ~~
		function configIncrementByReplace(uniquely) 
		{
			editCellOK(); //editCellCancel();
			
			var target = document.getElementById("findAndReplaceTarget").value;
			var incrementNum = document.getElementById("findAndReplaceWith").value | 0;
			if (!incrementNum)
				incrementNum = 1;
			Debug.log("configIncrementByReplace +=" + incrementNum + " @ " + target);

			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");
			var cells;
			var cols = rows[_CONFIG_DATA_ROW_OFFSET - 1].getElementsByTagName("th");
			var cellStr, cellNumIndex, cellNum;

			var uniqueCellNumIndex = -1;
			var cellNumIndex;

			for (var r = _CONFIG_DATA_ROW_OFFSET; r < rows.length; ++r) //skip header rows
			{
				cells = rows[r].getElementsByTagName("td");

				for (var c = _CONFIG_DATA_COL_OFFSET; c < cells.length; ++c) //skip row index column
				{
					//skip if not target column
					if (target != "*" && cols[c].innerHTML != target) continue;

					cellStr = cells[c].innerHTML;
					Debug.log("[" + r + "," + c + "]=" + cellStr);

					//find any trailing number					
					for (cellNumIndex = cellStr.length - 1;
						cellNumIndex >= 0; --cellNumIndex)
						if (cellStr[cellNumIndex] < '0' ||
							cellStr[cellNumIndex] > '9')
							break;
					++cellNumIndex;
					Debug.log("cellNumIndex=" + cellNumIndex + " - " + cellStr.substr(cellNumIndex));
					cellNum = cellStr.substr(cellNumIndex) | 0;
					Debug.log("cellNum=" + cellNum);

					if (uniquely) 
					{
						if (uniqueCellNumIndex < 0) //take starting value from cell
							uniqueCellNumIndex = cellNum;
						else 
						{
							uniqueCellNumIndex += incrementNum;
							cellNum = uniqueCellNumIndex;
						}
					}
					else
						cellNum += incrementNum;

					Debug.log("newNum=" + cellNum);

					cells[c].innerHTML = cellStr.substr(0, cellNumIndex) + cellNum;
				}
			}

			versionHasChanged();
		} //end configIncrementByReplace()

		//==============================================================================
		//tableReplace ~~
		function tableReplace() 
		{
			editCellOK(); //editCellCancel();
			var target = document.getElementById("findAndReplaceTarget").value;
			var needle = document.getElementById("findAndReplaceNeedle").value;
			var convertEl = document.getElementById("findAndReplaceHTML");

			//convert needle to HTML for search
			convertEl.innerHTML = "";
			convertEl.appendChild(document.createTextNode(needle));
			needle = convertEl.innerHTML; //converted text

			var replaceStr = document.getElementById("findAndReplaceWith").value;

			//convert replaceStr to HTML for search
			convertEl.innerHTML = "";
			convertEl.appendChild(document.createTextNode(replaceStr));
			replaceStr = convertEl.innerHTML; //converted text

			Debug.log("tableReplace '" + needle + "' with '" + replaceStr + "' @ " + target);

			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");
			var cells;
			var cols = rows[_CONFIG_DATA_ROW_OFFSET - 1].getElementsByTagName("th");
			var cellStr, tmpStr;
			var needleStartIndex;
			for (var r = _CONFIG_DATA_ROW_OFFSET; r < rows.length; ++r) //skip header rows
			{
				cells = rows[r].getElementsByTagName("td");

				for (var c = _CONFIG_DATA_COL_OFFSET; c < cells.length; ++c) //skip row index column
				{
					//skip if not target column
					if (target != "*" && cols[c].innerHTML != target) continue;

					cellStr = cells[c].innerHTML;
					tmpStr = cellStr;
					Debug.log("[" + r + "," + c + "]=" + cellStr);
					needleStartIndex = 0;
					while (cellStr.indexOf(needle, needleStartIndex) >= 0) 
					{
						cellStr = cellStr.replace(needle, replaceStr);
						if (cellStr == tmpStr) break; //in case replace is same as needle
						Debug.log("REPLACED=" + cellStr);
						needleStartIndex += replaceStr.length;
					}
					cells[c].innerHTML = cellStr;
				}
			}

			versionHasChanged();
		} //end tableReplace()

		//==============================================================================
		function versionHasChanged(attemptedVersion) 
		{
			if (!_versionIsChanged) 
			{
				_versionIsChanged = true;

				//give button for saving changes

				//get rid of all first save buttons (for temporary views)
				var el = document.getElementById("config-firstSaveButton");
				while (el) 
				{
					el.parentNode.removeChild(el);
					el = document.getElementById("config-firstSaveButton");
				}

				var newDiv = document.createElement("div");
				str = "";
				str += "<input type='button' onmouseup='popUpSaveNewTableForm()' " +
					"value='Save Changes as New Version' title='" +
					"Save the current table view as new persitent version." +
					"'/>";
				str += " ";
				str += "<input type='button' onmouseup='saveTableAsNewVersion(1)' " +
					"value='Save Changes as Temporary Version' title='" +
					"Save the current table view as new temporary version." +
					"'/>";
				
				//add loose column match load link
				if((attemptedVersion !== undefined && attemptedVersion >= 0) ||
						(_version !== undefined && _version >= 0))
				{		
					var backLinkStr = _tableViewBackLinkStr;
					//Note: be careful with the source of backLinkStr.. don't use both quote styles!
					if (backLinkStr.indexOf("'") >= 0)
						backLinkStr = backLinkStr.replace(/'/g, "\\\"");
					else
						backLinkStr = backLinkStr.replace(/"/g, "\\\"");
					Debug.log("Back-link = " + backLinkStr);

					str += "&nbsp;&nbsp;&nbsp;";				
					str += "<a onclick='setupSpecificTable(\"" + 
							_currentTableName + "\",\"" +
							(attemptedVersion?attemptedVersion:_version) + 
							"\",\"" + backLinkStr +
							"\" /*backlink*/, 1 /*allowIllegalColumns*/); return false' " +
							"title='Reload " + _currentTableName + "-v" +
							(attemptedVersion?attemptedVersion:_version) + 
							" with loose column matching.' " +
							">" +
							"Reload v" + (attemptedVersion?attemptedVersion:_version) +
							" with loose column matching</a>";
				}
				
				str += "<br><br>";

				newDiv.innerHTML = str;
				newDiv.style.whiteSpace = "nowrap";

				//insert a new div before and after table
				el = document.getElementById("display");
				var targetEl = document.getElementsByClassName("tableView-Menu");
				el.insertBefore(newDiv, targetEl[0]);
				newDiv = document.createElement("div");
				newDiv.innerHTML = "<br>" + str;
				newDiv.style.whiteSpace = "nowrap";
				el.appendChild(newDiv);
			}
		} //end versionHasChanged()

		//==============================================================================
		//treeViewGroupMemberEditMultiSelectHandler ~~
		//	called when a uid is selected or deselected
		function treeViewGroupMemberEditMultiSelectHandler(sel) 
		{
			var i = MultiSelectBox.getSelectedIndex(sel);
			var selArr = MultiSelectBox.getSelectionArray(sel);
			//			MultiSelectBox.dbg("ms Chosen element index:",i,
			//					"=", selArr[i],
			//					" value:",sel.innerText);
			//			for(var s in selArr)
			//				MultiSelectBox.dbg("ms selected [" + s + "]: ",
			//						selArr[s]);

			//show uid info box			
			var el = document.getElementById("treeView-editLink-uidInfo");
			el.style.display = "block";

			if (treeEditingGroupMembersLastSelect_ == sel.textContent)
				return; //already shown uid values

			if (!_editingCellEl) return; //something interrupted process

			treeEditingGroupMembersLastSelect_ = sel.textContent;

			el.innerHTML = ""; //clear

			var modifiedTables = ""; //csv table, temporay version,...
			for (var j = 0; j < treeMemberNames_.length; ++j)
				if ((treeMemberVersions_[j] | 0) < -1)
				{
					if (modifiedTables.length)
						modifiedTables += ",";
					modifiedTables += treeMemberNames_[j];
					modifiedTables += ",";
					modifiedTables += treeMemberVersions_[j];
				}

			DesktopContent.XMLHttpRequest("Request?RequestType=getTreeView" +
				"&tableGroup=" + treeGroupName_ +
				"&tableGroupKey=" + treeGroupKey_ +
				"&hideStatusFalse=" + 1 +
				"&depth=1",
				"startPath=" + "/" +
				_editingCellEl.getElementsByTagName("select")[0].value + "/" +
				treeEditingGroupMembersLastSelect_ + "/" +
				"&modifiedTables=" + modifiedTables,
				function (req) 
				{
					var err = DesktopContent.getXMLValue(req, "Error");
					if (err) 
					{
						el.innerHTML = "Error occurred.";
						return;
					}

					var warn = DesktopContent.getXMLValue(req, "Warning");
					if (warn) 
					{
						el.innerHTML = "Warning occurred.";
						return;
					}

					var str = "";

					str += "<u>UID '" + sel.textContent + "' values:</u><br>";
					str += "<div id='clearDiv' style='margin-top:10px'></div>"; //little padding
					var children = req.responseXML.getElementsByTagName("node");
					for (var j = 0; j < children.length; ++j) {
						//must all be value/link nodes					
						str += "<b class='bold-header' style='color:rgb(65, 86, 146);'>" +
							DesktopContent.getXMLValue(children[j]) + "</b>";
						str += " : ";
						str += DesktopContent.getXMLValue(children[j].children[0]);
						str += "<br>";
					}

					el.innerHTML = str;
				},
				0, 0, true); //reqParam, progressHandler, callHandlerOnErr
		} //end treeViewGroupMemberEditMultiSelectHandler()

		//==============================================================================
		//selectThisTreeNode ~~
		function selectThisTreeNode(idString, type, event) 
		{
			if (event) //stop the body from also calling onmouseup and cancelling select
			{
				event.stopPropagation();

				Debug.log(_mouseIsSelecting);
				if (_mouseIsSelecting) //block select if mouse is selecting text currently 
				{
					_mouseIsSelecting = false;
					Debug.log(_mouseIsSelecting);
					return;
				}
			}

			//if column type is Author or Timestamp, don't allow select
			//			el.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id
			//			"treeNode-ChildrenOf-0-0-ARTDAQDataLoggerTable"

			var el = 0;

			if (type == "table" || type == "link-comment") 
			{
				treeEditingNodeType_ = type;

				//edit table comment
				el = document.getElementById("treeNode-TableComment-" + idString);
				_editingCellElOldValue = el.textContent;
				var initVal = _editingCellElOldValue.substr(2).trim();
				treeEditingNodeInitValue_ = initVal;

				//add input into element
				var str = "";
				str += "<input type='text' onkeydown='keyHandler(event)' style='margin:-4px -2px -4px -1px;width:" +
					(el.offsetWidth > 150 ? el.offsetWidth : 150) + "px; height:" + (el.offsetHeight > 20 ? el.offsetHeight : 20) + "px' value='";
				str += encodeHTML(initVal);
				str += "' onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
					"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting); event.stopPropagation();' " +
					">";

				str += _OK_CANCEL_DIALOG_STR;

				el.innerHTML = str;

				//select text in new input
				ConfigurationAPI.setCaretPosition(el.getElementsByTagName("input")[0], 0, initVal.length);
			}
			else if (type == "uid") 
			{
				treeEditingNodeType_ = type;

				//edit record uid
				el = document.getElementById("treeNode-Value-" + idString);
				_editingCellElOldValue = el.textContent;
				treeEditingNodeInitValue_ = _editingCellElOldValue;

				var str = "";
				str += "<table cellpadding='0' cellspacing='0' border='0'><tr>";
				str += "<td>";
				str += "<input type='text' onkeydown='keyHandler(event)' style='margin:-4px -2px -4px -1px;width:" +
					(el.offsetWidth > 150 ? el.offsetWidth : 150) + "px; height:" + (el.offsetHeight > 20 ? el.offsetHeight : 20) + "px' value='";
				str += encodeHTML(_editingCellElOldValue);
				str += "' onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
					"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting); event.stopPropagation();' " +
					">";
				str += "</td><td>";
				str +=
					"<div class='treeNode-deleteIcon' " +
					"onmouseup='event.stopPropagation();' " +
					"onclick='event.stopPropagation();" +
					"DesktopContent.popUpVerification(" +
					"\"Are you sure you want to delete the record associated with the UID &apos;" +
					treeEditingNodeInitValue_ + "&apos; from the table &apos;" +
					treeEditingTargetTable_ + "&apos;?\"," +
					"function() {" +
					"treeEditingNodeType_ = \"delete-uid\";" +
					"editTreeNodeOK();" +
					"},0,\"#efeaea\",0,\"#770000\",0,250);' " + //val, bgColor, textColor, borderColor, getUserInput, dialogWidth)
					"title='Delete the record associated with this UID node.' " +
					"></div>";
				str += "</td></tr></table>";

				str += _OK_CANCEL_DIALOG_STR;

				el.innerHTML = str;

				//select text in new input
				ConfigurationAPI.setCaretPosition(el.getElementsByTagName("input")[0], 0, _editingCellElOldValue.length);
			}
			else if (type == "value") 
			{
				treeEditingNodeType_ = type;

				//edit column entry in record
				//	data type matters here, also don't edit author, timestamp
				el = document.getElementById("treeNode-Value-leafNode-" + idString);
				var vel = document.getElementById("treeNode-Value-" + idString);

				//if value node, dataType is in element class name
				var colType = vel.className.split(' ')[1].split('-');
				if (colType[1] == "ValueType")
					colType = colType[2];

				//Debug.log("el.className=" + vel.className);
				Debug.log("colType=" + colType);

				if (colType == "Author" ||
					colType == "Timestamp") 
				{
					Debug.log("Can not edit Author or Timestamp fields.",
						Debug.WARN_PRIORITY);
					return false;
				}

				var str = "";
				var optionIndex = -1;

				if (colType == "YesNo" ||
					colType == "TrueFalse" ||
					colType == "OnOff")  //if column type is boolean, use dropdown
				{
					treeEditingNodeType_ += "-bool";
					_editingCellElOldValue = el.innerHTML;

					var initVal = el.childNodes[0].textContent;
					treeEditingNodeInitValue_ = initVal;

					var boolVals = [];
					if (colType == "YesNo")
						boolVals = ["No", "Yes"];
					else if (colType == "TrueFalse")
						boolVals = ["False", "True"];
					else if (colType == "OnOff")
						boolVals = ["Off", "On"];


					str += "<select  onkeydown='keyHandler(event)' " +
						"onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
						"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting); event.stopPropagation();' " +
						"onclick='event.stopPropagation();'" +
						"style='margin:-4px -2px -4px -1px; height:" + (el.offsetHeight + 6) + "px'>";
					for (var i = 0; i < boolVals.length; ++i) 
					{
						str += "<option value='" + boolVals[i] + "'>";
						str += boolVals[i];	//can display however
						str += "</option>";
						if (boolVals[i] == initVal)
							optionIndex = i; //get starting sel index					
					}
					str += "</select>";
					if (optionIndex == -1) optionIndex = 0; //use False option by default					
				}
				else if (colType == "FixedChoiceData")
				{
					_editingCellElOldValue = el.textContent;
					treeEditingNodeInitValue_ = _editingCellElOldValue;

					var allowFixedChoiceArbitraryEdit = false;
					var optionCount = -1;
					optionIndex = 0; //default to default

					str += "<div onkeydown='keyHandler(event)' " +
						"onmouseup='event.stopPropagation();' " +
						"onclick='event.stopPropagation();' " +
						"style='" +
						"white-space:nowrap;" +
						"margin:-3px -2px -2px -1px;" +
						"height:" + (el.offsetHeight + 6) + "px'>";

					str += "<select  onkeydown='keyHandler(event)' " +
						"id='fixedChoice-editSelectBox' " +
						"onmouseup='event.stopPropagation();' " +
						"onclick='event.stopPropagation();' " +
						"style='" +
						"float:left;" +
						"margin: -2px 1px 0px 0px; " +
						"height:" + (el.offsetHeight + 6) + "px'>";

					//default value is assumed in list

					var vel = document.getElementById("treeNode-FixedChoice-CSV-" +
						idString);
					var choices = vel.textContent.split(',');
					var choice;
					optionIndex = -1;
					for (var i = 0; i < choices.length; ++i)
					{
						choice = decodeURIComponent(choices[i]);
						if (i == 1)//check for arbitraryBool flag
						{
							if (choice.indexOf("arbitraryBool=") == 0) 
							{
								//found arbitraryBool flag								
								allowFixedChoiceArbitraryEdit =
										choice[("arbitraryBool=").length] == "1" ?
										true : false;
								Debug.log("allowFixedChoiceArbitraryEdit " + allowFixedChoiceArbitraryEdit);
								continue;
							}
							else {
								//else no flag found, so treat as fixed choice option
								++optionCount; //count as an option in dropdown
							}
						}
						else
							++optionCount; //count as an option in dropdown

						str += "<option>";
						str += ConfigurationAPI.encodeHTML(choice);	//can display however
						str += "</option>";
						if (choice == _editingCellElOldValue)
							optionIndex = optionCount; //save selected index
					}
					if(optionIndex == -1)
					{ 
						if(allowFixedChoiceArbitraryEdit && 
								_editingCellElOldValue.length)
						{
							str += "<option>";
							str += ConfigurationAPI.encodeHTML(_editingCellElOldValue); //can display however
							str += "</option>";
							optionIndex = optionCount+1; //last index
						}
						else 
							optionIndex = 0; //default to default
					}		
					str += "</select>";

					if (allowFixedChoiceArbitraryEdit) 
					{
						var ww = (el.offsetWidth - 6);
						if (ww < 150) ww = 150;
						str += "<input type='text' " +
							"id='fixedChoice-editTextBox' " +
							"style='display:none;" +
							"float:left;" +
							"margin:-2px 0 -" + (el.offsetHeight + 6) + "px 0;" +
							"width:" +
							ww + "px; height:" + (el.offsetHeight + 6) + "px" +
							"'>";
						str += "";
						str += "</input>";

						str += "<div style='display:block;" +
							"margin: -2px 0 -7px 14px;" +
							"' " +
							"class='treeNode-Value-editIcon' id='fixedChoice-editIcon" +
							"' " +
							"onclick='handleFixedChoiceEditToggle();' " +
							"title='Toggle free-form editing' " +
							"></div>";
					}
					str += "</div>";
				}
				else if (colType == "BitMap") 
				{
					Debug.log("Handling bitmap select");

					_editingCellElOldValue = el.textContent;

					//let API bitmap dialog handle it
					ConfigurationAPI.bitMapDialog(
						//_editingCellElOldTitle, //field name
						"Target UID/Field: &quot;" +
						treeEditingTargetUID_ + "/" +
						treeEditingTargetColumn_ + "&quot;",
						document.getElementById("treeNode-BitMap-Params-" +
							idString).textContent.split(';'),
						_editingCellElOldValue,
						function (val) 
						{
							Debug.log("yes " + val);
							el.innerHTML = "";
							el.appendChild(document.createTextNode(val));
							_editingCellEl = el;

							treeEditingNodeType_ += "-bitmap";
							editTreeNodeOK();
							//_editingCell = false;
							//_editingCellEl = 0;

							//treeHasChanged();		
						},
						function () //cancel handler
						{
							//remove the editing cell selection
							Debug.log("no");
							_editingCell = false;
							_editingCellEl = 0;
						});
					return true;
				}
				else if (colType == "MultilineData")
				{
					_editingCellElOldValue = el.textContent;
					treeEditingNodeInitValue_ = _editingCellElOldValue;

					var ow = el.offsetWidth - 6;
					if (ow < 150) //force a minimum input width
						ow = 150;
					str += "<textarea rows='4' onkeydown='keyHandler(event)' cols='50' style='font-size: 14px; margin:-4px -2px -4px -1px;width:" +
						(ow) + "px; height:" + (el.offsetHeight - 8) + "px' ";
					str += " onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
						"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting);event.stopPropagation();' " +
						"onclick='event.stopPropagation();'" +
						">";
					str += _editingCellElOldValue;
					str += "</textarea>";
				}
				else // normal cells, with text input
				{
					if (colType == "GroupID") //track type if it is groupid field
						treeEditingNodeType_ += "-groupid";

					_editingCellElOldValue = el.textContent;
					treeEditingNodeInitValue_ = _editingCellElOldValue;

					var ow = el.offsetWidth + 6;
					if (ow < 150) //force a minimum input width
						ow = 150;
					str += "<input type='text' onkeydown='keyHandler(event)' style='margin:-4px -2px -4px -1px;width:" +
						(ow) + "px; height:" + (el.offsetHeight > 20 ? el.offsetHeight : 20) + "px' value='";
					str += encodeHTML(_editingCellElOldValue);
					str += "' onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
						"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting);event.stopPropagation();' " +
						"onclick='event.stopPropagation();'" +
						">";
				}


				str += _OK_CANCEL_DIALOG_STR;

				el.innerHTML = str;

				//handle default selection
				if (colType == "YesNo" ||
					colType == "TrueFalse" ||
					colType == "OnOff")  //if column type is boolean, use dropdown
				{					//select initial value
					el.getElementsByTagName("select")[0].selectedIndex = optionIndex;
					el.getElementsByTagName("select")[0].focus();
				}
				else if (colType == "FixedChoiceData") 
				{
					el.getElementsByTagName("select")[0].selectedIndex = optionIndex;
					el.getElementsByTagName("select")[0].focus();
				}
				else if (colType == "MultilineData")
					ConfigurationAPI.setCaretPosition(el.getElementsByTagName("textarea")[0], 0, _editingCellElOldValue.length);
				else 					//select text in new input
					ConfigurationAPI.setCaretPosition(el.getElementsByTagName("input")[0], 0, _editingCellElOldValue.length);

			}
			else if (type == "link" ||
				type == "link-disconnected")
			{

				//edit link entry in record (2 columns: link table and id)							
				el = document.getElementById("treeNode-Value-" + idString);

				//hide nav menu
				document.getElementById("treeNode-LinkContextMenuTD-" +
					idString).style.display = "none";

				var linkIdType;
				var linkInitId;
				_editingCellElOldValue = el.innerHTML;
				if (type == "link-disconnected") 
				{
					linkIdType = document.getElementById("treeNode-linkIdType-" + idString).textContent;
					linkInitId = document.getElementById("treeNode-linkId-" + idString).textContent;
				}
				else 
				{
					linkIdType = el.textContent.split('(')[1].split(' ')[0];
					linkInitId = el.textContent.split(')')[0].split('=')[1].substr(1);
				}


				var linkTable = document.getElementById("treeNode-linkTableName-" + idString);
				if (linkTable)
					linkTable = linkTable.textContent;
				else
					linkTable = "";
				var linkIndex = document.getElementById("treeNode-childLinkIndex-" + idString).textContent;

				Debug.log("linkTable " + linkTable);
				Debug.log("linkIdType " + linkIdType); // "UID" or "GroupID"
				Debug.log("linkInitId " + linkInitId);  //the ID
				Debug.log("linkIndex " + linkIndex);  //the link index

				treeEditingNodeType_ = "link"; //get rid of "disconnected"
				treeEditingNodeType_ += "-" + linkIdType;
				treeEditingNodeInitValue_ = linkTable + "," + linkInitId;

				var optionIndex = -1;

				selectLinkTableName = linkTable;
				selectLinkId = linkInitId;

				var firstTimeMembers = true;

				//////////////////////////
				//localGetLinkToChoices
				//	used to repeatedly get link-to-choices
				//		when selections change
				//		save last successfull table index to optionIndex
				function localGetLinkToChoices() 
				{
					//////////////////////////
					//localCreateLinkEditHTML ~~
					//	creates edit link html based on linkToChoices
					//	and selectLinkTableName
					function localCreateLinkEditHTML(linkToChoices, groupMembers, groupChoices)
					{
						var str = "";


						//////////////////////////
						//localSetupGroupMemberEdit ~~~~
						//	setup add/remove group members controls
						//	parameters are member uids and all possible uids
						function localSetupGroupMemberEdit()
						{
							Debug.log("localSetupGroupMemberEdit " +
								groupMembers.length + " of " +
								groupChoices.length);

							//new element with multi-select box of UID members
							var nel = document.getElementById('treeView-groupMemberEditDiv');
							nel.onclick = function (event) { event.stopPropagation(); }
							nel.onmouseup = function (event) { event.stopPropagation(); }


							//////////// make search box
							{
								var noMultiSelect = false; // true or false (false for multiselect functionality) 

								var msValues = []; 	//group names for multi-select
								var msKeys = []; 	//group keys for multi-select
								var msTypes = [];	//back link strings for multi-select

								treeEditingInitGroupMembers_ = [];
								treeEditingGroupMembersLastSelect_ = "";

								for (var i = 0; i < groupChoices.length; ++i) 
								{
									msValues.push(
										DesktopContent.getXMLValue(groupChoices[i])
									);
								}



								//write to a particular div
								MultiSelectBox.createSelectBox(nel,
									"treeViewGroupUIDs",
									"Select Group Members:",
									msValues, msValues, msValues,
									treeViewGroupMemberEditMultiSelectHandler,
									noMultiSelect,
									treeViewGroupMemberEditMultiSelectHandler);



								//set pre-selections for uids already in group
								MultiSelectBox.initMySelectBoxes(true); //init to clear
								var memberVal;
								for (var i = 0; i < groupMembers.length; ++i)
								{
									memberVal = DesktopContent.getXMLValue(groupMembers[i]);
									for (var j = 0; j < msValues.length; ++j)
										if (msValues[j] == memberVal)
										{
											//found member!
											MultiSelectBox.setSelectionElementByIndex(
												nel, j, true);
											treeEditingInitGroupMembers_.push(msValues[j]);

											if (firstTimeMembers) //append to init value the first time
												treeEditingNodeInitValue_ += "," + msValues[j];
											break;
										}
								}
								MultiSelectBox.initMySelectBoxes(false); //setup selections

								firstTimeMembers = false;
							}
							//////////// end make search box
						}


						optionIndex = -1;

						Debug.log("_tableLinkDropdownChoices " + _tableLinkDropdownChoices.length);

						str += "<label style='color:rgb(65, 86, 146);font-weight:bold;'>" +
							treeEditingTargetColumn_ + "</label>" + "<br>";

						str += "<table cellpadding='0' cellspacing='0' border='0' " +
							"onmouseup='event.stopPropagation();' " +
							"onclick='event.stopPropagation();' " +
							"><tr>";
						str += "<td style='text-align:right'>Table:</td><td>";
						str += "<select  onkeydown='keyHandler(event,this)' " +
							"onmouseup='event.stopPropagation();'" +
							"onclick='event.stopPropagation();'" +
							"style='" +
							"height:" + (29) + "px'>";

						//check if there are choices
						//	if so, use only those provided
						var choicesEl = document.getElementById("treeNode-FixedChoice-CSV-" +
							treeEditingNodeIdString_);
						var choices;
						var useAllTables = true;
						if (choicesEl) 
						{
							choices = choicesEl.textContent.split(',');
							if (choices[0] != "arbitraryBool=0") //make sure arbitrary is disabled
								useAllTables = true;
							else
								useAllTables = false;
						}

						if (useAllTables)
							choices = _tableLinkDropdownChoices;

						//if not using all tables, skip the arbitraryBool
						for (var i = useAllTables ? 0 : 1; i < choices.length; ++i)
						{
							str += "<option value='" + choices[i]
								+ "'>";
							str += choices[i];	//can display however
							str += "</option>";
							if (choices[i] == selectLinkTableName)
								optionIndex = i - (useAllTables ? 0 : 1); //get starting sel index
						}
						str += "</select>";
						str += "</td></tr><tr>";

						str += "<td style='text-align:right'>";
						str += linkIdType + ":";
						str += "</td><td>";

						//start new table for select and editIcon
						str += "<table cellpadding='0' cellspacing='0' border='0'><tr><td>";

						str += "<select  onkeydown='keyHandler(event,this)' " +
							"id='editTree-groupIdFreeform-select' " +
							"onmouseup='event.stopPropagation();'" +
							"onclick='event.stopPropagation();'" +
							"style='" +
							"height:" + (29) + "px'>";
						var linkToChoice;
						var linkToOptionIndex = -1; //init
						for (var i = 0; i < linkToChoices.length; ++i) 
						{
							linkToChoice = DesktopContent.getXMLValue(linkToChoices[i]);
							str += "<option value='" + linkToChoice + "'>";
							str += linkToChoice;	//can display however
							str += "</option>";
							if (linkToChoice == selectLinkId)
								linkToOptionIndex = i; //get starting sel index
						}
						if(linkToOptionIndex == -1)
						{ 
							if(true /*allowFixedChoiceArbitraryEdit*/ && 
									selectLinkId.length)
							{
								str += "<option value='" + 
										ConfigurationAPI.encodeHTML(selectLinkId)
														+ "'>";
								str += ConfigurationAPI.encodeHTML(selectLinkId); //can display however
								str += "</option>";
								linkToOptionIndex = linkToChoices.length; //last index
							}
							else 
								linkToOptionIndex = 0; //default to default
						}		
						str += "</select>";

						str += "<input type='text' " +
							"id='editTree-groupIdFreeform-input' " +
							"style='display:none; margin:2px; width:150px; height:" +
							(19) + "px'>";
						str += "";
						str += "</input>";

						str += "</td><td>";

						str += "<div style='display:block' " +
							"class='treeNode-Value-editIcon' " +
							"id='editTree-groupIdFreeform-editIcon' " +
							"onmouseup='event.stopPropagation();'" +
							"onclick='handleEditTreeGroupIDEditFreeformToggle();event.stopPropagation();' " +
							"title='Toggle free-form GroupID editing' " +
							"></div>";
						str += "</td></tr></table>"; //end select and editIcon table

						str += "</td></tr></table>";

						if (linkIdType == "GroupID")		//add extra group-link stuff	
						{
							str += "<div id='clearDiv'></div>";
							str += "<div id='treeView-groupMemberEditDiv' " +
								"style='height:200px; width:250px;" +
								//"margin-bottom: 0px;" +
								"margin: -20px 0 -5px 0;'"; //margin messes up error printing
							"'";
							str += ">";
							str += "</div>";

							//link for new default record in group
							str += "<a onmouseup='event.stopPropagation();' " +
								"id='treeView-editGroupLink-uidCreate' " +
								"style='" +
								"position: absolute;" +
								"left: 300px; top: 80px;" +
								"z-index: 10;" +
								"white-space: nowrap; text-decoration: underline;" +
								"' " + //end style
								"onclick='event.stopPropagation(); " +
								"treeEditingNodeType_ = \"table-newGroupRow\";" +
								"editTreeNodeOK();" +
								"'" +
								">";
							str += "Create a new Default Record in Group";
							str += "</a>";

							//uid info box
							str += "<div id='treeView-editLink-uidInfo' " +
								"onclick='event.stopPropagation();' onmouseup='event.stopPropagation();'" +
								"style='" +
								"height: 148px; width: 350px; position: absolute; " +
								"display: none; background-color: rgb(193, 152, 152); " +
								"left: 300px; top: 100px; border-radius: 5px; cursor: auto;" +
								"padding: 10px; overflow: auto; white-space: nowrap;" +
								"z-index: 10;" +
								"'>";

						}
						else if (linkIdType == "UID")		//add extra UID-link stuff	
						{
							str += "<div id='clearDiv'></div>";

							//backgroun box
							str += "<div style='" +
								"position: absolute;" +
								"left: 170px; top: 76px; " +
								"height: 199px; width:389px;" +
								"background-color: rgb(226, 216, 216);" +
								"border-radius: 5px;" +
								"z-index: 10;" +
								"border: 1px solid rgb(153, 153, 153);" +
								"'" +
								"></div>";
							//link for new default record in group
							str += "<a onmouseup='event.stopPropagation();' " +
								"id='treeView-editUIDLink-uidCreate' " +
								"style='" +
								"position: absolute;" +
								"left: 180px; top: 80px;" +
								"z-index: 10;" +
								"white-space: nowrap; text-decoration: underline;" +
								"' " + //end style
								"onclick='event.stopPropagation(); " +
								"treeEditingNodeType_ = \"table-newUIDRow\";" +
								"editTreeNodeOK();" +
								"'" +
								">";
							str += "Create a new Default Record in Linked Table";
							str += "</a>";

							//uid info box
							str += "<div id='treeView-editLink-uidInfo' " +
								"onclick='event.stopPropagation();' onmouseup='event.stopPropagation();'" +
								"style='" +
								"height: 148px; width: 350px; position: absolute; " +
								"display: none; background-color: rgb(193, 152, 152); " +
								"left: 180px; top: 100px; border-radius: 5px; cursor: auto;" +
								"padding: 10px; overflow: auto; white-space: nowrap;" +
								"z-index: 10;" +
								"'>";

						}

						str += "</div>";

						str += _OK_CANCEL_DIALOG_STR;

						el.innerHTML = str;

						//select initial value
						var sel = el.getElementsByTagName("select")[0];
						var selId = el.getElementsByTagName("select")[1];
						var telId = el.getElementsByTagName("input")[0];
						sel.selectedIndex = optionIndex;
						if (linkToChoices.length) 
						{
							selId.selectedIndex = linkToOptionIndex;
							selId.focus();
						}
						else
							selId.disabled = true;

						//////
						//localLinkEditSelectOnChangeHandler ~~
						//	handle change of dropdowns
						function localLinkEditSelectOnChangeHandler(event, setLinkId) 
						{
							selectLinkTableName = sel.value;
							if (setLinkId)
								selectLinkId = setLinkId;
							else if (selId.style.display != "none")
								selectLinkId = selId.value;
							else //take from text edit input, this happens after a save when forced change is propagated
								selectLinkId = telId.value;

							Debug.log("Select table changed: " + selectLinkTableName +
								" - " + selectLinkId);
							localGetLinkToChoices(); //re-request the linkToChoices
						};

						sel.onchange = localLinkEditSelectOnChangeHandler;
						selId.onchange = localLinkEditSelectOnChangeHandler;

						if (linkIdType == "GroupID")		//add extra group-link stuff					
							localSetupGroupMemberEdit();
						else if (linkIdType == "UID" &&
							!selId.disabled)		//add extra UID-link stuff
						{
							//sneak peak the chosen UID

							//show uid info box			
							var uel = document.getElementById("treeView-editLink-uidInfo");
							uel.style.display = "block";
							Debug.log("sneak peak UID");

							var modifiedTables = ""; //csv table, temporay version,...
							for (var j = 0; j < treeMemberNames_.length; ++j)
								if ((treeMemberVersions_[j] | 0) < -1) {
									if (modifiedTables.length)
										modifiedTables += ",";
									modifiedTables += treeMemberNames_[j];
									modifiedTables += ",";
									modifiedTables += treeMemberVersions_[j];
								}

							DesktopContent.XMLHttpRequest("Request?RequestType=getTreeView" +
								"&tableGroup=" + treeGroupName_ +
								"&tableGroupKey=" + treeGroupKey_ +
								"&hideStatusFalse=" + 1 +
								"&depth=1",
								"startPath=" + "/" +
								_editingCellEl.getElementsByTagName("select")[0].value + "/" +
								selId.value + "/" +
								"&modifiedTables=" + modifiedTables,
								function (req) {
									var err = DesktopContent.getXMLValue(req, "Error");
									if (err) {
										uel.innerHTML = "Error occurred.";
										return;
									}

									var warn = DesktopContent.getXMLValue(req, "Warning");
									if (warn) {
										uel.innerHTML = "Warning occurred.";
										return;
									}

									var str = "";

									str += "<u>UID '" + selId.value + "' values:</u><br>";
									str += "<div id='clearDiv' style='margin-top:10px'></div>"; //little padding
									var children = req.responseXML.getElementsByTagName("node");
									for (var j = 0; j < children.length; ++j) {
										//must all be value/link nodes					
										str += "<b class='bold-header' style='color:rgb(65, 86, 146);'>" +
											DesktopContent.getXMLValue(children[j]) + "</b>";
										str += " : ";
										str += DesktopContent.getXMLValue(children[j].children[0]);
										str += "<br>";
									}

									uel.innerHTML = str;
								},
								0, 0, true); //reqParam, progressHandler, callHandlerOnErr
						}

					} //end of localCreateLinkEditHTML definition


					var linkTableVersion = -1;
					for (var j = 0; j < treeMemberNames_.length; ++j)
						if (selectLinkTableName == treeMemberNames_[j])
						{
							linkTableVersion = treeMemberVersions_[j];
							break;
						}
					if (linkTableVersion == -1)
					{
						//if there is no valid table name, 
						//	then jump to html creation

						Debug.log("Invalid tree member table targeted, could not find able '" +
							treeEditingTargetTable_ + "' in the list of tree tables. " +
							"Perhaps the tree needs to be refreshed? " +
							"Or the table needs to be added to one of the active groups?");//,Debug.HIGH_PRIORITY);

						localCreateLinkEditHTML([], [], []);
						return;
					}

					//get possible choices for 
					//	link table, link type, and link index
					//... from server:
					DesktopContent.XMLHttpRequest("Request?RequestType=getLinkToChoices" +
						"&linkToTableName=" + selectLinkTableName +
						"&linkToTableVersion=" + linkTableVersion +
						"&linkIdType=" + linkIdType +
						"&linkIndex=" + linkIndex +
						"&linkInitId=" + selectLinkId,
						"", function (req) 
						{
							var err = DesktopContent.getXMLValue(req, "Error");
							if (err) 
							{
								Debug.log(err, Debug.HIGH_PRIORITY);

								//do not kill edit if worked before.. 
								//	in case user is playing with tables
								//revert to last successful table selection							
								if (optionIndex == -1) 
								{
									editCellCancel();
								}
								else 
								{
									Debug.log("Reverting back to previous table selection.",
										Debug.HIGH_PRIORITY);
									el.getElementsByTagName("select")[0].selectedIndex = optionIndex;
								}

								return;
							}

							var linkToChoices = req.responseXML.getElementsByTagName("linkToChoice");
							var groupMembers = req.responseXML.getElementsByTagName("groupMember");
							var groupChoices = req.responseXML.getElementsByTagName("groupChoice");

							//group links also need table version in init value
							if (treeEditingNodeType_ == "link-GroupID" &&
								firstTimeMembers)
								treeEditingNodeInitValue_ += "," + linkTableVersion;

							localCreateLinkEditHTML(linkToChoices, groupMembers, groupChoices);


						}, 0, 0, true //reqParam, progressHandler, callHandlerOnErr
					); //end of getLinkToChoices handler
				}; //end of localGetLinkToChoices definition

				localGetLinkToChoices(linkTable);

			}

			_editingCell = true;
			_editingCellEl = el;

			_editingCellElOldTitle = el.title;
			el.title = "";

			return true;
		} //end selectThisTreeNode()

		//==============================================================================
		//selectThisCell ~~
		function selectThisCell(r, c, el, event)
		{
			_editingCellElOldTitle = el.title; //originally only used by tree, but 
			//table cells have title now too

			if (event) //stop the body from also calling onmouseup and cancelling select
			{
				event.stopPropagation();

				//Debug.log(_mouseIsSelecting);
				if (_mouseIsSelecting) //block select if mouse is selecting text currently 
				{
					_mouseIsSelecting = false;
					//Debug.log(_mouseIsSelecting);
					return;
				}
			}

			if (_editingCell) //already have the edit box open, cancel it
			{
				if (_editingCellEl == el) //if same cell do nothing
					return true;
				editCellOK(); //editCellCancel(); //if new cell cancel
			}

			var tableEl = document.getElementById("SubSystemTable");
			var rows = tableEl.getElementsByTagName("tr");

			//if column type is Author or Timestamp, don't allow select
			var colType;
			if (_tableViewIsTransposed) 	//type is at col 0
				colType = rows[_CONFIG_DATA_COL_OFFSET + c].getElementsByTagName("td")[0].childNodes[0].innerHTML.split('<')[0];
			else						//type is at row 0
				colType = rows[0].getElementsByTagName("td")[_CONFIG_DATA_COL_OFFSET + c].childNodes[0].innerHTML.split('<')[0]; //type text is in a div for smaller font			

			if (colType == "Author" ||
				colType == "Timestamp")
				return false;


			_editingCell = true;
			_editingCellEl = el;
			_editingCellPos = [r, c];
			_editingCellType = colType;

			_editingCellElOldValue = el.textContent;
			var str = "";
			var optionIndex = -1;

			Debug.log("colType=" + colType);
			Debug.log("colType.indexOf('ChildLink')" + colType.indexOf("ChildLink"));
			Debug.log("_tableLinkDropdownChoices " + _tableLinkDropdownChoices.length);

			///////////// localGetPairColumnInfo
			function localGetPairColumnInfo()
			{
				var obj = {};
				obj.success = false;

				var pairCol = c - 1;
				var colSz = _tableViewIsTransposed ? rows.length : rows[0].getElementsByTagName("td").length;
				Debug.log("Number of columns " + colSz);

				var pairColType;
				var pairColTable;
				var colTypeSplit = colType.split('-')[1];

				Debug.log("Looking for link table column matching " + colTypeSplit);

				pairCol = (pairCol + colSz) % colSz; //make a legal col					
				while (pairCol != c) 
				{
					if (_tableViewIsTransposed) 	//type is at col 0
						pairColType = rows[_CONFIG_DATA_COL_OFFSET + pairCol].getElementsByTagName("td")[0].childNodes[0].innerHTML.split('<')[0];
					else						//type is at row 0
						pairColType = rows[0].getElementsByTagName("td")[_CONFIG_DATA_COL_OFFSET + pairCol].childNodes[0].innerHTML.split('<')[0]; //type text is in a div for smaller font			

					Debug.log("pairColType=" + pairColType);

					if (pairColType.split('-')[1] == colTypeSplit) 
					{
						Debug.log("Found link pair at col " + pairCol);

						//get value of table at cell [r,pairCol]
						if (_tableViewIsTransposed) 	//type is at col 0
							pairColTable = rows[_CONFIG_DATA_COL_OFFSET + pairCol].getElementsByTagName("td")[_CONFIG_DATA_ROW_OFFSET - 1 + r].innerText;
						else						//type is at row 0
							pairColTable = rows[_CONFIG_DATA_ROW_OFFSET + r].getElementsByTagName("td")[_CONFIG_DATA_COL_OFFSET + pairCol].innerText;

						Debug.log("pairColTable=" + pairColTable);

						if (pairColTable == "NO_LINK") 
						{
							Debug.log("Invalid table name.");
							return obj;
						}

						obj.success = true;

						obj.pairCol = pairCol;
						obj.pairColType = pairColType;
						obj.pairColTable = pairColTable;

						//successfully found link info
						return obj;
					}


					--pairCol;
					pairCol = (pairCol + colSz) % colSz; //make a legal col
				}

				Debug.log("Never found link pair.");
				return obj;

			} //end localGetPairColumnInfo()


			///////////// localHandleDropdownForLinkUID
			function localHandleDropdownForLinkUID() 
			{
				Debug.log("localHandleDropdownForLinkUID");

				//find link column pair

				var linkInfo = localGetPairColumnInfo();
				if (!linkInfo.success)
					return false;

				//else have link info				

				//ready to get all UIDs
				ConfigurationAPI.getSubsetRecords(linkInfo.pairColTable,
					undefined /*filterList*/,
					function (records) 
					{

						console.log(records);

						//create dropdown

						str += "<div style='" +
							"white-space:nowrap;" +
							"margin:0px -2px -4px 1px;width:" +//"margin:-4px -2px -4px 1px;width:" + 						
							(el.offsetWidth - 6 + (1 ? 50 : 0)) +
							"px; height:" + (el.offsetHeight - 8) + "px'>";

						str += "<select  onkeydown='keyHandler(event)' " +
							"id='fixedChoice-editSelectBox' " +
							"style='" +
							"float:left;" +
							//"style='margin:-4px -2px -4px 1px;
							"width:" +
							(el.offsetWidth - 6) + "px; height:" + (el.offsetHeight - 8) + "px'>";
						optionIndex = -1;
						for (var i = 0; i < records.length; ++i)
						{
							str += "<option value='" + records[i]
								+ "'>";
							str += records[i]; //can display however
							str += "</option>";
							if (records[i]
								== _editingCellElOldValue)
								optionIndex = i; //get starting sel index
						}
						if(optionIndex == -1)
						{ 
							if(true /*allowFixedChoiceArbitraryEdit*/ && 
									_editingCellElOldValue.length)
							{
								str += "<option value='" + 
										ConfigurationAPI.encodeHTML(_editingCellElOldValue)
										+ "'>";
								str += ConfigurationAPI.encodeHTML(_editingCellElOldValue); //can display however
								str += "</option>";
								optionIndex = records.length; //last index
							}
							else 
								optionIndex = 0; //default to default
						}	
						str += "</select>";

						//add arbitrary edit
						if (true) 
						{
							str += "<input type='text' " +
								"id='fixedChoice-editTextBox' " +
								"style='display:none;" +
								"float:left;" +
								"margin:-2px 0 -" + (el.offsetHeight - 10) + "px 0;" +
								"width:" +
								((el.offsetWidth > 150 ? el.offsetWidth : 150) - 6) + "px; height:" + (el.offsetHeight - 10) + "px" +
								"'>";
							str += "";
							str += "</input>";

							str += "<div style='display:block;" +
								"margin: 2px 0 -7px 14px;" +
								"' " +
								"class='treeNode-Value-editIcon' id='fixedChoice-editIcon" +
								"' " +
								"onclick='handleFixedChoiceEditToggle();' " +
								"title='Toggle free-form editing' " +
								"></div>";
						}

						str += "</div>";

						//finish up
						Debug.log("Finishing up select cell handling...");
						localFinishUpSelectCell();
					}); //end getSubsetRecords

				//successfully requested records
				return true;
			}	//end localHandleDropdownForLinkUID


			///////////// localHandleDropdownForLinkGroupID
			function localHandleDropdownForLinkGroupID()
			{
				Debug.log("localHandleDropdownForLinkGroupID");

				//find link column pair
				Debug.log("Looking for link table column matching " + colType.split('-')[1]);

				var linkInfo = localGetPairColumnInfo();
				if (!linkInfo.success)
					return false;

				//else have link info		

				//ready to get matching groupID field in destination table
				DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificTable" +
					"&dataOffset=0&chunkSize=" + 0 +
					"&tableName=" + linkInfo.pairColTable +
					"&version=" + "-1", //get mockup 
					"",
					function (req)
					{

						var err = DesktopContent.getXMLValue(req, "Error");
						if (err) 
						{
							Debug.log(err, Debug.HIGH_PRIORITY);

							Debug.log("There were errors loading the mockup version of '" +
									linkInfo.pairColTable + "'.\n\n" +
								"Please see the detailed Errors below:", Debug.HIGH_PRIORITY);

							//try to power through
						}

						var warns = DesktopContent.getXMLValue(req, "TableWarnings");
						if (warns)
							Debug.log("There were warnings found when loading table '" +
									linkInfo.pairColTable + 
									"' (you can treat them as informational):\n\n" +
								warns, Debug.WARN_PRIORITY);

						var colTypeEls = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnType");
						var colHdrs = req.responseXML.getElementsByTagName("CurrentVersionColumnHeaders")[0].getElementsByTagName("ColumnHeader");

						var childLinkIndex = colType.split('-')[1];
						Debug.log("Looking for groupID column in linked to table matching " + 
								childLinkIndex);

						var groupIdCol = -1;
						var groupIdField;
						for (var i = 0; i < colTypeEls.length; ++i)
							if (colTypeEls[i].getAttribute("value").split('-')[1] == childLinkIndex)
							{
								groupIdField = colHdrs[i].getAttribute("value");
								Debug.log("Found link groupid col " + i + " - " + groupIdField);
								groupIdCol = i;
								break;
							}

						var groupIds = [];
						if (groupIdCol == -1)
						{
							Debug.log("No matching GroupID column found at linked to table!", Debug.HIGH_PRIORITY);
						}
						else 
						{
							//get unique values of the groupID field, for all records
							ConfigurationAPI.getSubsetRecords(linkInfo.pairColTable,
								undefined /*filterList*/,
								function (records) 
								{

									console.log(records);

									ConfigurationAPI.getUniqueFieldValuesForRecords(
										linkInfo.pairColTable,
										records,
										groupIdField,
										function (obj) 
										{
											console.log(obj);

											try 
											{
												groupIds = obj[0].fieldUniqueValueArray;
											}
											catch (e) 
											{
												Debug.log("Caught error: " + e);
											}

											localFinishGroupIdDropdown();

										}); //end getUniqueFieldValuesForRecords
								}); //end getSubsetRecords

						}

						///////////////////// localFinishGroupIdDropdown
						function localFinishGroupIdDropdown() 
						{
							//create dropdown

							str += "<div style='" +
								"white-space:nowrap;" +
								"margin:0px -2px -4px 1px;width:" +//"margin:-4px -2px -4px 1px;width:" + 						
								(el.offsetWidth - 6 + (1 ? 50 : 0)) +
								"px; height:" + (el.offsetHeight - 8) + "px'>";

							str += "<select  onkeydown='keyHandler(event)' " +
								"id='fixedChoice-editSelectBox' " +
								"style='" +
								"float:left;" +
								//"style='margin:-4px -2px -4px 1px;
								"width:" +
								(el.offsetWidth - 6) + "px; height:" + (el.offsetHeight - 8) + "px'>";
							
							optionIndex = -1;
							for (var i = 0; i < groupIds.length; ++i)
							{
								str += "<option value='" + groupIds[i]
									+ "'>";
								str += groupIds[i]; //can display however
								str += "</option>";
								if (groupIds[i]
									== _editingCellElOldValue)
									optionIndex = i; //get starting sel index
							}
							if(optionIndex == -1)
							{ 
								if(true /*allowFixedChoiceArbitraryEdit*/ && 
										_editingCellElOldValue.length)
								{
									str += "<option value='" + 
											ConfigurationAPI.encodeHTML(_editingCellElOldValue)
															+ "'>";
									str += ConfigurationAPI.encodeHTML(_editingCellElOldValue); //can display however
									str += "</option>";
									optionIndex = groupIds.length; //last index
								}
								else 
									optionIndex = 0; //default to default
							}		
							str += "</select>";

							//add arbitrary edit
							if (true) 
							{
								str += "<input type='text' " +
									"id='fixedChoice-editTextBox' " +
									"style='display:none;" +
									"float:left;" +
									"margin:-2px 0 -" + (el.offsetHeight - 10) + "px 0;" +
									"width:" +
									((el.offsetWidth > 150 ? el.offsetWidth : 150) - 6) + "px; height:" + (el.offsetHeight - 10) + "px" +
									"'>";
								str += "";
								str += "</input>";

								str += "<div style='display:block;" +
									"margin: 2px 0 -7px 14px;" +
									"' " +
									"class='treeNode-Value-editIcon' id='fixedChoice-editIcon" +
									"' " +
									"onclick='handleFixedChoiceEditToggle();' " +
									"title='Toggle free-form editing' " +
									"></div>";
							}

							str += "</div>";

							//finish up
							Debug.log("Finishing up select cell handling...");
							localFinishUpSelectCell();

						}	//end localFinishGroupIdDropdown
					}, //end getSpecificTable request handler
					0, 0, true  //reqParam, progressHandler, callHandlerOnErr
				); //end XML Request for getSpecificTable		

				//successfully requested groupID values
				return true;
			}	//end localHandleDropdownForLinkGroupID


			if (_useTableLinkDropdown &&
				colType.indexOf("ChildLink") == 0 &&
				colType.indexOf("ChildLinkGroupID") < 0 &&
				colType.indexOf("ChildLinkUID") < 0) //if column type is ChildLink, use dropdown
			{
				str += "<div style='" +
					"white-space:nowrap;" +
					"margin:0px -2px -4px 1px;width:" +//"margin:-4px -2px -4px 1px;width:" + 						
					(el.offsetWidth - 6 + (1 ? 50 : 0)) +
					"px; height:" + (el.offsetHeight - 8) + "px'>";

				str += "<select  onkeydown='keyHandler(event)' " +
					"id='fixedChoice-editSelectBox' " +
					"style='" +
					"float:left;" +
					//"style='margin:-4px -2px -4px 1px;
					"width:" +
					(el.offsetWidth - 6) + "px; height:" + (el.offsetHeight - 8) + "px'>";


				var choices;
				var useAllTables = true;

				if (_tableFixedChoiceData[c] !== undefined &&
					_tableFixedChoiceData[c].length) 
				{
					if (_tableFixedChoiceData[c][0] != "arbitraryBool=0") //make sure arbitrary is disabled
						useAllTables = true;
					else
						useAllTables = false;
				}

				if (useAllTables)
					choices = _tableLinkDropdownChoices;
				else
					choices = _tableFixedChoiceData[c];

				optionIndex = -1;
				for (var i = useAllTables ? 0 : 1; i < choices.length; ++i)
				{
					str += "<option value='" + choices[i]
						+ "'>";
					str += choices[i]; //can display however
					str += "</option>";
					if (choices[i]
						== _editingCellElOldValue)
						optionIndex = i - (useAllTables ? 0 : 1); //get starting sel index
				}
				if(optionIndex == -1)
				{ 
					if(true /*allowFixedChoiceArbitraryEdit*/ && 
							_editingCellElOldValue.length)
					{
						str += "<option value='" + 
								ConfigurationAPI.encodeHTML(_editingCellElOldValue)
								+ "'>";
						str += ConfigurationAPI.encodeHTML(_editingCellElOldValue); //can display however
						str += "</option>";
						optionIndex = choices.length - (useAllTables ? 0 : 1); //last index
					}
					else 
						optionIndex = 0; //default to default
				}	
				str += "</select>";

				//add arbitrary edit
				if (true) 
				{
					str += "<input type='text' " +
						"id='fixedChoice-editTextBox' " +
						"style='display:none;" +
						"float:left;" +
						"margin:-2px 0 -" + (el.offsetHeight - 10) + "px 0;" +
						"width:" +
						((el.offsetWidth > 150 ? el.offsetWidth : 150) - 6) + "px; height:" + (el.offsetHeight - 10) + "px" +
						"'>";
					str += "";
					str += "</input>";

					str += "<div style='display:block;" +
						"margin: 2px 0 -7px 14px;" +
						"' " +
						"class='treeNode-Value-editIcon' id='fixedChoice-editIcon" +
						"' " +
						"onclick='handleFixedChoiceEditToggle();' " +
						"title='Toggle free-form editing' " +
						"></div>";
				}

				str += "</div>";

			}
			else if (_useTableLinkDropdown &&
				colType.indexOf("ChildLinkUID") == 0 &&
				localHandleDropdownForLinkUID()) //if column type is ChildLinkUID, use dropdown
			{
				//if here then dropdown UIDs were found successfully
				return true;
			}
			else if (_useTableLinkDropdown &&
				colType.indexOf("ChildLinkGroupID") == 0 &&
				localHandleDropdownForLinkGroupID()) //if column type is ChildLinkGroupID, use dropdown
			{
				//if here then dropdown UIDs were found successfully
				return true;
			}
			else if (colType == "FixedChoiceData") 
			{
				optionIndex = -1; //init

				var allowFixedChoiceArbitraryEdit = false;

				if (_tableFixedChoiceData[c] !== undefined && 
						_tableFixedChoiceData[c].length)
				{
					var optionCount = 0;
					for (var i = 0; i < _tableFixedChoiceData[c].length; ++i) 
					{
						if (!i)//check for arbitraryBool flag
						{
							var needToContinue = false;

							if (_tableFixedChoiceData[c][i].indexOf("arbitraryBool=") == 0) 
							{
								//found arbitraryBool flag								
								allowFixedChoiceArbitraryEdit = _tableFixedChoiceData[c][i][
									("arbitraryBool=").length] == "1" ? true : false;
								Debug.log("allowFixedChoiceArbitraryEdit " + allowFixedChoiceArbitraryEdit);
								needToContinue = true;
							}
							else 
							{
								//else no flag found, so treat as fixed choice option
								++optionCount; //count as an option in dropdown
							}

							//before the first option is added, add preamble and default
							{
								str += "<div style='" +
									"white-space:nowrap;" +
									"margin:0px -2px -4px 1px;width:" +//"margin:-4px -2px -4px 1px;width:" + 						
									(el.offsetWidth - 6 + (allowFixedChoiceArbitraryEdit ? 50 : 0)) +
									"px; height:" + (el.offsetHeight - 8) + "px'>";

								str += "<select  onkeydown='keyHandler(event)' " +
									"id='fixedChoice-editSelectBox' " +
									"style='" +
									"float:left;" +
									//"margin:-4px -2px -4px 1px;" +
									"width:" +
									(el.offsetWidth - 6) + "px; height:" + (el.offsetHeight - 8) + "px" +
									"'>";

								//default value is assumed in list
								str += "<option>";
								str += decodeURIComponent(_tableDefaultRowValues[c]);	//can display however
								str += "</option>";
							}

							if (needToContinue) continue;
						}
						else
							++optionCount; //count as an option in dropdown

						str += "<option>";
						str += ConfigurationAPI.encodeHTML(
								decodeURIComponent(_tableFixedChoiceData[c][i]));	//can display however
						str += "</option>";

						//check for currently selected value
						if (decodeURIComponent(_tableFixedChoiceData[c][i])
							== _editingCellElOldValue)
							optionIndex = optionCount; //+1 in advance to account for default option
					} //end option loop
					
					if(optionIndex == -1)
					{ 
						if(allowFixedChoiceArbitraryEdit && 
								_editingCellElOldValue.length)
						{
							str += "<option>";
							str += ConfigurationAPI.encodeHTML(_editingCellElOldValue); //can display however
							str += "</option>";
							optionIndex = optionCount+1; //last index
						}
						else 
							optionIndex = 0; //default to default
					}		
					str += "</select>";
				}
				else  //strange illegal fixed choice? but add div, just in case
					str += "<div style='" +
						"white-space:nowrap;" +
						"margin:0px -2px -4px 1px;width:" +//"margin:-4px -2px -4px 1px;width:" + 						
						(el.offsetWidth - 6 + (allowFixedChoiceArbitraryEdit ? 50 : 0)) +
						"px; height:" + (el.offsetHeight - 8) + "px'>";

				


				if (allowFixedChoiceArbitraryEdit) 
				{
					str += "<input type='text' " +
						"id='fixedChoice-editTextBox' " +
						"style='display:none;" +
						"float:left;" +
						"margin:-2px 0 -" + (el.offsetHeight - 10) + "px 0;" +
						"width:" +
						((el.offsetWidth > 150 ? el.offsetWidth : 150) - 6) + "px; height:" + (el.offsetHeight - 10) + "px" +
						"'>";
					str += "";
					str += "</input>";

					str += "<div style='display:block;" +
						"margin: 2px 0 -7px 14px;" +
						"' " +
						"class='treeNode-Value-editIcon' id='fixedChoice-editIcon" +
						"' " +
						"onclick='handleFixedChoiceEditToggle();' " +
						"title='Toggle free-form editing' " +
						"></div>";
				}
				str += "</div>";

			}
			else if (colType == "BitMap") 
			{
				//let API bitmap dialog handle it
				ConfigurationAPI.bitMapDialog(
					//_editingCellElOldTitle, //field name
					"Target UID/Field: &quot;" +
					_editingCellElOldTitle.split('\n')[0].split(" : ")[1] + "/" +
					_editingCellElOldTitle.split('\n')[1].split(" : ")[0] + "&quot;",
					_tableFixedChoiceData[c],
					_editingCellElOldValue,
					function (val) {
						Debug.log("yes " + val);
						_editingCellEl.innerHTML = "";
						_editingCellEl.appendChild(document.createTextNode(val));
						_editingCell = false;
						_editingCellEl = 0;

						versionHasChanged();
					},
					function () //cancel handler
					{
						//remove the editing cell selection
						Debug.log("no");
						_editingCell = false;
						_editingCellEl = 0;
					});
				return true;
			}
			else if (colType == "MultilineData") 
			{
				//onkeydown='keyHandler(event)' 
				str += "<textarea rows='4' onkeydown='keyHandler(event)' cols='50' style='font-size: 14px; margin:-4px -2px -4px -1px;width:" +
					((el.offsetWidth > 150 ? el.offsetWidth : 150) - 6) + "px; height:" + (el.offsetHeight - 8) + "px' ";
				str += " onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
					"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting);' " +
					">";
				str += _editingCellElOldValue;
				str += "</textarea>";
			}
			else if (colType == "YesNo" ||
				colType == "TrueFalse" ||
				colType == "OnOff")  //if column type is boolean, use dropdown
			{
				var boolVals = [];
				if (colType == "YesNo")
					boolVals = ["No", "Yes"];
				else if (colType == "TrueFalse")
					boolVals = ["False", "True"];
				else if (colType == "OnOff")
					boolVals = ["Off", "On"];


				str += "<select  onkeydown='keyHandler(event)' " +
					"style='margin:-4px -2px -4px 1px;width:" +
					(el.offsetWidth - 6) + "px; height:" + (el.offsetHeight - 8) + "px'>";
				for (var i = 0; i < boolVals.length; ++i)
				{
					str += "<option value='" + boolVals[i] + "'>";
					str += boolVals[i];	//can display however
					str += "</option>";
					if (boolVals[i] == _editingCellElOldValue)
						optionIndex = i; //get starting sel index					
				}
				str += "</select>";
				if (optionIndex == -1) optionIndex = 0; //use False option by default
			}
			else // normal cells, with text input
			{
				str += "<input type='text' onkeydown='keyHandler(event)' style='margin:-4px -2px -4px -1px;width:" +
					((el.offsetWidth > 150 ? el.offsetWidth : 150) - 6) + "px; height:" + (el.offsetHeight - 8) + "px' value='";
				str += encodeHTML(_editingCellElOldValue); //replace single quotes since within html
				str += "' onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
					"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting);' " +
					">";

			}

			localFinishUpSelectCell();
			return true;

			///////////// localFinishUpSelectCell
			function localFinishUpSelectCell(doAddNormalTextInput) 
			{
				if (doAddNormalTextInput)
				{
					str += "<input type='text' onkeydown='keyHandler(event)' style='margin:-4px -2px -4px -1px;width:" +
						((el.offsetWidth > 150 ? el.offsetWidth : 150) - 6) + "px; height:" + (el.offsetHeight - 8) + "px' value='";
					str += encodeHTML(_editingCellElOldValue); //replace single quotes since within html
					str += "' onmousedown='_mouseIsSelecting = true; Debug.log(_mouseIsSelecting);' " +
						"onmouseup='_mouseIsSelecting = false; Debug.log(_mouseIsSelecting);' " +
						">";
				}

				//Add OK | CANCEL
				//	if link, add GOTO 'button'
				{
					var controlString;

					if (colType.indexOf("ChildLink-") == 0 &&
							_editingCellElOldValue != "NO_LINK") 
					{
						var backLinkStr = "setupSpecificTable(\\\"" + 
								_currentTableName + "\\\",\\\"" +
							_version + "\\\");";

						var w = _OK_CANCEL_DIALOG_STR.indexOf("width:95px;");
						controlString = _OK_CANCEL_DIALOG_STR.substr(0, w);
						w += ("width:95px;").length;
						controlString += "width:150px;"; //needs to be wider
						controlString += _OK_CANCEL_DIALOG_STR.substr(w,
							_OK_CANCEL_DIALOG_STR.length - 6 - w);//remove closing </div>
						controlString += " | " +
							"<a class='popUpOkCancel' href='#' onclick='setupSpecificTable(\"" +
							_editingCellElOldValue +
							"\",\"\",\"" + backLinkStr + "\"); event.stopPropagation();' " +
							"onmouseup='event.stopPropagation();'" +
							"style='color:rgb(44, 44, 187);' " +
							"title='Go-to Link Table' " +
							">" +
							"<b style='color:rgb(44, 44, 187);font-size: 16px;'>Goto</b></a>";
						controlString += "</div>";
					}
					else
						controlString = _OK_CANCEL_DIALOG_STR;

					str += controlString;
				}


				//give focus to created element

				el.innerHTML = str;

				//				if(_useTableLinkDropdown && 
				//						colType.indexOf("ChildLink") == 0 &&
				//						colType.indexOf("ChildLinkGroupID") < 0 &&
				//						colType.indexOf("ChildLinkUID") < 0) //if column type is ChildLink, use dropdown
				//				{
				//					el.getElementsByTagName("select")[0].selectedIndex = optionIndex;
				//					el.getElementsByTagName("select")[0].focus();
				//				}
				//				else if(colType.indexOf("ChildLinkUID") == 0 || )
				if (colType.indexOf("ChildLink") == 0) //for all child link types, including ID and GroupID
				{
					if (el.getElementsByTagName("select").length) 
					{
						el.getElementsByTagName("select")[0].selectedIndex = optionIndex;
						el.getElementsByTagName("select")[0].focus();
					}
					else //assume text box
						ConfigurationAPI.setCaretPosition(el.getElementsByTagName("input")[0], 0, _editingCellElOldValue.length);
				}
				else if (colType == "FixedChoiceData") 
				{
					el.getElementsByTagName("select")[0].selectedIndex = optionIndex;
					el.getElementsByTagName("select")[0].focus();
				}
				else if (colType == "MultilineData")
					ConfigurationAPI.setCaretPosition(el.getElementsByTagName("textarea")[0], 0, _editingCellElOldValue.length);
				else if (colType == "YesNo" ||
					colType == "TrueFalse" ||
					colType == "OnOff")  //if column type is boolean, use dropdown
				{
					el.getElementsByTagName("select")[0].selectedIndex = optionIndex;
					el.getElementsByTagName("select")[0].focus();
				}
				else //select text box
					ConfigurationAPI.setCaretPosition(el.getElementsByTagName("input")[0], 0, _editingCellElOldValue.length);
			} //end localFinishUpSelectCell()

		} //end selectThisCell()

		//==============================================================================
		//bodyMouseHandler ~~
		function bodyMouseHandler(e) 
		{
			//Debug.log("bodyMouseHandler");
			if (!_mouseIsSelecting) 
			{
				//detect proper views
				var el = document.getElementById("treeView-ConfigGroupLink");
				if (el) //tree view ok handler
				{
					if (treeEditingNodeType_.indexOf("link-") == 0)
						return false; //ignore click saving when editing links (too difficult for users to be confident in their clicks)
					else
						editTreeNodeOK();
				}
				else
					editCellOK();
			}
			_mouseIsSelecting = false;
			//Debug.log(_mouseIsSelecting);
		} //end bodyMouseHandler()

		//==============================================================================
		//bodyKeyHandler ~~
		function bodyKeyHandler(e) 
		{
			//detect proper views
			var el = document.getElementById("treeView-ConfigGroupLink");
			var popUpEl = document.getElementById("popUpDialog");

			//tree view key handler and no popup and no editing cell
			if (el && !popUpEl && !_editingCellEl) 
			{
				//NOTE: Firefox and Chrome have different keycodes for +/-
				var expandKeys = [65, 69, 190, 221, 187, 61]; // a, e, >, }, +, FF+ (no shift needed)
				var hideKeys = [90, 77, 188, 219, 189, 173]; // z, m, <, {, -, FF- (no shift needed)

				//Debug.log("treeView bodyKey " + e.keyCode);

				for (var i = 0; i < expandKeys.length; ++i)
					if (expandKeys[i] == e.keyCode) 
					{
						//handle expand
						Debug.log("treeView bodyKey expand " + e.keyCode);
						expandTreeChildrenDepth();
						break;
					}

				for (var i = 0; i < hideKeys.length; ++i)
					if (hideKeys[i] == e.keyCode) 
					{
						//handle hide
						Debug.log("treeView bodyKey hide " + e.keyCode);
						hideTreeChildrenDepth();
						break;
					}
			}
			//else no handler			
		} //end bodyKeyHandler()

		//==============================================================================
		//keyHandler
		function keyHandler(e, keyEl) 
		{
			var TABKEY = 9;
			var ENTERKEY = 13;
			var UPKEY = 38;
			var DNKEY = 40;
			var ESCKEY = 27;
			//Debug.log("key " + e.keyCode);

			var shiftIsDown;
			if (window.event) 
			{
				key = window.event.keyCode;
				shiftIsDown = !!window.event.shiftKey; // typecast to boolean
			}
			else
			{
				key = e.which;
				shiftIsDown = !!e.shiftKey;	// typecast to boolean
			}
			//Debug.log("shift=" + shiftIsDown);


			//handle text area specially
			if (!shiftIsDown) 
			{
				var tel;
				if (_editingCellEl &&
					(tel = _editingCellEl.getElementsByTagName("textarea")).length) 
				{
					tel = tel[0];
					//handle special keys for text area
					if (e.keyCode == TABKEY) 
					{
						Debug.log("tab.");
						if (e.preventDefault)
							e.preventDefault();

						var i = tel.selectionStart;
						var j = tel.selectionEnd;
						tel.value = tel.value.substr(0, i) +
							'\t' + tel.value.substr(j);
						tel.selectionStart = tel.selectionEnd = j + 1;
					}
					return false; //done if text area was identified
				}
			}

			//tab key jumps to next cell with a CANCEL
			//	(enter key does same except saves/OKs value)
			//	shift is reverse jump
			if (e.keyCode == TABKEY || e.keyCode == ENTERKEY ||
				e.keyCode == UPKEY || e.keyCode == DNKEY) 
			{
				//this.value += "    ";
				if (e.preventDefault)
					e.preventDefault();


				editCellOK();
				if (e.keyCode == ENTERKEY) //dont move to new cell
					return false;

				//detect tree view
				var el = document.getElementById("treeView-ConfigGroupLink");
				if (el) 
				{
					Debug.log("TODO - Could move to next cell in future in tree-view.");
					return;
				}

				//jump forward (tab/enter) or backward (tab/enter+shift)
				//	or up or down.
				//get number of rows and cols
				//	to determine next row and col to jump to


				var newRow = _editingCellPos[0];
				var newCol = _editingCellPos[1];
				var el = document.getElementById("SubSystemTable");
				var rows = el.getElementsByTagName("tr");

				var numOfRows;
				var numOfCols;

				if (_tableViewIsTransposed) 
				{
					numOfCols = rows.length - _CONFIG_DATA_COL_OFFSET;
					numOfRows = rows[0].getElementsByTagName("td").length + 1 -
						_CONFIG_DATA_ROW_OFFSET; //assume one TH cell
				}
				else 
				{
					numOfRows = rows.length - _CONFIG_DATA_ROW_OFFSET;
					numOfCols = rows[_CONFIG_DATA_ROW_OFFSET - 1].getElementsByTagName("th").length -
						_CONFIG_DATA_COL_OFFSET;
				}

				do 
				{
					if (!_tableViewIsTransposed) 
					{
						if (e.keyCode == TABKEY || e.keyCode == ENTERKEY)
							newCol += (shiftIsDown ? -1 : 1);
						else if (e.keyCode == UPKEY)
							--newRow;
						else if (e.keyCode == DNKEY)
							++newRow;
					}
					else 
					{
						if (e.keyCode == TABKEY || e.keyCode == ENTERKEY)
							newRow += (shiftIsDown ? -1 : 1);
						else if (e.keyCode == UPKEY)
							--newCol;
						else if (e.keyCode == DNKEY)
							++newCol;
					}

					//new position is chosen! now make it happen (in a clean way)	

					if (newCol == numOfCols) { ++newRow; newCol = 0; }
					if (newRow == numOfRows) newRow = 0;
					if (newCol < 0) { --newRow; newCol = numOfCols - 1; }
					if (newRow < 0) newRow = numOfRows - 1;

					if (_tableViewIsTransposed)
						el = rows[_CONFIG_DATA_COL_OFFSET + newCol].getElementsByTagName("td")[_CONFIG_DATA_ROW_OFFSET - 1 + newRow];
					else
						el = rows[_CONFIG_DATA_ROW_OFFSET + newRow].getElementsByTagName("td")[_CONFIG_DATA_COL_OFFSET + newCol];

				} while (!selectThisCell(newRow, newCol, el));

				Debug.log("newRow=" + newRow + " newCol=" + newCol);

				return false;
			}
			else if (e.keyCode == ESCKEY) 
			{
				if (e.preventDefault)
					e.preventDefault();
				editCellCancel();
				return false;
			}
			else if ((e.keyCode >= 48 && e.keyCode <= 57) ||
				(e.keyCode >= 96 && e.keyCode <= 105))// number 0-9
			{
				//if child link cell or boolean cell			
				var sel;
				if ((sel = _editingCellEl.getElementsByTagName("select")).length) 
				{
					if (keyEl) //if input element, use it
						sel = keyEl;
					else
						sel = sel[sel.length - 1]; //assume the last select in the cell is the select

					//select based on number
					var selNum;
					if (e.keyCode >= 96)
						selNum = e.keyCode - 96;
					else
						selNum = e.keyCode - 48;

					sel.selectedIndex = selNum % (sel.options.length);
					sel.focus();

					Debug.log("number select =" + sel.selectedIndex);
					if (sel.onchange) //if onchange implemented call it
						sel.onchange();
				}
			}
		} //end keyHandler()

		//==============================================================================
		//popUpGroupViewAliasForm ~~
		function popUpGroupViewAliasForm(groupName, groupKey) 
		{
			Debug.log("CfgGUI popUpGroupViewAliasForm");

			var str = "";

			var el = document.getElementById("popUpDialog");
			if (!el) 
			{
				el = document.createElement("div");
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 380;
			var h = 215;
			ConfigurationAPI.setPopUpPosition(el, w /*w*/, h /*h*/);


			//show choices of group aliases or alternatively textbox
			//	default to the system alias that is closest to groupName/groupKey


			//get existing group aliases	
			///////////////////////////////////////////////////////////
			DesktopContent.XMLHttpRequest("Request?RequestType=getGroupAliases" +
				"",
				"",
				function (req) 
				{
					var err = DesktopContent.getXMLValue(req, "Error");
					if (err) 
					{
						Debug.log(err, Debug.HIGH_PRIORITY);
						el.innerHTML = str;
						return;
					}

					var aliases = req.responseXML.getElementsByTagName("GroupAlias");
					var aliasGroupNames = req.responseXML.getElementsByTagName("GroupName");
					var aliasGroupKeys = req.responseXML.getElementsByTagName("GroupKey");

					//Show dropdown for alias
					//	and a pencil to change dropdown to text box to free-form alias.
					//Also, identify if already aliased and choose that as default option
					//	in dropwdown.					
					var alias, aliasGroupName, aliasGroupKey;
					var i = 0; //re-using code that had multiple groups, this requires just one group					
					var groupOptionIndex = []; //keep ABSOLUTE distance and index of option for each group, or -1 if none

					groupOptionIndex.push([-1, 0]); //index and distance

					//find alias
					var modTblStr = "";
					for (var j = 0; j < aliasGroupNames.length; ++j)
					{
						alias = DesktopContent.getXMLValue(aliases[j]);
						aliasGroupName = DesktopContent.getXMLValue(aliasGroupNames[j]);
						aliasGroupKey = DesktopContent.getXMLValue(aliasGroupKeys[j]);

						//Debug.log("compare " + aliasGroupName + ":" +
						//		aliasGroupKey);

						//also build drop down
						modTblStr += "<option value='" + alias + "' ";

						//consider any alias with same groupName
						if (aliasGroupName == groupName) 
						{
							if (groupOptionIndex[i][0] == -1 ||	//take best match
								Math.abs(groupKey - aliasGroupKey) < groupOptionIndex[i][1]) 
							{
								Debug.log("found alias");
								groupOptionIndex[i][0] = j; //index
								groupOptionIndex[i][1] = Math.abs(groupKey - aliasGroupKey); //ABSOLUTE distance
							}
						}
						modTblStr += ">";
						modTblStr += alias;	//can display however
						modTblStr += "</option>";
					}

					var str = "<a id='" +
						"popUpDialog" +
						"-header' onclick='var el = document.getElementById(" +
						"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

					str += "<div id='popUpDialog-div'>";

					str += "Please choose a System Alias below and then click 'Create System Alias' " +
						"to setup a System Alias referring to the current group  '" +
						groupName + " (" + groupKey + ").'<br><br>";

					str += "<center>";
					str += "Set '<b style='font-size:16px'>" + groupName + " (" +
						groupKey + ")</b>' to System Alias:";
					str += "</a><br>";
					str += "<table cellpadding='0' cellspacing='0' border='0'><tr><td>";
					str += "<select " +
						"id='popUpDialog-editAliasSelect-" + (i) + "' " +
						"style='margin:2px; height:" + (25) + "px'>";
					str += modTblStr;
					str += "</select>";

					str += "<input type='text' " +
						"id='popUpDialog-editAliasTextBox-" + (i) + "' " +
						"style='display:none; margin:2px; width:150px; height:" +
						(19) + "px'>";
					str += "";
					str += "</input>";
					str += "</td><td>";

					str += "<div style='display:block' " +
						"class='treeNode-Value-editIcon' id='popUpDialog-editIcon-" +
						(i) + "' " +
						"onclick='handleEditTreeAliasEditToggle(" +
						i +
						");' " +
						"title='Toggle free-form system alias editing' " +
						"></div>";

					str += "</td></tr></table>";


					// done with system alias handling
					// continue with pop-up prompt

					str += "</center></div><br>"; //close main popup div

					var onmouseupJS = "";
					onmouseupJS += "document.getElementById(\"popUpDialog-submitButton\").disabled = true;";
					onmouseupJS += "popUpGroupViewAliasFormSubmit(\"" + groupName +
						"\",\"" + groupKey + "\");";

					str += "<input id='popUpDialog-submitButton' type='button' onmouseup='" +
						onmouseupJS + "' " +
						"value='Alias' title='" +
						"Set the System Alias to the current Group name and key" +
						"'/>";
					el.innerHTML = str;

					//handle default dropdown selections for group alias
					if (groupOptionIndex[i][0] != -1) //have a default
						document.getElementById("popUpDialog-editAliasSelect-" +
							i).selectedIndex = groupOptionIndex[i][0];

				}, 0, 0, true //reqParam, progressHandler, callHandlerOnErr
			); //end of getGroupAliases handler

			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";
		} //end popUpGroupViewAliasForm

		//==============================================================================
		//popUpGroupViewAliasFormSubmit ~~
		function popUpGroupViewAliasFormSubmit(groupName, groupKey)
		{
			//get group alias
			var groupAlias;
			{
				var setAliasCheckboxIndex = 0;
				var el = document.getElementById("popUpDialog-editAliasSelect-" +
					setAliasCheckboxIndex);
				if (el.style.display == "none")
				{
					//get value from text box
					el = document.getElementById("popUpDialog-editAliasTextBox-" +
						setAliasCheckboxIndex);
				}
				groupAlias = el.value;
			}
			Debug.log("Group view alias setting to " + groupAlias);
			ConfigurationAPI.setGroupAliasInActiveBackbone(groupAlias, groupName, groupKey, 0,
				function (retParams) //done handler
				{
					if (retParams) 
					{
						if (retParams.newBackbone)
							Debug.log("Successfully modified the active Backbone group " +
								" to set the System Alias '" + groupAlias + "' to " +
								" refer to the current group '" + groupName +
								" (" + groupKey + ").'" +
								"\n\n" +
								"Backbone group '" + retParams.groupName + " (" +
								retParams.groupKey + ")' was created and activated.",
								Debug.INFO_PRIORITY);
						else
							Debug.log("Success, but no need to create a new Backbone group. " +
								"An existing Backbone group " +
								" already has the System Alias '" + groupAlias + "' " +
								" referring to the current group '" + groupName +
								" (" + groupKey + ").'" +
								"\n\n" +
								"Backbone group '" + retParams.groupName + " (" +
								retParams.groupKey + ")' was activated.",
								Debug.INFO_PRIORITY);

						//kill popup dialog
						var el = document.getElementById("popUpDialog");
						if (el) el.parentNode.removeChild(el);
					}
					else 
					{
						//else error, leave popup there and re-enable button
						document.getElementById("popUpDialog-submitButton").disabled = false;
					}


				}, true); //request return parameters
		} //end popUpGroupViewAliasFormSubmit()

		//==============================================================================
		//popUpSaveTreeForm ~~
		function popUpSaveTreeForm() 
		{
			Debug.log("CfgGUI popUpSaveTreeForm");

			var str = "";

			var el = document.getElementById("popUpDialog");
			if (!el) 
			{
				el = document.createElement("div");
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var gh = 50;
			var w = 380;
			var h = 330;
			ConfigurationAPI.setPopUpPosition(el, w /*w*/, h - gh * 2 /*h*/,
				undefined /*padding*/, undefined /*border*/, undefined /*margin*/, undefined /*doNotResize*/,
				gh * 2 /*offsetUp*/);

			//always
			//	- save modified tables (show list of modified tables)
			//		(and which active group they are in)
			//
			//optionally
			//	- checkbox to bump version of modified active groups
			//	- checkbox to assign system alias to bumped active group 

			//if there are new tables added they should be in as "mockup" version -1

			var modTblCount = 0;
			var modTblStr = "";
			var modifiedTables = ""; //csv table, temporary version,...
			for (var j = 0; j < treeMemberNames_.length; ++j)
				if ((treeMemberVersions_[j] | 0) < 0) //allow new tables' mockup version to be added
				{
					if (modTblCount++)
						modTblStr += ",";
					modTblStr += treeMemberNames_[j];

					if (modifiedTables.length)
						modifiedTables += ",";
					modifiedTables += treeMemberNames_[j];
					modifiedTables += ",";
					modifiedTables += treeMemberVersions_[j];
										
				}

			if (modTblCount == 0) 
			{
				Debug.log("No modified tables found. Nothing to save.", Debug.WARN_PRIORITY);
				return;
			}

			var str = "<a id='" +
				"popUpDialog" +
				"-header' onclick='var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "Saving the tree will create new persistent versions of each modified table." +
				"<br><br>" +
				"Here is the list of modified tables (count=" + modTblCount +
				"):" +
				"<br>";


			//display modified tables
			str += "<div style='white-space:nowrap; width:" + w + "px; height:40px; " +
				"overflow:auto; font-weight: bold;'>";
			str += modTblStr;
			str += "</div>";

			//get affected groups
			//	and save member map to hidden div for Save action			
			var tableGroupEls = document.getElementById("treeView-ConfigGroupLink").childNodes;
			///////////////////////////////////////////////////////////
			DesktopContent.XMLHttpRequest("Request?RequestType=getAffectedActiveGroups" +
				"&groupName=" + tableGroupEls[0].innerHTML +
				"&groupKey=" + tableGroupEls[1].innerHTML,
				"&modifiedTables=" + modifiedTables,
				function (req) 
				{
					var err = DesktopContent.getXMLValue(req, "Error");
					if (err) 
					{
						Debug.log(err, Debug.HIGH_PRIORITY);
						el.innerHTML = str;
						return;
					}

					//for each affected group
					//	 put csv: name,key,memberName,memberVersion...
					var groups = req.responseXML.getElementsByTagName("AffectedActiveGroup");
					var memberNames, memberVersions;
					var xmlGroupName;
					modTblStr = ""; //re-use
					for (var i = 0; i < groups.length; ++i) 
					{
						xmlGroupName = DesktopContent.getXMLValue(groups[i], "GroupName");
						str += "<div style='display:none' class='popUpDialog-affectedGroups' >";
						str += xmlGroupName;
						str += "," + DesktopContent.getXMLValue(groups[i], "GroupKey");

						memberNames = groups[i].getElementsByTagName("MemberName");
						memberVersions = groups[i].getElementsByTagName("MemberVersion");
						Debug.log("memberNames.length " + memberNames.length);
						for (var j = 0; j < memberNames.length; ++j)
							str += "," + DesktopContent.getXMLValue(memberNames[j]) +
								"," + DesktopContent.getXMLValue(memberVersions[j]);
						str += "</div>"; //close div popUpDialog-affectedGroups


						if (modTblStr.length)
							modTblStr += ",";


						modTblStr += "<a style='color:black' onclick='" +
							"var forFirefox = handleGroupCommentToggle(\"" + xmlGroupName + "\");" +
							" handlePopUpHeightToggle(" + h + "," + gh + ");' " +
							"title='Click to edit the comment for this group' " +
							">";
						modTblStr += xmlGroupName;
						modTblStr += "</a>";

						//store cached group comment in hidden html
						modTblStr += "<div id='popUpDialog-groupComment-" +
							xmlGroupName + "' " +
							"class='popUpDialog-groupComment-cache' " +
							"style='display:none'>" +
							decodeURIComponent(DesktopContent.getXMLValue(groups[i], "GroupComment")) +
							"</div>";
					}

					str += "Please choose the options you want and click 'Save Tree':" +
						"<br>";

					//add checkbox to save affected groups
					str += "<input type='checkbox' id='popUpDialog-bumpGroupVersions' checked " +
						"onclick='handlePopUpHeightToggle(" + h + "," + gh + ");'>";
					//add link so text toggles checkbox
					str += "<a onclick='" +
						"var el = document.getElementById(\"popUpDialog-bumpGroupVersions\");" +
						"var forFirefox = (el.checked = !el.checked);" +
						" handlePopUpHeightToggle(" + h + "," + gh + "); return false;'>";
					str += "Save Affected Groups as New Keys";
					str += "</a>";
					str += "</input><br>";

					//add checkbox to activate saved affected groups
					str += "<input type='checkbox' id='popUpDialog-activateBumpedGroupVersions' checked " +
						">";
					//add link so text toggles checkbox
					str += "<a onclick='" +
						"var el = document.getElementById(\"popUpDialog-activateBumpedGroupVersions\");" +
						"if(el.disabled) return false; " +
						"var forFirefox = (el.checked = !el.checked);" +
						"return false;'>";
					str += "Also Activate New Groups";
					str += "</a>";
					str += "</input><br>";

					str += "Here is the list of affected groups (count=" + groups.length +
						"):" +
						"<br>";

					//display affected groups
					str += "<div style='white-space:nowrap; width:" + w + "px; margin-bottom:20px; " +
						"overflow:auto; font-weight: bold;'>";
					str += modTblStr;
					str += "<div id='clearDiv'></div>";
					str += "<center>";

					str += "<div id='popUpDialog-groupComment-header'></div>";

					str += "<div id='clearDiv'></div>";

					str += "<textarea id='popUpDialog-groupComment' rows='4' cols='50' style='width:417px;height:68px;display:none;margin:0;'>";
					str += ConfigurationAPI._DEFAULT_COMMENT;
					str += "</textarea>";
					str += "</center>";

					str += "</div>"; //end affected groups div		

					str += "<div id='popUpDialog-groupAliasArea' ><center>";

					//get existing group aliases	
					///////////////////////////////////////////////////////////
					DesktopContent.XMLHttpRequest("Request?RequestType=getGroupAliases" +
						"",
						"",
						function (req) 
						{
							var err = DesktopContent.getXMLValue(req, "Error");
							if (err) 
							{
								Debug.log(err, Debug.HIGH_PRIORITY);
								el.innerHTML = str;
								return;
							}

							var aliases = req.responseXML.getElementsByTagName("GroupAlias");
							var aliasGroupNames = req.responseXML.getElementsByTagName("GroupName");
							var aliasGroupKeys = req.responseXML.getElementsByTagName("GroupKey");

							//for each affected group
							//	-Show checkbox for setting alias and dropdown for alias
							//	and a pencil to change dropdown to text box to free-form alias.
							//	-Also, identify if already aliased and choose that as default option
							//	in dropwdown.					
							var alias, aliasGroupName, aliasGroupKey;
							var groupName, groupKey;
							var groupOptionIndex = []; //keep distance and index of option for each group, or -1 if none
							for (var i = 0; i < groups.length; ++i) 
							{
								groupOptionIndex.push([-1, 0]); //index and distance

								groupName = DesktopContent.getXMLValue(groups[i], "GroupName");
								groupKey = DesktopContent.getXMLValue(groups[i], "GroupKey");

								//find alias
								modTblStr = ""; //re-use
								for (var j = 0; j < aliasGroupNames.length; ++j) 
								{
									alias = DesktopContent.getXMLValue(aliases[j]);
									aliasGroupName = DesktopContent.getXMLValue(aliasGroupNames[j]);
									aliasGroupKey = DesktopContent.getXMLValue(aliasGroupKeys[j]);

									//Debug.log("compare " + aliasGroupName + ":" +
									//		aliasGroupKey);

									//also build drop down
									modTblStr += "<option value='" + alias + "' ";

									//consider any alias with same groupName
									if (aliasGroupName == groupName) 
									{
										if (groupOptionIndex[i][0] == -1 ||	//take best match
											Math.abs(groupKey - aliasGroupKey) < groupOptionIndex[i][1]) 
										{
											Debug.log("found alias");
											groupOptionIndex[i][0] = j; //index
											groupOptionIndex[i][1] = Math.abs(groupKey - aliasGroupKey); //distance
										}
									}
									modTblStr += ">";
									modTblStr += alias;	//can display however
									modTblStr += "</option>";
								}

								str += "<input type='checkbox' class='popUpDialog-setGroupAlias' " +
									(groupOptionIndex[i][0] >= 0 ? "checked" : "") + //check if has an alias already
									">";
								//add link so text toggles checkbox
								str += "<a onclick='" +
									"var el = document.getElementsByClassName(\"popUpDialog-setGroupAlias\");" +
									"var forFirefox = (el[" + i + "].checked = !el[" + i + "].checked);" +
									" return false;'>";
								str += "Set '<b style='font-size:16px'>" + groupName + "</b>' to System Alias:";
								str += "</a><br>";

								str += "<table cellpadding='0' cellspacing='0' border='0'><tr><td>";
								str += "<select " +
									"id='popUpDialog-editAliasSelect-" + (i) + "' " +
									"style='margin:2px; height:" + (25) + "px'>";
								str += modTblStr;
								str += "</select>";

								str += "<input type='text' " +
									"id='popUpDialog-editAliasTextBox-" + (i) + "' " +
									"style='display:none; margin:2px; width:150px; height:" +
									(19) + "px'>";
								str += "";
								str += "</input>";
								str += "</td><td>";

								str += "<div style='display:block' " +
									"class='treeNode-Value-editIcon' id='popUpDialog-editIcon-" +
									(i) + "' " +
									"onclick='handleEditTreeAliasEditToggle(" +
									i +
									");' " +
									"title='Toggle free-form system alias editing' " +
									"></div>";

								str += "</td></tr></table>";

								str += "</input>";

								//increase height each time a group check is added
								h += gh;
								el.style.height = h + "px";
							}
							if (groups.length == 0) //add some height for no groups case
							{
								h += gh;
								el.style.height = h + "px";

							}

							str += "</center></div>"; //close id='popUpDialog-groupAliasArea'


							// done with system alias handling
							// continue with pop-up prompt

							str += "</div><br>"; //close main popup div

							var onmouseupJS = "";
							onmouseupJS += "document.getElementById(\"popUpDialog-submitButton\").disabled = true;";
							onmouseupJS += "handleGroupCommentToggle(0,1);"; //force cache of group comment
							onmouseupJS += "handlePopUpHeightToggle(" + h + "," + gh + ");";
							onmouseupJS += "saveModifiedTree();";

							str += "<input id='popUpDialog-submitButton' type='button' onmouseup='" +
								onmouseupJS + "' " +
								"value='Save Tree' title='" +
								"Save new versions of every modified table\n" +
								"(Optionally, save new active groups and assign system aliases)" +
								"'/>";
							el.innerHTML = str;

							//handle default dropdown selections for group alias
							for (var i = 0; i < groups.length; ++i)
								if (groupOptionIndex[i][0] != -1) //have a default
									document.getElementById("popUpDialog-editAliasSelect-" +
										i).selectedIndex = groupOptionIndex[i][0];

						}, 0, 0, true //reqParam, progressHandler, callHandlerOnErr
					); //end of getGroupAliases handler

				}, 0, 0, true //reqParam, progressHandler, callHandlerOnErr
			); //end of getActiveTableGroups handler			


			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";
		} //end popUpSaveTreeForm()

		//==============================================================================
		//saveModifiedTree ~~
		//	ignoreWarnings = true will ignore warnings when saving groups
		function saveModifiedTree(ignoreWarnings)
		{
			Debug.log("saveModifiedTree " + (ignoreWarnings ? 1 : 0));

			//for each modified table
			//	save new version
			//	update tree member table version based on result
			//if saving groups
			//	figure out group type and save/activate in this order:
			//		config, context, backbone
			//		for each affected group
			//			save member list but with tree table versions
			//			modify root group name if changed
			//if saving aliases
			//	for each alias
			//		set alias for new group

			//Note: all information comes from popup dialog
			//	any return must also kill the popup

			var numberOfRequests = 0;
			var numberOfReturns = 0;
			var allRequestsSent = false;

			//go through each tree member
			//	if modified table
			//		save new version
			//		update tree member table version based on result
			for (var j = 0; j < treeMemberNames_.length; ++j)
				if ((treeMemberVersions_[j] | 0) < 0) //for each modified and mockup table
				{
					var reqStr = "Request?RequestType=saveSpecificTable" +
						"&dataOffset=0&chunkSize=0" +
						"&tableName=" + treeMemberNames_[j] +
						"&version=" + treeMemberVersions_[j] +
						"&temporary=0" +
						"&tableComment=" + treeMemberComments_[j] +
						"&sourceTableAsIs=1";
					Debug.log(reqStr);

					++numberOfRequests;

					//	save new version
					///////////////////////////////////////////////////////////
					DesktopContent.XMLHttpRequest(reqStr, "",
						function (req, treeMemberIndex) 
						{
							var err = DesktopContent.getXMLValue(req, "Error");
							if (err) 
							{
								Debug.log(err, Debug.HIGH_PRIORITY);

								//kill popup dialog
								var el = document.getElementById("popUpDialog");
								if (el) el.parentNode.removeChild(el);
								return;
							}

							var tableName = DesktopContent.getXMLValue(req, "savedName");
							var savedVersion = DesktopContent.getXMLValue(req, "savedVersion");
							var foundEquivalentVersion = DesktopContent.getXMLValue(req, "foundEquivalentVersion") | 0; //as int

							var scratchNotice = (ConfigurationAPI._SCRATCH_VERSION == (savedVersion | 0)) ? _SCRATCH_VIEW_NAME : savedVersion;

							if (foundEquivalentVersion)
								Debug.log("Found equivalent version '" + scratchNotice +
									"' for table '" +
									tableName + ".' ", Debug.INFO_PRIORITY);
							else
								Debug.log("New persistent version '" + scratchNotice +
									"' for table '" +
									tableName + "' was successfully created.", Debug.INFO_PRIORITY);

							//update tree member table version based on result
							treeMemberVersions_[treeMemberIndex] = savedVersion;

							++numberOfReturns;

							//check if done saving tables
							if (allRequestsSent &&
								numberOfReturns == numberOfRequests) 
							{
								localHandleAffectedGroups();
							}
						}, j, 0, true  //reqParam, progressHandler, callHandlerOnErr
					);	//end save new table request
				}	//end modified table for loop

			allRequestsSent = true; //indicate last request was sent

			if (numberOfRequests == 0) //no requests were sent, so go on to affected groups
				localHandleAffectedGroups();

			//=========================================
			//localHandleAffectedGroups ~~ /////////////////////////////
			function localHandleAffectedGroups() 
			{
				Debug.log("Done with table saving.");

				//check if saving groups
				var savingGroups =
					document.getElementById("popUpDialog-bumpGroupVersions").checked;
				var activatingSavedGroups =
					document.getElementById("popUpDialog-activateBumpedGroupVersions").checked;

				if (!savingGroups) //then no need to proceed. exit!
				{
					//kill popup dialog
					var el = document.getElementById("popUpDialog");
					if (el) el.parentNode.removeChild(el);
					return;
				}

				//identify root group name/key
				var rootGroupEl = document.getElementById("treeView-ConfigGroupLink");
				var rootGroupName = rootGroupEl.childNodes[0].textContent;
				var rootGroupKey = rootGroupEl.childNodes[1].textContent;

				Debug.log("rootGroup = " + rootGroupName + "(" + rootGroupKey + ")");
				Debug.log("On to saving groups");

				numberOfRequests = 0;		//re-use
				numberOfReturns = 0;		//re-use
				allRequestsSent = false; 	//re-use

				var affectedGroupNames = []; //to be populated for use by alias setting
				var affectedGroupKeys = []; //to be populated for use by alias setting
				var affectedGroupEls =
					document.getElementsByClassName("popUpDialog-affectedGroups");
				var affectedGroupCommentEls =
					document.getElementsByClassName("popUpDialog-groupComment-cache");

				var affectedGroupMemberMaps = []; //to be populated by initial group type loop, and used by save/activate loop

				//organize by group type
				var affectedConfigGroups = [];
				var affectedContextGroups = [];
				var affectedBackboneGroups = [];
				var affectedIterateGroups = [];

				// first organize and order by group type: config, context, backbone
				for (var i = 0; i < affectedGroupEls.length; ++i) 
				{
					//save member list but with tree table versions
					Debug.log(affectedGroupEls[i].textContent);
					Debug.log("group comment: " + affectedGroupCommentEls[i].textContent);

					var affectedArr = affectedGroupEls[i].textContent.split(',');

					//build member config map
					var tableMap = "tableList=";
					//member map starts after group name/key (i.e. [2])
					for (var a = 2; a < affectedArr.length; a += 2)
						if ((affectedArr[a + 1] | 0) < -1) //there should be a new modified version
						{
							Debug.log("affectedArr " + affectedArr[a] + "-v" + affectedArr[a + 1]);
							//find version
							for (var k = 0; k < treeMemberNames_.length; ++k)
								if (affectedArr[a] == treeMemberNames_[k])
								{
									Debug.log("found " + treeMemberNames_[k] + "-v" + treeMemberVersions_[k]);
									tableMap += affectedArr[a] + "," +
										treeMemberVersions_[k] + ",";
									break;
								}
						}
						else //use existing version
							tableMap += affectedArr[a] + "," + affectedArr[a + 1] + ",";

					affectedGroupNames.push(affectedArr[0]);
					affectedGroupMemberMaps.push(tableMap);

					reqStr = ""; //reuse
					reqStr = "Request?RequestType=getTableGroupType";

					Debug.log(reqStr);
					Debug.log(tableMap);

					++numberOfRequests;
					///////////////////////////////////////////////////////////
					DesktopContent.XMLHttpRequest(reqStr, tableMap,
						function (req, groupIndex)
						{
							var err = DesktopContent.getXMLValue(req, "Error");
							if (err) 
							{
								Debug.log(err, Debug.HIGH_PRIORITY);

								//kill popup dialog
								var el = document.getElementById("popUpDialog");
								if (el) el.parentNode.removeChild(el);
								return;
							}

							++numberOfReturns;

							var groupType = DesktopContent.getXMLValue(req, "TableGroupType");
							Debug.log("groupType = " + groupType);

							if (groupType == "Configuration")
								affectedConfigGroups.push(groupIndex);
							else if (groupType == "Context")
								affectedContextGroups.push(groupIndex);
							else if (groupType == "Backbone")
								affectedBackboneGroups.push(groupIndex);
							else if (groupType == "Iterate")
								affectedIterateGroups.push(groupIndex);
							else 
							{
								Debug.log("Invalid Group Type determined '" + groupType +
									".' This should not be possible - notify developers.",
									Debug.HIGH_PRIORITY);

								//kill popup dialog
								var el = document.getElementById("popUpDialog");
								if (el) el.parentNode.removeChild(el);
								return;
							}

							//check if done organizing groups
							if (allRequestsSent &&
								numberOfRequests == numberOfReturns) 
							{
								localSaveAndActivateGroups();
							}

						}, //end req handler
						i, 0, true); //reqIndex, progressHandler, callHandlerOnErr
				}

				allRequestsSent = true; //indicate last request was sent

				//=========================================
				//localSaveAndActivateGroups ~~ /////////////////////////////
				function localSaveAndActivateGroups()
				{
					Debug.log("Done organizing groups by type.");

					//at this point we have all of the member maps
					//	and groups organized by type
					// 
					// 	input arrays:
					//		var affectedGroupMemberMaps					
					//		//organize by group type
					//		var affectedConfigGroups = [];
					//		var affectedContextGroups = [];
					//		var affectedBackboneGroups = [];
					//		var affectedIterateGroups = [];

					numberOfRequests = 0;		//re-use
					numberOfReturns = 0;		//re-use
					allRequestsSent = false; 	//re-use

					// in order of config, context, backbone
					//	for each affected group
					//		save and activate group..
					//		do not allow next save/activate until previous is done

					localSaveAndActivateGroup(0); //launch first save and activate

					//=========================================
					//localSaveAndActivateGroups ~~ /////////////////////////////
					//	orderedGroupListIndex is sequential index spanning
					//		these arrays:
					//		var affectedConfigGroups = [];
					//		var affectedContextGroups = [];
					//		var affectedBackboneGroups = [];
					//		var affectedIterateGroups = [];					
					function localSaveAndActivateGroup(orderedGroupListIndex) 
					{
						//complete save and activate for group specified by 
						//	orderedGroupListIndex
						//	then launch next

						//find group index into affected group elements						
						var offsetIndex = 0;
						var i = -1;

						if (orderedGroupListIndex - offsetIndex <
							affectedConfigGroups.length)
							i = affectedConfigGroups[orderedGroupListIndex - offsetIndex];

						if (i == -1) 
						{
							offsetIndex += affectedConfigGroups.length;

							if (orderedGroupListIndex - offsetIndex <
								affectedContextGroups.length)
								i = affectedContextGroups[orderedGroupListIndex - offsetIndex]
						}

						if (i == -1) 
						{
							offsetIndex += affectedContextGroups.length;

							if (orderedGroupListIndex - offsetIndex <
								affectedBackboneGroups.length)
								i = affectedBackboneGroups[orderedGroupListIndex - offsetIndex]
						}

						if (i == -1) 
						{
							offsetIndex += affectedBackboneGroups.length;

							if (orderedGroupListIndex - offsetIndex <
								affectedIterateGroups.length)
								i = affectedIterateGroups[orderedGroupListIndex - offsetIndex]
						}

						Debug.log("affectedGroupIndex " + i);

						//at this point i is the affectedGroupIndex						

						if (i == -1) //done, no more groups
						{
							Debug.log("Done with group saving. " + numberOfRequests + " saved.");

							//refresh versions based on treeMemberVersions_ fix all the table and table-link versions
							refreshTreeTableVersions();

							allRequestsSent = true;
							if (numberOfRequests == 0) //no groups to save
							{
								//this could happen if editing tables with no current active groups
								Debug.log("There were no groups to save!", Debug.INFO_PRIORITY);

								//kill popup dialog
								var el = document.getElementById("popUpDialog");
								if (el) el.parentNode.removeChild(el);

								Debug.log("Tree saving operations complete.", Debug.INFO_PRIORITY);
								treeHasChanged(true); // reset
								return;
							}

							Debug.log("Moving on to Alias creation...");

							//check each alias checkbox
							//	for each alias that is checked
							//		set alias for new group
							//if any aliases modified, save and activate backbone

							//get checkboxes
							var setAliasCheckboxes =
								document.getElementsByClassName("popUpDialog-setGroupAlias");

							var groupAlias, groupName, groupKey;
							var setAliasCheckboxIndex = -1;
							var groupAliasName, groupAliasVersion;

							//in order to set alias, we need:
							//	groupAlias
							//	groupName
							//	groupKey				

							//for each set alias checkbox that is checked
							//	modify the active group alias table one after the other


							localNextAliasHandler(); //set in motion

							//=============================
							//localNextAliasHandler ~ //////////////////////////////////
							//	uses setAliasCheckboxIndex to iterate through setAliasCheckboxes
							//	and send the next request to modify the activegroupAlias table
							//	sequentially
							function localNextAliasHandler(retParams)
							{
								//first time there is no setAliasCheckboxIndex, it is -1
								if (setAliasCheckboxIndex >= 0) 
								{
									if (retParams) 
									{
										if (retParams.newGroupCreated)
											Debug.log("Successfully modified the active Backbone group " +
												" to set the System Alias '" + groupAlias + "' to " +
												" refer to the current group '" + groupName +
												" (" + groupKey + ").'" +
												"\n\n" +
												"Backbone group '" + retParams.groupName + " (" +
												retParams.groupKey + ")' was created and activated.",
												Debug.INFO_PRIORITY);
										else
											Debug.log("Success, but no need to create a new Backbone group. " +
												"An existing Backbone group " +
												" already has the System Alias '" + groupAlias + "' " +
												" referring to the current group '" + groupName +
												" (" + groupKey + ").'" +
												"\n\n" +
												"Backbone group '" + retParams.groupName + " (" +
												retParams.groupKey + ")' was activated.",
												Debug.INFO_PRIORITY);
									}
									else 
									{
										Debug.log("Process interrupted. Failed to modify the currently active Backbone!", Debug.HIGH_PRIORITY);

										//kill popup dialog
										var el = document.getElementById("popUpDialog");
										if (el) el.parentNode.removeChild(el);
										return;
									}

									++setAliasCheckboxIndex; //req back, so ready for next index
								}
								else
									setAliasCheckboxIndex = 0; //ready for first checkbox

								//get next affected group index			
								while (setAliasCheckboxIndex < setAliasCheckboxes.length &&
									!setAliasCheckboxes[setAliasCheckboxIndex].checked)
									Debug.log("Skipping checkbox " + (++setAliasCheckboxIndex));

								if (setAliasCheckboxIndex >= setAliasCheckboxes.length)
								{
									Debug.log("Done with alias checkboxes ");

									if (!retParams)//req) 
									{
										Debug.log("No System Aliases were changed, so Backbone was not modified. Done.");

										//kill popup dialog
										var el = document.getElementById("popUpDialog");
										if (el) el.parentNode.removeChild(el);

										Debug.log("Tree saving operations complete.", Debug.INFO_PRIORITY);
										treeHasChanged(true); // reset
										return;
									}

									Debug.log("Saving and activating Backbone done.");

									//kill popup dialog
									var el = document.getElementById("popUpDialog");
									if (el) el.parentNode.removeChild(el);

									Debug.log("Tree saving operations complete.", Debug.INFO_PRIORITY);
									treeHasChanged(true); // reset
									return;
								}

								//get next alias
								{
									var el = document.getElementById("popUpDialog-editAliasSelect-" +
										setAliasCheckboxIndex);
									if (el.style.display == "none")
									{
										//get value from text box
										el = document.getElementById("popUpDialog-editAliasTextBox-" +
											setAliasCheckboxIndex);
									}
									groupAlias = el.value;
								}

								groupName = affectedGroupNames[setAliasCheckboxIndex];
								groupKey = affectedGroupKeys[setAliasCheckboxIndex];

								Debug.log("groupAlias = " + groupAlias);
								Debug.log("groupName = " + groupName);
								Debug.log("groupKey = " + groupKey);

								ConfigurationAPI.setGroupAliasInActiveBackbone(groupAlias, groupName, groupKey,
									"TreeEditWiz",
									localNextAliasHandler,
									true); //request return parameters		
							}

							Debug.log("Aliases set in motion"); //so done with this thread						
							return;
						} //end done with groups section
						else 
						{
							//save/activate group i

							//save member list but with tree table versions
							Debug.log("group comment: " + affectedGroupCommentEls[i].textContent);

							var tableMap = affectedGroupMemberMaps[i];

							reqStr = ""; //reuse
							reqStr = "Request?RequestType=saveNewTableGroup" +
								"&groupName=" + affectedGroupNames[i] +
								"&allowDuplicates=0" +
								"&lookForEquivalent=1" +
								"&ignoreWarnings=" + (ignoreWarnings ? 1 : 0) +
								"&groupComment=" + encodeURIComponent(affectedGroupCommentEls[i].textContent);
							Debug.log("reqStr = " + reqStr);
							Debug.log("tableMap = " + tableMap);

							++numberOfRequests;
							///////////////////////////////////////////////////////////
							DesktopContent.XMLHttpRequest(reqStr, tableMap,
								function (req, reqi) 
								{

									var attemptedNewGroupName = DesktopContent.getXMLValue(req, "AttemptedNewGroupName");
									var treeErr = DesktopContent.getXMLValue(req, "TreeErrors");

									if (treeErr)
									{
										Debug.log(treeErr, Debug.HIGH_PRIORITY);
										Debug.log("There were problems identified in the tree view of the " +
											"attempted new group '" +
											attemptedNewGroupName +
											"'.\nThe new group was not created.\n" +
											"(Note: Other tables and groups may have been successfully created, " +
											"and would have success indications below this error info)\n\n" +
											"You can save the group anyway (if you think it is a good idea) by clicking " +
											"the button in the pop-up dialog " +
											"'<u>Save Groups with Warnings Ignored</u>.' " +
											"\n\nOtherwise, you can hit '<u>Cancel</u>.' and fix the tree. " +
											"Below you will find the description of the problem:",
											Debug.HIGH_PRIORITY);

										//change dialog save button
										var el = document.getElementById("popUpDialog-submitButton");
										el.onmouseup = function () {
											document.getElementById("popUpDialog-submitButton").disabled = true;
											saveModifiedTree(1);
										};
										el.value = "Save Groups with Warnings Ignored";
										el.disabled = false;
										return;
									}

									var err = DesktopContent.getXMLValue(req, "Error");
									if (err) 
									{
										Debug.log(err, Debug.HIGH_PRIORITY);

										//kill popup dialog
										var el = document.getElementById("popUpDialog");
										if (el) el.parentNode.removeChild(el);
										return;
									}

									++numberOfReturns;

									var newGroupKey = DesktopContent.getXMLValue(req, "TableGroupKey");
									affectedGroupKeys[reqi] = newGroupKey;//.push(newGroupKey);  // take from req parameter, since order may vary

									var foundEquivalentKey = DesktopContent.getXMLValue(req, "foundEquivalentKey") | 0; //as int

									if (foundEquivalentKey)
										Debug.log("Found equivalent group '" + attemptedNewGroupName +
											" (" + newGroupKey + ")'", Debug.INFO_PRIORITY);
									else
										Debug.log("Successfully created new group '" + attemptedNewGroupName +
											" (" + newGroupKey + ")'", Debug.INFO_PRIORITY);

									//need to modify root group name if changed


									//activate if option was selected
									if (activatingSavedGroups)
										activateSystemConfig(attemptedNewGroupName, newGroupKey, false /*false to not ignore warnings*/,
											function () //done handler
											{
												//save/activate is now done.. so proceed to next group
												localSaveAndActivateGroup(orderedGroupListIndex + 1);
											});
									else //save/activate is now done.. so proceed to next group									
										localSaveAndActivateGroup(orderedGroupListIndex + 1);

									//last step:
									//if this was root group in tree, modify tree display/links
									if (rootGroupName == attemptedNewGroupName) 
									{
										//modify display and onlick for root group link
										Debug.log("Modifying root group key");
										var str = "";
										str += "<div style='display:none'>" + rootGroupName + "</div>";
										str += "<div style='display:none'>" + newGroupKey + "</div>";
										str += rootGroupName + " (" + newGroupKey + ")";
										rootGroupEl.innerHTML = str;
										rootGroupEl.onclick = function () {

											var backLinkStr = "setupTableGroupTreeView(\"" +
												rootGroupName + "\",\"" +
												newGroupKey + "\");";
											setupSpecificTableGroup(rootGroupName, newGroupKey,
												backLinkStr);
											return false;
										};

										//modify group details
										{
											str = "";
											str += "Root-Group Details:";
											var groupComment = DesktopContent.getXMLValue(req, "TableGroupComment");
											groupComment = decodeURIComponent(groupComment);
											var groupAuthor = DesktopContent.getXMLValue(req, "TableGroupAuthor");
											var groupCreationTime = DesktopContent.getXMLValue(req, "TableGroupCreationTime");
											groupCreationTime = ConfigurationAPI.getDateString(new Date((groupCreationTime | 0) * 1000));

											str += "<table border='0' style='" +
												"border: 1px solid #9c5e5e;" +
												"margin: 5px 0 5px 30px;" +
												"background-color: #d2c1c1;" +
												"'>";
											str += "<tr><th>Author:</th><td class='underlineRow'>" + groupAuthor + "</td></tr>";
											str += "<tr><th>Created:</th><td class='underlineRow'>" + groupCreationTime + "</td></tr>";
											str += "<tr><th>Comment:</th><td>" +
												groupComment.replace(/\n/g, "<br>") + "</td></tr>";
											str += "</table>";

											document.getElementById("groupDetails").innerHTML = str;
										}


										//modify the activate link
										rootGroupEl = document.getElementById("treeView-ConfigGroupActivateLink");
										rootGroupEl.onclick = function () {
											activateSystemConfig(rootGroupName, newGroupKey);
											return false;
										};

										//edit global key value
										treeGroupKey_ = newGroupKey;
									}


								}, i, 0, true  //reqParam, progressHandler, callHandlerOnErr
							); //end save new group request
						} //end else case for saving group i 
					} //localSaveAndActivateGroup()

				} //end localSaveAndActivateGroups()
			} //end localHandleAffectedGroups()			
		} //end saveModifiedTree()

		//==============================================================================
		//treeHasChanged ~~
		function treeHasChanged(reset) 
		{
			if (reset) 
			{
				treeHasChanged_ = false;

				//delete all buttons
				var svBtn = document.getElementById("treeSaveButton");
				while (svBtn) 
				{
					svBtn.parentNode.removeChild(svBtn);
					svBtn = document.getElementById("treeSaveButton");
				}
				return;
			}

			if (treeHasChanged_) return;

			//delete all buttons
			var svBtn = document.getElementById("treeSaveButton");
			while (svBtn) 
			{
				svBtn.parentNode.removeChild(svBtn);
				svBtn = document.getElementById("treeSaveButton");
			}


			treeHasChanged_ = true;

			//add buttons to save tree		


			var newDiv = document.createElement("div");
			newDiv.setAttribute("id", "treeSaveButton");
			str = "";
			str += "<input type='button' onmouseup='popUpSaveTreeForm()' " +
				"value='Save All Tree Changes' title='" +
				"Save new versions of every modified table\n" +
				"(Optionally, save new active groups and assign system aliases)" +
				"'/>";
			str += "<br><br>";
			newDiv.innerHTML = str;

			//insert a new div before and after table
			el = document.getElementById("display");
			var targetEl = document.getElementById("treeView-ConfigGroupLink");
			el.insertBefore(newDiv, targetEl);
			newDiv = document.createElement("div");
			newDiv.setAttribute("id", "treeSaveButton");
			newDiv.innerHTML = "<br>" + str;
			el.appendChild(newDiv);
		} //end treeHasChanged()

		//==============================================================================
		//editTreeNodeOK
		function editTreeNodeOK() 
		{
			try 
			{
				if (!_editingCellEl) return;
				Debug.log("editTreeNodeOK type " + treeEditingNodeType_);

				//local initial variables can be used by continuation edit types 
				//	if globals are temporarily modified
				var initTargetTable = treeEditingTargetTable_;

				if (
					treeEditingNodeType_ == "table" ||
					treeEditingNodeType_ == "table-newRow" ||
					treeEditingNodeType_ == "uid" ||
					treeEditingNodeType_ == "delete-uid" ||
					treeEditingNodeType_.indexOf("link-") == 0 || //UID or GroupID
					treeEditingNodeType_ == "table-newGroupRow" || //spawns from group link edit
					treeEditingNodeType_ == "table-newUIDRow" || //spawns from uid link edit
					treeEditingNodeType_ == "value" ||
					treeEditingNodeType_ == "value-bool" ||
					treeEditingNodeType_ == "value-bitmap" ||
					treeEditingNodeType_ == "value-groupid")
				{
					var newValue;

					if (treeEditingNodeType_ == "value-bool") 
					{
						var sel = _editingCellEl.getElementsByTagName("select")[0];
						if (sel.selectedIndex < 0) sel.selectedIndex = 0; //default to default
						newValue = sel.options[sel.selectedIndex].value;
					}
					else if (treeEditingNodeType_ == "value-bitmap") 
					{
						newValue = encodeURIComponent(_editingCellEl.textContent);
					}
					else if (treeEditingNodeType_.indexOf("link-") == 0 &&
						treeEditingNodeType_ != "link-comment")
					{
						//make csv newValue := linkTable,linkInitId
						var sel = _editingCellEl.getElementsByTagName("select")[0];
						if (sel.selectedIndex < 0) sel.selectedIndex = 0; //default to default
						newValue = sel.options[sel.selectedIndex].value;
						newValue += ",";
						sel = _editingCellEl.getElementsByTagName("select")[1];
						if (sel.style.display == "none") 
						{
							//get value from text box if not displayed 
							newValue +=
								encodeURIComponent(
									_editingCellEl.getElementsByTagName("input")[0].value.trim());
						}
						else {
							if (sel.selectedIndex >= 0) //if valid
								newValue += sel.options[sel.selectedIndex].value;
						}

						if (treeEditingNodeType_ == "link-GroupID")
						{
							//make csv newValue := linkTable,linkGroupID,linkTableVersion,groupMemberUID,...

							//add link target table version and chosen group members						
							var linkTargetTable = _editingCellEl.getElementsByTagName("select")[0].value;
							var tableVersion = -1;
							var tableIndex = -1;
							for (var j = 0; j < treeMemberNames_.length; ++j)
								if (linkTargetTable == treeMemberNames_[j]) 
								{
									tableVersion = treeMemberVersions_[j];
									tableIndex = j;
									break;
								}
							//allow broken links, for example "NO_LINK"
							//							if(tableIndex == -1)
							//							{
							//								Debug.log("Invalid linked tree member table!",Debug.HIGH_PRIORITY);
							//								return;					
							//							}
							newValue += "," + tableVersion;

							//save new group members 
							// if different from treeEditingInitGroupMembers_

							var el = document.getElementById("treeView-groupMemberEditDiv");
							var selArr = MultiSelectBox.getSelectionArray(el);

							for (var s in selArr) 
							{
								Debug.log("ms selected [" + s + "]: " +
									selArr[s]);
								if (!selArr[s]) continue;
								Debug.log(MultiSelectBox.getSelectionElementByIndex(el, s).textContent);
								newValue += "," +
									MultiSelectBox.getSelectionElementByIndex(el, s).textContent;
							}
						}
					}
					else if (treeEditingNodeType_ == "table-newGroupRow") 
					{
						//coming from edit setup of group link "link-GroupID"
						var sel = _editingCellEl.getElementsByTagName("select")[0];
						if (sel.selectedIndex < 0) sel.selectedIndex = 0; //default to default
						treeEditingTargetTable_ = sel.options[sel.selectedIndex].value;

						//make csv newValue := linkIndex,linkID,newRowUID

						//start with linkIndex
						newValue = document.getElementById("treeNode-childLinkIndex-" +
							treeEditingNodeIdString_).textContent;

						//add linkID
						newValue += ",";
						sel = _editingCellEl.getElementsByTagName("select")[1];
						if (sel.style.display != "none") //if select box is visible 
						{
							if (sel.selectedIndex >= 0) //if valid
								newValue += sel.options[sel.selectedIndex].value;
						}
						else //take linkId from text edit box
						{
							sel = _editingCellEl.getElementsByTagName("input")[0];
							newValue += encodeURIComponent(sel.value.trim());
						}

						//add newRowUID to new value
						newValue += ",";
						var newRowUID = prompt("Please enter the UID for the new record:");
						if (newRowUID)
							newValue += encodeURIComponent(newRowUID.trim());
						else //prompt was cancelled
						{
							//revert edit type back to link-GroupID
							treeEditingNodeType_ = "link-GroupID";
							editCellCancel();
							return;
						}
					}
					else if (treeEditingNodeType_ == "table-newUIDRow")
					{
						//coming from edit setup of group link "link-UID"
						var sel = _editingCellEl.getElementsByTagName("select")[0];
						if (sel.selectedIndex < 0) sel.selectedIndex = 0; //default to default
						treeEditingTargetTable_ = sel.options[sel.selectedIndex].value;

						//make new value the new UID 
						newValue = prompt("Please enter the UID for the new record:");
						if (newValue)
							newValue = encodeURIComponent(newValue.trim());
						else //prompt was cancelled
						{
							//revert edit type back to link-UID
							treeEditingNodeType_ = "link-UID";
							editCellCancel();
							return;
						}
					}
					else if (treeEditingNodeType_ == "table-newRow")
					{
						//make new value the new UID 
						newValue = prompt("Please enter the UID for the new record:");
						if (newValue)
							newValue = encodeURIComponent(newValue.trim());
						else //prompt was cancelled
						{
							editCellCancel();
							return;
						}

					}
					else	//value (normal or multiline data)
					{
						var sel;
						if ((sel = _editingCellEl.getElementsByTagName("textarea")).length) //for MultilineData					
							newValue = sel[0].value; //assume the first textarea in the cell is the textarea
						else if ((sel = _editingCellEl.getElementsByTagName("select")).length) //for FixedChoiceData
						{
							//check if displayed
							if (sel[0].style.display == "none") 
							{
								//if not displayed assume first input field is ours!
								//take "normal cell" approach from below
								newValue = _editingCellEl.getElementsByTagName("input")[0].value;
							}
							else
								newValue = sel[0].options[sel[0].selectedIndex].value; //assume the first select dropbox in the cell is the one
						}
						else if (treeEditingNodeType_ == "delete-uid" && //take from old value if deleting this node programatically (not from user clicking directly)
							(sel = _editingCellEl.getElementsByTagName("input")).length == 0)
							newValue = treeEditingNodeInitValue_;
						else
							newValue = _editingCellEl.getElementsByTagName("input")[0].value;

						newValue = encodeURIComponent(newValue.trim());
					} //end extraction of newValue based on type

					Debug.log("CfgGUI editTreeNodeOK editing " + treeEditingNodeType_ + " node = " +
						newValue);

					//check if value was modified, and if it should have been

					if (encodeURIComponent(treeEditingNodeInitValue_) == newValue) 
					{
						//some types allow no change
						if (treeEditingNodeType_ != "delete-uid" &&
							treeEditingNodeType_ != "table-newGroupRow" &&
							treeEditingNodeType_ != "table-newUIDRow") 
						{
							Debug.log("No change. Do nothing.");
							editCellCancel();
							return;
						}
						else
							Debug.log("No change. OK for operation.");
					}
					else if (	//some types REQUIRE no change
						treeEditingNodeType_ == "delete-uid")
					{
						Debug.log("The UID you are trying to delete has not been " +
							"saved yet. You can not delete a locally modified UID.",
							Debug.HIGH_PRIORITY);
						editCellCancel();
						return;
					}

					//save affected table as temporary version (re-use active temporary version at server)
					//		if saved successfully
					//			update value in tree-view and scan for other needed changes				

					var tableVersion = -1;
					var tableIndex = -1;
					for (var j = 0; j < treeMemberNames_.length; ++j)
						if (treeEditingTargetTable_ == treeMemberNames_[j] &&
								(treeMemberVersions_[j] | 0) != -1) //make sure not mockup version
						{
							tableVersion = treeMemberVersions_[j];
							tableIndex = j;
							break;
						}
					if (tableIndex == -1) 
					{
						Debug.err("Invalid tree member table targeted, could not find able '" +
							treeEditingTargetTable_ + "' in the list of tree tables. " +
							"Perhaps the tree needs to be refreshed? " +
							"Or the table needs to be added to one of the active groups?" +
							"\n\n" +
							//Important! same as ConfigurationGUISupervisor.cc L:4559
							//Important! similar to ConfigurationGUI.html: tableLinkTooltip(): L:11860
							// CHANGES MUST BE PROPAGATED
							"To add a table to a group, click the group name to go to the " +
							"group view, then click 'Add/Remove/Modify Member Tables.' You " +
							"can then add or remove tables and save the new group." +
							"\n\n" +
							"OR!!! Click the following button to add the table '" + treeEditingTargetTable_ +
							"' to the Configuration Group: " +
							"<input type='button' style='color:black !important;' " +
							"title='Click to add table to the active Configuration Group' " +
							"onclick='addTableToConfigurationGroup(\"" +
							treeEditingTargetTable_ + "\"); Debug.closeErrorPop();event.stopPropagation(); ' value='Add Table'>" +
							"</input>");
						return;
					}

					//send edit to server
					DesktopContent.XMLHttpRequest("Request?RequestType=saveTreeNodeEdit" +
						"&editNodeType=" + treeEditingNodeType_ +
						"&targetTable=" + treeEditingTargetTable_ +
						"&targetTableVersion=" + tableVersion +
						"&targetUID=" + treeEditingTargetUID_ +
						"&targetColumn=" + treeEditingTargetColumn_
						,
						"newValue=" + newValue, //newValue post in case the value is large 
						function (req) 
						{
							var err = DesktopContent.getXMLValue(req, "Error");
							if (err) 
							{
								var warnings = req.responseXML.getElementsByTagName("Warning");
								for (var i = 0; i < warnings.length; ++i)
									Debug.log(DesktopContent.getXMLValue(warnings[i]),
										Debug.WARN_PRIORITY);

								//suppress same value error
								if (err.indexOf("is the same as the current value. No need to save node.") > 0) 
								{
									Debug.log(err);
									return;
								}
								Debug.log("If you do not understand the error, try refreshing the tree from the '>>' menu in the top left of the page", Debug.HIGH_PRIORITY);
								Debug.log(err, Debug.HIGH_PRIORITY);

								editCellCancel();
								return;
							}

							//maintain tree member versions
							// (Note: more than one table may have changed!)
							var resultingTableNames = req.responseXML.getElementsByTagName("savedName");
							var resultingTableVersions = req.responseXML.getElementsByTagName("savedVersion");

							var resultingTableIndex;
							var resultingTableName;
							for (var i = 0; i < resultingTableNames.length; ++i) 
							{
								resultingTableIndex = -1;
								resultingTableName = DesktopContent.getXMLValue(resultingTableNames[i]);

								for (var j = 0; j < treeMemberNames_.length; ++j)
									if (resultingTableName == treeMemberNames_[j]) 
									{
										treeMemberVersions_[j] =
											DesktopContent.getXMLValue(resultingTableVersions[i]);
										resultingTableIndex = j;
										break;
									}
								if (resultingTableIndex == -1) 
								{
									Debug.log("Invalid tree member '" + resultingTableName +
										"' was changed! Should be impossible. If repeatable, alert admins.",
										Debug.HIGH_PRIORITY);
									return;
								}
								Debug.log("New table version for " + resultingTableName + " = " +
									treeMemberVersions_[resultingTableIndex]);
							}

							if (!_editingCellEl) 
							{
								Debug.log("Mid request _editingCellEl became invalid. Assuming there was a cancel?");
								editCellCancel();
								return;
							}
							//change target edit tree node 
							localEditTreeNodeOKRequestsComplete(tableIndex, newValue);

							//now need to propagate changes throughout tree
							//	note: arguments can vary by edit type
							editTreeNodePropagateChange(newValue);

							//refresh versions based on treeMemberVersions_ fix all the table and table-link versions
							refreshTreeTableVersions();

							//add tree save buttons
							treeHasChanged();

							//finish special handling of new row					
							if (treeEditingNodeType_ == "table-newRow") 
							{
								//if hiding status, switch and refresh
								if (treeViewHideStatus_) 
								{
									//treeViewHideStatus_ = false;
									//refreshTreeView();
									DesktopContent.tooltip("Tree View Hide Nodes w/Status=False", "The tree-view menu option 'Hide Nodes w/Status=False' " +
										" is currently hiding records with Status fields evaluating to " +
										" false. If you do not see your new record, this may be why; click the tree-view menu " +
										"in the top-left and select '" +
										"<a href='#' onclick='treeViewHideStatus_=false;refreshTreeView();'>" +
										"Show Nodes w/Status=False" +
										"</a>" +
										".'");
								}

								//							Debug.log("Successfully added a new record to temporary version '" +
								//									treeMemberVersions_[resultingTableIndex] + "' of table '" + 
								//									treeEditingTargetTable_ + ".'",
								//									Debug.INFO_PRIORITY);						
							}
							else if (treeEditingNodeType_ == "table-newGroupRow")
							{
								//revert edit type back to link-GroupID
								treeEditingNodeType_ = "link-GroupID";
							}
							else if (treeEditingNodeType_ == "table-newUIDRow") 
							{
								//revert edit type back to link-UID
								treeEditingNodeType_ = "link-UID";
							}

							//recover (possibly) modified target table
							treeEditingTargetTable_ = initTargetTable;

						}, 0, 0, true //reqParam, progressHandler, callHandlerOnErr
					); //end of getActiveTableGroups handler
				}
				else	//unrecognized type!?
				{
					Debug.log("Unrecognizd tree edit type! Should be impossible!", Debug.HIGH_PRIORITY);
					editCellCancel();
					return;
				}


				//withhold ending edit until after request completes
				//			_editingCell = false;
				//			_editingCellEl = 0;	


				///////////////////////////////////////////////
				//localEditTreeNodeOKRequestsComplete
				//	called after successful edit req return
				function localEditTreeNodeOKRequestsComplete(tableIndex, newValue)
				{
					Debug.log("localEditTreeNodeOKRequestsComplete " + newValue);

					//some types should be handled before cell is cleared
					//	e.g. for continuation of editing, like "table-newGroupRow"
					//	and "table-newUIDRow"
					if (treeEditingNodeType_ == "table-newGroupRow") //spawns from group link edit)
					{
						//clear children and re-toggle if shown	
						//then 
						//reselect target edit node

						var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" +
							treeEditingNodeIdString_);
						var wasDisplayed = elChildrenNode.style.display != "none" &&
							elChildrenNode.innerHTML != "";

						toggleTreeChildren(
							treeEditingNodeIdString_.split('-')[0],
							treeEditingNodeIdString_.split('-')[1], false);
						elChildrenNode.innerHTML = "";

						if (wasDisplayed)
							toggleTreeChildren(
								treeEditingNodeIdString_.split('-')[0],
								treeEditingNodeIdString_.split('-')[1], true);

						//reload members in multiselect
						_editingCellEl.getElementsByTagName("select")[0].onchange();
						return;
					}
					else if (treeEditingNodeType_ == "table-newUIDRow") //spawns from uid link edit)
					{
						//reload members uid dropdown
						_editingCellEl.getElementsByTagName("select")[0].onchange(newValue);
						return;
					}


					// all other types are clearing the cell

					_editingCellEl.innerHTML = "";


					if (treeEditingNodeType_ == "table") 
					{
						treeMemberComments_[tableIndex] = newValue;
						_editingCellEl.appendChild(document.createTextNode("//" + decodeURIComponent(newValue)));
					}
					else if (treeEditingNodeType_ == "link-comment") 
					{
						treeMemberComments_[tableIndex] = newValue;
						var el = el = document.getElementById("treeNode-TableComment-" + treeEditingNodeIdString_);
						el.innerHTML = "";
						el.appendChild(document.createTextNode("//" + decodeURIComponent(newValue)));
					}
					else if (treeEditingNodeType_ == "table-newRow") 
					{
						//replace the value that was erased with table name
						_editingCellEl.appendChild(document.createTextNode(treeEditingTargetTable_));

						//reset children
						toggleTreeChildren(treeEditingNodeIdString_.split('-')[0],
							treeEditingNodeIdString_.split('-')[1], false);
						document.getElementById("treeNode-ChildrenOf-" +
							treeEditingNodeIdString_).innerHTML = "";
						toggleTreeChildren(treeEditingNodeIdString_.split('-')[0],
							treeEditingNodeIdString_.split('-')[1], true);
					}
					else if (treeEditingNodeType_ == "uid") 
					{
						//modify display and nodename with new value
						_editingCellEl.appendChild(document.createTextNode(decodeURIComponent(newValue)));

						var el = document.getElementById("treeNode-nodeName-" +
							treeEditingNodeIdString_);
						el.innerHTML = "";
						el.appendChild(document.createTextNode(decodeURIComponent(newValue)));

						//clear children,
						//and if children were displayed
						//		then toggle/show new children 
						var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" +
							treeEditingNodeIdString_);
						var wasDisplayed = elChildrenNode.style.display != "none" &&
							elChildrenNode.innerHTML != "";

						toggleTreeChildren(
							treeEditingNodeDepth_,
							treeEditingNodeIdString_.split('-')[1], false);
						elChildrenNode.innerHTML = "";

						if (wasDisplayed)
							toggleTreeChildren(
								treeEditingNodeDepth_,
								treeEditingNodeIdString_.split('-')[1], true);
					}
					else if (treeEditingNodeType_ == "delete-uid")
					{
						//reset parent children is enough
						//	correct response should come from server



						//var el = document.getElementById("treeNode-" + treeEditingNodeIdString_);
						var pel = document.getElementById("treeNode-ChildrenOf-" +
							treeEditingNodeParentIdString_);

						//pel.removeChild(el);

						//reset parent children
						toggleTreeChildren(treeEditingNodeParentIdString_.split('-')[0],
							treeEditingNodeParentIdString_.split('-')[1], false);
						pel.innerHTML = "";

						//check if parent is now empty in the handler treeViewHandler()
						toggleTreeChildren(treeEditingNodeParentIdString_.split('-')[0],
							treeEditingNodeParentIdString_.split('-')[1], true);

						Debug.log("treeEditingNodeParentIdString_ " + treeEditingNodeParentIdString_);




					}
					else if (treeEditingNodeType_.indexOf("link-") == 0) 
					{
						//change link table/id and clear children
						//and edit peripheral link info

						var csvArr = newValue.split(',');

						if (!refreshLinkTreeNode(
							_editingCellEl,//targetEl,
							treeEditingNodeIdString_,//idString
							treeEditingTargetColumn_,//LinkColumnNameLabel
							treeEditingNodeType_.split('-')[1],//linkType
							csvArr[0],//linkTable
							csvArr[1]))//linkId
						//,tableComment,tableTitle,menuItems,menuItemHandlers);
						{
							//if disconnected from edit, show tooltip
							tableLinkTooltip("We noticed you have a disconnected link.");
						}
					}
					else if (treeEditingNodeType_ == "value" ||
						treeEditingNodeType_ == "value-bitmap") 
					{
						//if(treeEditingNodeType_ == "MultilineData")
						//MultilineData and normal
						//normal data
						//bitmap data (do nothing would be ok, value already set)
						_editingCellEl.appendChild(document.createTextNode(decodeURIComponent(newValue)));

					}
					else if (treeEditingNodeType_ == "value-bool") 
					{
						var str = "";

						//colorize true false														
						str += "<div style='float:left'>";
						str += newValue;
						str += "</div>";

						var color = (newValue == "On" || newValue == "Yes" || newValue == "True") ?
							"rgb(16, 204, 16)" : "rgb(255, 0, 0);";
						str += "<div style='width:10px;height:10px;" +
							"background-color:" + color + ";" +
							"float: left;" +
							"border-radius: 7px;" +
							"border: 2px solid white;" +
							"margin: 2px 0 0 6px;" +
							"'></div>";
						_editingCellEl.innerHTML = str;
					}
					else if (treeEditingNodeType_ == "value-groupid") 
					{
						//if parent is a link (depth != 2)
						//	then if no longer in group
						//		then delete from group
						//		if no more children, say no children
						//	else just change value
						//else
						//	change value 

						if (treeEditingNodeDepth_ != 2)
						{
							//check if in group still:
							//	get LINKID of groupid
							//	get LINKID of parent group link
							//	if not matching link
							//		just change value (still in group) and done						
							//	if matching LINKIDs
							//		check if still in group .. 
							//		(could be separated by | and still in group)


							//try: if failure to find parentLinkIndex, 
							//	then likely editing the groupID locally where groupID value is not relevant to position in tree
							try 
							{
								var parentLinkIndex;
								parentLinkIndex =
									document.getElementById("treeNode-childLinkIndex-" +
										(document.getElementById("treeNode-ParentId-" +
											treeEditingNodeParentIdString_).textContent)).textContent;

								var vel = document.getElementById("treeNode-Value-" + treeEditingNodeIdString_);

								//if value-groupid node, link index is last in element class name
								var colType = vel.className.split(' ')[1];
								var selfLinkIndex = colType.substr(
									("treeNode-ValueType-GroupID").length);

								var groupId = document.getElementById("treeNode-Value-" +
									((document.getElementById("treeNode-ParentId-" +
										treeEditingNodeParentIdString_).textContent))).textContent;
								groupId = groupId.split('=')[1].substr(1); //get after =
								groupId = groupId.substr(0, groupId.length - 1); //remove ending )

								Debug.log("parentLinkIndex = " + parentLinkIndex);
								Debug.log("selfLinkIndex = " + selfLinkIndex);
								Debug.log("groupId = " + groupId);

								if (parentLinkIndex != selfLinkIndex) //no match
								{
									//just change value (still in group) and done	
									_editingCellEl.appendChild(document.createTextNode(newValue));
								}
								else //matching link ids
								{
									var groupIds = newValue.split('|');
									var stillInGroup = false;
									for (var i = 0; i < groupIds.length; ++i)
										if (groupIds[i].trim() == groupId)
										{
											Debug.log("found groupIds[" + i + "] = " + groupIds[i]);
											stillInGroup = true;
											break;
										}

									if (stillInGroup)
										_editingCellEl.appendChild(document.createTextNode(newValue));
									else // remove from group
									{
										//need to remove parent 'treeNode' from 
										//	parent-of-parent childrenNode: 
										var parentTreeNode = document.getElementById("treeNode-" +
											treeEditingNodeParentIdString_);
										var popChildrenNode = parentTreeNode.parentNode;
										popChildrenNode.removeChild(parentTreeNode);

										//if no more children, say so
										var popChildren = popChildrenNode.getElementsByClassName("treeNode");
										if (popChildren.length == 0)
										{
											var str = "";
											str +=
												"<div class='treeNode'> " +
												"<div class='treeNode-Connection'></div>" +
												"<div class='treeNode-Value'>";

											str += "No Children Nodes Found.";

											str += "</div>" + //end treeNode Value div		
												"</div>" + //end treeNode div							
												"<div id='clearDiv'></div>";
											popChildrenNode.innerHTML = str;
										}
									}
								}
							}
							catch (e) 
							{
								//assume new value is not relevant to position in tree
								//finish edit
								Debug.log("Assuming new value is not relevant to position in tree - here is the error: " + e);
								_editingCellEl.appendChild(document.createTextNode(newValue));
							}
						}
						else
							_editingCellEl.appendChild(document.createTextNode(newValue));
					}
					else	//unrecognized type!?
					{
						Debug.log("Unrecognizd tree edit type! Should be impossible!", Debug.HIGH_PRIORITY);
						editCellCancel();
						return;
					}

					//requests are done, so end editing
					_editingCell = false;
					_editingCellEl = 0;
				} //end localEditTreeNodeOKRequestsComplete
				///////////////////////////////////////////////


			}
			catch (e) 
			{
				Debug.med("Error occured during editCellOK - attempting to recover. Error: ", e);
				editCellCancel();
			}
		} //end editTreeNodeOK()

		//==============================================================================
		//refreshTreeTableVersions ~~
		//	refresh versions based on treeMemberVersions_ fix all the table and table-link versions
		function refreshTreeTableVersions() 
		{
			Debug.log("Refreshing tree table versions...");

			//for each table and link
			//	get table name, and lookup version
			//	fix table/link based on version

			var table;
			var idString;
			var tableStringsObj;

			////////////////////////////
			function localEditTableVersion(targetEl, tableStringsObj)
			{
				var treeNavContextMenuItems = tableStringsObj.treeNavContextMenuItems;
				var treeNavContextMenuItemHandlers = tableStringsObj.treeNavContextMenuItemHandlers;
				//var tableComment = tableStringsObj.tableComment;
				var tableTitle = tableStringsObj.tableTitle;
				var idString = targetEl.id.substr(("treeNode-Value-").length);

				///////////////////////////////
				//change element title
				targetEl.title = tableTitle;

				//get context menu element
				var el = document.getElementById("treeNode-LinkContextMenuTD-" +
					idString);

				///////////////////////////////	
				//change context menu
				// same as in function refreshLinkTreeNode(targetEl,...)
				if (treeNavContextMenuItemHandlers.length == 0) 
				{
					//no context menu items found
					//assume DISCONNECTED!

					el.style.display = "none"; //hide context menu element

					Debug.log("Empty treeNavContextMenuItemHandlers array! Assuming disconnected link.");
				}
				else 
				{
					//change context menu for table link							

					el.style.display = "block"; //show context menu element

					var str = "";
					str +=
						"<div class='treeNode-Link' " + //start treeNode Link div
						"onmousedown='" + // start link onmousedown
						SimpleContextMenu.createMenuCallAsString(
							treeNavContextMenuItems,
							treeNavContextMenuItemHandlers,
							"treeNavContextMenu",
							_CONTEXT_MENU_PRIMARY_COLOR,
							_CONTEXT_MENU_SECONDARY_COLOR) + "' "; // end link onmousedown

					str +=
						">" +
						"<div class='gotoNavDiv'></div>" +
						"</div>"; //end treeNode Link div

					el.innerHTML = str;
				}

			} // end localEditTableVersion

			var els = document.getElementsByClassName("treeNode-Value-nodeEditType-link");
			//for each link
			for (var i = 0; i < els.length; ++i) 
			{
				try 
				{
					idString = els[i].id.substr(("treeNode-Value-").length);
					table = document.getElementById("treeNode-linkTableName-" + idString).textContent;

					localEditTableVersion(els[i], getTreeViewTableStrings(table, true /*isLink*/));
				}
				catch (e) 
				{
					//ignore errors
					Debug.log("Failed link table version refresh: " + e);
					continue;
				}
			}

			els = document.getElementsByClassName("treeNode-Value-nodeEditType-table");
			//for each table
			for (var i = 0; i < els.length; ++i) 
			{
				try 
				{
					table = els[i].textContent;
					localEditTableVersion(els[i], getTreeViewTableStrings(table));
				}
				catch (e)
				{
					//ignore errors
					Debug.log("Failed table version refresh: " + e);
					continue;
				}
			}
		} //end refreshTreeTableVersions()

		//==============================================================================
		//refreshLinkTreeNode ~~
		//	updates link context menu
		//		last 4 commented inputs are generated by getTreeViewTableStrings(tableLinkName)
		//		linkType is "GroupID" or "UID"
		//
		//	return false for DISCONNECTED else true
		function refreshLinkTreeNode(targetEl, idString, LinkColumnNameLabel, linkType, linkTable, linkId)
		{
			//clear target element
			targetEl.innerHTML = "";

			var retVal = getTreeViewTableStrings(linkTable);
			var treeNavContextMenuItems = retVal.treeNavContextMenuItems;
			var treeNavContextMenuItemHandlers = retVal.treeNavContextMenuItemHandlers;
			var tableComment = retVal.tableComment;
			var tableTitle = retVal.tableTitle;
			var el;

			///////////////////////////////
			//change element title
			targetEl.title = tableTitle;

			///////////////////////////////			
			//add type/ID as text node first in case not html safe
			var newValue = "-(" + linkType + " = " + linkId + ")";
			targetEl.appendChild(document.createTextNode(newValue));

			//then add html piece to tartget node (acquire html version of type/ID
			newValue = targetEl.innerHTML;
			newValue = "<label class='treeNode-LinkColumnNameLabel'>" +
				LinkColumnNameLabel +
				"</label>" +
				newValue;
			targetEl.innerHTML = newValue;


			///////////////////////////////
			//change link table name			
			el = document.getElementById("treeNode-linkTableName-" +
				idString);
			el.innerHTML = "";
			el.appendChild(document.createTextNode(linkTable));

			///////////////////////////////
			//change link table comment
			el = document.getElementById("treeNode-TableComment-" +
				idString);
			el.innerHTML = "";
			if (tableComment != "")
				el.appendChild(document.createTextNode("//" + tableComment));

			//get context menu element
			el = document.getElementById("treeNode-LinkContextMenuTD-" +
				idString);

			///////////////////////////////		
			//change context menu
			// same as in refreshTreeTableVersions():localEditTableVersion(targetEl,...)
			if (treeNavContextMenuItemHandlers.length == 0)
			{
				//no context menu items found
				//assume DISCONNECTED!

				el.style.display = "none"; //hide context menu element

				Debug.log("Empty treeNavContextMenuItemHandlers array! Assuming disconnected link.");

				//append disconnected to value
				newValue += "-" +
					"<label class='treeNode-LinkDisconnectedLabel'>" +
					"DISCONNECTED" +
					"</label>";
				targetEl.innerHTML = newValue;

			}
			else 
			{
				//change context menu for table link							

				el.style.display = "block"; //show context menu element

				var str = "";
				str +=
					"<div class='treeNode-Link' " + //start treeNode Link div
					"onmousedown='" + // start link onmousedown
					SimpleContextMenu.createMenuCallAsString(
						treeNavContextMenuItems,
						treeNavContextMenuItemHandlers,
						"treeNavContextMenu",
						_CONTEXT_MENU_PRIMARY_COLOR,
						_CONTEXT_MENU_SECONDARY_COLOR) + "' "; // end link onmousedown

				str +=
					">" +
					"<div class='gotoNavDiv'></div>" +
					"</div>"; //end treeNode Link div

				el.innerHTML = str;
			}


			///////////////////////////////
			//clear children,
			//and if children were displayed
			//		then toggle/show new children 
			var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" +
				idString);
			var wasDisplayed = elChildrenNode.style.display != "none" &&
				elChildrenNode.innerHTML != "";

			toggleTreeChildren(
				idString.split('-')[0],
				idString.split('-')[1], false);
			elChildrenNode.innerHTML = "";

			if (wasDisplayed)
				toggleTreeChildren(
					idString.split('-')[0],
					idString.split('-')[1], true);

			///////////////////////////////
			//if disconnected, return false
			if (treeNavContextMenuItemHandlers.length == 0)
				return false;
			return true; //true for link is NOT disconnected
		} //end refreshLinkTreeNode()

		//==============================================================================
		//hardRefreshTreeView ~~
		//	redraw tree completely from server request
		function hardRefreshTreeView() 
		{
			Debug.log("hardRefreshTreeView()");
			
			treeViewHandlerStr_ = "";
			
			//capture expanded children status
			doCaptureTreeViewExpand(); 
			
			setupTableGroupTreeView(treeGroupName_, treeGroupKey_);			
			
		} //end hardRefreshTreeView()

		//==============================================================================
		//refreshTreeView ~~
		//	reduce tree back to only root children so that the value are reloaded
		//	but do not reload tables from server in case there are temporary versions
		//	Also, capture expanded nodes for returned expansion
		function refreshTreeView()
		{
			//capture expanded children status
			Debug.log("refreshTreeView()");
			
			doCaptureTreeViewExpand();			
			
			var els = document.getElementsByClassName("treeNode-Value-nodeEditType-table");
			var idString;

			//for each table, toggle children to hidden, and delete childrenOf node
			for (var i = 0; i < els.length; ++i)
			{
				idString = els[i].id.substr(("treeNode-Value-").length);
				toggleTreeChildren(idString.split('-')[0], idString.split('-')[1], false);
				document.getElementById("treeNode-ChildrenOf-" + idString).innerHTML = "";
			}

			//re-acquired the tree string
			treeViewHandlerStr_ = document.getElementById("display").innerHTML;

			//reset editing cell, since it was destroyed
			_editingCell = false;
			_editingCellEl = 0;			

			doRestoreNextTreeViewExpand(); //launch restore expands
			
		} //end refreshTreeView()

		//==============================================================================
		//editTreeNodePropagateChange ~~
		//	arguments are different depending on treeEditingNodeType_.
		//	After propagating change,
		//		last step is to update treeViewHandlerStr_ for page nav		
		function editTreeNodePropagateChange() 
		{
			Debug.log("arguments.length " + arguments.length);
			Debug.log("editTreeNodePropagateChange " + treeEditingNodeType_);

			if (treeEditingNodeType_ == "table")
			{
				//parameters:
				// 	treeEditingTargetTable_
				//	newValue -- arg0

				var newValue = arguments[0];
				Debug.log("editTreeNodePropagateChange " + newValue);

				//find all Links with target table and change comment				
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-link");
					var idString;
					var table;
					var el;
					for (var i = 0; i < els.length; ++i)
					{
						idString = els[i].id.substr(("treeNode-Value-").length);
						table = document.getElementById("treeNode-linkTableName-" + idString).textContent;
						if (table == treeEditingTargetTable_) 
						{
							el = document.getElementById("treeNode-TableComment-" + idString);
							el.innerHTML = "";
							el.appendChild(document.createTextNode("//" + decodeURIComponent(newValue)));
						}
					}
				}
			}
			else if (treeEditingNodeType_ == "link-comment") 
			{
				//parameters:
				// 	treeEditingTargetTable_
				//	newValue -- arg0

				var newValue = arguments[0];
				Debug.log("editTreeNodePropagateChange " + newValue);

				//find all Links with target table and change comment				
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-link");
					var idString;
					var table;
					var el;
					for (var i = 0; i < els.length; ++i) 
					{
						idString = els[i].id.substr(("treeNode-Value-").length);
						table = document.getElementById("treeNode-linkTableName-" + idString).textContent;
						if (table == treeEditingTargetTable_) 
						{
							el = document.getElementById("treeNode-TableComment-" + idString);
							el.innerHTML = "";
							el.appendChild(document.createTextNode("//" + decodeURIComponent(newValue)));
						}
					}
				}

				//find all tables with target table and change comment				
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-table");
					var idString;
					var table;
					var el;
					for (var i = 0; i < els.length; ++i) 
					{
						idString = els[i].id.substr(("treeNode-Value-").length);
						table = els[i].textContent;
						if (table == treeEditingTargetTable_) 
						{
							el = document.getElementById("treeNode-TableComment-" + idString);
							el.innerHTML = "";
							el.appendChild(document.createTextNode("//" + decodeURIComponent(newValue)));
						}
					}
				}


			}
			else if (treeEditingNodeType_ == "table-newRow" ||
				treeEditingNodeType_ == "table-newGroupRow" ||
				treeEditingNodeType_ == "table-newUIDRow") 
			{
				//since add row can only be done at root table
				//find all Links with target table and reset children				
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-link");
					var idString;
					var table, elValSplit;
					var el;
					for (var i = 0; i < els.length; ++i) 
					{
						idString = els[i].id.substr(("treeNode-Value-").length);
						table = document.getElementById("treeNode-linkTableName-" +
							idString).textContent;
						if (table == treeEditingTargetTable_) 
						{
							elValSplit = els[i].textContent.split('(');

							//if ( is missing, then this cell is currently being edited 
							// by type "table-newGroupRow", so skip it
							if (elValSplit.length == 1) continue;

							linkIdType = elValSplit[1].split(' ')[0];

							if (linkIdType != "GroupID") continue; //only consider link GroupIDs

							//reset children
							var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" +
								idString);
							var wasDisplayed = elChildrenNode.style.display != "none" &&
								elChildrenNode.innerHTML != "";

							toggleTreeChildren(
								idString.split('-')[0],
								idString.split('-')[1], false);
							elChildrenNode.innerHTML = "";

							if (wasDisplayed)
								toggleTreeChildren(
									idString.split('-')[0],
									idString.split('-')[1], true);
						}
					}
				}

				//for groupRow and UIDRow also have to refresh target table
				if (treeEditingNodeType_ == "table-newGroupRow" ||
					treeEditingNodeType_ == "table-newUIDRow") 
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-table");

					for (var i = 0; i < els.length; ++i) 
					{
						if (els[i].textContent != treeEditingTargetTable_) continue;

						idString = els[i].id.substr(("treeNode-Value-").length);

						//reset children
						var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" +
							idString);
						var wasDisplayed = elChildrenNode.style.display != "none" &&
							elChildrenNode.innerHTML != "";

						toggleTreeChildren(
							idString.split('-')[0],
							idString.split('-')[1], false);
						elChildrenNode.innerHTML = "";

						if (wasDisplayed)
							toggleTreeChildren(
								idString.split('-')[0],
								idString.split('-')[1], true);

						break; //should only happen once	
					}
				}
			}
			else if (treeEditingNodeType_ == "uid") 
			{
				//parameters:
				// 	treeEditingTargetTable_
				//	treeEditingTargetUID_
				//	newValue -- arg0

				var newValue = arguments[0];
				Debug.log("editTreeNodePropagateChange " + newValue);


				//find all LinkUIDs with target table and UID and clear children				
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-link");
					var idString;
					var table, uid;
					var linkIdType;
					var elChildrenNode, parentIdString;
					for (var i = 0; i < els.length; ++i) 
					{
						idString = els[i].id.substr(("treeNode-Value-").length);
						uid = els[i].textContent;
						linkIdType = uid.split('(')[1].split(' ')[0];

						if (linkIdType == "GroupID") continue; //only consider link UIDs

						uid = uid.split(')')[0].split('=')[1].substr(1);

						//Debug.log("link-idString " + idString + " " + uid);

						table = document.getElementById("treeNode-linkTableName-" + idString).textContent;
						if (table == treeEditingTargetTable_ &&
							uid == treeEditingTargetUID_) 
						{
							//hide parent children, delete them, and re-expand

							parentIdString = document.getElementById("treeNode-ParentId-" +
								idString).textContent;
							elChildrenNode = document.getElementById("treeNode-ChildrenOf-" +
								parentIdString);
							toggleTreeChildren(
								parentIdString.split('-')[0],
								parentIdString.split('-')[1], false);
							elChildrenNode.innerHTML = "";
							toggleTreeChildren(
								parentIdString.split('-')[0],
								parentIdString.split('-')[1], true);
						}
					}
				}

				//find all UID nodes with target table and UID and change
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-uid");
					var table, uid;
					var depth;
					for (var i = 0; i < els.length; ++i) 
					{
						var idString = els[i].id.substr(("treeNode-Value-").length);
						depth = idString.split('-')[0];

						if (treeEditingNodeDepth_ == 1 &&
							depth == 1) continue; //can only possibly be self, which has already changed

						//if verifiably self, also skip
						if (idString == treeEditingNodeIdString_) continue;

						//Debug.log("uid-idString " + idString + " " + els[i].textContent);

						//need table to verify match.. must get from parent
						if (depth == 1)
							table = document.getElementById("treeNode-Value-" +
								(document.getElementById("treeNode-ParentId-" +
									idString).textContent)).textContent;
						else {
							//needs to get from parent OR parent-of-parent
							//	if parent is uid link.. then one level back
							//	if parent is groupid link.. then two levels back

							var pel = document.getElementById("treeNode-linkTableName-" +
								(document.getElementById("treeNode-ParentId-" +
									idString).textContent));
							if (!pel)
								pel = document.getElementById("treeNode-linkTableName-" +
									(document.getElementById("treeNode-ParentId-" +
										(document.getElementById("treeNode-ParentId-" +
											idString).textContent)).textContent));
							if (!pel) 
							{
								Debug.log("Big problem with locating table name through ancestry! " +
									"Please notify developers as to how you got here.",
									Debug.HIGH_PRIORITY);
								return;
							}

							table = pel.textContent;
						}

						//Debug.log("uid-table " + table);
						uid = els[i].textContent;

						if (table == treeEditingTargetTable_ &&
							uid == treeEditingTargetUID_)
						{
							//modify display and nodename with new value						
							//Debug.log("link-idString " + idString + " " + uid);
							Debug.log("uid-idString CHANGE to " + newValue);

							els[i].innerHTML = "";
							els[i].appendChild(document.createTextNode(decodeURIComponent(newValue)));

							var el = document.getElementById("treeNode-nodeName-" + idString);
							el.innerHTML = "";
							el.appendChild(document.createTextNode(decodeURIComponent(newValue)));

							//reset children
							var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" +
								idString);
							var wasDisplayed = elChildrenNode.style.display != "none" &&
								elChildrenNode.innerHTML != "";

							toggleTreeChildren(
								idString.split('-')[0],
								idString.split('-')[1], false);
							elChildrenNode.innerHTML = "";

							if (wasDisplayed)
								toggleTreeChildren(
									idString.split('-')[0],
									idString.split('-')[1], true);
						}
					}
				}
			}
			else if (treeEditingNodeType_ == "delete-uid") 
			{
				//for all matches
				//	reset parent children is enough
				//		correct response should come from server

				//parameters:
				// 	treeEditingTargetTable_
				//	treeEditingTargetUID_

				//find all LinkUIDs with target table and UID and clear children				
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-link");
					var idString;
					var table, uid;
					var linkIdType;
					var elChildrenNode, parentIdString;
					for (var i = 0; i < els.length; ++i) 
					{
						idString = els[i].id.substr(("treeNode-Value-").length);
						uid = els[i].textContent;
						linkIdType = uid.split('(')[1].split(' ')[0];

						if (linkIdType == "GroupID") continue; //only consider link UIDs

						uid = uid.split(')')[0].split('=')[1].substr(1);

						//Debug.log("link-idString " + idString + " " + uid);

						table = document.getElementById("treeNode-linkTableName-" + idString).textContent;
						if (table == treeEditingTargetTable_ &&
							uid == treeEditingTargetUID_) 
						{
							//hide parent children, delete them, and re-expand

							parentIdString = document.getElementById("treeNode-ParentId-" +
								idString).textContent;
							elChildrenNode = document.getElementById("treeNode-ChildrenOf-" +
								parentIdString);
							toggleTreeChildren(
								parentIdString.split('-')[0],
								parentIdString.split('-')[1], false);
							elChildrenNode.innerHTML = "";
							toggleTreeChildren(
								parentIdString.split('-')[0],
								parentIdString.split('-')[1], true);
						}
					}
				}

				//find all UID nodes with target table and UID and change
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-uid");
					var table, uid;
					var depth;
					var elChildrenNode, parentIdString;
					for (var i = 0; i < els.length; ++i) 
					{
						var idString = els[i].id.substr(("treeNode-Value-").length);
						depth = idString.split('-')[0];

						if (treeEditingNodeDepth_ == 1 &&
							depth == 1) continue; //can only possibly be self, which has already changed

						//if verifiably self, also skip
						if (idString == treeEditingNodeIdString_) continue;

						//Debug.log("uid-idString " + idString + " " + els[i].textContent);

						//need table to verify match.. must get from parent
						if (depth == 1)
							table = document.getElementById("treeNode-Value-" +
								(document.getElementById("treeNode-ParentId-" +
									idString).textContent)).textContent;
						else 
						{
							//needs to get from parent OR parent-of-parent
							//	if parent is uid link.. then one level back
							//	if parent is groupid link.. then two levels back

							var pel;

							try 
							{
								pel = document.getElementById("treeNode-linkTableName-" +
									(document.getElementById("treeNode-ParentId-" +
										parentIdString).textContent));
							}
							catch (e) 
							{
								Debug.log("Problem with ancestry! Hopefully this was remnants from an edit already completed (like double clicking?). " +
									"Error: " + e);
								return;
							}

							if (!pel)
								pel = document.getElementById("treeNode-linkTableName-" +
									(document.getElementById("treeNode-ParentId-" +
										(document.getElementById("treeNode-ParentId-" +
											parentIdString).textContent)).textContent));
							if (!pel) 
							{
								Debug.log("Big problem with locating table name through ancestry! " +
									"Please notify developers as to how you got here.",
									Debug.HIGH_PRIORITY);
								return;
							}

							table = pel.textContent;
						}

						//Debug.log("uid-table " + table);
						uid = els[i].textContent;

						if (table == treeEditingTargetTable_ &&
							uid == treeEditingTargetUID_)
						{
							//hide parent children, delete them, and re-expand

							parentIdString = document.getElementById("treeNode-ParentId-" +
								idString).textContent;
							elChildrenNode = document.getElementById("treeNode-ChildrenOf-" +
								parentIdString);
							toggleTreeChildren(
								parentIdString.split('-')[0],
								parentIdString.split('-')[1], false);
							elChildrenNode.innerHTML = "";
							toggleTreeChildren(
								parentIdString.split('-')[0],
								parentIdString.split('-')[1], true);
						}
					}
				}
			}
			else if (treeEditingNodeType_.indexOf("link-") == 0)
			{
				//For all link nodes
				//	change link table/id and clear children
				//	and edit peripheral link info

				//parameters:
				// 	treeEditingTargetTable_
				//	treeEditingTargetUID_
				//	treeEditingTargetColumn_
				//	newValue -- arg0

				var newValue = arguments[0];


				var csvArr = newValue.split(',');
				var linkTable = csvArr[0];
				var linkId = csvArr[1];
				var linkType = treeEditingNodeType_.split('-')[1]; //GroupID or UID

				//				newValue = 
				//						"<label style='color:rgb(65, 86, 146);font-weight:bold;'>" +
				//						treeEditingTargetColumn_ + 
				//						"</label>" +
				//						"-(" + 
				//						treeEditingNodeType_.split('-')[1] + " = " + linkId + ")";
				//
				//				Debug.log("editTreeNodePropagateChange " + newValue);

				//find all Links with target table and UID and column and clear children				
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-link");
					var idString;
					var table, uid, col;
					var depth;

					for (var i = 0; i < els.length; ++i) 
					{
						idString = els[i].id.substr(("treeNode-Value-").length);
						depth = idString.split('-')[0];

						//this could save a substantial amount of searching
						if (treeEditingNodeDepth_ == 2 &&
							depth == 2 && linkType != "GroupID") continue; //can only possibly be self, which has already changed

						//if verifiably self, also skip
						if (idString == treeEditingNodeIdString_) continue;

						Debug.log("value-idString " + idString + " " + els[i].textContent);

						//verify column match...
						var tmpSplit = els[i].textContent.split('-');
						col = tmpSplit[0]; //get before dash
						if (col != treeEditingTargetColumn_)
						{
							//if group link, may still need to modify children
							//	if matching table and groupID!
							if(linkType == "GroupID")
							{
								Debug.log("Checking for groupID match");
								
								try
								{
									var p = tmpSplit[1].lastIndexOf('=')+2; //get past "= "
									var tmpLinkId = tmpSplit[1].substr(p,tmpSplit[1].length-p-1); //remove last )
									if(linkId == tmpLinkId
											&&
											linkTable == document.getElementById(
													"treeNode-linkTableName-" + idString).innerText 
											) 
									{
										Debug.log("Found matching table/groupId: " + linkId + "," +
												linkTable);
										
										//change link table/id and clear children
										//and edit peripheral link info
										refreshLinkTreeNode(
												els[i],//targetEl,
												idString,//idString
												col,//LinkColumnNameLabel
												linkType,//linkType
												linkTable,//linkTable
												linkId);//linkId
										//,tableComment,tableTitle,menuItems,menuItemHandlers);
										continue; //keep looking for more matches
									}
								}
								catch(e)
								{} //ignore error
							}
							
							continue; //skip if not column match
						}

						//need table/uid to verify match.. must get from parent of parent
						parentIdString = document.getElementById("treeNode-ParentId-" +
							idString).textContent;

						uid = document.getElementById("treeNode-Value-" +
							parentIdString).textContent;

						if (depth == 2)
							table = document.getElementById("treeNode-Value-" +
								(document.getElementById("treeNode-ParentId-" +
									parentIdString).textContent)).textContent;
						else 
						{
							//needs to get table from parent OR parent-of-parent
							//	if parent is uid link.. then one level back
							//	if parent is groupid link.. then two levels back

							var pel = document.getElementById("treeNode-linkTableName-" +
								parentIdString);
							if (!pel)
								pel = document.getElementById("treeNode-linkTableName-" +
									(document.getElementById("treeNode-ParentId-" +
										parentIdString).textContent));
							else //parent is uid link, so UID from path is wrong, fix it
							{
								//take uid from parent value, right side						
								uid = document.getElementById("treeNode-Value-" +
									parentIdString).textContent.
									split(')')[0].split('=')[1].substr(1);
							}

							table = pel.textContent;
						}

						Debug.log("link-table " + table);
						Debug.log("link-uid " + uid);

						if (table != treeEditingTargetTable_ ||
							uid != treeEditingTargetUID_)
							continue; //skip if table/uid does not match

						//change link table/id and clear children
						//and edit peripheral link info
						refreshLinkTreeNode(
							els[i],//targetEl,
							idString,//idString
							treeEditingTargetColumn_,//LinkColumnNameLabel
							linkType,//linkType
							linkTable,//linkTable
							linkId);//linkId
						//,tableComment,tableTitle,menuItems,menuItemHandlers);

					}  //end for loop
				}
			}
			else if (treeEditingNodeType_ == "value" ||
				treeEditingNodeType_ == "value-bool" ||
				treeEditingNodeType_ == "value-bitmap") 
			{
				//parameters:
				// 	treeEditingTargetTable_
				//	treeEditingTargetUID_
				//	treeEditingTargetColumn_
				//	newValue -- arg0

				var newValue = arguments[0];
				Debug.log("editTreeNodePropagateChange " + newValue);

				//find all value nodes with target table and UID and change col
				{
					var els = document.getElementsByClassName(
						"treeNode-Value-leafNode-ColumnName-" + treeEditingTargetColumn_);
					var table, uid;
					var depth;
					var parentIdString;
					for (var i = 0; i < els.length; ++i)
					{
						var idString = els[i].id.substr(("treeNode-Value-leafNode-").length);
						depth = idString.split('-')[0];

						//this could save a substantial amount of searching
						if (treeEditingNodeDepth_ == 2 &&
							depth == 2) continue; //can only possibly be self, which has already changed

						//if verifiably self, also skip
						if (idString == treeEditingNodeIdString_) continue;

						Debug.log("value-idString " + idString + " " + els[i].textContent);

						//need table to verify match.. must get from parent of parent
						parentIdString = document.getElementById("treeNode-ParentId-" +
							idString).textContent;
						if (depth == 2)
							table = document.getElementById("treeNode-Value-" +
								(document.getElementById("treeNode-ParentId-" +
									parentIdString).textContent)).textContent;
						else 
						{
							//needs to get from parent OR parent-of-parent
							//	if parent is uid link.. then one level back
							//	if parent is groupid link.. then two levels back

							var pel = document.getElementById("treeNode-linkTableName-" +
								parentIdString);
							if (!pel)
								pel = document.getElementById("treeNode-linkTableName-" +
									(document.getElementById("treeNode-ParentId-" +
										parentIdString).textContent));

							//							var pel = document.getElementById("treeNode-linkTableName-" + 
							//									(document.getElementById("treeNode-ParentId-" + 
							//											parentIdString).textContent));
							//							if(!pel)
							//								pel = document.getElementById("treeNode-linkTableName-" + 
							//										(document.getElementById("treeNode-ParentId-" + 
							//										(document.getElementById("treeNode-ParentId-" + 
							//												parentIdString).textContent)).textContent));
							if (!pel)
							{
								Debug.log("Big problem with locating table name through ancestry! " +
									"Please notify developers as to how you got here.",
									Debug.HIGH_PRIORITY);
								return;
							}

							table = pel.textContent;
						}

						Debug.log("value-table " + table);
						uid = document.getElementById("treeNode-Value-" +
							parentIdString).textContent;
						Debug.log("value-uid " + table);

						if (table == treeEditingTargetTable_ &&
							uid == treeEditingTargetUID_) 
						{
							//modify display with new value						
							//Debug.log("link-idString " + idString + " " + uid);
							Debug.log("value-idString CHANGE to " + newValue);

							els[i].innerHTML = ""; //clear target el

							if (treeEditingNodeType_ == "value-bool") 
							{
								var str = "";

								//colorize true false														
								str += "<div style='float:left'>";
								str += newValue;
								str += "</div>";

								var color = (newValue == "On" || newValue == "Yes" || newValue == "True") ?
									"rgb(16, 204, 16)" : "rgb(255, 0, 0);";
								str += "<div style='width:10px;height:10px;" +
									"background-color:" + color + ";" +
									"float: left;" +
									"border-radius: 7px;" +
									"border: 2px solid white;" +
									"margin: 2px 0 0 6px;" +
									"'></div>";
								els[i].innerHTML = str;
							}
							else
								els[i].appendChild(document.createTextNode(newValue));

						}
					}
				}
			}
			else if (treeEditingNodeType_ == "value-groupid")
			{
				//parameters:
				// 	treeEditingTargetTable_
				//	treeEditingTargetUID_
				//	treeEditingTargetColumn_
				//	newValue -- arg0

				var newValue = arguments[0];
				var groupIds = newValue.split('|');
				Debug.log("editTreeNodePropagateChange " + newValue);

				//find the singlular depth 2 value node with target table and UID and change col
				if (treeEditingNodeDepth_ != 2) //only if self was not depth 2
				{
					var els = document.getElementsByClassName(
						"treeNode-Value-leafNode-ColumnName-" + treeEditingTargetColumn_);
					var table, uid;
					var depth;
					var parentIdString;
					for (var i = 0; i < els.length; ++i) 
					{
						var idString = els[i].id.substr(("treeNode-Value-leafNode-").length);
						depth = idString.split('-')[0];

						//this could save a substantial amount of searching
						if (depth != 2) continue; //can only possibly be self, which has already changed


						Debug.log("value-idString " + idString + " " + els[i].textContent);

						//depth is forced to 2 by here
						//need table to verify match.. must get from parent of parent						
						table = document.getElementById("treeNode-Value-" +
							(document.getElementById("treeNode-ParentId-" +
								parentIdString).textContent)).textContent;

						Debug.log("value-table " + table);
						uid = document.getElementById("treeNode-Value-" +
							parentIdString).textContent;
						Debug.log("value-uid " + table);

						if (table == treeEditingTargetTable_ &&
							uid == treeEditingTargetUID_) 
						{
							//modify display with new value						
							//Debug.log("link-idString " + idString + " " + uid);
							Debug.log("value-idString CHANGE to " + newValue);

							els[i].innerHTML = ""; //clear target el
							els[i].appendChild(document.createTextNode(newValue));
							break; //done, since can only be one at depth 2
						}
					}
				}

				//find all depth != 1 UID nodes with target table and UID and 
				//	check if link is grouplink and check if it is affected
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-uid");
					var table, uid;
					var depth;
					var parentIdString;
					var groupId, linkIdType, stillInGroup, groupIdIndex;
					for (var i = 0; i < els.length; ++i) 
					{
						var idString = els[i].id.substr(("treeNode-Value-").length);
						depth = idString.split('-')[0];

						if (depth == 1) continue; //only care about group-linked uid nodes

						//Debug.log("uid-idString " + idString + " " + els[i].textContent);

						//need table to verify match.. must get from parent link	
						parentIdString = document.getElementById("treeNode-ParentId-" +
							idString).textContent;

						{
							//needs to get from parent OR parent-of-parent
							//	if parent is uid link.. then one level back
							//	if parent is groupid link.. then two levels back

							var pel = document.getElementById("treeNode-linkTableName-" +
								parentIdString);
							if (!pel)
								pel = document.getElementById("treeNode-linkTableName-" +
									(document.getElementById("treeNode-ParentId-" +
										parentIdString).textContent));

							table = pel.textContent;
						}


						//Debug.log("uid-table " + table);
						uid = els[i].textContent;

						if (table == treeEditingTargetTable_ &&
							uid == treeEditingTargetUID_) 
						{
							//verify parent link is group-link else skip
							groupId = document.getElementById("treeNode-Value-" +
								parentIdString).textContent;
							linkIdType = groupId.split('(')[1].split(' ')[0];

							if (linkIdType != "GroupID") continue;

							//Debug.log("link-idString " + idString + " " + uid);
							Debug.log("uid-idString CHANGE to " + newValue);

							//this is a verified uid in a group-link target
							//check if change keeps the uid in the group or not

							groupId = groupId.split('=')[1].substr(1); //get after =
							groupId = groupId.substr(0, groupId.length - 1); //remove ending )

							Debug.log("groupId = " + groupId);

							stillInGroup = false;
							for (groupIdIndex = 0; groupIdIndex < groupIds.length; ++groupIdIndex)
								if (groupIds[groupIdIndex].trim() == groupId)
								{
									Debug.log("found groupIds[" + groupIdIndex + "] = " +
										groupIds[groupIdIndex]);
									stillInGroup = true;
									break;
								}

							if (!stillInGroup)	// remove from group
							{
								//need to this uid nodes' 'treeNode' from 
								//	parent childrenNode: 
								var elTreeNode = document.getElementById("treeNode-" +
									idString);
								var pChildrenNode = elTreeNode.parentNode;
								pChildrenNode.removeChild(elTreeNode);

								//if no more children, say so
								var pChildren = pChildrenNode.getElementsByClassName("treeNode");
								if (pChildren.length == 0) 
								{
									var str = "";
									str +=
										"<div class='treeNode'> " +
										"<div class='treeNode-Connection'></div>" +
										"<div class='treeNode-Value'>";

									str += "No Children Nodes Found.";

									str += "</div>" + //end treeNode Value div		
										"</div>" + //end treeNode div							
										"<div id='clearDiv'></div>";
									pChildrenNode.innerHTML = str;
								}
							}

						}
					}
				}

				//find all group links with target table and	
				//	if groupId is match 
				//		and if uid is not present 
				//		then clear children				
				{
					var els = document.getElementsByClassName("treeNode-Value-nodeEditType-link");
					var idString;
					var table, groupId, groupIdIndex, foundInGroup;
					var linkIdType;
					for (var i = 0; i < els.length; ++i) 
					{
						idString = els[i].id.substr(("treeNode-Value-").length);
						groupId = els[i].textContent;
						linkIdType = groupId.split('(')[1].split(' ')[0];

						if (linkIdType != "GroupID") continue; //only consider group links


						table = document.getElementById("treeNode-linkTableName-" + idString).textContent;
						if (table != treeEditingTargetTable_) continue; //skip if table does not match

						//check if group id matches
						groupId = groupId.split('=')[1].substr(1); //get after =
						groupId = groupId.substr(0, groupId.length - 1); //remove ending )

						Debug.log("groupId = " + groupId);

						foundInGroup = false;
						for (groupIdIndex = 0; groupIdIndex < groupIds.length; ++groupIdIndex)
							if (groupIds[groupIdIndex].trim() == groupId) 
							{
								Debug.log("found groupIds[" + groupIdIndex + "] = " +
									groupIds[groupIdIndex]);
								foundInGroup = true;
								break;
							}

						if (foundInGroup)
						{
							//if uid is not one of the children then delete them all
							var elChildrenNode = document.getElementById("treeNode-ChildrenOf-" + idString);
							var elChildren = elChildrenNode.childNodes;
							var foundUIDChild = false;
							var uid;

							for (var j = 0; j < elChildren.length; ++j) 
							{
								if (elChildren[j].id.indexOf("treeNode") != 0) continue; //skip superfluous children

								uid = document.getElementById("treeNode-Value-" +
									elChildren[j].id.substr(("treeNode-").length)).textContent;

								Debug.log("uid = " + uid);

								if (uid == treeEditingTargetUID_) 
								{
									foundUIDChild = true;
									break;
								}
							}

							if (!foundUIDChild) 
							{
								//hide children and delete them		
								// if they were shown before, toggle children again to show uids of group

								//Debug.log("link-idString " + idString + " " + uid);
								//Debug.log("link-idString CHANGE to " + newValue);

								var wasDisplayed = elChildrenNode.style.display != "none" &&
									elChildrenNode.innerHTML != "";

								toggleTreeChildren(idString.split('-')[0], idString.split('-')[1], false);
								elChildrenNode.innerHTML = "";

								if (wasDisplayed)
									toggleTreeChildren(idString.split('-')[0], idString.split('-')[1], true);
							}
						}
					}
				}
			}
			else	//unrecognized type!?
			{
				Debug.log("Unrecognizd tree edit type! Should be impossible!", Debug.HIGH_PRIORITY);
			}

			//after propagating change,
			//	last step is to update treeViewHandlerStr_ for page nav			 
			treeViewHandlerStr_ = document.getElementById("display").innerHTML;
		} //end editTreeNodePropagateChange()

		//==============================================================================
		//editCellOK
		function editCellOK() 
		{
			//detect proper views
			var el = document.getElementById("treeView-ConfigGroupLink");
			if (el) //tree view 
				return editTreeNodeOK();

			//avoid doing anything while popup is open
			el = document.getElementById("popUpDialog");
			if (el) //config gui popup
				return;
			el = document.getElementById(ConfigurationAPI._POP_UP_DIALOG_ID);
			if (el) //config API popup
				return;

			//else table view 
			//...

			if (!_editingCellEl) return;

			var r = _editingCellPos[0];
			var c = _editingCellPos[1];

			//if child link cell or boolean cell
			try
			{
				var sel;
				if ((sel = _editingCellEl.getElementsByTagName("select")).length) 
				{
					sel = sel[0]; //assume the first select in the cell is the select

					Debug.log("CfgGUI editCellOK editing r,c:" + r + "," + c);

					//check if displayed
					if (sel.style.display == "none") 
					{
						//if not displayed assume first input field is ours!
						//take "normal cell" approach from below
						var str = "";
						try 
						{
							str = _editingCellEl.getElementsByTagName("input")[0].value;
							Debug.log("CfgGUI editCellOK editing r,c:" + r + "," + c + " = " +
								str);
						}
						catch (err) 
						{
							Debug.log("Error try-catch: " + err);
						}

						_editingCellEl.innerHTML = "";

						if (_editingCellType.indexOf("ChildLink-") == 0 &&
							str != "NO_LINK") 
						{
							var astr = "";
							astr += "<a href='#'>"; //for show
							astr += str;
							astr += "</a>";
							_editingCellEl.innerHTML = astr;
						}
						else
							_editingCellEl.appendChild(document.createTextNode(str));
					}
					else
					{
						if (sel.selectedIndex < 0) sel.selectedIndex = 0; //default to default
						var selVal = sel.options[sel.selectedIndex].value;

						Debug.log("CfgGUI editCellOK = " +
							selVal);

						str = "";
						str += selVal;

						_editingCellEl.innerHTML = "";

						if (_editingCellType.indexOf("ChildLink-") == 0 &&
							str != "NO_LINK") 
						{
							var astr = "";
							astr += "<a href='#'>"; //for show
							astr += str;
							astr += "</a>";
							_editingCellEl.innerHTML = astr;
						}
						else
							_editingCellEl.appendChild(document.createTextNode(str)); //_editingCellEl.innerHTML = str;		

						//assume no child link will be named a boolean word
						var boolTypeTrues = ["On", "True", "Yes"];
						var statusTypeFalses = ["Off", "False", "No"];

						//determine if true value
						var isTrue = false;
						var isFalse = false;
						for (var i = 0; i < boolTypeTrues.length; ++i)
							if (boolTypeTrues[i] == selVal) 
							{
								isTrue = true; break;
							}
						for (var i = 0; !isTrue && i < statusTypeFalses.length; ++i)
							if (statusTypeFalses[i] == selVal) 
							{
								isFalse = true; break;
							}

						if (isTrue)
							_editingCellEl.style.backgroundColor = _TABLE_BOOL_TYPE_TRUE_COLOR;
						else if (isFalse)
							_editingCellEl.style.backgroundColor = _TABLE_BOOL_TYPE_FALSE_COLOR;
					}
				}
				else if ((sel = _editingCellEl.getElementsByTagName("textarea")).length) //for MultilineData
				{
					sel = sel[0]; //assume the first textarea in the cell is the textarea

					Debug.log("CfgGUI editCellOK editing r,c:" + r + "," + c + " = " +
						sel.value);

					var str = sel.value;
					_editingCellEl.innerHTML = "";
					_editingCellEl.appendChild(document.createTextNode(str));
				}
				else //normal cell
				{
					var str = "";
					try 
					{
						str = _editingCellEl.getElementsByTagName("input")[0].value;
						Debug.log("CfgGUI editCellOK editing r,c:" + r + "," + c + " = " +
							str);
					}
					catch (err) 
					{
						Debug.log("Error try-catch: " + err);
					}

					_editingCellEl.innerHTML = "";

					if (_editingCellType.indexOf("ChildLink-") == 0 &&
						str != "NO_LINK") 
					{
						var astr = "";
						astr += "<a href='#'>"; //for show
						astr += str;
						astr += "</a>";
						_editingCellEl.innerHTML = astr;
					}
					else
						_editingCellEl.appendChild(document.createTextNode(str));
				}

			} //catch to make sure editing cell goes false
			catch (err) 
			{
				Debug.log("Error try-catch: " + err);
			}

			_editingCell = false;
			_editingCellEl = 0;

			versionHasChanged();
		} //end editCellOK()

		//==============================================================================
		//tableLinkTooltip
		function tableLinkTooltip(prependString) 
		{
			//get all tables to give option to add table now.			

			DesktopContent.XMLHttpRequest("Request?RequestType=getTables", "",
				function(req)
				{

			var tableNames = req.responseXML.getElementsByTagName("TableName");
			var selectStr = "";
			
			selectStr += "<select id='tableLinkTooltipTableSelect' " +
					"style='width:300px; color:black !important;' " +
					">";

			for (var i = 0; i < tableNames.length; ++i) 
			{
				tableName = tableNames[i].getAttribute("value");
				selectStr += "<option value='" + tableName + "'>" +
						tableName + "</option>";				
			}
			selectStr += "</select>";
			
			DesktopContent.tooltip("FAQ: Where is the Table I want to link to?!",
				prependString + " " +
				"Were you looking for a table name that was NOT in the drop-down list?\n\n" +
				"It is important to note that, when editing links, only currently active " +
				"tables are available to be linked to. If you do not see the table " +
				"name you are looking for, it is probably because that table is not a member " +
				"of the currently active group. To resolve this issue, you must go to the group view and edit " +
				"the group to include the new table as a member." + 
				//Important! similar to ConfigurationGUISupervisor.cc L:4559
				//Important! similar to ConfigurationGUI.html: editTreeNodeOK(): L:9972
				// CHANGES MUST BE PROPAGATED
				"\n\n" +
				"OR!!! Select the missing table and add it now" +
				" to the Configuration Group: " +
				selectStr + " " +
				"<input type='button' style='color:black !important;' " +
				"title='Click to add table to the active Configuration Group' " +
				"onclick='addTableToConfigurationGroup(" +
				"document.getElementById(\"tableLinkTooltipTableSelect\").value); " +
				" Debug.closeErrorPop();event.stopPropagation(); ' value='Add Table'>" +
				"</input>");
			
				}); //end getTables request
			
		} //end tableLinkTooltip()

		//==============================================================================
		//editCellCancel
		function editCellCancel() 
		{
			Debug.log("editCellCancel");

			if (_editingCellEl) //return old value, convert from text to html
			{
				var isTreeView = document.getElementById("treeView-ConfigGroupLink") ? true : false;

				if (isTreeView)
				{
					if (treeEditingNodeType_.indexOf("link") == 0
						&& treeEditingNodeType_ != "link-comment") 
					{
						//if canceling from link edit, show tooltip
						tableLinkTooltip("We noticed you canceled your link edit.");
					}

					if (treeEditingNodeType_ == "value-bool" ||
						treeEditingNodeType_.indexOf("link") == 0 ||
						treeEditingNodeType_ == "table-newGroupRow" ||
						treeEditingNodeType_ == "table-newUIDRow") 
					{
						//take old value as HTML for bool values
						_editingCellEl.innerHTML = _editingCellElOldValue;

						//show again nav context menu
						try 
						{
							if (treeEditingNodeType_.indexOf("link") == 0)
								document.getElementById("treeNode-LinkContextMenuTD-" +
									treeEditingNodeIdString_).style.display = "block";
						}
						catch (e)
						{
							Debug.log("Link does not have context menu? " + e);
						}
					}
					else 
					{
						_editingCellEl.innerHTML = "";
						_editingCellEl.appendChild(document.createTextNode(_editingCellElOldValue));
					}
				}
				else //!isTreeView
				{
					_editingCellEl.innerHTML = "";

					if (_editingCellType.indexOf("ChildLink-") == 0 &&
						_editingCellElOldValue != "NO_LINK") 
					{
						var astr = "";
						astr += "<a href='#'>"; //for show
						astr += _editingCellElOldValue;
						astr += "</a>";
						_editingCellEl.innerHTML = astr;
					}
					else
						_editingCellEl.appendChild(document.createTextNode(_editingCellElOldValue));
				}

				_editingCellEl.title = _editingCellElOldTitle;
			}

			_editingCell = false;
			_editingCellEl = 0;
		}

		//addRow ~~
		// adds row to position r (relative to view on page)
		// absolute row is _dataOffset + r
		function addRow(rowToAdd) 
		{
			Debug.log("CfgGUI addRow " + rowToAdd);

			editCellOK(); //editCellCancel();

			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");
			var str = "";
			var cols = [];

			var colTypes = getTableViewColTypes(rows);


			if (!_tableViewIsTransposed) //reading from normal view
			{
				//get all cols
				for (var r = 0, newr = 0; r < rows.length + 1; ++r) 
				{
					if (r - _CONFIG_DATA_ROW_OFFSET == rowToAdd) 
					{
						//create row of default column cells
						var newRowArr = [];
						for (var c = 0; c < rows[0].childNodes.length; ++c) 
						{
							newRowArr.push(document.createElement("td"));
							if (c >= _CONFIG_DATA_COL_OFFSET) //skip row # column
							{
								if (c - _CONFIG_DATA_COL_OFFSET ==
									_tableDefaultRowValues.length) //add date
									newRowArr[c].innerHTML = ConfigurationAPI.getDateString(new Date());
								else
									newRowArr[c].innerHTML =
										_tableDefaultRowValues[c - _CONFIG_DATA_COL_OFFSET];
							}
						}
						cols[newr] = newRowArr; //add new row
						++newr;
					}

					if (r >= rows.length) continue; //gone through all data already

					if (r == _CONFIG_DATA_ROW_OFFSET - 1) //col names are headers
						cols[newr] = rows[r].getElementsByTagName("th");
					else
						cols[newr] = rows[r].getElementsByTagName("td");
					++newr;
				}

			}
			else						//reading from transposed view
			{
				//get all cols (transposed)
				var tmpCols;
				var numOfNewRows = -1;
				for (var c = 0; c < rows.length; ++c) 
				{
					cols.push([]); //push empty column, for each 

					//assume there is 1 th cell
					tmpCols = rows[c].getElementsByTagName("td");
					for (var r = 0, newr = 0, tmpColsIndex = 0; r < tmpCols.length + 2; ++r) //+1 for th, and +1 for new row
					{
						if (r - _CONFIG_DATA_ROW_OFFSET == rowToAdd)
						{
							//create default col cell to new row
							cols[c][newr] = document.createElement("td");
							if (c >= _CONFIG_DATA_COL_OFFSET) //skip row # column
							{
								if (c - _CONFIG_DATA_COL_OFFSET ==
									_tableDefaultRowValues.length) //add date
									cols[c][newr].innerHTML = ConfigurationAPI.getDateString(new Date());
								else
									cols[c][newr].innerHTML =
										_tableDefaultRowValues[c - _CONFIG_DATA_COL_OFFSET];
							}

							++newr;
						}

						if (r >= tmpCols.length + 1) continue; //gone through all data already

						if (r == _CONFIG_DATA_ROW_OFFSET - 1) //col names are headers
							cols[c][newr] = rows[c].getElementsByTagName("th")[0];
						else //take from the td cels
							cols[c][newr] = tmpCols[tmpColsIndex++];
						++newr;
					}
				}
			}

			//create output string based on cols
			str += createTableViewOutputStr(cols, colTypes);

			el.innerHTML = str;

			versionHasChanged();

			//update last add row link
			if (_tableViewIsTransposed) 
			{
				document.getElementById("lastAddRowLink0").onclick =
					function () 
					{
						addRow(cols[0].length - _CONFIG_DATA_ROW_OFFSET);
						return false;
					};
				document.getElementById("lastAddRowLink1").onclick =
					function () 
					{
						addRow(cols[0].length - _CONFIG_DATA_ROW_OFFSET);
						return false;
					};
			}
			else 
			{
				document.getElementById("lastAddRowLink0").onclick =
					function ()
					{
						addRow(cols.length - _CONFIG_DATA_ROW_OFFSET);
						return false;
					};
				document.getElementById("lastAddRowLink1").onclick =
					function () 
					{
						addRow(cols.length - _CONFIG_DATA_ROW_OFFSET);
						return false;
					};
			}

		} //end addRow()

		//==============================================================================
		//deleteRow ~~
		// delete row at destination
		function deleteRow(rowToDelete)
		{
			Debug.log("CfgGUI deleteRow " + rowToDelete);

			editCellOK(); //editCellCancel();

			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");
			var str = "";
			var cols = [];

			var colTypes = getTableViewColTypes(rows);

			if (!_tableViewIsTransposed) //reading from normal view
			{
				//get all 
				for (var r = 0, newr = 0; r < rows.length; ++r)
				{
					if (r - _CONFIG_DATA_ROW_OFFSET == rowToDelete)
						continue; //skip row to delete

					if (r == _CONFIG_DATA_ROW_OFFSET - 1) //col names are headers
						cols[newr] = rows[r].getElementsByTagName("th");
					else
						cols[newr] = rows[r].getElementsByTagName("td");
					++newr;
				}

			} // end normal view handling
			else 					//reading from transposed view
			{
				//get all cols (transposed)
				var tmpCols;
				var numOfNewRows = -1;
				for (var c = 0; c < rows.length; ++c) 
				{
					cols.push([]); //push empty column, for each 

					//assume there is 1 th cell
					tmpCols = rows[c].getElementsByTagName("td");
					for (var r = 0, newr = 0, tmpColsIndex = 0; r < tmpCols.length + 1; ++r) //+1 for th
					{
						if (r - _CONFIG_DATA_ROW_OFFSET == rowToDelete) { ++tmpColsIndex; continue; }//skip row to delete

						if (r == _CONFIG_DATA_ROW_OFFSET - 1) //col names are headers
							cols[c][newr] = rows[c].getElementsByTagName("th")[0];
						else //take from the td cels
						{
							cols[c][newr] = tmpCols[tmpColsIndex];
							++tmpColsIndex;
						}
						++newr;
					}
				}
			} // end transpose view handling

			str = createTableViewOutputStr(cols, colTypes);
			el.innerHTML = str;
			versionHasChanged();

			//update last add row link
			if (_tableViewIsTransposed) 
			{
				document.getElementById("lastAddRowLink0").onclick =
					function () 
					{
						addRow(cols[0].length - _CONFIG_DATA_ROW_OFFSET);
						return false;
					};
				document.getElementById("lastAddRowLink1").onclick =
					function () 
					{
						addRow(cols[0].length - _CONFIG_DATA_ROW_OFFSET);
						return false;
					};
			}
			else 
			{
				document.getElementById("lastAddRowLink0").onclick =
					function ()
					{
						addRow(rows.length - _CONFIG_DATA_ROW_OFFSET);
						return false;
					};
				document.getElementById("lastAddRowLink1").onclick =
					function () 
					{
						addRow(rows.length - _CONFIG_DATA_ROW_OFFSET);
						return false;
					};
			}
		} //end deleteRow()

		//==============================================================================
		//popUpVersionAliasSpecificGroupForm
		function popUpGroupUploadDownloadForm(groupName, groupKey, isUpload) 
		{
			Debug.log("CfgGUI popUpGroupUploadDownloadForm " + isUpload);

			var type = isUpload ? "upload" : "download";
			var capType = isUpload ? "Upload" : "Download";

			var str = "";

			var el = document.getElementById("popUpDialog");
			if (!el) 
			{
				el = document.createElement("div");
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = isUpload ? 560 : 460;
			var h = 460;
			ConfigurationAPI.setPopUpPosition(el, w /*w*/, h /*h*/);

			var str = "<a id='" +
				"popUpDialog" +
				"-header' onclick='var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "Please select the member tables you would like to " +
				type + ":<br><br>";

			str += "</div><br><br>";

			el.innerHTML = str;


			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";


			DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificTableGroup" +
				"&groupName=" + groupName +
				"&groupKey=" + groupKey,
				"", function (req) 
				{

					var tableNames = req.responseXML.getElementsByTagName("MemberName");
					var tableVersions = req.responseXML.getElementsByTagName("MemberVersion");

					str = "";
					str += "Please select the member tables you would like to " +
						type + " (member count = " + tableNames.length + "):<br><br>";

					if (isUpload) 
					{
						str += "For uploading you have two approaches:<br><b>(a)</b> you can either select one or many files " +
							"in your file browser, or <br><b>(b)</b> you can choose each file individually. <br><br>Choosing files individually " +
							"allows you to have filename mismatches; choosing multiple files at once will upload tables by table name found in the file name.";
						str += "<br><br>";
						str += "<b>(a) Choose multiple files at once:</b><br>";
						str += "<input type='file' multiple='multiple' id='uploadControlMultipleFiles' " +
							"accept='.csv' enctype='multipart/form-data' />";

						str += "<br><br>";
						str += "<b>(b) Choose invidual files:</b><br>";
					}
					else //is download
					{
						str += "Default field delimiters (in Excel and Numbers) vary based " +
								"on keyboard settings, so please select your field delimiter: <br><br>";
						str += "<select id='fieldSelect'>";

						str += "<option value= ',' selected>Comma ,</option>";
						str += "<option value= ';'>Semicolon ;</option>";
						str += "</select><br><br>";

						str += htmlOpen("a",
							{
								"onclick": "var el = document.getElementsByClassName(\"uploadDownloadCheckbox\");" +
									"for(var i in el){var forFirefox = (el[i].checked = true);}",
							},
							"Select All" /*innerHTML*/,
							true /*doCloseTag*/);
						str += " ";
						str += htmlOpen("a",
							{
								"onclick": "var el = document.getElementsByClassName(\"uploadDownloadCheckbox\");" +
									"for(var i in el){var forFirefox = (el[i].checked = false);}",
							},
							"Select None" /*innerHTML*/,
							true /*doCloseTag*/);

						str += "<br>";
					}

					var tableName, tableVersion;
					str += htmlOpen("center");
					str += htmlOpen("table");

					_memberMapForGroupSave = {}; //clear global variable
					for (var i = 0; i < tableNames.length && i < tableVersions.length; ++i) 
					{
						tableName = tableNames[i].getAttribute("value");
						tableVersion = tableVersions[i].getAttribute("value");
						_memberMapForGroupSave[tableName] = tableVersion;

						str += htmlOpen("tr");
						str += htmlOpen("td", {
							"style": "white-space:nowrap;text-align:left;" +
								(i % 2 ? "background-color:rgb(218, 194, 194);" : "")
						});

						if (isUpload)
						{
							str += tableName + "-v" + tableVersion;

							str += "</td>";
							str += htmlOpen("td", {
								"style": "text-align:left;" +
									(i % 2 ? "background-color:rgb(218, 194, 194);" : "")
							});

							str += "<input type='file' class='uploadDownloadFileInput' " +
								"id='uploadDownloadFileInput-" + i + "' " +
								"accept='.csv' enctype='multipart/form-data' />";
						}
						else //is download
						{
							str += htmlOpen("input",
								{
									"type": "checkbox",
									"class": "uploadDownloadCheckbox",
								},
								htmlOpen("a",
									{
										"style": "text-decoration:none;color:black;",
										"onclick": "var el = document.getElementsByClassName(\"uploadDownloadCheckbox\");" +
											"var forFirefox = (el[" + i + "].checked = !el[" + i + "].checked);",
									},
									tableName + "-v" + tableVersion /*innerHTML*/,
									true /*doCloseTag*/
								) /*innerHTML*/,
								true /*doCloseTag*/);
						}

						str += "</td></tr>";
					}
					str += "</table>";
					str += "</center>";

					str += "<br><br>";
					str += htmlOpen("input",
						{
							"type": "button",
							"id": "uploadDownloadButton",
							"value": capType + " Member Tables",
							"title": capType + " the selected member tables.",
						},
						"" /*innerHTML*/,
						true /*doCloseTag*/);

					document.getElementById("popUpDialog-div").innerHTML = str;

					var uploadedFiles = {};

					document.getElementById("uploadDownloadButton").onmouseup = 
							function () 
							{

						Debug.log("uploadDownloadButton onmouseup");



						if (isUpload) 
						{
							localDoUpload();
						}
						else //is download
						{
							var checkboxes = document.getElementsByClassName("uploadDownloadCheckbox");

							var tableName, tableVersion;
							var selectedTables = [];
							for (var i = 0; i < checkboxes.length; ++i)
								if (checkboxes[i].checked) 
								{
									tableName = tableNames[i].getAttribute("value");
									tableVersion = tableVersions[i].getAttribute("value");
									console.log(capType, tableName, tableVersion);

									selectedTables.push([tableName, tableVersion]);

								}

							localDownloadMembers();

							////////////////////
							//localDownloadMembers ~~
							//	recursively download all selected tables
							function localDownloadMembers() 
							{

								var targetTable = selectedTables.pop();
								console.log("localDownloadMembers", targetTable);

								DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificTable" +
										"&dataOffset=0&chunkSize=" + _MAX_CHUNK_SIZE +
										"&tableName=" + targetTable[0] +
										"&version=" + targetTable[1],
										"", function (req)
										{

									console.log("localDownloadMembers have data for ", targetTable);

									//Note: copied download code from downloadTableAsCSV()

									var rowDel = '\n';
									var colDel = document.getElementById("fieldSelect").value;

									var dataStr = "data:text/csv;charset=utf-8,";
									try 
									{
										var rows = req.responseXML.getElementsByTagName(
												"CurrentVersionRows")[0].getElementsByTagName("Row");

										var rowEntries;
										for (var r = 0; r < rows.length; ++r) 
										{
											if (r)
												dataStr += encodeURI(rowDel); //encoded \n

											rowEntries = rows[r].getElementsByTagName("Entry");

											for (var c = 0; c < rowEntries.length; ++c) 
											{
												if (c)
													dataStr += encodeURI(colDel);
												dataStr += encodeURIComponent(rowEntries[c].getAttribute("value").
														replace(new RegExp(rowDel,'g'),"${OTS_RECORD_DELIMETER}").
														replace(new RegExp(colDel,'g'),"${OTS_FIELD_DELIMETER}"));
											}
										}
										Debug.log("localDownloadMembers dataStr=" + dataStr);
										var link = document.createElement("a");
										link.setAttribute("href", dataStr); //double encode, so encoding remains in CSV
										link.setAttribute("style", "display:none");
										link.setAttribute("download", targetTable[0] + "-v" +
												targetTable[1] + "_download.csv");
										document.body.appendChild(link); // Required for FF

										link.click(); // This will download the data file with filename *_download.csv

										link.parentNode.removeChild(link);
									}
									catch (e) 
									{
										Debug.log("Target table '" + targetTable[0] + "-v" +
												targetTable[1] + "' failed to download. " +
												"Go to the 'Table Editor' to check on the validity of the table.",
												Debug.HIGH_PRIORITY);
										console.log("Error: " + e);
									}

									if (selectedTables.length) //if still more tables, continue
										localDownloadMembers();
								}); //end tableVersion request
							} //end localDownloadMembers()	
						} //end download section

							}; //end button onmouseup handler

					if (isUpload) //add option a Multiple Files handler
					{
						Debug.log("Adding Upload special behavior");



						//add all the file upload event listeners
						//	every file upload should modify 
						//	uploadedFiles object:
						//		{tableName : tableUploadString}
						//	Note: multiple files use file name to associate to tableName
						//	Note: individual files use position to associate to tableName
						//
						document.getElementById("uploadControlMultipleFiles").addEventListener(
							'change', function (evt)
							{
								Debug.log("Multiple files chosen");
								var files = evt.target.files;

								var fileArr = [];
								for (var i = 0; i < files.length; ++i)
									fileArr.push(i);

								localGetUploadFiles();

								////////////////////
								//localGetUploadFiles ~~
								//	recursively localGetUploadFiles
								function localGetUploadFiles() 
								{
									if (fileArr.length == 0) return;

									var fileIndex = fileArr.pop();
									var file = files[fileIndex];
									var tableName = file.name.split('_')[0].split('-')[0];

									console.log("tableName", tableName);
									console.log("file", file);
									var reader = new FileReader();
									reader.onload = 
											function ()
											{
										//store uploaded file and enable button								
										uploadedFiles[tableName] = this.result;
										console.log("uploadedFiles", uploadedFiles);

										if (fileArr.length) //if still files, continue
											localGetUploadFiles();
									} //end onload handler
									reader.readAsText(file);
								} //end localGetUploadFiles

							}, false); //end change event listener

						//now add individual listeners
						var uploadControls =
							document.getElementsByClassName("uploadDownloadFileInput");
						for (var i = 0; i < uploadControls.length; ++i) 
						{
							uploadControls[i].addEventListener(
								'change', function (evt) 
								{
									Debug.log("Individual file chosen");
									var files = evt.target.files;
									//force only one file for these
									if (1) 
									{
										var file = files[0];
										var tableIndex = this.id.split('-')[1];
										var tableName = tableNames[tableIndex].getAttribute("value");

										console.log("tableName", tableName);
										console.log("file", file);
										var reader = new FileReader();
										reader.onload = 
												function ()
												{
											//store uploaded file and enable button								
											uploadedFiles[tableName] = this.result;
											console.log("uploadedFiles", uploadedFiles);
										} //end onload handler
										reader.readAsText(file);
									} //end file loop 
								}, false); //end change event listener
						}

					} //end special upload behavior


					////////////////////
					//localDoUpload ~~
					//	uploadedFiles object := {name : tableString}
					function localDoUpload() 
					{
						var fileKeys = Object.keys(uploadedFiles);
						if (fileKeys.length == 0) 
						{
							Debug.log("There were no selected upload files!", Debug.HIGH_PRIORITY);
							return;
						}

						//save as new version of table, track member versions
						console.log("_memberMapForGroupSave", _memberMapForGroupSave);

						var fileKeyArr = [];
						for (var fileKey in uploadedFiles)
						{
							console.log("fileKey", fileKey);
							fileKeyArr.push(fileKey);
						}

						localUploadMembers();

						////////////////////
						//localUploadMembers ~~
						function localUploadMembers() 
						{
							if (fileKeyArr.length == 0) return;

							var fileKey = fileKeyArr.pop();
							
							Debug.log("Uploading member table " + fileKey);
							
							//Note: this upload code is copied from js::ConfigurationGUI::uploadTableFromCSV()

							var colDel, rowDel = '\n'; //row/record and column/field delimeters (default record to \n)
							
							//auto find record delimeter (finding auto-row delimiter is more complicated if there are options.. to avoid confusion with data)
							//	take last found, which must always be correct
							//	because last fields are forced fields (author/time) and 
							//	do not have special characters.

							for (var i = uploadedFiles[fileKey].length-1;i >= 0; --i) 
							{
								if (uploadedFiles[fileKey][i] == ',')
								{
									colDel = ',';
									break;
								}
								else if (uploadedFiles[fileKey][i] == ';')
								{
									colDel = ';';
									break;
								}
							}

							console.log("uploadedFiles[fileKey]",
									uploadedFiles[fileKey].length,
									uploadedFiles[fileKey]);
							console.log("record rowDel",rowDel);
							console.log("field colDel",colDel);
						
							var srcRows = uploadedFiles[fileKey].length? //if no data, make no rows
									uploadedFiles[fileKey].split(rowDel):[]; 
							var src = []; //src = [r][c]
							for (var i = 0; i < srcRows.length; ++i)
								src.push(srcRows[i].split(colDel));
							console.log("src", src);

							var dataStr = ""; // semi-colon(;) separated rows.. comma(,) separated entries within row
							for (var r = 0; r < src.length; ++r) {
								for (var c = 0; c < src[r].length; ++c) //skip row index column
								{
									dataStr += encodeURIComponent(src[r][c].
											replace(/\$\{OTS_FIELD_DELIMETER\}/g,colDel).
											replace(/\$\{OTS_RECORD_DELIMETER\}/g,rowDel)) + ",";
								}
								dataStr += ";";
							}

							var reqStr = "Request?RequestType=saveSpecificTable" +
								"&dataOffset=" + _dataOffset +
								"&chunkSize=" + (src.length) +
								"&tableName=" + fileKey +
								"&version=" + (-1) +
								"&lookForEquivalent=" + (1) +
								"&temporary=" + (0) +
								"&tableComment=" +
								encodeURIComponent("Uploaded table version");
							console.log("dataStr",dataStr);
							console.log("reqStr",reqStr);

							DesktopContent.XMLHttpRequest(reqStr, "data=" + dataStr,
								function (req) 
								{

									var tableName = DesktopContent.getXMLValue(req, "savedName");
									var version = DesktopContent.getXMLValue(req, "savedVersion");

									//save as new version of table, track member versions
									if (!_memberMapForGroupSave[tableName]) 
									{
										Debug.log("Table '" + tableName + "' can not be uploaded to " +
											"the group because it is not a member table.",
											Debug.HIGH_PRIORITY);
										return;
									}

									if (_memberMapForGroupSave[tableName] != version)
										Debug.log("Modifying member map for table '" +
											tableName + "' from v" + _memberMapForGroupSave[tableName] +
											" to v" + version);
									else
										Debug.log("Uploaded member was equivalent for table '" +
											tableName + "' v" + version);
									_memberMapForGroupSave[tableName] = version;
									console.log("_memberMapForGroupSave", _memberMapForGroupSave);

									if (fileKeyArr.length)
										localUploadMembers();
									else 
									{
										Debug.log("New members have been created... now create group");

										popUpSaveNewGroupForm(
											groupName,
											groupKey /*sourceGroupKey*/,
											2 /*sourceType*/);
									}
								}); //end saveSpecificTable request handler


						} //end localUploadMembers() 

					} //end localDoUpload()

					return;
				} //end getSpecificTableGroup request handler
			); //end getSpecificTableGroup request


		} //end popUpGroupUploadDownloadForm()

		//==============================================================================
		//popUpVersionAliasSpecificGroupForm
		function popUpVersionAliasSpecificGroupForm(groupName, groupKey) 
		{
			Debug.log("CfgGUI popUpVersionAliasSpecificGroupForm");

			var str = "";

			var el = document.getElementById("popUpDialog");
			if (!el)
			{
				el = document.createElement("div");
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 300;
			var h = 200;
			ConfigurationAPI.setPopUpPosition(el, w /*w*/, h /*h*/);

			var defaultAlias = "myAlias";
			var str = "<a id='" +
				"popUpDialog" +
				"-header' onclick='var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "Please enter the Alias you would like to apply to all member table versions:<br><br>";
			str += "<input type='text' id='popUpDialog-alias' value='" +
				defaultAlias + "'></input>";
			str += "</div><br><br>";

			var onmouseupJS = "";
			onmouseupJS +=
				"DesktopContent.XMLHttpRequest(\"Request?RequestType=setAliasOfGroupMembers" +
				"&versionAlias=\" + " +
				"document.getElementById(\"popUpDialog-alias\").value + \"" +
				"&groupName=" + groupName +
				"&groupKey=" + groupKey + "\", \"\"," +
				"ConfigurationAPI.newWizBackboneMemberHandler,[\"MemberVersionAliasWizBackbone\",undefined]," +
				"0,true" +  //progressHandler, callHandlerOnErr
				");";
			onmouseupJS += "var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); ";

			str += "<input type='button' onmouseup='" + onmouseupJS + "' " +
				"value='Set Member Aliases' title='" +
				"Set the Alias for all members in the active Backbone." +
				"'/>";
			el.innerHTML = str;


			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";

			//select comment text
			ConfigurationAPI.setCaretPosition(document.getElementById("popUpDialog-alias"),
				0, defaultAlias.length);
		} //end popUpVersionAliasSpecificGroupForm()

		//==============================================================================
		//popUpFilterTreeForm
		function popUpFilterTreeForm()
		{
			Debug.log("CfgGUI popUpFilterTreeForm");

			var str = "";

			var el = document.getElementById("popUpDialog");
			if (!el)
			{
				el = document.createElement("div");
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 300;
			var h = 200;
			ConfigurationAPI.setPopUpPosition(el, w /*w*/, h /*h*/);

			Debug.log("Previous filter = " + lastTreeFilter_);
			var defaultFilter = lastTreeFilter_ == "" ? "*Port*" : lastTreeFilter_;

			var str = "<a id='" +
				"popUpDialog" +
				"-header' onclick='var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "Please enter the filter (* may be used) to select which values are " +
				"shown in the tree:<br><br>";
			str += "<input type='text' id='popUpDialog-filter' value='" +
					encodeHTML(defaultFilter) + "'></input>";
			str += "</div><br><br>";

			var onmouseupJS = "";
			onmouseupJS += "applyTreeFilter(" +
				"document.getElementById(\"popUpDialog-filter\").value" +
				"); ";
			onmouseupJS += "var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); ";

			str += "<input type='button' onmouseup='" + onmouseupJS + "' " +
				"value='Filter Values' title='" +
				"Select the Alias in the drop-down for all tables." +
				"'/>";
			el.innerHTML = str;


			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";

			//select comment text
			ConfigurationAPI.setCaretPosition(document.getElementById("popUpDialog-filter"),
				0, defaultFilter.length);
		} //end popUpFilterTreeForm()

		//==============================================================================
		//popUpVersionAliasGroupEditorForm
		function popUpVersionAliasGroupEditorForm() 
		{
			Debug.log("CfgGUI popUpVersionAliasGroupEditorForm");

			var str = "";

			var el = document.getElementById("popUpDialog");
			if (!el) 
			{
				el = document.createElement("div");
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 300;
			var h = 200;
			ConfigurationAPI.setPopUpPosition(el, w /*w*/, h /*h*/);

			var defaultAlias = "myAlias";
			var str = "<a id='" +
				"popUpDialog" +
				"-header' onclick='var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "Please enter the Alias you would like to select for all tables:<br><br>";
			str += "<input type='text' id='popUpDialog-alias' value='" +
				defaultAlias + "'></input>";
			str += "</div><br><br>";

			var onmouseupJS = "";
			onmouseupJS += "versionsForCreateTableGroup(2," +
				"document.getElementById(\"popUpDialog-alias\").value" +
				"); ";
			onmouseupJS += "var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); ";

			str += "<input type='button' onmouseup='" + onmouseupJS + "' " +
				"value='Select Alias' title='" +
				"Select the Alias in the drop-down for all tables." +
				"'/>";
			el.innerHTML = str;


			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";

			//select comment text
			ConfigurationAPI.setCaretPosition(document.getElementById("popUpDialog-alias"),
				0, defaultAlias.length);
		} //end popUpVersionAliasGroupEditorForm()

		//==============================================================================
		//popUpClearVersionsPrompt
		function popUpClearVersionsPrompt(clearTemporary, backLinkStr)
		{
			Debug.log("CfgGUI popUpClearVersionsPrompt");
			var str = "";

			var el = document.getElementById("popUpDialog");
			if (!el) 
			{
				el = document.createElement("div");
				el.setAttribute("id", "popUpDialog");
			}

			//set position and size
			var w = 300;
			var h = 170;
			ConfigurationAPI.setPopUpPosition(el, w /*w*/, h /*h*/);

			var str = "<br><a id='" +
				"popUpDialog" +
				"-header' onclick='var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "Are you sure you want to clear all " +
				(clearTemporary ? "temporary" : "cached") +
				" versions of <b>" +
				_currentTableName + "</b>?<br>";
			str += "</div>";

			//Note: be careful with the source of backLinkStr.. don't use both quote styles!
			if (backLinkStr.indexOf("'") >= 0)
				backLinkStr = backLinkStr.replace(/'/g, "\\\"");
			else
				backLinkStr = backLinkStr.replace(/"/g, "\\\"");

			var refreshLinkStr = "setupSpecificTable(\"" +
				_currentTableName + "\",\"" +
				_version + "\",\"" + backLinkStr + "\");";

			var clearLinkStr;

			if (clearTemporary)
				clearLinkStr = "DesktopContent.XMLHttpRequest(" +
					"\"Request?RequestType=clearTableTemporaryVersions" +
					"&tableName=" + _currentTableName + "\",\"\"," +
					" function(req) { " +
					refreshLinkStr +
					"}" + //end handler function					
					");";
			else
				clearLinkStr = "DesktopContent.XMLHttpRequest(" +
					"\"Request?RequestType=clearTableCachedVersions" +
					"&tableName=" + _currentTableName + "\",\"\"," +
					" function(req) { " +
					refreshLinkStr +
					"}" + //end handler function					
					");";

			str += "<input style='margin-top: 20px;' " +
				"type='button' onmouseup='" + clearLinkStr + "' " +
				"value='Clear " +
				(clearTemporary ? "Temporary" : "Cached") +
				" Versions!' title='" +
				"Permanently delete all the temporary versions associated with " +
				_currentTableName + "." +
				"'/>";
			el.innerHTML = str;


			document.getElementById("display").appendChild(el); //add element to display div


			el.style.display = "block";
		} //end popUpClearVersionsPrompt()

		//==============================================================================
		//popUpSaveNewTableForm
		function popUpSaveNewTableForm() 
		{
			editCellOK(); //editCellCancel();
			Debug.log("CfgGUI popUpSaveNewTableForm");

			var str = "";

			var el = document.getElementById("popUpDialog");
			if (!el) 
			{
				el = document.createElement("div");
				el.setAttribute("id", "popUpDialog");
			}

			//set position and size
			var gh = 85;
			var w = 500;
			var h = 395;
			ConfigurationAPI.setPopUpPosition(el, w /*w*/, h /*h*/,
				undefined /*padding*/, undefined /*border*/, undefined /*margin*/, undefined /*doNotResize*/,
				gh * 2 /*offsetUp*/);


			var str = "<br><a id='" +
				"popUpDialog" +
				"-header' onclick='var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";

			//Mimicking popUpSaveTreeForm() (3/27/2017) RAR
			{
				str += "Saving will create a new persistent version for this table.<br><p style ='font-size:12px; margin-top:3px;margin-bottom:-10px;'> Note: If this table is in a Context Group, you must restart ots for the changes to take effect.</p>" +
					"<br>";

				str += "Please enter a comment describing this new version of <b>" +
					_currentTableName + "</b>:<br>";
				str += "<textarea id='popUpDialog-comment' rows='4' cols='50' style='width:417px;height:68px;'>";
				var comment = _cachedTableComment == "" ? ConfigurationAPI._DEFAULT_COMMENT : _cachedTableComment;
				str += comment;
				str += "</textarea>";
				str += "</div>";

				//Note: 1/13/2017 - changed to always using cached comment 
				//give option to use cached comment
				//			if(_cachedTableComment != "") 			
				//				str += "<a onclick='" + 
				//					"var el = document.getElementById(" +
				//					"\"popUpDialog-comment\"); el.value = _cachedTableComment; return false;' " +
				//					"title='Load the cached comment associated with last persistent version " +
				//					"of " + _currentTableName + " that was viewed. " + 
				//					"You will still have a chance to append to the comment.' " +
				//					">Get cached table comment</a><br><br>"; 

				//				str += "<input type='button' onmouseup='saveTableAsNewVersion(0)' " +
				//						"value='Save Changes as New Version' title='" +
				//						"Save the current table view as new persitent version." +
				//						"'/>";



				//put -1 to gaurantee recognizing as a change
				var modifiedTables = _currentTableName + ",-1"; //csv table, temporay version,...
				Debug.log("modifiedTables= " + modifiedTables);
				//get affected groups
				//	and save member map to hidden div for Save action
				///////////////////////////////////////////////////////////
				DesktopContent.XMLHttpRequest("Request?RequestType=getAffectedActiveGroups" +
					"&groupName=" + _associatedGroupName +
					"&groupKey=" + _associatedGroupKey,
					"&modifiedTables=" + modifiedTables,
					function (req) 
					{
						var err = DesktopContent.getXMLValue(req, "Error");
						if (err) 
						{
							Debug.log(err, Debug.HIGH_PRIORITY);
							el.innerHTML = str;
							return;
						}

						//for each affected group
						//	 put csv: name,key,memberName,memberVersion...
						var groups = req.responseXML.getElementsByTagName("AffectedActiveGroup");
						var memberNames, memberVersions;
						var xmlGroupName;
						modTblStr = ""; //re-use
						for (var i = 0; i < groups.length; ++i) 
						{
							xmlGroupName = DesktopContent.getXMLValue(groups[i], "GroupName");
							str += "<div style='display:none' class='popUpDialog-affectedGroups' >";
							str += xmlGroupName;
							str += "," + DesktopContent.getXMLValue(groups[i], "GroupKey");

							memberNames = groups[i].getElementsByTagName("MemberName");
							memberVersions = groups[i].getElementsByTagName("MemberVersion");
							Debug.log("memberNames.length " + memberNames.length);
							for (var j = 0; j < memberNames.length; ++j)
								str += "," + DesktopContent.getXMLValue(memberNames[j]) +
									"," + DesktopContent.getXMLValue(memberVersions[j]);
							str += "</div>"; //close div popUpDialog-affectedGroups


							if (modTblStr.length)
								modTblStr += ",";


							modTblStr += "<a style='color:black' onclick='" +
								"var forFirefox = handleGroupCommentToggle(\"" + xmlGroupName + "\");" +
								" handlePopUpHeightToggle(" + h + "," + gh + ");' " +
								"title='Click to edit the comment for this group' " +
								">";
							modTblStr += xmlGroupName;
							modTblStr += "</a>";

							//store cached group comment in hidden html
							modTblStr += "<div id='popUpDialog-groupComment-" +
								xmlGroupName + "' " +
								"class='popUpDialog-groupComment-cache' " +
								"style='display:none'>" +
								decodeURIComponent(DesktopContent.getXMLValue(groups[i], "GroupComment")) +
								"</div>";
						}

						str += "<br>...and choose the options you want; then click 'Save Table':" +
							"<br>";

						//add checkbox to save affected groups
						str += "<input type='checkbox' id='popUpDialog-bumpGroupVersions' checked " +
							"onclick='handlePopUpHeightToggle(" + h + "," + gh + ");'>";
						//add link so text toggles checkbox
						str += "<a onclick='" +
							"var el = document.getElementById(\"popUpDialog-bumpGroupVersions\");" +
							"var forFirefox = (el.checked = !el.checked);" +
							" handlePopUpHeightToggle(" + h + "," + gh + "); return false;'>";
						str += "Save Affected Groups as New Keys";
						str += "</a>";
						str += "</input><br>";

						//add checkbox to activate saved affected groups
						str += "<input type='checkbox' id='popUpDialog-activateBumpedGroupVersions' checked " +
							">";
						//add link so text toggles checkbox
						str += "<a onclick='" +
							"var el = document.getElementById(\"popUpDialog-activateBumpedGroupVersions\");" +
							"if(el.disabled) return false; " +
							"var forFirefox = (el.checked = !el.checked);" +
							"return false;'>";
						str += "Also Activate New Groups";
						str += "</a>";
						str += "</input><br>";

						str += "Here is the list of affected groups - click to set a group comment (count=" + groups.length +
							"):" +
							"<br>";

						//display affected groups
						str += "<div style='white-space:nowrap; width:" + w + "px; margin-bottom:20px; " +
							"overflow:auto; font-weight: bold;'>";
						str += modTblStr;

						str += "<div id='clearDiv'></div>";
						str += "<center>";

						str += "<div id='popUpDialog-groupComment-header'></div>";

						str += "<div id='clearDiv'></div>";

						str += "<textarea id='popUpDialog-groupComment' rows='4' cols='50' style='width:417px;height:68px;display:none;margin:0;'>";
						str += ConfigurationAPI._DEFAULT_COMMENT;
						str += "</textarea>";
						str += "</center>";

						str += "</div>"; //end affected groups div	

						str += "<div id='popUpDialog-groupAliasArea' style='margin-bottom:20px' ><center>";

						//get existing group aliases	
						///////////////////////////////////////////////////////////
						DesktopContent.XMLHttpRequest("Request?RequestType=getGroupAliases" +
							"",
							"",
							function (req) 
							{
								var err = DesktopContent.getXMLValue(req, "Error");
								if (err) 
								{
									Debug.log(err, Debug.HIGH_PRIORITY);
									el.innerHTML = str;
									return;
								}

								var aliases = req.responseXML.getElementsByTagName("GroupAlias");
								var aliasGroupNames = req.responseXML.getElementsByTagName("GroupName");
								var aliasGroupKeys = req.responseXML.getElementsByTagName("GroupKey");

								//for each affected group
								//	-Show checkbox for setting alias and dropdown for alias
								//	and a pencil to change dropdown to text box to free-form alias.
								//	-Also, identify if already aliased and choose that as default option
								//	in dropwdown.					
								var alias, aliasGroupName, aliasGroupKey;
								var groupName, groupKey;
								var groupOptionIndex = []; //keep distance and index of option for each group, or -1 if none
								for (var i = 0; i < groups.length; ++i)
								{
									groupOptionIndex.push([-1, 0]); //index and distance

									groupName = DesktopContent.getXMLValue(groups[i], "GroupName");
									groupKey = DesktopContent.getXMLValue(groups[i], "GroupKey");

									//find alias
									modTblStr = ""; //re-use
									for (var j = 0; j < aliasGroupNames.length; ++j) 
									{
										alias = DesktopContent.getXMLValue(aliases[j]);
										aliasGroupName = DesktopContent.getXMLValue(aliasGroupNames[j]);
										aliasGroupKey = DesktopContent.getXMLValue(aliasGroupKeys[j]);

										//Debug.log("compare " + aliasGroupName + ":" +
										//		aliasGroupKey);

										//also build drop down
										modTblStr += "<option value='" + alias + "' ";

										//consider any alias with same groupName
										if (aliasGroupName == groupName)
										{
											if (groupOptionIndex[i][0] == -1 ||	//take best match
												Math.abs(groupKey - aliasGroupKey) < groupOptionIndex[i][1]) 
											{
												Debug.log("found alias");
												groupOptionIndex[i][0] = j; //index
												groupOptionIndex[i][1] = Math.abs(groupKey - aliasGroupKey); //distance
											}
										}
										modTblStr += ">";
										modTblStr += alias;	//can display however
										modTblStr += "</option>";
									}

									str += "<input type='checkbox' class='popUpDialog-setGroupAlias' " +
										(groupOptionIndex[i][0] >= 0 ? "checked" : "") + //check if has an alias already
										">";
									//add link so text toggles checkbox
									str += "<a onclick='" +
										"var el = document.getElementsByClassName(\"popUpDialog-setGroupAlias\");" +
										"var forFirefox = (el[" + i + "].checked = !el[" + i + "].checked);" +
										" return false;'>";
									str += "Set '<b style='font-size:16px'>" + groupName + "</b>' to System Alias:";
									str += "</a><br>";

									str += "<table cellpadding='0' cellspacing='0' border='0'><tr><td>";
									str += "<select " +
										"id='popUpDialog-editAliasSelect-" + (i) + "' " +
										"style='margin:2px; height:" + (25) + "px'>";
									str += modTblStr;
									str += "</select>";

									str += "<input type='text' " +
										"id='popUpDialog-editAliasTextBox-" + (i) + "' " +
										"style='display:none; margin:2px; width:150px; height:" +
										(19) + "px'>";
									str += "";
									str += "</input>";
									str += "</td><td>";

									str += "<div style='display:block' " +
										"class='treeNode-Value-editIcon' id='popUpDialog-editIcon-" +
										(i) + "' " +
										"onclick='handleEditTreeAliasEditToggle(" +
										i +
										");' " +
										"title='Toggle free-form system alias editing' " +
										"></div>";

									str += "</td></tr></table>";

									str += "</input>";

									//increase height each time a group check is added
									h += gh;
									el.style.height = h + "px";
								}

								str += "</center></div>"; //close id='popUpDialog-groupAliasArea'


								// done with system alias handling
								// continue with pop-up prompt

								str += "</div>"; //close main popup div

								var onmouseupJS = "";
								onmouseupJS += "document.getElementById(\"popUpDialog-submitButton\").disabled = true;";
								onmouseupJS += "handleGroupCommentToggle(0,1);"; //force cache of group comment
								onmouseupJS += "handlePopUpHeightToggle(" + h + "," + gh + ");";
								onmouseupJS += "saveTableAsNewVersion(0);";

								str += "<input id='popUpDialog-submitButton' type='button' onmouseup='" +
									onmouseupJS + "' " +
									"value='Save Table' title='" +
									"Save new version of the table\n" +
									"(Optionally, save new active groups and assign system aliases)" +
									"'/>";
								el.innerHTML = str;

								//handle default dropdown selections for group alias
								for (var i = 0; i < groups.length; ++i)
									if (groupOptionIndex[i][0] != -1) //have a default
										document.getElementById("popUpDialog-editAliasSelect-" +
											i).selectedIndex = groupOptionIndex[i][0];

								//select comment text
								ConfigurationAPI.setCaretPosition(document.getElementById("popUpDialog-comment"),
									0, comment.length);

							}, 0, 0, true //reqParam, progressHandler, callHandlerOnErr
						); //end of getGroupAliases handler

					}, 0, 0, true //reqParam, progressHandler, callHandlerOnErr
				); //end of getActiveTableGroups handler			

			}

			//add element to body
			//	because saving/loading table resets the display and activeConfig!
			//	(actually could be more 'proper' than appending to display)
			document.body.appendChild(el);
			el.style.display = "block";
		} //end popUpSaveNewTableForm()

		//==============================================================================
		//popUpSaveNewGroupForm
		//	use sourceType to decide how to create member map
		function popUpSaveNewGroupForm(groupName, sourceGroupKey, sourceType) 
		{
			//groupKey is used to select the best matching alias
			//	if sourceGroupKey < 0 choose a high number so matches are biased high
			var groupKey = sourceGroupKey < 0 ? 1E8 : sourceGroupKey;

			Debug.log("CfgGUI popUpSaveNewGroupForm sourceType=" + sourceType);

			var str = "";

			var el = document.getElementById("popUpDialog");
			if (!el) 
			{
				el = document.createElement("div");
				el.setAttribute("id", "popUpDialog");
			}

			//set position and size
			var gh = 50;
			var w = 500;
			var h = 335;
			ConfigurationAPI.setPopUpPosition(el, w /*w*/, h - gh * 2 /*h*/,
				undefined /*padding*/, undefined /*border*/, undefined /*margin*/, undefined /*doNotResize*/,
				gh * 2 /*offsetUp*/);

			var str = "<br><a id='" +
				"popUpDialog" +
				"-header' onclick='" +
				"_cachedGroupComment = document.getElementById(" +
				"\"popUpDialog-comment\").value; " +
				"var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); " +				
				"return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";

			//Mimicking popUpSaveNewTableForm () (4/20/2017) RAR
			{
				str += "Saving will create a new persistent key for this group." +
					"<br><br>";

				str += "Please enter a comment describing this new key for group <b>" +
					groupName + "</b>:<br>";
				str += "<textarea id='popUpDialog-comment' rows='4' cols='50' style='width:417px;height:68px;''>";
				var comment = (!_cachedGroupComment || _cachedGroupComment == "") ? ConfigurationAPI._DEFAULT_COMMENT : _cachedGroupComment;
				str += comment;
				str += "</textarea>";
				str += "</div>";

				//affected group is trivial for this case

				var modTblStr = ""; //re-useable str				

				str += "<br>...and choose the options you want; then click 'Save Group':" +
					"<br>";


				//add checkbox to activate saved affected groups
				str += "<input type='checkbox' id='popUpDialog-activateBumpedGroupVersions' checked " +
					">";
				//add link so text toggles checkbox
				str += "<a onclick='" +
					"var el = document.getElementById(\"popUpDialog-activateBumpedGroupVersions\");" +
					"if(el.disabled) return false; " +
					"var forFirefox = (el.checked = !el.checked);" +
					"return false;'>";
				str += "Activate New Group";
				str += "</a>";
				str += "</input><br>";

				str += "<div id='popUpDialog-groupAliasArea' ><center>";

				//get existing group aliases	
				///////////////////////////////////////////////////////////
				DesktopContent.XMLHttpRequest("Request?RequestType=getGroupAliases" +
					"",
					"",
					function (req) 
					{
						var err = DesktopContent.getXMLValue(req, "Error");
						if (err) 
						{
							Debug.log(err, Debug.HIGH_PRIORITY);

							localFinishDialog();

							return;
						}

						var aliases = req.responseXML.getElementsByTagName("GroupAlias");
						var aliasGroupNames = req.responseXML.getElementsByTagName("GroupName");
						var aliasGroupKeys = req.responseXML.getElementsByTagName("GroupKey");

						//for each affected group
						//	-Show checkbox for setting alias and dropdown for alias
						//	and a pencil to change dropdown to text box to free-form alias.
						//	-Also, identify if already aliased and choose that as default option
						//	in dropwdown.					
						var alias, aliasGroupName, aliasGroupKey;
						var groupOptionIndex = []; //keep distance and index of option for each group, or -1 if none
						for (var i = 0; i < 1; ++i)//groups.length;++i) //only one affected group, the trivial one
						{
							groupOptionIndex.push([-1, 0]); //index and distance

							//groupName = DesktopContent.getXMLValue(groups[i],"GroupName");
							//groupKey = DesktopContent.getXMLValue(groups[i],"GroupKey");

							//find alias
							modTblStr = ""; //re-use
							for (var j = 0; j < aliasGroupNames.length; ++j)
							{
								alias = DesktopContent.getXMLValue(aliases[j]);
								aliasGroupName = DesktopContent.getXMLValue(aliasGroupNames[j]);
								aliasGroupKey = DesktopContent.getXMLValue(aliasGroupKeys[j]);

								//Debug.log("compare " + aliasGroupName + ":" +
								//		aliasGroupKey);

								//also build drop down
								modTblStr += "<option value='" + alias + "' ";

								//consider any alias with same groupName
								if (aliasGroupName == groupName) 
								{
									if (groupOptionIndex[i][0] == -1 ||	//take best match
										Math.abs(groupKey - aliasGroupKey) < groupOptionIndex[i][1]) 
									{
										Debug.log("found alias");
										groupOptionIndex[i][0] = j; //index
										groupOptionIndex[i][1] = Math.abs(groupKey - aliasGroupKey); //distance
									}
								}
								modTblStr += ">";
								modTblStr += alias;	//can display however
								modTblStr += "</option>";
							}

							str += "<input type='checkbox' class='popUpDialog-setGroupAlias' " +
								(groupOptionIndex[i][0] >= 0 ? "checked" : "") + //check if has an alias already
								">";
							//add link so text toggles checkbox
							str += "<a onclick='" +
								"var el = document.getElementsByClassName(\"popUpDialog-setGroupAlias\");" +
								"var forFirefox = (el[" + i + "].checked = !el[" + i + "].checked);" +
								" return false;'>";
							str += "Set '<b style='font-size:16px'>" + groupName + "</b>' to System Alias:";
							str += "</a><br>";

							str += "<table cellpadding='0' cellspacing='0' border='0'><tr><td>";
							str += "<select " +
								"id='popUpDialog-editAliasSelect-" + (i) + "' " +
								"style='margin:2px; height:" + (25) + "px'>";
							str += modTblStr;
							str += "</select>";

							str += "<input type='text' " +
								"id='popUpDialog-editAliasTextBox-" + (i) + "' " +
								"style='display:none; margin:2px; width:150px; height:" +
								(19) + "px'>";
							str += "";
							str += "</input>";
							str += "</td><td>";

							str += "<div style='display:block' " +
								"class='treeNode-Value-editIcon' id='popUpDialog-editIcon-" +
								(i) + "' " +
								"onclick='handleEditTreeAliasEditToggle(" +
								i +
								");' " +
								"title='Toggle free-form system alias editing' " +
								"></div>";

							str += "</td></tr></table>";

							str += "</input>";

							//increase height each time a group check is added
							h += gh;

						}

						localFinishDialog();

						function localFinishDialog()
						{
							el.style.height = h + "px";
							str += "</center></div>"; //close id='popUpDialog-groupAliasArea'


							// done with system alias handling
							// continue with pop-up prompt

							str += "</div><br>"; //close main popup div

							var onmouseupJS = "";
							onmouseupJS += "document.getElementById(\"popUpDialog-submitButton\").disabled = true;";
							onmouseupJS += "saveTableGroupAsNewKey(\"" +
								groupName + "\"," +
								sourceType + "," +
								"0 /*ignoreWarnings*/);";

							str += "<input id='popUpDialog-submitButton' type='button' onmouseup='" +
								onmouseupJS + "' " +
								"value='Save Group' title='" +
								"Save new key for the group\n" +
								"(Optionally, activate new group and assign system alias)" +
								"'/>";
							el.innerHTML = str;
						}

						//handle default dropdown selections for group alias
						for (var i = 0; i < 1; ++i)//groups.length;++i) //only one affected group, the trivial one
							if (groupOptionIndex[i][0] != -1) //have a default
								document.getElementById("popUpDialog-editAliasSelect-" +
									i).selectedIndex = groupOptionIndex[i][0];

						//select comment text
						ConfigurationAPI.setCaretPosition(document.getElementById("popUpDialog-comment"),
							0, comment.length);

					}, 0, 0, true //reqParam, progressHandler, callHandlerOnErr
				); //end of getGroupAliases handler							

			}

			//add element to body
			//	because saving/loading table resets the display and activeConfig!
			//	(actually could be more 'proper' than appending to display)
			document.body.appendChild(el);
			el.style.display = "block";
		} //end popUpSaveNewGroupForm()

		//==============================================================================
		//popUpGroupAliasForm
		// target either isLatest or isActivated
		function popUpGroupAliasForm(isLatest, myAlias)
		{
			Debug.log("CfgGUI popUpGroupAliasForm " + isLatest);

			var str = "";

			var el = document.getElementById("popUpDialog");
			if (!el)
			{
				el = document.createElement("div");
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 300;
			var h = 220;
			ConfigurationAPI.setPopUpPosition(el, w /*w*/, h /*h*/);

			var defaultAlias = (myAlias && myAlias != "") ? myAlias : "mySystemAlias";
			var str = "<a id='" +
				"popUpDialog" +
				"-header' onclick='var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "<center>";
			str += "Please enter the System Alias to assign, and select the targeted ";
			str += isLatest ? "Latest" : "Active";
			str += " Group Type:<br><br>";

			str += "<table cellpadding='2px' cellspacing='2px' border='0'><tr><td style='text-align:right'>";
			str += "System Alias:</td><td style='text-align:left'>";
			str += "<input type='text' id='popUpDialog-alias' value='" +
				defaultAlias + "'></input>";
			str += "</td></tr>";

			//add group type drop down
			str += "<tr><td style='text-align:right'>";

			if (isLatest)
				str += "Latest Group";
			else
				str += "Active Group";
			str += ":</td><td style='text-align:left'>";
			str += "<select " +
				"id='popUpDialog-aliasGroupType' " +
				"style='height:" + (25) + "px'>";
			str += "<option value='" + "0" + "'>" + "Context" + "</option>";
			str += "<option value='" + "1" + "'>" + "Backbone" + "</option>";
			str += "<option value='" + "2" + "' selected>" + "Configuration" + "</option>";
			str += "</select>";
			str += "</td></tr>";

			str += "</table>";

			str += "</center>";
			str += "</div>";
			str += "<br><br>";

			var onmouseupJS = "";
			if (isLatest)
				onmouseupJS += "wizToLatestTableGroup(" +
					"document.getElementById(\"popUpDialog-alias\").value" +
					",0," +
					"document.getElementById(\"popUpDialog-aliasGroupType\").value" +
					"); ";
			else	//initialized
				onmouseupJS += "wizToActiveTableGroup(" +
					"document.getElementById(\"popUpDialog-alias\").value" +
					",document.getElementById(\"popUpDialog-aliasGroupType\").value" +
					"); ";

			onmouseupJS += "var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); ";

			str += "<input type='button' onmouseup='" + onmouseupJS + "' " +
				"value='Setup System Alias' title='" +
				"Assign a System Alias to the selected ";
			str += isLatest ? "Latest" : "Active";
			str += " Group Type" +
				" by automatically modifying the active Backbone group." +
				"'/>";
			el.innerHTML = str;


			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";

			//select comment text
			ConfigurationAPI.setCaretPosition(document.getElementById("popUpDialog-alias"),
				0, defaultAlias.length);
		} //end popUpGroupAliasForm()

		//==============================================================================
		//popUpVersionAliasForm
		function popUpVersionAliasForm() 
		{
			Debug.log("CfgGUI popUpVersionAliasForm");

			var str = "";

			var el = document.getElementById("popUpDialog");
			if (!el) 
			{
				el = document.createElement("div");
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 300;
			var h = 200;
			ConfigurationAPI.setPopUpPosition(el, w /*w*/, h /*h*/);

			var defaultAlias = "myAlias";
			var str = "<a id='" +
				"popUpDialog" +
				"-header' onclick='var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";
			str += "Please enter the Alias you would like to assign to version &apos;" +
				_version + "&apos; of <b>" +
				_currentTableName + "</b>:<br><br>";
			str += "<input type='text' id='popUpDialog-alias' value='" +
				defaultAlias + "'></input>";
			str += "</div><br><br>";

			var onmouseupJS = "";
			onmouseupJS += "setVersionAliasInActiveBackbone(" +
				"document.getElementById(\"popUpDialog-alias\").value" +
				",\"" +
				_currentTableName + "\",\"" +
				_version + "\",0,/*done handler*/ function()" +
				"{setupSpecificTable(\"" +
				_currentTableName + "\",\"" +
				_version + "\");}" +
				"); ";
			onmouseupJS += "var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); ";

			str += "<input type='button' onmouseup='" + onmouseupJS + "' " +
				"value='Assign Alias' title='" +
				"Assign an Alias to " + _currentTableName +
				" version " + _version +
				" by automatically modifying the active Backbone group." +
				"'/>";
			el.innerHTML = str;


			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";

			//select comment text
			ConfigurationAPI.setCaretPosition(document.getElementById("popUpDialog-alias"),
				0, defaultAlias.length);
		} //end popUpVersionAliasForm()

		//==============================================================================
		//uploadTableFromCSV ~~
		function uploadTableFromCSV() 
		{
			//enable button so can retry if failure
			document.getElementById('popUpDialog-submitButton').disabled = false;

			editCellOK(); //editCellCancel();
			Debug.log("CfgGUI uploadTableFromCSV _tableUploadStr = " + _tableUploadStr);

			var uploadStyle = document.getElementById("popUpDialog-uploadStyleSelect").value | 0;

			Debug.log("CfgGUI uploadTableFromCSV uploadStyle = " + uploadStyle);

			var doReplace = uploadStyle == 0;
			var doAppend = uploadStyle == 1 || uploadStyle == 2 || uploadStyle == 3;
			Debug.log("CfgGUI uploadTableFromCSV doReplace = " + doReplace);
			Debug.log("CfgGUI uploadTableFromCSV doAppend = " + doAppend);

			//Note: if this upload code changes, apply to popUpGroupUploadDownloadForm() => localDoUpload() => localUploadMembers()
			
			var colDel, rowDel = '\n'; //row/record and column/field delimeters
			
			//auto find record delimeter (finding auto-row delimiter is more complicated if there are options.. to avoid confusion with data)
			//	take last found, which must always be correct
			//	because last fields are forced fields (author/time) and 
			//	do not have special characters.

			for (var i = _tableUploadStr.length-1;i >= 0; --i) 
			{
				if (_tableUploadStr[i] == ',')
				{
					colDel = ',';
					break;
				}
				else if (_tableUploadStr[i] == ';')
				{
					colDel = ';';
					break;
				}
			}

			console.log("_tableUploadStr",
					_tableUploadStr.length,
					_tableUploadStr);
			console.log("record rowDel",rowDel);
			console.log("field colDel",colDel);
			
			var srcRows = _tableUploadStr.length? //if no data, make no rows
					_tableUploadStr.split(rowDel):[]; 
			var src = []; //src = [r][c]
			for (var i = 0; i < srcRows.length; ++i)
				src.push(srcRows[i].split(colDel));			
			console.log("src",src);

			//Note: similar to addRow
			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");
			var str = "";
			var cols = [];
			var colTypes = getTableViewColTypes(rows);

			var rowOffset = 0;

			//if transposed cols = [c][r], else cols = [r][c]

			//localInsertSourceData ~~
			function localInsertSourceData() 
			{
				if (_tableViewIsTransposed) 
				{

					for (var r = 0; r < src.length; ++r) 
					{
						var srcc = 0;

						//do not let go past special 3 columns of current column types (-1 for the c+1)
						for (var c = 0; c < src[r].length - 3 && c < colTypes.length - 3 - 1; ++c) 
						{
							if (rowOffset + r == 0) cols[c] = [];
							if (!c) cols[0][rowOffset + r] = rowOffset + r; //insert row number	
							
							//seems like no need to decode URI component on import side
							cols[c + 1][rowOffset + r] = src[r][srcc++].
								replace(/\$\{OTS_FIELD_DELIMETER\}/g,colDel).
								replace(/\$\{OTS_RECORD_DELIMETER\}/g,rowDel); //e.g. swap commas and newlines back in
														
						}

						//fill any missing columns up to special columns
						for (c; c < colTypes.length - 3 - 1; ++c) 
						{
							if (rowOffset + r == 0) cols[c] = [];
							if (!c) cols[0][rowOffset + r] = rowOffset + r; //insert row number
							cols[c + 1][rowOffset + r] = ""; //blank
						}

						//finish last special 3
						for (c; srcc < src[r].length; ++c) 
						{
							if (rowOffset + r == 0) cols[c] = [];
							if (!c) cols[0][rowOffset + r] = rowOffset + r; //insert row number
							
							//seems like no need to decode URI component on import side
							cols[c + 1][rowOffset + r] = src[r][srcc++].
									replace(/\$\{OTS_FIELD_DELIMETER\}/g,colDel).
									replace(/\$\{OTS_RECORD_DELIMETER\}/g,rowDel);  //e.g. swap commas and newlines back in
							
						}

					}
				}
				else 
				{
					for (var r = 0; r < src.length; ++r) 
					{
						var srcc = 0;

						cols[rowOffset + r] = [];

						//do not let go past special 3 columns of current column types (-1 for the c+1)
						for (var c = 0; c < src[r].length - 3 && c < colTypes.length - 3 - 1; ++c) 
						{
							if (!c) cols[rowOffset + r][0] = rowOffset + r; //insert row number

							//seems like no need to decode URI component on import side
							cols[rowOffset + r][c + 1] = src[r][srcc++].
									replace(/\$\{OTS_FIELD_DELIMETER\}/g,colDel).
									replace(/\$\{OTS_RECORD_DELIMETER\}/g,rowDel);  //e.g. swap commas and newlines back in
						
						}

						//fill any missing columns up to special columns
						for (c; c < colTypes.length - 3 - 1; ++c) 
						{
							if (!c) cols[rowOffset + r][0] = rowOffset + r; //insert row number
							cols[rowOffset + r][c + 1] = ""; //blank
						}

						//finish last special 3
						for (c; srcc < src[r].length; ++c)
						{
							if (!c) cols[rowOffset + r][0] = rowOffset + r; //insert row number
							
							//seems like no need to decode URI component on import side
							cols[rowOffset + r][c + 1] = src[r][srcc++].
									replace(/\$\{OTS_FIELD_DELIMETER\}/g,colDel).
									replace(/\$\{OTS_RECORD_DELIMETER\}/g,rowDel);  //e.g. swap commas and newlines back in
							
						}
					}
				}
				rowOffset += src.length;
			}
			//end localInsertSourceData()

			//-------------------------			


			//localInsertCurrentData ~~
			function localInsertCurrentData(rowStart, rowEnd) 
			{
				if (rowEnd === undefined || rowEnd < 0 || rowEnd >= rows.length)
					rowEnd = (_tableViewIsTransposed ?
						(rows[0].getElementsByTagName("td").length + 1) :
						rows.length) - 1;

				var tmpCols;
				if (!_tableViewIsTransposed) //reading from normal view
				{
					for (var r = rowStart; r <= rowEnd; ++r) 
					{
						cols.push([]); //push empty column, for each 
						if (r == _CONFIG_DATA_ROW_OFFSET - 1) //col names are headers
						{
							tmpCols = rows[r].getElementsByTagName("th");
							for (var c = 0; c < tmpCols.length; ++c)
								cols[rowOffset + r - rowStart][c] = tmpCols[c].innerHTML;
						}
						else 
						{
							tmpCols = rows[r].getElementsByTagName("td");
							for (var c = 0; c < tmpCols.length; ++c)
								cols[rowOffset + r - rowStart][c] = tmpCols[c].innerHTML;
						}
					}
				}
				else //reading from transposed view
				{
					var tmpColsIndex;
					for (var c = 0; c < rows.length; ++c)
					{
						if (c >= cols.length)
							cols.push([]); //push empty column, for each 

						//assume there is 1 th cell
						tmpCols = rows[c].getElementsByTagName("td");
						for (var r = rowStart, tmpColsIndex = rowStart -
							(rowStart >= _CONFIG_DATA_ROW_OFFSET ? 1 : 0); r <= rowEnd; ++r) //-1 for th when starting at DATA OFFSET
						{
							if (r == _CONFIG_DATA_ROW_OFFSET - 1) //col names are headers
								cols[c][rowOffset + r - rowStart] = rows[c].getElementsByTagName("th")[0].innerHTML;
							else //take from the td cels
								cols[c][rowOffset + r - rowStart] = tmpCols[tmpColsIndex++].innerHTML;
						}
					}
				}
				rowOffset += (rowEnd - rowStart) + 1;
			}
			//end localInsertCurrentData(rowStart,rowEnd)

			//-------------------------		





			//FIRST, always get rows up to data offset
			localInsertCurrentData(0, _CONFIG_DATA_ROW_OFFSET - 1);

			var uploadStartRow = -1;
			var existingStartRow = -1;
			var uploadSize = -1;
			var existingSize = -1;

			if (!doAppend) //prepending or replacing data, so add first
			{
				uploadStartRow = rowOffset;
				localInsertSourceData();
				uploadSize = rowOffset - uploadStartRow;
			}

			if (!doReplace) //get current values from table
			{
				existingStartRow = rowOffset;
				localInsertCurrentData(_CONFIG_DATA_ROW_OFFSET);
				existingSize = rowOffset - existingStartRow;
			}

			if (doAppend) //appending or replacing data, so add last
			{
				uploadStartRow = rowOffset;
				localInsertSourceData();
				uploadSize = rowOffset - uploadStartRow;
			}


			//now remove conflicting UIDs based on uploadStyle
			Debug.log("CfgGUI uploadTableFromCSV uploadStartRow = " + uploadStartRow);
			Debug.log("CfgGUI uploadTableFromCSV existingStartRow = " + existingStartRow);
			Debug.log("CfgGUI uploadTableFromCSV uploadSize = " + uploadSize);
			Debug.log("CfgGUI uploadTableFromCSV existingSize = " + existingSize);
			var colUID = -1;
			for (var j = 0; j < colTypes.length; ++j)
				if (colTypes[j] == "UID") { colUID = j; break; }

			if (colUID == -1)
			{
				Debug.log("Could not find UID column during upload!", Debug.HIGH_PRIORITY);
				return;
			}

			if (!_tableViewIsTransposed && uploadStyle != 1 &&
				uploadStyle != 4) {
				//delete conficts
				for (var j = 0; j < uploadSize; ++j) 
				{
					//search for conflict
					for (var r = 0; r < existingSize; ++r) 
					{
						if (cols[r + existingStartRow][colUID] ==
							cols[j + uploadStartRow][colUID]) 
						{
							Debug.log("Found conflict");

							if (uploadStyle == 2 || uploadStyle == 5)
							{
								//remove from upload
								cols.splice(j + uploadStartRow, 1);
								if (uploadStartRow < existingStartRow)
									--existingStartRow;
								--uploadSize;
								--j;
							}
							else if (uploadStyle == 3 || uploadStyle == 6) 
							{
								//remove from existing table
								cols.splice(r + existingStartRow, 1);
								if (uploadStartRow > existingStartRow)
									--uploadStartRow;
								--existingSize;
								--r;
							}

							break; //stop search
						}
					}
				}

			} //end non-transposed handling
			else //transposed
			{
				//delete conficts
				for (var j = 0; j < uploadSize; ++j) 
				{
					//search for conflict
					for (var r = 0; r < existingSize; ++r) 
					{
						if (cols[colUID][r + existingStartRow] ==
							cols[colUID][j + uploadStartRow])
						{
							Debug.log("Found conflict");

							if (uploadStyle == 2 || uploadStyle == 5)
							{
								//remove from upload

								//remove from every column
								for (var c = 0; c < cols.length; ++c)
									cols[c].splice(j + uploadStartRow, 1);

								if (uploadStartRow < existingStartRow)
									--existingStartRow;
								--uploadSize;
								--j;
							}
							else if (uploadStyle == 3 || uploadStyle == 6)
							{
								//remove from existing table

								//remove from every column
								for (var c = 0; c < cols.length; ++c)
									cols[c].splice(r + existingStartRow, 1);

								if (uploadStartRow > existingStartRow)
									--uploadStartRow;
								--existingSize;
								--r;
							}

							break; //stop search
						}
					}
				}

			}  //end transposed handling



			//create output string based on cols
			try 
			{
				str += createTableViewOutputStr(cols, colTypes,
					false /*transpose output*/, true /*cols is array*/);
			}
			catch (e) 
			{
				Debug.log(e);
				Debug.log("There was a problem importing the CSV file. There may have been a mismatch in the " +
					"number of columns. Please check the compatibility of the imported data.",
					Debug.HIGH_PRIORITY);
				return;
			}
			el.innerHTML = str;

			//on succes remove popup
			el = document.getElementById("popUpDialog");
			if (el) el.parentNode.removeChild(el);

			versionHasChanged();
			
			Debug.log("The upload was successful!", Debug.INFO_PRIORITY);
		} //end uploadTableFromCSV()

		//==============================================================================
		//popUpUploadCSVTableForm ~~
		function popUpUploadCSVTableForm(groupName, groupKey) 
		{
			Debug.log("CfgGUI popUpUploadCSVTableForm");
			_tableUploadStr = ""; //clear previous upload

			var str = "";

			var el = document.getElementById("popUpDialog");
			if (!el) 
			{
				el = document.createElement("div");
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 380;
			var h = 275;
			ConfigurationAPI.setPopUpPosition(el, w /*w*/, h /*h*/);

			var str = "<a id='" +
				"popUpDialog" + //clear upload string on cancel!
				"-header' onclick='_tableUploadStr = \"\"; var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";

			str += "Please choose a CSV formatted data file (i.e. commas for columns, and new lines for rows) " +
				"to upload, and choose whether you want to replace the current " +
				"data or prepend/append the new data:<br><br>";

			str += "<center>";

			str += "<input type='file' id='popUpDialog-fileUpload' " +
				"accept='.csv' enctype='multipart/form-data' />";
			str += "<br><br>";

			str += "Select your upload method: <br>";
			str += "<select id='popUpDialog-uploadStyleSelect' style='width:360px'>";

			var selectArr = [
				"Replace all current records with uploaded records", 			//0
				"Append all uploaded records to current table", 				//1
				"Append only uploaded records without conflicting UIDs",		//2
				"Append all uploaded records and replace conflicting UIDs",	//3
				"Prepend all uploaded records to current table",				//4
				"Prepend only uploaded records without conflicting UIDs",		//5
				"Prepend all uploaded records and replace conflicting UIDs"	//6
			];
			for (var j = 0; j < selectArr.length; ++j)
			{
				str += "<option value='" + j + "'>";
				str += selectArr[j];	//can display however
				str += "</option>";
			}
			str += "</select>";

			// done with special handling
			// continue with pop-up prompt
			str += "</center></div><br><br>"; //close main popup div

			var onmouseupJS = "";
			onmouseupJS += "document.getElementById(\"popUpDialog-submitButton\").disabled = true;";
			onmouseupJS += "uploadTableFromCSV();";

			str += "<input id='popUpDialog-submitButton' disabled type='button' onmouseup='" +
				onmouseupJS + "' " +
				"value='Upload File' title='" +
				"Upload the chosen file to the current table based on your selected options." +
				"'/>";

			el.innerHTML = str;
			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";

			document.getElementById('popUpDialog-fileUpload').addEventListener(
				'change', function (evt) 
				{
					var files = evt.target.files;
					var file = files[0];
					var reader = new FileReader();
					reader.onload = 
							function () 
							{
						//store uploaded file and enable button
						_tableUploadStr = this.result;
						Debug.log("_tableUploadStr = " + _tableUploadStr);
						document.getElementById('popUpDialog-submitButton').disabled = false;
							}
					reader.readAsText(file);
				}, false);
		} //end popUpUploadCSVTableForm()

		//==============================================================================
		//downloadTableAsCSV ~~
		// on the internet, people complain that this doesn't work for big files.
		// Note: if files become too big, could have server create csv file
		//	then link to <a href='/WebPath/download.csv' download></a>
		//	Note: href must be  encodeURI(dataStr) if data not already encoded
		function downloadTableAsCSV() 
		{
			// Popup selection window
			_tableUploadStr = ""; //clear previous upload

			var str = "";

			var el = document.getElementById("popUpDialog");
			if (!el) 
			{
				el = document.createElement("div");
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 380;
			var h = 275;
			ConfigurationAPI.setPopUpPosition(el, w /*w*/, h /*h*/);

			var str = "<a id='" +
				"popUpDialog" + //clear upload string on cancel!
				"-header' onclick='_tableUploadStr = \"\"; var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";

			str += "<div id='popUpDialog-div'>";

			str += "<center>";
			
			str += "Default field delimiters (in Excel and Numbers) vary based " +
					"on keyboard settings, so please select your field delimiter: <br><br>";
			str += "<select id='fieldSelect'>";

			str += "<option value= ',' selected>Comma ,</option>";
			str += "<option value= ';'>Semicolon ;</option>";
			//			str += "<option value= '%'>Percent ' % '</option>";
			//			str += "<option value= '/'>Forward slash ' / '</option>";

			//RAR removed record delimiter selection, always assume new line 
			//	otherwise creates havoc with auto determining on upload
			
			//			str += "</select><br><br>";
			//
			//			str += "Select your record delimiter: <br><br>";
			//			str += "<select id='recordSelect' style='width:360px'>";
			//
			//			str += "<option value= '\n' selected>New line</option>";
			//			str += "<option value= ';'>Semicolon ' ; '</option>";
			//			str += "<option value= ';'>Semicolon ' , '</option>";
			//			str += "<option value= '&'>Ampersand ' & '</option>";
			str += "</select>";

			// done with special handling
			// continue with pop-up prompt
			str += "</center></div><br><br>"; //close main popup div
			var onmouseupJS = "";
			onmouseupJS += "document.getElementById(\"delimiterSubmit\").disabled = true;";
			onmouseupJS += "uploadTableFromCSV();";

			str += "<button id='downloadCSV' class='downloadCSV' title='Download current table values with your chosen delimiter'>Download current table values</button>";

			str += "<br><br>Or select a table version to download:<br>" +
				"<input style='margin: 5px;' type='text' " +
				"id='downloadCSVtableVersion' value='" +
				_version + "'><br>";
			
			str += "<button id='downloadVersionedCSV' class='downloadCSV' title='Download versioned tabled with your chosen delimiter'>Download versioned table</button>";

			el.innerHTML = str;
			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";
			called = 0;
			document.getElementById("downloadCSV").onclick = 
					function () 
					{
				Debug.log("CfgGUI downloadTableAsCSV ");
				editCellOK(); //editCellCancel();
				var dataStr = "data:text/csv;charset=utf-8,";
				el = document.getElementById("SubSystemTable");
				var rows = el.getElementsByTagName("tr");
				
				//Note: changes to download code to propagate to localDownloadMembers()
				
				var rowDel = '\n'; //document.getElementById("recordSelect").value;
				var colDel = document.getElementById("fieldSelect").value;

				var cells;

				if (_tableViewIsTransposed)
				{
					var numOfCols = rows.length - _CONFIG_DATA_COL_OFFSET;
					var numOfRows = rows[0].getElementsByTagName("td").length + 1 -
						_CONFIG_DATA_ROW_OFFSET; //assume one TH cell

					//have to locate each cell individually
					for (var r = 0; r < numOfRows; ++r) 
					{
						if (r)
							dataStr += encodeURI(rowDel); //encoded \n

						for (var c = 0; c < numOfCols; ++c) //skip row index column
						{
							cells = rows[_CONFIG_DATA_COL_OFFSET + c].getElementsByTagName("td");
							//assume one th column so minus 1
							if (c)
								dataStr += encodeURI(colDel);
							dataStr += encodeURIComponent(
									cells[_CONFIG_DATA_ROW_OFFSET - 1 + r].textContent.trim().
									replace(new RegExp(rowDel,'g'),"${OTS_RECORD_DELIMETER}").
									replace(new RegExp(colDel,'g'),"${OTS_FIELD_DELIMETER}")
							); //replaces all special characters				
						}
					}
				}
				else
				{
					for (var r = _CONFIG_DATA_ROW_OFFSET; r < rows.length; ++r) //skip header rows
					{
						if (r - _CONFIG_DATA_ROW_OFFSET)
							dataStr += encodeURI(rowDel); //encoded \n

						cells = rows[r].getElementsByTagName("td");

						for (var c = _CONFIG_DATA_COL_OFFSET; c < cells.length; ++c) //skip row index column
						{
							if (c - _CONFIG_DATA_COL_OFFSET)	
								dataStr += encodeURI(colDel);
														
							dataStr += encodeURIComponent(cells[c].textContent.trim().
									replace(new RegExp(rowDel,'g'),"${OTS_RECORD_DELIMETER}").
									replace(new RegExp(colDel,'g'),"${OTS_FIELD_DELIMETER}")
							); //replaces all special characters				
						}
					}
				}
				Debug.log("CfgGUI downloadTableAsCSV dataStr=" + dataStr);
				console.log("dataStr",decodeURIComponent(dataStr));
								
				var link = document.createElement("a");
				link.setAttribute("href", dataStr); //double encode, so encoding remains in CSV
				link.setAttribute("style", "display:none");
				link.setAttribute("download", _currentTableName + "-v" +
					_version + "_download.csv");
				document.body.appendChild(link); // Required for FF

				link.click(); // This will download the data file with filename *_download.csv

				link.parentNode.removeChild(link);
				
				document.getElementById("popUpDialog").style.display = "none";

				Debug.info("File '" + "download", _currentTableName + "-v" +
					_version + "_download.csv" + "' was successfully downloaded");

			}; //end downloadCSV handler

			document.getElementById("downloadVersionedCSV").onclick = 
				function()
			{
				var v = document.getElementById("downloadCSVtableVersion").value;
				Debug.log("downloadVersionedCSV() v",v);
				DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificTable" +
					"&dataOffset=0&chunkSize=" + _MAX_CHUNK_SIZE +
					"&rawData=1" +
					"&tableName=" + _currentTableName +
					"&version=" + v,
					"",
					function(req)
					{
						//Debug.log("req",req.responseText);

						var rawData = DesktopContent.getXMLValue(req, "TableRawData");
						Debug.logv({rawData});
						var columns = req.responseXML.getElementsByTagName("ColumnHeader");

						var dataStr = "data:text/csv;charset=utf-8,";

						var rowDel = '\n'; //document.getElementById("recordSelect").value;
						var colDel = document.getElementById("fieldSelect").value;		

						var colNames = {}; //make column name map to verify column sanity		
						for(var i=0;i<columns.length;++i)
						{
							colNames[columns[i].getAttribute("value")] = -1; //init, and then determine column in table from data													
						} //end column name header loop

						var dataArr = rawData.split(',');
						//format of raw data CSV:
						//	- first columns.length entries are column pairs<name,type> in order	
						//	- then pairs<column name, value> .. for all table data
						//	-- it can be inferred when column names repeat, a new record/row has started
						for(var i=0;i<columns.length && i*2 < dataArr.length;++i)
						{
							var decodedColumnName = decodeURIComponent(dataArr[i*2]);
							if(colNames[decodedColumnName] === undefined)
							{
								Debug.warn("Header field " + colCount + " with column name '" +
									decodedColumnName +	"' is not found in source column list (" +
									columns.length + " source columns found)."); 
							}			
							colNames[decodedColumnName] = i; //set column in table
							if(i) dataStr += encodeURI(colDel);
							dataStr += decodedColumnName;	
						} //end leading column name in data loop
						dataStr += encodeURI(rowDel); //encoded \n

						var colCount = 0, rowCount = 0;
						for(var i=columns.length*2;i+1<dataArr.length;i+=2)
						{				
							var decodedColumnName = decodeURIComponent(dataArr[i]);
							if(colNames[decodedColumnName] === undefined)
							{
								Debug.warn("Column " + colCount + " with column name '" +
									decodedColumnName +	"' in row " + 
									rowCount + " is not found in source column list (" +
									columns.length + " source columns found)."); 
							}			
							else if(colNames[decodedColumnName] != colCount)
							{
								Debug.warn("Column " + colCount + " with column name '" +
									decodedColumnName + "' in row " + 
									rowCount + " is not at expected column position of " + colCount + "."); 
							}			

							if(colCount) dataStr += encodeURI(colDel);
							dataStr += encodeURIComponent(decodeURIComponent(dataArr[i+1]).
									replace(new RegExp(rowDel,'g'),"${OTS_RECORD_DELIMETER}").
									replace(new RegExp(colDel,'g'),"${OTS_FIELD_DELIMETER}")); //comes from server already encoded
							
							if(++colCount == columns.length)
							{
								//new record starting
								dataStr += encodeURI(rowDel); //encoded \n
								colCount = 0; //reset column counter
								++rowCount;
							}
						} //end data string contruction loop

						var link = document.createElement("a");
						link.setAttribute("href", dataStr); //double encode, so encoding remains in CSV
						link.setAttribute("style", "display:none");
						link.setAttribute("download", _currentTableName + "-v" +
							v + "_raw.csv");
						document.body.appendChild(link); // Required for FF

						link.click(); // This will download the data file with filename *_download.csv

						link.parentNode.removeChild(link);

						Debug.info("File '" + "download", _currentTableName + "-v" +
							v + "_raw.csv" + "' was successfully downloaded");

					} //end downloadCSVtableVersion request handler
				); //end downloadCSVtableVersion request call
			}; // end downloadVersionedCSV handler

		} //end downloadTableAsCSV()
		
		//==============================================================================
		//saveTableAsNewVersion ~~
		//	ignoreWarnings = true will ignore warnings when saving groups
		//
		//	mimicking saveModifiedTree(ignoreWarnings) for group saving aspects
		function saveTableAsNewVersion(temporary, backLinkStr, ignoreWarnings) 
		{
			editCellOK(); //editCellCancel();
			Debug.log("CfgGUI saveTableAsNewVersion temporary=" + temporary);

			var el = document.getElementById("popUpDialog-comment");
			var comment;
			if (el)
				comment = encodeURIComponent(el.value);
			else
				comment = "This is a temporary table.";

			//create data string from html table
			var dataStr = ""; // semi-colon(;) separated rows.. comma(,) separated entries within row
			el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");

			var cells;

			if (_tableViewIsTransposed) 
			{
				var numOfCols = rows.length - _CONFIG_DATA_COL_OFFSET;
				var numOfRows = rows[0].getElementsByTagName("td").length + 1 -
					_CONFIG_DATA_ROW_OFFSET; //assume one TH cell

				//have to locate each cell individually
				for (var r = 0; r < numOfRows; ++r)
				{
					for (var c = 0; c < numOfCols; ++c) //skip row index column
					{
						cells = rows[_CONFIG_DATA_COL_OFFSET + c].getElementsByTagName("td");
						//assume one th column so minus 1
						dataStr += encodeURIComponent(
							cells[_CONFIG_DATA_ROW_OFFSET - 1 + r].textContent.trim()) + ","; //replaces all special characters				
					}
					dataStr += ";";
				}
			}
			else 
			{
				for (var r = _CONFIG_DATA_ROW_OFFSET; r < rows.length; ++r) //skip header rows
				{
					cells = rows[r].getElementsByTagName("td");

					for (var c = _CONFIG_DATA_COL_OFFSET; c < cells.length; ++c) //skip row index column
						dataStr += encodeURIComponent(cells[c].textContent.trim()) + ","; //replaces all special characters					
					dataStr += ";";
				}
			}

			if (temporary) 
			{
				var reqStr = "Request?RequestType=saveSpecificTable" +
					"&dataOffset=" + _dataOffset + "&chunkSize=" + (rows.length - _CONFIG_DATA_ROW_OFFSET) +
					"&tableName=" + _currentTableName + "&version=" + _version +
					"&temporary=" + (temporary ? 1 : 0) +
					"&tableComment=" + comment;
				Debug.log(dataStr);
				Debug.log(reqStr);
				DesktopContent.XMLHttpRequest(reqStr, "data=" + dataStr,
					saveTableAsNewVersionHandler, backLinkStr,
					0, true  //progressHandler, callHandlerOnErr
				);
				return; //done handling temporary version save
			}

			//saving persistent version

			//Note: all information comes from popup dialog
			//	any return must also kill the popup

			//for each modified table
			//	save new version
			//	update tree member table version based on result
			//if saving groups
			//	for each affected group
			//		save member list but with tree table versions
			//		modify root group name if changed
			//if saving aliases
			//	for each alias
			//		set alias for new group

			Debug.log("saveTableAsNewVersion " + (ignoreWarnings ? 1 : 0));
			var numberOfRequests = 0;
			var numberOfReturns = 0;
			var allRequestsSent = false;

			//localHandleAffectedGroups ~~
			//	savedVersion is the new version of this table
			//	use it to updage member map of affected groups
			function localHandleAffectedGroups(savedVersion)
			{
				Debug.log("Done with table saving.");

				//check if saving groups
				var savingGroups =
					document.getElementById("popUpDialog-bumpGroupVersions").checked;
				var activatingSavedGroups =
					document.getElementById("popUpDialog-activateBumpedGroupVersions").checked;

				if (!savingGroups) //then no need to proceed. exit!
				{
					//kill popup dialog
					var el = document.getElementById("popUpDialog");
					if (el) el.parentNode.removeChild(el);
					return;
				}

				Debug.log("On to saving groups");

				numberOfRequests = 0;		//re-use
				numberOfReturns = 0;		//re-use
				allRequestsSent = false; 	//re-use

				var affectedGroupNames = []; //to be populated for use by alias setting
				var affectedGroupKeys = []; //to be populated for use by alias setting
				var affectedGroupEls =
					document.getElementsByClassName("popUpDialog-affectedGroups");
				var affectedGroupCommentEls =
					document.getElementsByClassName("popUpDialog-groupComment-cache");

				//	for each affected group
				for (var i = 0; i < affectedGroupEls.length; ++i)
				{
					//save member list but with tree table versions
					Debug.log(affectedGroupEls[i].textContent);
					Debug.log("group comment: " + affectedGroupCommentEls[i].textContent);

					var affectedArr = affectedGroupEls[i].textContent.split(',');

					//build member config map
					var tableMap = "tableList=";
					//member map starts after group name/key (i.e. [2])
					for (var a = 2; a < affectedArr.length; a += 2)
						if ((affectedArr[a + 1] | 0) == -1) //replace version with new saved version
						{
							Debug.log("affectedArr " + affectedArr[a] + "-v" + affectedArr[a + 1]);

							tableMap += affectedArr[a] + "," +
								savedVersion + ",";
						}
						else //use existing version
							tableMap += affectedArr[a] + "," + affectedArr[a + 1] + ",";

					affectedGroupNames.push(affectedArr[0]);
					reqStr = ""; //reuse
					reqStr = "Request?RequestType=saveNewTableGroup" +
						"&groupName=" + affectedArr[0] +
						"&allowDuplicates=0" +
						"&lookForEquivalent=1" +
						"&ignoreWarnings=" + (ignoreWarnings ? 1 : 0) +
						"&groupComment=" + encodeURIComponent(affectedGroupCommentEls[i].textContent);
					Debug.log(reqStr);
					Debug.log(tableMap);

					++numberOfRequests;
					///////////////////////////////////////////////////////////
					DesktopContent.XMLHttpRequest(reqStr, tableMap,
						function (req, treeMemberIndex) 
						{

							var attemptedNewGroupName = DesktopContent.getXMLValue(req, "AttemptedNewGroupName");
							var treeErr = DesktopContent.getXMLValue(req, "TreeErrors");
							if (treeErr)
							{
								Debug.log(treeErr, Debug.HIGH_PRIORITY);
								Debug.log("There were problems identified in the tree view of the " +
									"attempted new group '" +
									attemptedNewGroupName +
									"'.\nThe new group was not created.\n" +
									"(Note: Other tables and groups may have been successfully created, " +
									"and would have success indications below this error info)\n\n" +
									"You can save the group anyway (if you think it is a good idea) by clicking " +
									"the button in the pop-up dialog " +
									"'<u>Save Groups with Warnings Ignored</u>.' " +
									"\n\nOtherwise, you can hit '<u>Cancel</u>.' and fix the tree. " +
									"Below you will find the description of the problem:",
									Debug.HIGH_PRIORITY);

								//change dialog save button
								var el = document.getElementById("popUpDialog-submitButton");
								el.onmouseup = 
										function () 
										{
									document.getElementById("popUpDialog-submitButton").disabled = true;
									saveTableAsNewVersion(temporary, backLinkStr, 1);//saveModifiedTree(1);								
								};
								el.value = "Save Groups with Warnings Ignored";
								el.disabled = false;
								return;
							}

							var err = DesktopContent.getXMLValue(req, "Error");
							if (err) 
							{
								Debug.log(err, Debug.HIGH_PRIORITY);

								//kill popup dialog
								var el = document.getElementById("popUpDialog");
								if (el) el.parentNode.removeChild(el);
								return;
							}

							++numberOfReturns;

							var newGroupKey = DesktopContent.getXMLValue(req, "TableGroupKey");
							affectedGroupKeys.push(newGroupKey); //can only be index 0, since affectedArr[0] was used for request

							var foundEquivalentKey = DesktopContent.getXMLValue(req, "foundEquivalentKey") | 0; //as int

							if (foundEquivalentKey)
								Debug.log("Found equivalent group '" + attemptedNewGroupName +
									" (" + newGroupKey + ")'", Debug.INFO_PRIORITY);
							else
								Debug.log("Successfully created new group '" + attemptedNewGroupName +
									" (" + newGroupKey + ")'", Debug.INFO_PRIORITY);

							//need to modify root group name if changed

							//activate if option was selected
							if (activatingSavedGroups)
								activateSystemConfig(attemptedNewGroupName, newGroupKey);


							if (allRequestsSent &&
								numberOfReturns == numberOfRequests)
							{
								Debug.log("Done with group saving.");

								Debug.log("Moving on to Alias creation...");

								//check each alias checkbox
								//	for each alias that is checked
								//		set alias for new group
								//if any aliases modified, save and activate backbone

								//get checkboxes
								var setAliasCheckboxes =
									document.getElementsByClassName("popUpDialog-setGroupAlias");

								var groupAlias, groupName, groupKey;
								var setAliasCheckboxIndex = 0;
								var groupAliasName, groupAliasVersion;

								//in order to set alias, we need:
								//	groupAlias
								//	groupName
								//	groupKey				

								//for each set alias checkbox that is checked
								//	modify the active group alias table one after the other

								//localNextAliasHandler
								//	uses setAliasCheckboxIndex to iterate through setAliasCheckboxes
								//	and send the next request to modify the activegroupAlias table
								//	sequentially
								function localNextAliasHandler(req) 
								{
									//first time there is no req
									if (req)
									{
										var err = DesktopContent.getXMLValue(req, "Error");
										if (err) 
										{
											Debug.log(err, Debug.HIGH_PRIORITY);
											Debug.log("Process interrupted. Failed to modify the currently active Backbone!", Debug.HIGH_PRIORITY);

											//kill popup dialog
											var el = document.getElementById("popUpDialog");
											if (el) el.parentNode.removeChild(el);
											return;
										}

										groupAliasName = DesktopContent.getXMLValue(req, "savedName");
										groupAliasVersion = DesktopContent.getXMLValue(req, "savedVersion");

										Debug.log("Successfully added the system alias '" + groupAlias +
											"' reference to group '" + groupName + " (" + groupKey + ")' " +
											" in table '" + groupAliasName + "-v" + groupAliasVersion +
											"'.",
											Debug.INFO_PRIORITY);
										++setAliasCheckboxIndex; //req back, so ready for next index
									}

									//get next affected group index			
									while (setAliasCheckboxIndex < setAliasCheckboxes.length &&
										!setAliasCheckboxes[setAliasCheckboxIndex].checked)
										Debug.log("Skipping checkbox " + (++setAliasCheckboxIndex));

									if (setAliasCheckboxIndex >= setAliasCheckboxes.length) 
									{
										Debug.log("Done with alias checkboxes ");

										if (!req) 
										{
											Debug.log("Backbone was not modified, so no need to save.");

											//kill popup dialog
											var el = document.getElementById("popUpDialog");
											if (el) el.parentNode.removeChild(el);

											Debug.log("Tree saving operations complete.", Debug.INFO_PRIORITY);
											treeHasChanged(true); // reset
											return;
										}
										Debug.log("Saving and activating modified Backbone");


										Debug.log("groupAliasName=" + groupAliasName);
										Debug.log("groupAliasVersion=" + groupAliasVersion);
										var tableNames = req.responseXML.getElementsByTagName("oldBackboneName");
										var tableVersions = req.responseXML.getElementsByTagName("oldBackboneVersion");

										//make a new backbone with old versions of everything except Group Alias 
										var tableMap = "tableList=";
										var name;
										for (var i = 0; i < tableNames.length; ++i)
										{
											name = tableNames[i].getAttribute("value");

											if (name == groupAliasName)
											{
												tableMap += name + "," +
													groupAliasVersion + ",";
												continue;
											}
											//else use old member
											tableMap += name + "," +
												tableVersions[i].getAttribute("value") + ",";
										}
										Debug.log(tableMap);

										//FIXME -- use config API version of setGroupAliasInActiveBackbone
										saveGroupAndActivate("TableEditWizBackbone", tableMap,
											function (retParams) 
											{
												Debug.log("Save and activate is done.");

												if (retParams) 
												{
													Debug.log("Successfully modified the active Backbone group.\n" +
														"Backbone group '" + retParams.groupName + " (" +
														retParams.groupKey + ")' was activated.",
														Debug.INFO_PRIORITY);
												}

												//kill popup dialog
												var el = document.getElementById("popUpDialog");
												if (el) el.parentNode.removeChild(el);

												Debug.log("Tree saving operations complete.", Debug.INFO_PRIORITY);
												treeHasChanged(true); // reset
												return;
											},	//end of done handler for saveGroupAndActivate
											true //request return parameters
										);
										return;
									}

									//get next alias
									{
										var el = document.getElementById("popUpDialog-editAliasSelect-" +
											setAliasCheckboxIndex);
										if (el.style.display == "none")
										{
											//get value from text box
											el = document.getElementById("popUpDialog-editAliasTextBox-" +
												setAliasCheckboxIndex);
										}
										groupAlias = el.value;
									}

									groupName = affectedGroupNames[setAliasCheckboxIndex];
									groupKey = affectedGroupKeys[setAliasCheckboxIndex];

									Debug.log("groupAlias = " + groupAlias);
									Debug.log("groupName = " + groupName);
									Debug.log("groupKey = " + groupKey);

									if (!groupAlias || groupAlias.trim() == "")
									{
										Debug.log("Process interrupted. Invalid empty alias given!", Debug.HIGH_PRIORITY);

										//kill popup dialog
										var el = document.getElementById("popUpDialog");
										if (el) el.parentNode.removeChild(el);

										return;
									}

									DesktopContent.XMLHttpRequest("Request?RequestType=setGroupAliasInActiveBackbone" +
										"&groupAlias=" + groupAlias +
										"&groupName=" + groupName +
										"&groupKey=" + groupKey, "",
										localNextAliasHandler,
										0, 0, true  //reqParam, progressHandler, callHandlerOnErr
									);
								} //end localNextAliasHandler()

								localNextAliasHandler();

								Debug.log("Aliases set in motion");

								return;
							}

						}, 0, 0, true  //reqParam, progressHandler, callHandlerOnErr
					); //end save new group request								
				} //end affected group for loop

				allRequestsSent = true;
				if (numberOfRequests == 0) //no requests were sent, so go on to affected groups
				{
					Debug.log("There were no affected groups found to save.", Debug.INFO_PRIORITY);

					//kill popup dialog
					var el = document.getElementById("popUpDialog");
					if (el) el.parentNode.removeChild(el);

					Debug.log("Tree saving operations complete.", Debug.INFO_PRIORITY);
					treeHasChanged(true); // reset
				}
			}	//end localHandleAffectedGroups


			///////////
			//save the new table version

			var reqStr = "Request?RequestType=saveSpecificTable" +
				"&dataOffset=" + _dataOffset + "&chunkSize=" + (rows.length - _CONFIG_DATA_ROW_OFFSET) +
				"&tableName=" + _currentTableName +
				"&version=" + _version +
				"&lookForEquivalent=" + "1" +
				"&temporary=" + (temporary ? 1 : 0) +
				"&tableComment=" + comment;
			Debug.log(dataStr);
			Debug.log(reqStr);

			DesktopContent.XMLHttpRequest(reqStr, "data=" + dataStr,
				function (req) 
				{
					var err = DesktopContent.getXMLValue(req, "Error");
					if (err)
					{
						if (ignoreWarnings) 
						{
							//try to continue on with saving the group
							Debug.log(err, Debug.WARN_PRIORITY);
							Debug.log("Ignoring table saving error and proceding with saving group...",
								Debug.WARN_PRIORITY);

							//handle group handling based on popup options
							localHandleAffectedGroups(_version); //use current version
							return;
						}

						Debug.log(err, Debug.HIGH_PRIORITY);

						//kill popup dialog
						var el = document.getElementById("popUpDialog");
						if (el) el.parentNode.removeChild(el);
						return;
					}

					var savedVersion = DesktopContent.getXMLValue(req, "savedVersion");
					var foundEquivalentVersion = DesktopContent.getXMLValue(req, "foundEquivalentVersion") | 0; //as int

					var scratchNotice = (ConfigurationAPI._SCRATCH_VERSION == (savedVersion | 0)) ? _SCRATCH_VIEW_NAME : savedVersion;

					if (foundEquivalentVersion)
						Debug.log("Found equivalent version '" + scratchNotice +
							"' for table '" +
							_currentTableName + ".' ", Debug.INFO_PRIORITY);
					else
						Debug.log("New persistent version '" + scratchNotice +
							"' for table '" +
							_currentTableName + "' was successfully created.", Debug.INFO_PRIORITY);

					//handle group handling based on popup options
					localHandleAffectedGroups(savedVersion);

					//call normal handler to update main table display
					saveTableAsNewVersionHandler(req, backLinkStr);


				}, 0, 		//parameter
				0, true  //progressHandler, callHandlerOnErr
			);

			//done with initial call..
			//all further events happen after request for saving table returns
		} //end saveTableAsNewVersion()

		//==============================================================================
		//saveTableAsNewVersionHandler ~~
		function saveTableAsNewVersionHandler(req, backLinkStr) 
		{
			if (!backLinkStr) backLinkStr = _tableViewBackLinkStr;
			Debug.log("saveTableAsNewVersionHandler requestHandler req " + req.responseText);

			var err = DesktopContent.getXMLValue(req, "Error");
			if (err && err != "") 
			{
				Debug.log(err, Debug.HIGH_PRIORITY);
				return;
			}

			activateSystemConfigHandler(req);

			var tableName = DesktopContent.getXMLValue(req, "savedName");
			var version = DesktopContent.getXMLValue(req, "savedVersion");

			Debug.log("saveTableAsNewVersionHandler requestHandler tableName " + tableName + " version " + version);
			setupSpecificTable(tableName, version, backLinkStr);
		} //end saveTableAsNewVersionHandler()

		//==============================================================================
		//changeMemberVersionForTableGroup ~~
		function changeMemberVersionForTableGroup(groupName, groupKey, tableName, newVersion) 
		{
			Debug.log("CfgGUI changeMemberVersionForTableGroup tableName=" + tableName +
				" newVersion=" + newVersion);

			//steps:
			//	change current version
			//	update existing versions
			//	add button to save new group

			//change current version
			var el = document.getElementById(tableName + "-currentVersion");
			el.innerHTML = newVersion;

			//change link
			el = document.getElementById(tableName + "-currentVersionLink");
			//			el.onclick = function()
			//					{
			//							
			//					}
			var str;
			str = el.href;
			var linkSplitArr = str.split(',');
			str = ""; //build link href str back up with new version
			for (var i = 0; i < linkSplitArr.length; ++i)
			{
				if (i) str += ",";
				if (i == 1)
					str += "\"" + newVersion + "\"";
				else
					str += linkSplitArr[i];
			}
			el.href = str;

			//update existing
			el = document.getElementById(tableName + "-versions");
			str = el.innerHTML;
			var configNameArr = str.split(',');
			str = "";
			//str += newVersion;
			//for each member configuration					
			for (var i = 0; i < configNameArr.length - 1; ++i) //skip last ',' empty element
			{
				//Debug.log(configNameArr[i]);
				//if(configNameArr[i] == newVersion)  //skip link
				if (configNameArr[i] == newVersion || //skip link for current version
					(configNameArr[i] ==
						ConfigurationAPI._VERSION_ALIAS_PREPEND +
						ConfigurationAPI._SCRATCH_ALIAS &&
						newVersion == ConfigurationAPI._SCRATCH_VERSION)) 
				{
					str += " " + configNameArr[i];
					continue;
				}
				str += " ";
				str += "<a href='#' onclick='changeMemberVersionForTableGroup(\"" +
					groupName + "\",\"" + groupKey + "\",\"" + tableName + "\"," +
					"\"" + configNameArr[i] + "\"";
				str += "); return false;'>" + configNameArr[i];
				str += "</a>";
			}

			el = document.getElementById(tableName + "-existingVersions");
			el.innerHTML = str;


			//get new version comment and show ----------
			DesktopContent.XMLHttpRequest("Request?RequestType=getSpecificTable" +
				"&dataOffset=0&chunkSize=" + 0 +
				"&tableName=" + tableName +
				"&version=" + newVersion,
				"",
				function (req) 
				{

					var err = DesktopContent.getXMLValue(req, "Error");
					if (err) 
					{
						Debug.log(err, Debug.HIGH_PRIORITY);

						Debug.log("There were errors loading this version.\n\n" +
							"Please see the detailed Errors below:", Debug.HIGH_PRIORITY);

						//try to power through
					}

					var warns = DesktopContent.getXMLValue(req, "TableWarnings");
					if (warns)
						Debug.log("There were warnings found when loading this table " +
							"(you can treat them as informational):\n\n" +
							warns, Debug.WARN_PRIORITY);

					var tableComment = DesktopContent.getXMLValue(req, "TableComment");
					Debug.log("tableComment=" + tableComment);

					document.getElementById(tableName + "-comment").innerHTML =
						"//" + tableComment;
				},
				0, 0, true  //reqParam, progressHandler, callHandlerOnErr
			);



			//add Save Changes button -------------
			el = document.getElementById("display");
			if (document.getElementById("popUpSaveNewGroupForm-button"))//el.getElementsByTagName("div")[0].childNodes[0].tagName == "INPUT")
				return; //only add button once

			var dispStr = el.innerHTML;
			str = "";
			str += "<br><div>";
			str += "<input id='popUpSaveNewGroupForm-button' type='button' onmouseup='popUpSaveNewGroupForm(\"" +
				//			str += "<input type='button' onmouseup='saveTableGroupAsNewKey(\"" +
				groupName + "\",\"" + groupKey + "\",0)" + //0 is sourceType
				"' value='Save Changes as New Group'" +
				" title='" +
				"Save the modified group as a new persistent key for this group name." +
				"'/>";
			str += "</div>";
			el.innerHTML = str + "<br>" + dispStr + "<div id='clearDiv'></div>" + str;

			el = document.getElementById("tableGroupModified");
			el.innerHTML = "*Modified* "; //mark modified

			el = document.getElementById("saveGroupWithWarningsIgnored");
			if (el)
				el.style.display = "none";



		} //end changeMemberVersionForTableGroup()

		//==============================================================================
		//saveTableGroupAsNewKey ~~
		//	use sourceType to decide how to create member map
		//	sourceType: 
		//		0 := from specific group view	 (formerly saveTableGroupAsNewKey())
		//		1 := from add/remove member view (formerly createTableGroup()) 
		//		2 := use global _memberMapForGroupSave variable (e.g., used by upload member tables)
		function saveTableGroupAsNewKey(groupName, sourceType, ignoreWarnings)
		{
			Debug.log("CfgGUI saveTableGroupAsNewKey ignoreWarnings=" + ignoreWarnings +
				" sourceType=" + sourceType);

			var el = document.getElementById("popUpDialog-comment");
			var comment = encodeURIComponent(el.value);

			//create member map from from html
			//	depending on sourceType

			var tableMap = "tableList=";
			if (sourceType == 0) //0 := from specific group view	 (formerly saveTableGroupAsNewKey())
			{
				var memberArr = document.getElementById("GroupMember-names").innerHTML.split(",");
				Debug.log("memberArr " + memberArr);
				var version;
				for (var i = 0; i < memberArr.length - 1; ++i)
				{
					version = document.getElementById(memberArr[i] +
						"-currentVersion").innerHTML;
					Debug.log("table=" + memberArr[i] +
						" version=" + version);
					tableMap += memberArr[i] + "," + version + ",";
				}
			}
			else if (sourceType == 1) //1 := from add/remove member view (formerly createTableGroup())
			{
				var els = document.getElementsByClassName("memberTableCheckbox");
				var sel;
				for (var el = 0; el < els.length; ++el)
					if (els[el].checked)
					{
						sel = document.getElementById("select-" + els[el].value);
						if (sel.options.length) 
						{
							if (sel.selectedIndex < 0) sel.selectedIndex = 0; //default to default
							Debug.log("table=" + els[el].value + " version=" +
								sel.options[sel.selectedIndex].value);
							tableMap += els[el].value + "," + sel.options[sel.selectedIndex].value + ",";
						}
						else //if no options, choose mockup version, -1
						{
							Debug.log("table=" + els[el].value + " version=" +
								(-1));
							tableMap += els[el].value + "," + (-1) + ",";
						}
					}
			}
			else if (sourceType == 2)
			{
				//2 := use global _memberMapForGroupSave variable (e.g., used by upload member tables)

				//get tableMap from _memberMapForGroupSave

				for (var tableName in _memberMapForGroupSave) 
				{
					Debug.log("table=" + tableName +
						" version=" + _memberMapForGroupSave[tableName]);
					tableMap += tableName + "," + _memberMapForGroupSave[tableName] + ",";
				}
			}
			else
			{
				Debug.log("Unknown member map source '" + sourceType + "'",
					Debug.HIGH_PRIORITY);
				return
			}


			//saving persistent key

			//Note: all information comes from popup dialog
			//	any return must also kill the popup

			//save the trivial one group
			//	for each affected group 
			//		activate if checked
			//if saving aliases
			//	for each alias
			//		set alias for new group

			var numberOfRequests = 0;
			var numberOfReturns = 0;
			var allRequestsSent = false;

			//localHandleAffectedGroups ~~
			//	for this case, there is only the one trivial affected group
			function localHandleAffectedGroups()
			{
				var activatingSavedGroups =
					document.getElementById("popUpDialog-activateBumpedGroupVersions").checked;

				Debug.log("On to saving groups");

				numberOfRequests = 0;		//re-use
				numberOfReturns = 0;		//re-use
				allRequestsSent = false; 	//re-use

				var affectedGroupNames = []; //to be populated for use by alias setting
				var affectedGroupKeys = []; //to be populated for use by alias setting

				//	for each affected group
				for (var i = 0; i < 1; ++i)//affectedGroupEls.length;++i) //only the trivial one group
				{
					affectedGroupNames.push(groupName);

					reqStr = ""; //reuse
					reqStr = "Request?RequestType=saveNewTableGroup" +
						"&groupName=" + affectedGroupNames[0] +
						"&allowDuplicates=0" +
						"&lookForEquivalent=1" +
						"&ignoreWarnings=" + (ignoreWarnings ? 1 : 0) +
						"&groupComment=" + comment;
					Debug.log(reqStr);
					Debug.log(tableMap);

					++numberOfRequests;
					///////////////////////////////////////////////////////////
					DesktopContent.XMLHttpRequest(reqStr, tableMap,
						function (req, treeMemberIndex) 
						{

							var attemptedNewGroupName = DesktopContent.getXMLValue(req, "AttemptedNewGroupName");
							var treeErr = DesktopContent.getXMLValue(req, "TreeErrors");

							if (treeErr) 
							{
								Debug.log(treeErr, Debug.WARN_PRIORITY);
								Debug.log("There were problems identified in the tree view of the " +
									"attempted new group '" +
									attemptedNewGroupName +
									".'\nThe new group was not created.\n\n" +
									"You can save the group anyway (if you think it is a good idea) by clicking " +
									"the button in the pop-up dialog " +
									"'<u>Save Group with Warnings Ignored</u>.' " +
									"\n\nOtherwise, you can hit '<u>Cancel</u>.' and fix any issues. " +
									"Below you will find the description of the problem:",
									Debug.WARN_PRIORITY);

								//change dialog save button
								var el = document.getElementById("popUpDialog-submitButton");
								el.onmouseup = 
										function () 
										{
									document.getElementById("popUpDialog-submitButton").disabled = true;
									saveTableGroupAsNewKey(attemptedNewGroupName, sourceType, 1); //1 = ignore warnings								
								};
								el.value = "Save Group with Warnings Ignored";
								el.disabled = false;
								return;
							}

							var err = DesktopContent.getXMLValue(req, "Error");
							if (err) 
							{
								Debug.log(err, Debug.HIGH_PRIORITY);

								//							//kill popup dialog
								//							var el = document.getElementById("popUpDialog"); 
								//							if(el) el.parentNode.removeChild(el);

								Debug.log("There were problems identified while saving the " +
									"attempted new group '" +
									attemptedNewGroupName +
									".'\nThe new group was not created.\n\n" +
									"You can attempt to save the group anyway (if you think it is a good idea) by clicking " +
									"the button in the pop-up dialog " +
									"'<u>Save Group with Warnings Ignored</u>.' " +
									"\n\nOtherwise, you can hit '<u>Cancel</u>.' and fix any issues. " +
									"Below you will find the description of the problem:",
									Debug.WARN_PRIORITY);

								//change dialog save button
								var el = document.getElementById("popUpDialog-submitButton");
								el.onmouseup = function () {
									document.getElementById("popUpDialog-submitButton").disabled = true;
									saveTableGroupAsNewKey(attemptedNewGroupName, sourceType, 1); //1 = ignore warnings								
								};
								el.value = "Save Group with Warnings Ignored";
								el.disabled = false;
								return;
							}

							++numberOfReturns;

							var newGroupKey = DesktopContent.getXMLValue(req, "TableGroupKey");
							affectedGroupKeys.push(newGroupKey); //can only be one group, since affectedGroupNames[0] was used in request

							var foundEquivalentKey = DesktopContent.getXMLValue(req, "foundEquivalentKey") | 0; //as int

							if (foundEquivalentKey)
								Debug.log("Found equivalent group '" + attemptedNewGroupName +
									" (" + newGroupKey + ")'", Debug.INFO_PRIORITY);
							else
								Debug.log("Successfully created new group '" + attemptedNewGroupName +
									" (" + newGroupKey + ")'", Debug.INFO_PRIORITY);

							//need to modify root group name if changed

							specificGroupRequestHandler(req); //display new group

							//activate if option was selected
							if (activatingSavedGroups)
								activateSystemConfig(attemptedNewGroupName, newGroupKey);


							if (allRequestsSent &&
								numberOfReturns == numberOfRequests)
							{
								Debug.log("Done with group saving.");

								Debug.log("Moving on to Alias creation...");

								//check each alias checkbox
								//	for each alias that is checked
								//		set alias for new group
								//if any aliases modified, save and activate backbone

								//get checkboxes
								var setAliasCheckboxes =
									document.getElementsByClassName("popUpDialog-setGroupAlias");

								var groupAlias, groupName, groupKey;
								var setAliasCheckboxIndex = 0;
								var groupAliasName, groupAliasVersion;

								//in order to set alias, we need:
								//	groupAlias
								//	groupName
								//	groupKey				

								//for each set alias checkbox that is checked
								//	modify the active group alias table one after the other

								//localNextAliasHandler
								//	uses setAliasCheckboxIndex to iterate through setAliasCheckboxes
								//	and send the next request to modify the activegroupAlias table
								//	sequentially
								function localNextAliasHandler(req)
								{
									//first time there is no req
									if (req) 
									{
										var err = DesktopContent.getXMLValue(req, "Error");
										if (err) 
										{
											Debug.log(err, Debug.HIGH_PRIORITY);
											Debug.log("Process interrupted. Failed to modify the currently active Backbone!", Debug.HIGH_PRIORITY);

											//kill popup dialog
											var el = document.getElementById("popUpDialog");
											if (el) el.parentNode.removeChild(el);
											return;
										}

										groupAliasName = DesktopContent.getXMLValue(req, "savedName");
										groupAliasVersion = DesktopContent.getXMLValue(req, "savedVersion");

										Debug.log("Successfully added the system alias '" + groupAlias +
											"' reference to group '" + groupName + " (" + groupKey + ")' " +
											" in table '" + groupAliasName + "-v" + groupAliasVersion +
											"'.",
											Debug.INFO_PRIORITY);
										++setAliasCheckboxIndex; //req back, so ready for next index
									}

									//get next affected group index			
									while (setAliasCheckboxIndex < setAliasCheckboxes.length &&
										!setAliasCheckboxes[setAliasCheckboxIndex].checked)
										Debug.log("Skipping checkbox " + (++setAliasCheckboxIndex));

									if (setAliasCheckboxIndex >= setAliasCheckboxes.length) 
									{
										Debug.log("Done with alias checkboxes ");

										if (!req) 
										{
											Debug.log("Backbone was not modified, so no need to save.");

											//kill popup dialog
											var el = document.getElementById("popUpDialog");
											if (el) el.parentNode.removeChild(el);

											Debug.log("Tree saving operations complete.", Debug.INFO_PRIORITY);
											treeHasChanged(true); // reset
											return;
										}
										Debug.log("Saving and activating modified Backbone");


										Debug.log("groupAliasName=" + groupAliasName);
										Debug.log("groupAliasVersion=" + groupAliasVersion);
										var tableNames = req.responseXML.getElementsByTagName("oldBackboneName");
										var tableVersions = req.responseXML.getElementsByTagName("oldBackboneVersion");

										//make a new backbone with old versions of everything except Group Alias 
										var tableMap = "tableList=";
										var name;
										for (var i = 0; i < tableNames.length; ++i) 
										{
											name = tableNames[i].getAttribute("value");

											if (name == groupAliasName)
											{
												tableMap += name + "," +
													groupAliasVersion + ",";
												continue;
											}
											//else use old member
											tableMap += name + "," +
												tableVersions[i].getAttribute("value") + ",";
										}
										Debug.log(tableMap);

										//FIXME use API 
										saveGroupAndActivate("TableEditWizBackbone", tableMap,
											function (retParams) 
											{
												Debug.log("Save and activate is done.");

												if (retParams)
												{
													Debug.log("Successfully modified the active Backbone group.\n" +
														"Backbone group '" + retParams.groupName + " (" +
														retParams.groupKey + ")' was activated.",
														Debug.INFO_PRIORITY);
												}

												//kill popup dialog
												var el = document.getElementById("popUpDialog");
												if (el) el.parentNode.removeChild(el);

												Debug.log("Tree saving operations complete.", Debug.INFO_PRIORITY);
												treeHasChanged(true); // reset
												return;
											},	//end of done handler for saveGroupAndActivate
											true //request return parameters
										);
										return;
									}

									//get next alias
									{
										var el = document.getElementById("popUpDialog-editAliasSelect-" +
											setAliasCheckboxIndex);
										if (el.style.display == "none") 
										{
											//get value from text box
											el = document.getElementById("popUpDialog-editAliasTextBox-" +
												setAliasCheckboxIndex);
										}
										groupAlias = el.value;
									}

									groupName = affectedGroupNames[setAliasCheckboxIndex];
									groupKey = affectedGroupKeys[setAliasCheckboxIndex];

									Debug.log("groupAlias = " + groupAlias);
									Debug.log("groupName = " + groupName);
									Debug.log("groupKey = " + groupKey);

									if (!groupAlias || groupAlias.trim() == "") 
									{
										Debug.log("Process interrupted. Invalid empty alias given!", Debug.HIGH_PRIORITY);

										//kill popup dialog
										var el = document.getElementById("popUpDialog");
										if (el) el.parentNode.removeChild(el);

										return;
									}

									DesktopContent.XMLHttpRequest("Request?RequestType=setGroupAliasInActiveBackbone" +
										"&groupAlias=" + groupAlias +
										"&groupName=" + groupName +
										"&groupKey=" + groupKey, "",
										localNextAliasHandler,
										0, 0, true  //reqParam, progressHandler, callHandlerOnErr
									);
								} //end localNextAliasHandler()

								localNextAliasHandler();

								Debug.log("Aliases set in motion");

								return;
							}

						}, 0, 0, true  //reqParam, progressHandler, callHandlerOnErr
					); //end save new group request								
				} //end affected group for loop

				allRequestsSent = true;
				if (numberOfRequests == 0) //no requests were sent, so go on to affected groups
				{
					Debug.log("There were no affected groups found to save.", Debug.INFO_PRIORITY);

					//kill popup dialog
					var el = document.getElementById("popUpDialog");
					if (el) el.parentNode.removeChild(el);

					Debug.log("Tree saving operations complete.", Debug.INFO_PRIORITY);
					treeHasChanged(true); // reset
				}
			}	//end localHandleAffectedGroups


			//handle group handling based on popup options
			localHandleAffectedGroups();

			//done with initial call..
			//all further events happen after request for saving table returns
		} //end saveTableGroupAsNewKey()

		//==============================================================================
		//addMemberToConfigGroup ~~
		function addMemberToConfigGroup(groupName, backLinkStr)
		{
			Debug.log("CfgGUI addMemberToConfigGroup " + groupName);

			var memberArr = document.getElementById("GroupMember-names").innerHTML.split(",");
			Debug.log("memberArr " + memberArr);

			//make special preselectStr CSV string with groupName and then current members
			var preSelectStr = groupName + ",";
			var version;
			for (var i = 0; i < memberArr.length - 1; ++i) 
			{
				version = document.getElementById(memberArr[i] +
					"-currentVersion").innerHTML;
				Debug.log("table=" + memberArr[i] +
					" version=" + version);
				preSelectStr += memberArr[i] + "," + version + ",";
			}

			if (backLinkStr && backLinkStr != "")
				preSelectStr += "&backLinkStr=" + backLinkStr;
			setupGroupCreator(preSelectStr);
		} //end addMemberToConfigGroup()

		//==============================================================================
		//jump ~~
		function jump(anchor) 
		{
			Debug.log("jump = " + anchor);
			var url = location.href;
			location.href = "#" + anchor;
			history.replaceState(null, null, url);
		} //end jump()

		//==============================================================================
		//evaluateJS ~~
		function evaluateJS(str) 
		{
			Debug.log("evaluateJS = " + str);
			eval(str);
		} //end evaluateJS()

		//==============================================================================
		//createEditTableMenu ~~
		function createEditTableMenu(event) 
		{
			var menuItems = [
				"Find and Replace",
				"Copy and Move",
				"Diff Table Versions",
				_showTableDetails ?
					"Hide Table Details" :
					"Show Table Details",
				"Transpose Table View",
				"Open Subset View",
				"Download Data (CSV)",
				"Upload Data (CSV)"
			];
			
			//make record alias with spaces instead of all one word
			// and remove table
			var recordAlias = "";
			for (var c = 0; c < _currentTableName.length - ("Table").length; ++c) 
			{
				if (c && c + 1 < _currentTableName.length &&
						(_currentTableName[c] >= 'A' &&
								_currentTableName[c] <= 'Z') &&
								(_currentTableName[c + 1] >= 'a' &&
										_currentTableName[c + 1] <= 'z'))
					recordAlias += ' ';
				recordAlias += _currentTableName[c];
			}
			if(recordAlias.length && recordAlias[recordAlias.length-1] != 's')
				recordAlias += 's'; //make plural
			
			var menuItemHandlers = [
				"setupFindAndReplace()",
				"setupCopyAndMoveRows()",
				"setupTableVersionDiff()",
				"toggleTableDetails()",
				"transposeTableView()",
				"DesktopContent.openNewBrowserTab(" +
					"\"" + _currentTableName +
					" Subset\",\"\",\"" +
					//windowPath
					"/WebPath/html/ConfigurationGUI_subset.html?urn=" +
						DesktopContent._localUrnLid +
						"&subsetBasePath=" + _currentTableName +
						"&groupingFieldList=AUTO" +
						"&recordAlias=" + recordAlias +
						"&editableFieldList=" + "!*CommentDescription" +
					"\",false /*unique*/);",
				"downloadTableAsCSV()",
				"popUpUploadCSVTableForm()"
			];
			Debug.log("createEditTableMenu()");
			SimpleContextMenu.createMenu(
				menuItems,
				menuItemHandlers,
				"editTableMenu",					//element ID
				event.pageX - 1, event.pageY - 1, 	//top left position
				_CONTEXT_MENU_PRIMARY_COLOR, 		//primary color
				_CONTEXT_MENU_SECONDARY_COLOR,		//secondary color
				true /*useDefaultHighlightColors*/
			);
		} //end createEditTableMenu

		//==============================================================================
		//createSystemViewMenu ~~
		function createSystemViewMenu(e, groupAliasesName, 
				groupAliasesVersion, backLinkStr, x, y, modeIndex)
		{
			if(modeIndex)
			{
				Debug.log("Second level context menu " + modeIndex);
				
				var menuItems = [
					"Open the artdaq Configuration GUI",
					"Open the artdaq Configuration GUI in new browser tab"
								 ];
				var menuItemHandlers = [];

				//Call like this: DesktopContent.openNewBrowserTab(name,subname,windowPath,unique)

				//url should look like this:
				//http://correlator2.fnal.gov:2015/urn:xdaq-application:lid=290/
				//	Verify?code=fa37&requestingWindowId=1001&
				//	windowName=Code%20Editor&windowSubname=&
				//	windowUnique=0&windowPath=/WebPath/html/ConfigurationGUI_artdaq.html?urn=280#0

				var newwindowJS;
				var newWindowStr;
				
				newWindowStr = "/WebPath/html/ConfigurationGUI_artdaq.html?" +
						"urn=" + DesktopContent._localUrnLid;
							
				newWindowStr = newWindowStr.replace(/"/g, "\\\"");
				
				Debug.log("newWindowStr = " + newWindowStr);
				
				newwindowJS = "DesktopContent.openNewWindow(" +
						"\"ARTDAQ Config\" /*name*/," + 
						"\"\" /*subname*/,\"" +
						newWindowStr + "\"," +
						"false /*unique*/);";
				
				Debug.log("newwindowJS = " + newwindowJS);

				menuItemHandlers.push(newwindowJS);
				
				newwindowJS = "DesktopContent.openNewBrowserTab(" +
						"\"ARTDAQ Config\" /*name*/," + 
						"\"\" /*subname*/,\"" +
						newWindowStr + "\"," +
						"false /*unique*/);";

				Debug.log("newwindowJS = " + newwindowJS);

				menuItemHandlers.push(newwindowJS);
				
				SimpleContextMenu.createMenu(
					menuItems,
					menuItemHandlers,
					"editTableMenu",					//element ID
					x, event.pageY - 10, 				//top left position
					_CONTEXT_MENU_PRIMARY_COLOR, 		//primary color
					_CONTEXT_MENU_SECONDARY_COLOR,		//secondary color
					true /*useDefaultHighlightColors*/
				);
				return;
			} //end special second level menu handling
			
			
			var menuItems = [
				"Relaunch ots in Normal Mode",
				"Relaunch ots in Wiz Mode",
				_versionTrackingIsOn ? "Turn Version Tracking OFF" : "Turn Version Tracking ON",
				"Flatten Configuration to System Aliases ONLY",
				"Merge Table Groups",
				"Open the artdaq Configuration GUI",
				"Add Application Status Monitoring to Desktop"
			];
			var menuItemHandlers = [
				"verifyRelaunchNormalMode();",
				"verifyRelaunchWizMode();",
				"toggleVersionTracking();",
				"flattenToSystemAliases();",
				"mergeGroupsDialog();",
				"createSystemViewMenu(0,0,0,0," +
				(e.pageX - 1) + "," +
				(e.pageY - 1) + ", 1 /*artdaq GUI mode*/);",
				"createAppStatusDesktopIcon()"
			];

			Debug.log("createEditTableMenu()");
			SimpleContextMenu.createMenu(
				menuItems,
				menuItemHandlers,
				"editTableMenu",					//element ID
				e.pageX - 1, e.pageY - 1, 		//top left position
				_CONTEXT_MENU_PRIMARY_COLOR, 		//primary color
				_CONTEXT_MENU_SECONDARY_COLOR,		//secondary color
				true /*useDefaultHighlightColors*/
			);
		} //end createSystemViewMenu()

		//==============================================================================
		//createAppStatusDesktopIcon ~~
		function createAppStatusDesktopIcon() 
		{
			Debug.log("createAppStatusDesktopIcon()");
			
			
			DesktopContent.addDesktopIcon(
					"App Status" /*caption*/,
					"STAT" /*altText*/,
					"" /*folderPath*/,
					true /*unique*/,
					1 /*permissionString*/,
					"icon-SystemStatus.png" /*imageURL*/,
					"/WebPath/html/SystemStatus.html" /*windowURL*/,
					DesktopContent._serverUrnLid /*linked app*/,
					"" /*parameters*/
					);
					
		} //end createAppStatusDesktopIcon()
		
		//==============================================================================
		//mergeGroupsDialog ~~
		function mergeGroupsDialog() 
		{
			Debug.log("mergeGroupsDialog");

			var el = document.getElementById("popUpDialog");
			if (!el) 
			{
				el = document.createElement("div");
				el.setAttribute("id", "popUpDialog");
			}
			el.style.display = "none";

			//set position and size
			var w = 500;
			var h = 295;
			ConfigurationAPI.setPopUpPosition(el, w /*w*/, h /*h*/);

			//show choices for context and config groups

			var str = "<a id='" +
				"popUpDialog" +
				"-header' onclick='var el = document.getElementById(" +
				"\"popUpDialog\"); if(el) el.parentNode.removeChild(el); return false;'>Cancel</a><br><br>";


			//get existing group aliases	
			///////////////////////////////////////////////////////////
			DesktopContent.XMLHttpRequest("Request?RequestType=getTableGroups" +
				"",
				"",
				function (req) 
				{
					var err = DesktopContent.getXMLValue(req, "Error");
					if (err) 
					{
						Debug.log(err, Debug.HIGH_PRIORITY);
						el.innerHTML = str;
						return;
					}

					var groupNames = req.responseXML.getElementsByTagName("TableGroupName");
					var keys = req.responseXML.getElementsByTagName("TableGroupKey");
					var types = req.responseXML.getElementsByTagName("TableGroupType");

					var groupName, lastGroupName;

					//Two group types here:	"Context" "Configuration"

					str += "<div id='popUpDialog-div'>";
					str += "Please select a pair of context and/or configuration groups to merge. (If you would like to target " +
						"just one pair of groups, then leave the other pair of group names blank.)" +
						"<br><br>";
					str += "<center>";

					str += "<table>" +
						"<tr><td></td><td>Name</td><td>Key</td></tr>";

					str += "<tr><td style='text-align:right'>Context Group-A: </td><td>";

					str += "<select id='select-ContextA' style='width:200px'>";
					str += "<option value=''></option>"; //add blank option
					for (var j = 0; j < groupNames.length; ++j) 
					{
						if (types[j].getAttribute("value") == "Context") 
						{
							groupName = groupNames[j].getAttribute("value");
							if (lastGroupName == groupName) continue;
							str += "<option value='" + groupName + "'>";
							str += groupName;	//can display however
							str += "</option>";
							lastGroupName = groupName;
						}
					}
					str += "</select>";
					str += "</td><td id='select-ContextA-key-el'>" +
						"<select id='select-ContextA-key' style='width:85px'>";
					str += "<option value=''></option>"; //add blank option
					str += "</select>";
					str += "</td></tr>";
					str += "<tr><td style='text-align:right'>Context Group-B: </td><td>";

					str += "<select id='select-ContextB' style='width:200px'>";
					str += "<option value=''></option>"; //add blank option
					lastGroupName = "";
					for (var j = 0; j < groupNames.length; ++j)
					{
						if (types[j].getAttribute("value") == "Context") 
						{
							groupName = groupNames[j].getAttribute("value");
							if (lastGroupName == groupName) continue;
							str += "<option value='" + groupName + "'>";
							str += groupName;	//can display however
							str += "</option>";
							lastGroupName = groupName;
						}
					}
					str += "</select>";
					str += "</td><td id='select-ContextB-key-el'>" +
						"<select id='select-ContextB-key' style='width:85px'>";
					str += "<option value=''></option>"; //add blank option
					str += "</select>";
					str += "</td></tr>";

					str += "<tr><td style='text-align:right'>Config Group-A: </td><td>";

					str += "<select id='select-ConfigA' style='width:200px'>";
					str += "<option value=''></option>"; //add blank option
					lastGroupName = "";
					for (var j = 0; j < groupNames.length; ++j)
					{
						if (types[j].getAttribute("value") == "Configuration") 
						{
							groupName = groupNames[j].getAttribute("value");
							if (lastGroupName == groupName) continue;
							str += "<option value='" + groupName + "'>";
							str += groupName;	//can display however
							str += "</option>";
							lastGroupName = groupName;
						}
					}
					str += "</select>";
					str += "</td><td id='select-ConfigA-key-el'>" +
						"<select id='select-ConfigA-key' style='width:85px'>";
					str += "<option value=''></option>"; //add blank option
					str += "</select>";
					str += "</td></tr>";
					str += "<tr><td style='text-align:right'>Config Group-B: </td><td>";

					str += "<select id='select-ConfigB' style='width:200px'>";
					str += "<option value=''></option>"; //add blank option
					lastGroupName = "";
					for (var j = 0; j < groupNames.length; ++j) 
					{
						if (types[j].getAttribute("value") == "Configuration") 
						{
							groupName = groupNames[j].getAttribute("value");
							if (lastGroupName == groupName) continue;
							str += "<option value='" + groupName + "'>";
							str += groupName;	//can display however
							str += "</option>";
							lastGroupName = groupName;
						}
					}
					str += "</select>";
					str += "</td><td id='select-ConfigB-key-el'>" +
						"<select id='select-ConfigB-key' style='width:85px'>";
					str += "<option value=''></option>"; //add blank option
					str += "</select>";
					str += "</td></tr>";


					//Merge approach
					str += "<tr><td colspan='3' style='text-align:center' title='" +
						"Choose the method for handling record conflicts when merging Group-B records into Group-A,\n" +
						"i.e. if a B record has the same UID as an A record, do you want to skip the B record, replace\n" +
						"the A record, or rename the B record." +
						"'>Merge Conflict Approach: ";

					str += "<select id='select-MergeApproach' style='width:85px'>";
					var approaches = ["Skip", "Replace", "Rename"];
					for (var j = 0; j < approaches.length; ++j) 
					{
						str += "<option value='" + approaches[j] + "'>";
						str += approaches[j];	//can display however
						str += "</option>";
					}
					str += "</select>";
					str += "</td></tr>";

					str += "</table>";



					str += "</center>";

					str += "</div><br>"; //close main popup div

					var onmouseupJS = "";
					onmouseupJS += "document.getElementById(\"popUpDialog-submitButton\").disabled = true;";
					onmouseupJS += "mergeGroups(" +
						"document.getElementById(\"select-ContextA\").value," +
						"document.getElementById(\"select-ContextA-key\").value," +
						"document.getElementById(\"select-ContextB\").value," +
						"document.getElementById(\"select-ContextB-key\").value," +
						"document.getElementById(\"select-ConfigA\").value," +
						"document.getElementById(\"select-ConfigA-key\").value," +
						"document.getElementById(\"select-ConfigB\").value," +
						"document.getElementById(\"select-ConfigB-key\").value," +
						"document.getElementById(\"select-MergeApproach\").value," +
						");";

					str += "<input id='popUpDialog-submitButton' type='button' onmouseup='" +
						onmouseupJS + "' " +
						"value='Merge Groups' title='" +
						"Merge Group-B records into Group-A using the record conflict handling method selected." +
						"'/>";
					el.innerHTML = str;

					///////////////////////////////////////////
					document.getElementById("select-ContextA").onchange =
						document.getElementById("select-ContextB").onchange =
						document.getElementById("select-ConfigA").onchange =
						document.getElementById("select-ConfigB").onchange = function ()
						{

							Debug.log(this.id + " changed to " + this.value);
							var el = document.getElementById(this.id + "-key-el");
							var type = this.id.length > 14 ? "Context" : "Configuration";

							var str = "";
							str += "<select id='" + this.id + "-key' style='width:85px'>";
							for (var j = 0; j < groupNames.length; ++j) 
							{
								if (groupNames[j].getAttribute("value") == this.value &&
									types[j].getAttribute("value") == type) 
								{
									str += "<option value='" + keys[j].getAttribute("value") + "'>";
									str += keys[j].getAttribute("value");	//can display however
									str += "</option>";
								}
							}
							str += "</select>";

							el.innerHTML = str;

						}  //end select-group change handler


				}, 0, 0, true //reqParam, progressHandler, callHandlerOnErr
			); //end of getTableGroups handler


			document.getElementById("display").appendChild(el); //add element to display div
			el.style.display = "block";


		} //end mergeGroupsDialog()

		//==============================================================================
		//mergeGroups
		function mergeGroups(groupANameContext, groupAKeyContext, groupBNameContext, groupBKeyContext,
			groupANameConfig, groupAKeyConfig, groupBNameConfig, groupBKeyConfig, mergeApproach) 
		{
			DesktopContent.XMLHttpRequest("Request?RequestType=mergeGroups" +
				"&groupANameContext=" + groupANameContext.trim() +
				"&groupAKeyContext=" + groupAKeyContext +
				"&groupBNameContext=" + groupBNameContext.trim() +
				"&groupBKeyContext=" + groupBKeyContext +
				"&groupANameConfig=" + groupANameConfig.trim() +
				"&groupAKeyConfig=" + groupAKeyConfig +
				"&groupBNameConfig=" + groupBNameConfig.trim() +
				"&groupBKeyConfig=" + groupBKeyConfig +
				"&mergeApproach=" + mergeApproach +
				"", "",
				function (req) 
				{
					var err = DesktopContent.getXMLValue(req, "Error");
					if (err) 
					{
						Debug.log(err, Debug.HIGH_PRIORITY);
						Debug.log("Error! The merger of the two group pairs, " +
							groupANameContext + "(" + groupAKeyContext + ") & " +
							groupBNameContext + "(" + groupBKeyContext + "), and " +
							groupANameConfig + "(" + groupAKeyConfig + ") & " +
							groupBNameConfig + "(" + groupBKeyConfig + "), " +
							"failed...", Debug.HIGH_PRIORITY);

						try 
						{
							//attempt to re-enable submit button in dialog (if there)
							document.getElementById("popUpDialog-submitButton").disabled = false;
						} catch (e) { } //ignore error

						return;
					}

					//open newly created group
					var contextGroupName = DesktopContent.getXMLValue(req, "ContextGroupName");
					var contextGroupKey = DesktopContent.getXMLValue(req, "ContextGroupKey");
					var didContextMerge = contextGroupName && contextGroupName != "";

					if (didContextMerge) 
					{
						Debug.log("The context groups, " + groupANameContext + "(" + groupAKeyContext + ") & " +
							groupBNameContext + "(" + groupBKeyContext + "), were successfully merged into a new group, " +
							contextGroupName + "(" + contextGroupKey + ")!", Debug.INFO_PRIORITY);
						Debug.log("Click to <a onclick='activateSystemConfig(\"" +
							contextGroupName + "\",\"" + contextGroupKey + "\");'>Activate " +
							contextGroupName + "(" + contextGroupKey + ")</a> (to avoid errors, activate the config group before the context group). or goto " +
							"<a onclick='setupSpecificTableGroup(\"" +
							contextGroupName + "\",\"" + contextGroupKey + "\");'>" +
							contextGroupName + "(" + contextGroupKey + ") Group-view</a> or " +
							"<a onclick='setupTableGroupTreeView(\"" +
							contextGroupName + "\",\"" + contextGroupKey + "\");'>" +
							contextGroupName + "(" + contextGroupKey + ") Tree-view</a>!"
							, Debug.INFO_PRIORITY);

						var mergeReportFile = DesktopContent.getXMLValue(req, "MergeReportFile");
						var str = "";
						str += "You can view the merge report in the Code Editor...\n" + 
								"(Click " +
								"<a onclick='DesktopContent.openNewBrowserTab(" +
								"\"Code Editor\",\"\"," + 
								"\"/WebPath/html/CodeEditor.html?" + 
								"urn=" + _codeEditorAppId + 
								"&startFilePrimary=" +
								mergeReportFile + "\",0 /*unique*/);' " +
								"title='Click to open the merge report in a new browser tab using the Code Editor.'>" +
								"here</a> to open the merge report in a new tab)";
						
						Debug.info(str);
						
					}
					else
						Debug.log("Skipped merger of context groups due to empty group name.", Debug.INFO_PRIORITY);

					var tableGroupName = DesktopContent.getXMLValue(req, "ConfigGroupName");
					var tableGroupKey = DesktopContent.getXMLValue(req, "ConfigGroupKey");
					var didConfigMerge = tableGroupName && tableGroupName != "";

					if (didConfigMerge) 
					{
						Debug.log("The config groups, " + groupANameConfig + "(" + groupAKeyConfig + ") & " +
							groupBNameConfig + "(" + groupBKeyConfig + "), were successfully merged into a new group, " +
							tableGroupName + "(" + tableGroupKey + ")!", Debug.INFO_PRIORITY);
						Debug.log("Click here to <a onclick='activateSystemConfig(\"" +
							tableGroupName + "\",\"" + tableGroupKey + "\");'>Activate " +
							tableGroupName + "(" + tableGroupKey + ")</a> (to avoid errors, activate the config group before the context group), or goto " +
							"<a onclick='setupSpecificTableGroup(\"" +
							tableGroupName + "\",\"" + tableGroupKey + "\");'>" +
							tableGroupName + "(" + tableGroupKey + ") Group-view</a> or " +
							"<a onclick='setupTableGroupTreeView(\"" +
							tableGroupName + "\",\"" + tableGroupKey + "\");'>" +
							tableGroupName + "(" + tableGroupKey + ") Tree-view</a>!"
							, Debug.INFO_PRIORITY);
					}
					else
						Debug.log("Skipped merger of config groups due to empty group name.", Debug.INFO_PRIORITY);

					//decide on next view
					//							if(didContextMerge && !didConfigMerge) //group view							
					//								setupSpecificTableGroup(contextGroupName,contextGroupKey,"setupSystemViewMode();" /*backLinkStr*/);
					//							else if(!didContextMerge && didConfigMerge) //group view							
					//								setupSpecificTableGroup(tableGroupName,tableGroupKey,"setupSystemViewMode();" /*backLinkStr*/);
					//							else //both, so tree view of contex
					//								setupTableGroupTreeView(contextGroupName,contextGroupKey,"setupSystemViewMode();" /*backLinkStr*/)

				}, //end handler
				0, 0, true  //reqParam, progressHandler, callHandlerOnErr
			);
		} //end mergeGroups

		//==============================================================================
		//flattenToSystemAliases ~~
		function flattenToSystemAliases()
		{
			Debug.log("flattenToSystemAliases");
			DesktopContent.popUpVerification("Are you sure you want to remove all unused groups and tables based on the currently active System Aliases?",
				function ()
				{
					DesktopContent.XMLHttpRequest("Request?RequestType=flattenToSystemAliases",
						"",
						handleFlattenSystemAliasesResponse, 0);
				}, 0, "#efeaea", 0, "#770000");
		} //end flattenToSystemAliases

		//==============================================================================
		//toggleVersionTracking ~~
		function toggleVersionTracking() 
		{
			Debug.log("toggleVersionTracking init=" + _versionTrackingIsOn);

			DesktopContent.popUpVerification("Are you sure you want to turn " +
				(_versionTrackingIsOn ? "OFF" : "ON") + " your configuration version tracking?",
				function () 
				{
					DesktopContent.XMLHttpRequest("Request?RequestType=versionTracking&Type=" +
						(_versionTrackingIsOn ? "OFF" : "ON"),
						"",
						versionTrackingHandler, 0);
				}, 0, "#efeaea", 0, "#770000");
		} //end toggleVersionTracking

		//==============================================================================
		//verifyRelaunchWizMode ~~
		function verifyRelaunchWizMode() 
		{
			Debug.log("verifyRelaunchWizMode");
			DesktopContent.popUpVerification("Are you sure you want to relaunch otsdaq in Wiz Mode?",
				function () 
				{

					//start blackout
					DesktopContent.systemBlackout(true);
					//DesktopContent._blockSystemCheckMailbox.innerHTML = "1";
					window.setTimeout(localDelayedLaunch, 1000); //gaurantee blackout starts
					//now in all future requests must ignoreSystemBlock

					//===========
					function localDelayedLaunch()
					{
						DesktopContent.XMLHttpRequest("Request?RequestType=gatewayLaunchWiz",
							"",
							handleOtsRelaunchResponse,
							true /*for wiz mode, handler param*/,
							0 /*progressHandler*/,
							true /*callHandlerOnErr*/,
							false /*doNotShowLoadingOverlay*/,
							true /*targetSupervisor*/,
							true /*ignoreSystemBlock*/);
					} //end localDelayedLaunch		

				}, 0, "#efeaea", 0, "#770000");

		} //end verifyRelaunchWizMode

		//==============================================================================
		//verifyRelaunchNormalMode ~~
		function verifyRelaunchNormalMode() 
		{
			Debug.log("verifyRelaunchNormalMode");
			DesktopContent.popUpVerification("Are you sure you want to relaunch otsdaq in Normal Mode?",
				function () 
				{


					//start blackout
					DesktopContent.systemBlackout(true);
					//DesktopContent._blockSystemCheckMailbox.innerHTML = "1";
					window.setTimeout(localDelayedLaunch, 1000); //gaurantee blackout starts
					//now in all future requests must ignoreSystemBlock

					//===========
					function localDelayedLaunch() 
					{
						DesktopContent.XMLHttpRequest("Request?RequestType=gatewayLaunchOTS",
							"",
							handleOtsRelaunchResponse,
							0 /*handler param*/,
							0 /*progressHandler*/,
							true /*callHandlerOnErr*/,
							false /*doNotShowLoadingOverlay*/,
							true /*targetSupervisor*/,
							true /*ignoreSystemBlock*/);
					} //end localDelayedLaunch		

				}, 0, "#efeaea", 0, "#770000");
		} //end verifyRelaunchNormalMode

		//==============================================================================
		//createTreeViewMenu ~~
		function createTreeViewMenu(event) 
		{
			var menuItems = [
				"Refresh",
				_showGroupDetails ?
					"Hide Group Details" :
					"Show Group Details",
				treeViewHideStatus_ ?
					"Show Nodes w/Status=False" :
					"Hide Nodes w/Status=False",
				treeFilterApplied_ ?
					"Clear Tree View Filter" :
					"Filter Tree View Values",
				treeViewHideInfo_ ?
					"Show Info Fields" :
					"Hide Info Fields",
				"Record Creation Wizard",
				"Record Deletion Wizard"
			];

			var refreshLinkStr = "refreshTreeView();";
			var hardRefreshLinkStr = "hardRefreshTreeView();";

			//if tree has changed, ask if you really want to refresh
			//else, refresh
			var refreshWrapper = "if(treeHasChanged_) DesktopContent.popUpVerification(" +
				"\"The tree has been modified. Refreshing will discard changes and " +
				"revert to the tree-view of group '" + treeGroupName_ + " (" +
				treeGroupKey_ + ").' <br><br>Are you sure you want to Refresh?\", " +
				"function() {" + hardRefreshLinkStr + "},0,\"#efeaea\",0,\"#770000\");" +
				"else {" + hardRefreshLinkStr + "}";

			var menuItemHandlers = [
				refreshWrapper,
				"toggleGroupDetails()",
				"treeViewHideStatus_ = !treeViewHideStatus_;" +
				refreshLinkStr,
				"treeFilterApplied_?applyTreeFilter():popUpFilterTreeForm()",
				"treeViewHideInfo_ = !treeViewHideInfo_; " +
				"applyTreeFilter('',0,1)",
				"launchRecordCreationWizard(\"tree\")",
				"launchRecordDeletionWizard(\"tree\")"
			];
			Debug.log("createEditTableMenu()");
			SimpleContextMenu.createMenu(
				menuItems,
				menuItemHandlers,
				"editTableMenu",					//element ID
				event.pageX - 1, event.pageY - 1, 	//top left position
				_CONTEXT_MENU_PRIMARY_COLOR, 		//primary color
				_CONTEXT_MENU_SECONDARY_COLOR,		//secondary color
				true /*useDefaultHighlightColors*/
			);
		} //end createTreeViewMenu()

		//==============================================================================
		//addTableToConfigurationGroup ~~
		function addTableToConfigurationGroup(tableName) 
		{
			Debug.log("addTableToConfigurationGroup",tableName);

			editCellCancel();
			
			//Steps:
			//	1. save current tree changes using popUpSaveTreeForm() with new table added
			//		a. when done, treeHasChanged(reset) which does not change the current tree drawing
			
			treeMemberNames_.push(tableName);
			treeMemberVersions_.push(-1);
			treeMemberComments_.push("Added to group through Configuration Tree");
			popUpSaveTreeForm();

		} //end addTableToConfigurationGroup()
		
		//==============================================================================
		//getTableViewColTypes ~~
		//	returns column types for each column and specially indicates the columns 
		//	that have a bool type
		function getTableViewColTypes(rows) 
		{
			var colTypes = [];
			var boolTypes = ["OnOff", "TrueFalse", "YesNo"];

			//init pre-data columns
			for (var c = 0; c < _CONFIG_DATA_COL_OFFSET; ++c)
				colTypes.push(false);

			//////////////////////////
			{	//determine the boolean columns			
				var isStatusType;
				var colType;

				if (_tableViewIsTransposed) //table is currently transposed, type is at col 0
				{
					for (var c = _CONFIG_DATA_COL_OFFSET; c < rows.length; ++c)
					{
						colType = rows[c].getElementsByTagName("td")[0].childNodes[0].innerHTML.split('<')[0];
						isStatusType = false;
						for (var i = 0; i < boolTypes.length; ++i)
							if (boolTypes[i] == colType) 
							{
								isStatusType = true; break;
							}
						colTypes.push(isStatusType ? "Bool" : colType);
					}
				}
				else						//table is currently normal view, type is at row 0
				{
					var firstRowEls = rows[0].getElementsByTagName("td");
					for (var c = _CONFIG_DATA_COL_OFFSET; c < firstRowEls.length; ++c) 
					{
						colType = firstRowEls[c].childNodes[0].innerHTML.split('<')[0]; //type text is in a div for smaller font
						isStatusType = false;
						for (var i = 0; i < boolTypes.length; ++i)
							if (boolTypes[i] == colType)
							{
								isStatusType = true; break;
							}
						colTypes.push(isStatusType ? "Bool" : colType);
					}
				}
			}
			/////////// done determining bool columns

			return colTypes;
		} //end getTableViewColTypes()

		//==============================================================================
		//createTableViewOutputStr ~~
		//	must exactly match the data table section of specificTableRequestHandler()
		function createTableViewOutputStr(cols, colTypes, transposeOutput, colsIsArray) 
		{
			var boolTypeTrues = ["1", "On", "True", "Yes"];
			var tdStyle;
			var str = "";
			var val, titleVal;
			var rowsSz = transposeOutput ? cols[0].length : cols.length;
			var colsSz = transposeOutput ? cols.length : cols[0].length;
			var uidCol, uidVal, colHdr;
			var r, c;

			//determine colUID
			{
				var found = false;
				for (var rr = 0; !found && rr < rowsSz; ++rr) {
					for (var cc = 0; !found && cc < colsSz; ++cc) {
						//choose proper value based on situation
						if (!_tableViewIsTransposed && !transposeOutput) //normal source and leaving normal
						{
							r = rr;
							c = cc;
							val = colsIsArray ? cols[rr][cc] : cols[rr][cc].innerHTML;
						}
						else if (!_tableViewIsTransposed && transposeOutput) //normal source and transposing
						{
							r = cc;
							c = rr;
							val = colsIsArray ? cols[cc][rr] : cols[cc][rr].innerHTML;
						}
						else if (_tableViewIsTransposed && !transposeOutput) //transposed source and leaving transpoed
						{
							r = cc;
							c = rr;
							val = colsIsArray ? cols[rr][cc] : cols[rr][cc].innerHTML;
						}
						else if (_tableViewIsTransposed && transposeOutput) //transposed source and normalizing
						{
							r = rr;
							c = cc;
							val = colsIsArray ? cols[cc][rr] : cols[cc][rr].innerHTML;
						}

						if (r == _CONFIG_DATA_ROW_OFFSET - 2 &&
							c >= _CONFIG_DATA_COL_OFFSET) //col types
						{
							if (val.substr(val.indexOf('title=') + ('title=').length + 1, 3) == //val.split('>')[1].split('<')[0] == 
								"UID") {
								uidCol = c;
								Debug.log("uidCol " + c);
								found = true;
							}
							Debug.log("uidval? " + val);
						}
					}
				}
			}

			//create output string based on cols
			for (var rr = 0; rr < rowsSz; ++rr) {
				str += "<tr>";
				for (var cc = 0; cc < colsSz; ++cc) {
					//choose proper value based on situation
					if (!_tableViewIsTransposed && !transposeOutput) //normal source and leaving normal
					{
						r = rr;
						c = cc;
						val = colsIsArray ? cols[rr][cc] : cols[rr][cc].innerHTML;
						uidVal = colsIsArray ? cols[rr][uidCol] : cols[rr][uidCol].innerHTML;
						colHdr = colsIsArray ? cols[_CONFIG_DATA_ROW_OFFSET - 1][cc] : cols[_CONFIG_DATA_ROW_OFFSET - 1][cc].innerHTML;
					}
					else if (!_tableViewIsTransposed && transposeOutput) //normal source and transposing
					{
						r = cc;
						c = rr;
						val = colsIsArray ? cols[cc][rr] : cols[cc][rr].innerHTML;
						uidVal = colsIsArray ? cols[cc][uidCol] : cols[cc][uidCol].innerHTML;
						colHdr = colsIsArray ? cols[_CONFIG_DATA_ROW_OFFSET - 1][rr] : cols[_CONFIG_DATA_ROW_OFFSET - 1][rr].innerHTML;
					}
					else if (_tableViewIsTransposed && !transposeOutput) //transposed source and leaving transpoed
					{
						r = cc;
						c = rr;

						val = colsIsArray ? cols[rr][cc] : cols[rr][cc].innerHTML;
						uidVal = colsIsArray ? cols[uidCol][cc] : cols[uidCol][cc].innerHTML;
						colHdr = colsIsArray ? cols[rr][_CONFIG_DATA_ROW_OFFSET - 1] : cols[rr][_CONFIG_DATA_ROW_OFFSET - 1].innerHTML;
					}
					else if (_tableViewIsTransposed && transposeOutput) //transposed source and normalizing
					{
						r = rr;
						c = cc;
						val = colsIsArray ? cols[cc][rr] : cols[cc][rr].innerHTML;
						uidVal = colsIsArray ? cols[uidCol][rr] : cols[uidCol][rr].innerHTML;
						colHdr = colsIsArray ? cols[cc][_CONFIG_DATA_ROW_OFFSET - 1] : cols[cc][_CONFIG_DATA_ROW_OFFSET - 1].innerHTML;
					}


					//handle bool style
					tdStyle = "";
					if (colTypes[c] == "Bool") //use r/c depending on source data
					{
						//determine if true value
						var isTrue = false;
						for (var i = 0; i < boolTypeTrues.length; ++i)
							if (boolTypeTrues[i] == val) {
								isTrue = true; break;
							}
						tdStyle += "style='background-color:";
						tdStyle += (isTrue) ? _TABLE_BOOL_TYPE_TRUE_COLOR : _TABLE_BOOL_TYPE_FALSE_COLOR;
						tdStyle += "'";
					}


					//open table cell
					if (r == _CONFIG_DATA_ROW_OFFSET - 1) //col names are headers
						str += "<th>";
					else if (r >= _CONFIG_DATA_ROW_OFFSET &&	//data cells
						c >= _CONFIG_DATA_COL_OFFSET) {
						titleVal = (val.replace(/"/g, "&quot;").replace(/'/g, "&apos;"));
						if (titleVal.length > 50)
							titleVal = titleVal.substr(0, 50) + "...";

						str += "<td onmouseup='selectThisCell(" + (r - _CONFIG_DATA_ROW_OFFSET) + "," +
							(c - _CONFIG_DATA_COL_OFFSET) + ",this,event);' " +
							tdStyle +

							" title='UID : " + uidVal + "\n" +
							colHdr +
							" : " +
							titleVal +
							"' " +

							">";
					}
					else
						str += "<td>";

					//cell value
					//first column is row numbers
					if (c == 0 && r >= _CONFIG_DATA_ROW_OFFSET)
					{
						str += "<center>";
						str += (_dataOffset + (r - _CONFIG_DATA_ROW_OFFSET));	//insert row index column
						str += "<br>";

						//add +/- row controls
						str += "<a class='tableAddRowButton' " +
							"title='Add a row before this row.' " +
							"onclick='addRow(" + (r - _CONFIG_DATA_ROW_OFFSET) + "); return false;'>";
						str += "+";
						str += "</a>";
						str += "/";
						str += "<a  class='tableDeleteRowButton' " +
							"title='Delete this row.' " +
							"onclick='deleteRow(" + (r - _CONFIG_DATA_ROW_OFFSET) + "); return false;'>";
						str += "-";
						str += "</a>";
						str += "</center>";
					}
					else if (c == 0 && r == _CONFIG_DATA_ROW_OFFSET - 1)
						str += "Row";
					else if (r >= _CONFIG_DATA_ROW_OFFSET && colTypes[c].indexOf("ChildLink-") == 0 &&
						val != "NO_LINK") 
					{
						//apply link 
						str += "<a href='#'>"; //show link just for show ... goto is in Edit selectThisCell
						str += val;
						str += "</a>";
					}
					else
						str += val;

					//close table cell
					if (r == _CONFIG_DATA_ROW_OFFSET - 1) //col names are headers
						str += "</th>";
					else
						str += "</td>";
				}
				str += "</tr>";
			}

			return str;

		} //end createTableViewOutputStr()

		//==============================================================================
		//transposeTableView ~~
		function transposeTableView() 
		{
			editCellOK(); //editCellCancel();
			Debug.log("transposeTableView() transposed was =" + _tableViewIsTransposed);

			var el = document.getElementById("SubSystemTable");
			var rows = el.getElementsByTagName("tr");
			var str = "";
			var cols = [];

			var colTypes = getTableViewColTypes(rows);


			if (!_tableViewIsTransposed) //reading from normal view and transposing
			{
				//get all cols
				for (var r = 0; r < rows.length; ++r)
				{
					if (r == _CONFIG_DATA_ROW_OFFSET - 1) //col names are headers
						cols[r] = rows[r].getElementsByTagName("th");
					else
						cols[r] = rows[r].getElementsByTagName("td");
				}

				//create output string based on cols
				str += createTableViewOutputStr(cols, colTypes, true /*transpose output*/);

				document.getElementById("lastAddRowLink0").style.display = "none";
				document.getElementById("lastAddRowLink1").style.display = "block";
			}
			else 
			{
				//get all cols (transposed)
				var tmpCols, tmpColsIndex;
				var numOfNewRows = -1;
				for (var c = 0; c < rows.length; ++c) 
				{
					cols.push([]); //push empty column, for each 

					//assume there is 1 th cell
					tmpCols = rows[c].getElementsByTagName("td");
					tmpColsIndex = 0;
					for (var r = 0; r < tmpCols.length + 1; ++r) 
					{
						if (r == _CONFIG_DATA_ROW_OFFSET - 1) //col names are headers
							cols[cols.length - 1][r] = rows[c].getElementsByTagName("th")[0];
						else //take from the td cels
						{
							cols[cols.length - 1][r] = tmpCols[tmpColsIndex];
							++tmpColsIndex;
						}
					}
				}

				//create output string based on cols
				str += createTableViewOutputStr(cols, colTypes, true /*transpose output*/);

				document.getElementById("lastAddRowLink0").style.display = "block";
				document.getElementById("lastAddRowLink1").style.display = "none";
			}

			el.innerHTML = str;

			_tableViewIsTransposed = !_tableViewIsTransposed;
			Debug.log("transposeTableView() transposed now =" + _tableViewIsTransposed);
		} //end transposeTableView()

		//==============================================================================
		//handlePopUpHeightToggle ~~
		//	checkbox was already set before this function call
		//	this responds to current value
		//
		//	pass height and group height
		function handlePopUpHeightToggle(h, gh) 
		{
			var el = document.getElementById("popUpDialog-bumpGroupVersions");
			Debug.log("handlePopUpHeightToggle " + el.checked);

			var ael = document.getElementById("popUpDialog-activateBumpedGroupVersions");

			var groupCommentEl = document.getElementById("popUpDialog-groupComment");
			var groupCommentHeight = 0;

			if (groupCommentEl && groupCommentEl.style.display != "none")
				groupCommentHeight += 100;

			var popEl = document.getElementById("popUpDialog");
			if (!el.checked)
			{
				//hide alias area and subtract the height

				document.getElementById("popUpDialog-groupAliasArea").style.display = "none";
				popEl.style.height = (h + groupCommentHeight) + "px";
				ael.disabled = true;
			}
			else
			{
				//show alias area and add the height

				//count if grps is 1 or 2
				var grps = document.getElementsByClassName("popUpDialog-affectedGroups");
				popEl.style.height = (h + grps.length * gh + groupCommentHeight) + "px";
				document.getElementById("popUpDialog-groupAliasArea").style.display = "block";
				ael.disabled = false;
			}
		} //end handlePopUpHeightToggle()

		//==============================================================================
		//handleGroupCommentToggle ~~		
		// toggles affected group comment box and handles details
		function handleGroupCommentToggle(groupName, setHideVal)
		{
			var el = document.getElementById("popUpDialog-groupComment");
			var hel = document.getElementById("popUpDialog-groupComment-header");

			var doHide = el.style.display != "none";
			if (setHideVal !== undefined)
				doHide = setHideVal;

			if (doHide) //cache (possibly modified) group comment
			{
				if (hel.textContent == "") return; //assume was a force hide when already hidden

				//get current groupName so we know where to cache comment
				var gn = hel.textContent.split("'")[1];
				Debug.log("gn " + gn);
				var cel = document.getElementById("popUpDialog-groupComment-" +
					gn);
				cel.innerHTML = "";
				cel.appendChild(document.createTextNode(el.value));

				//setup group comment header properly
				hel.innerHTML = "";
				el.style.display = "none";

				//if for sure hiding, then done
				if (gn == groupName || setHideVal !== undefined)
					return;
				//else show immediately the new selection
			}

			//show groupName comment
			{
				var cel = document.getElementById("popUpDialog-groupComment-" +
					groupName);
				el.value = cel.textContent;
				el.style.display = "block"; //show display before set caret (for Firefox)
				ConfigurationAPI.setCaretPosition(el, 0, cel.textContent.length);

				hel.innerHTML = ("&apos;" + groupName + "&apos; group comment:");
			}
		} //end handleGroupCommentToggle()

		//==============================================================================
		//handleEditTreeGroupIDEditFreeformToggle
		function handleEditTreeGroupIDEditFreeformToggle() 
		{
			Debug.log("handleEditTreeGroupIDEditFreeformToggle ");

			var sel = document.getElementById("editTree-groupIdFreeform-select");
			var tel = document.getElementById("editTree-groupIdFreeform-input");
			Debug.log("sel.style.display  " + sel.style.display);
			if (sel.style.display == "none") 
			{
				sel.style.display = "block";
				tel.style.display = "none";
			}
			else 
			{
				tel.style.width = ((sel.offsetWidth > 150 ? sel.offsetWidth : 150) - 2) + "px";
				sel.style.display = "none";
				tel.style.display = "block";
				if (tel.value == "") tel.value = sel.value; //take value from select the first time
				ConfigurationAPI.setCaretPosition(tel, 0, tel.value.length);
			}
		} //end handleEditTreeGroupIDEditFreeformToggle()

		//==============================================================================
		//handleFixedChoiceEditToggle ~~
		//	toggle select box to text field edit
		function handleFixedChoiceEditToggle() 
		{
			Debug.log("handleFixedChoiceEditToggle");

			var sel = document.getElementById("fixedChoice-editSelectBox");
			var tel = document.getElementById("fixedChoice-editTextBox");

			Debug.log("sel.style.display  " + sel.style.display);
			if (sel.style.display == "none") 
			{
				sel.style.display = "block";
				tel.style.display = "none";
			}
			else 
			{
				tel.style.width = ((sel.offsetWidth > 150 ? sel.offsetWidth : 150) - 2) + "px";
				tel.parentNode.style.width = ((sel.offsetWidth > 150 ? sel.offsetWidth : 150) + 50) + "px"; //div may need to expand to accomodate pencil is display				
				sel.style.display = "none";

				if (tel.value == "") //take value from select (rather than old value)
				{
					if(sel.value == "DEFAULT" && _editingCellElOldValue != "")
						tel.value = _editingCellElOldValue;
					else
						tel.value = sel.value;
				}

				tel.style.display = "block";
				ConfigurationAPI.setCaretPosition(tel, 0, tel.value.length);
			}
		} //end handleFixedChoiceEditToggle()

		//==============================================================================
		//handleEditTreeAliasEditToggle ~~
		function handleEditTreeAliasEditToggle(i) 
		{
			Debug.log("handlePopUpHeightToggle " + i);

			var sel = document.getElementById("popUpDialog-editAliasSelect-" + i);
			var tel = document.getElementById("popUpDialog-editAliasTextBox-" + i);
			Debug.log("sel.style.display  " + sel.style.display);
			if (sel.style.display == "none") 
			{
				sel.style.display = "block";
				tel.style.display = "none";
			}
			else 
			{
				tel.style.width = ((sel.offsetWidth > 150 ? sel.offsetWidth : 150) - 2) + "px";
				sel.style.display = "none";
				tel.style.display = "block";
				if(tel.value == "")
					tel.value = sel.value; //take value from select
				ConfigurationAPI.setCaretPosition(tel, 0, tel.value.length);
			}

		} //end handleEditTreeAliasEditToggle()

		//==============================================================================
		//bodyMouseMoveHandler ~~
		function bodyMouseMoveHandler(e) 
		{
			if (treeEditingEditIconShownEl_) 
			{
				//Debug.log("bodyMouseMoveHandler clearing ");
				treeEditingEditIconShownEl_.style.display = "none";
				treeEditingEditIconShownEl_ = 0;


				//try bringing along the comment edit icon, and ignore fails
				try 
				{
					document.getElementById("treeNode-Value-editCommentIcon-" +
						treeEditingEditIconShownIdString_).style.display = "none";
				}
				catch (e) { }

				var vel = document.getElementById("treeNode-Value-" + treeEditingEditIconShownIdString_);
				if (vel)
					vel.style.backgroundColor = "transparent";
			}
		} //end bodyMouseMoveHandler()

		//==============================================================================
		//handleTreeNodeMouseMove ~~
		function handleTreeNodeMouseMove(depth, uid, event) 
		{
			event.stopPropagation();
			DesktopContent.mouseMove(event); //keep desktop content happy

			if (_editingCell) return; //no setting while editing

			var idString = depth + "-" + uid;
			var el = document.getElementById("treeNode-Value-editIcon-" + idString);
			if (treeEditingEditIconShownEl_ == el) return;

			if (treeEditingEditIconShownEl_) 
			{
				//Debug.log("bodyMouseMoveHandler clearing ");
				bodyMouseMoveHandler();
			}

			//Debug.log("handleTreeNodeMouseMove setting ");
			treeEditingEditIconShownIdString_ = idString;
			treeEditingEditIconShownEl_ = el;
			treeEditingEditIconShownEl_.style.display = "block";
			var vel = document.getElementById("treeNode-Value-" + treeEditingEditIconShownIdString_);
			vel.style.backgroundColor = "rgb(218, 194, 194)";

			//try bringing along the comment edit icon, and ignore fails
			try 
			{
				document.getElementById("treeNode-Value-editCommentIcon-" +
					treeEditingEditIconShownIdString_).style.display = "block";
			}
			catch (e) { }

		} //end handleTreeNodeMouseMove()

	</script>
</head>


<body onload='//init() called by DesktopContent.js'>

	<h1>Configuration Editor</h1>

	<div style='width:550px'>

		<a href='#' onclick='setupSystemViewMode(); return false;'>System View</a> &nbsp;&nbsp;
		<a href='#' onclick='setupGroupViewMode(); return false;'>Group View</a> &nbsp;&nbsp;
		<a href='#' onclick='setupTableViewMode(); return false;'>Table View</a> &nbsp;&nbsp;

	</div>

	<hr>
	<div id='activeConfig'></div>
	<div id='activateConfigWithWarnings'></div>
	<hr>
	<div id='tempTree'></div>
	<div id='display'></div>
	<div class='preloadImage' id='preloadImage-treeEditIconHover'></div>
	<div class='preloadImage' id='preloadImage-treeEditTrashIcon'></div>
	<div class='preloadImage' id='preloadImage-treeEditTrashIconHover'></div>

</body>

</html>
