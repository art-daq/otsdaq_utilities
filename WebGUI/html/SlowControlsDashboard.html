<!DOCTYPE HTML>
<html lang="en"> 
	<head>
		<title>Epics CA Monitor</title>
		<style type="text/css">			
			body {
				background-color: rgb(200,200,200);
			}
			
			#clearDiv {
				clear: both;
			}
			
			a {
				color: blue;
			}
			
			
			#fileBlock {
				background-color: rgb(26,148,49);
			}				

			#mainBlock {
				background-color: rgb(240,234,214);
			}

			#editBlock {
				background-color: rgb(200,0,0);
			}
			
			.mainBlock {
				position:absolute;
			}
									
		</style>
		
		
		<script type="text/JavaScript" src="/WebPath/js/Globals.js"></script>	
		<script type="text/JavaScript" src="/WebPath/js/Debug.js"></script>	
		<script type="text/JavaScript" src="/WebPath/js/DesktopWindowContentCode.js"></script>
		
		
		<script>		
			
			
		
			//functions:			
				//init()					
				
			//top-level scope (global) variables:
			var pvListJSON;
			var fileBlock_ = {name:"", isHidden:false, el:""};// = ["fileBlock", false ];
			var mainBlock_ = {name:"", isHidden:false, el:""};// = ["mainBlock", false ];
			var editBlock_ = {name:"", isHidden:true, el:""};// = [false ];
					
			/////////////////////////////////////////////////////////////////////////////////////////
			/////////////////////////////////////////////////////////////////////////////////////////
			
			//init called once body has loaded
			function init() {			
				Debug.log("init() was called");

				fileBlock_.el = document.getElementById('fileBlock');//red
				mainBlock_.el = document.getElementById('mainBlock');//yellow
				editBlock_.el = document.getElementById('editBlock');//green

				
				fileBlock_.name = fileBlock_.el.id;
				mainBlock_.name = mainBlock_.el.id;
				editBlock_.name = editBlock_.el.id;
				
				
				
				console.log("editBlock_.hidden : " + editBlock_.hidden);
				
				//DesktopContent.XMLHttpRequest("Default?RequestType=getList", "", handlerFunction);
				//console.log("URN #: " + DesktopContent._localUrnLid);
				//DesktopContent.XMLHttpRequest("Default?RequestType=Default","",handlerFunction);
				//DesktopContent._localUrnLid = 340;
				DesktopContent.XMLHttpRequest("Default?RequestType=getList", "", pvListReqHandler, undefined, undefined, "sequence");	
				

				window.onresize = redrawWindow;
				redrawWindow(); //redraw window for first time
			}	
			
			function pvListReqHandler(req){
			
				pvListJSON = req;
			}
			
			function handlerFunction(req) {
				Debug.log("handlerFunction() was called. Req: " + req.responseText);

				var child1data = DesktopContent.getXMLValue(req,"child");
				var child2data = DesktopContent.getXMLValue(req,"child2");
				
				Debug.log("--child1data:",child1data," --child2data:",child2data);
				//block1El = document.getElementById('block1');
				//block1.innerHTML = child1data;
				
			}
			
			function toggleEditMode(editMode)
			{
				editBlock_.isHidden =! editMode;
			
				console.log(editMode);
			
				if(editMode == false)
				{
					console.log("Cleared");
					editBlock_.el.innerHTML = "";
					
				}
				else
				{
				/*	var hideButton = document.createElement("button");
					hideButton.onclick = "toggleEditMode(false)";
					hideButton.innerHTML = "Run";
					hideButton.id = "editButton";
					editBlock_.el.appendChild(hideButton);
					document.getElementById(hideButton.id).addEventListener("click", toggleEditMode, false);*/
				}
			
			
				redrawWindow();
				
			}

			function redrawWindow(clicked, hover) {
				Debug.log("redrawWindow() to " + window.innerWidth + " - " + window.innerHeight);
					
				var _MARGIN = 10;
				var maxWidth = window.innerWidth   - (2 * _MARGIN);
				var maxHeight = window.innerHeight - (2 * _MARGIN);
				
				var hiddenWidth = maxWidth * 0.05;
				var unhiddenWidth = maxWidth * 0.2;
				
				console.log(clicked + "clicked!");
				console.log(fileBlock_.name);
				//DEFAULT VALUES //Sides Hidden
				var fileLeft = _MARGIN, fileTop = _MARGIN, fileWidth = unhiddenWidth                     , fileHeight = maxHeight;
				var editLeft          , editTop = _MARGIN, editWidth = hiddenWidth                       , editHeight = maxHeight;
				var mainLeft          , mainTop = _MARGIN, mainWidth = maxWidth - (fileWidth + editWidth), mainHeight = maxHeight;
				


					
				if(!editBlock_.isHidden)
				{
				
					editWidth += unhiddenWidth;
					mainWidth -= unhiddenWidth;
					var editFrame = document.createElement("iframe");
					editFrame.id = "editFrame";
					editFrame.src = "/WebPath/html/SlowControlsDashboardEdit.html";
					editBlock_.el.appendChild(editFrame);
					
					
					
					window.frames[editFrame.id].document.getElementById("tilesDiv").appendChild();
				}
				
				if(hover)
				{
					//fileBlock_.el.hidden = false;
					fileBlock_.el.style["float"] = "left";
					fileBlock_.el.style["background-color"] = "green";
					
					//mainWidth = mainWidth - unhiddenWidth + hiddenWidth;
					console.log("Hovering!");
				}
				else
				{
					fileWidth = hiddenWidth;
					fileBlock_.el.style["background-color"] = "transparent";
					mainWidth += unhiddenWidth - hiddenWidth;

				}

				
				mainLeft = fileLeft + fileWidth;
				editLeft = mainLeft + mainWidth;				


				
				mainBlock_.el.style.left = mainLeft + "px";
				mainBlock_.el.style.top =  mainTop + "px";
				mainBlock_.el.style.width =  mainWidth + "px";
				mainBlock_.el.style.height =  mainHeight + "px";

				fileBlock_.el.style.left = fileLeft + "px";
				fileBlock_.el.style.top =  fileTop + "px";
			    fileBlock_.el.style.width =  fileWidth + "px";
				fileBlock_.el.style.height =  fileHeight + "px";
				
				
				editBlock_.el.style.left = editLeft + "px";
				editBlock_.el.style.top =  editTop + "px";
				editBlock_.el.style.width =  editWidth + "px";
				editBlock_.el.style.height =  editHeight + "px";
				
				
				

		
			}
			
		</script>
		
	</head>
	
	
	<body onload='Javascript:init();'>	
			
		<div class='mainBlock' id='fileBlock'  onmouseover="redrawWindow(null, true)"></div>
		<div class='mainBlock 'id='mainBlock' onclick=redrawWindow("mainBlock") onmouseover="redrawWindow(null, false)"></div>
		<div class='mainBlock' id='editBlock' onclick=toggleEditMode(true)></div>
				
		
	</body>
	
</html>
